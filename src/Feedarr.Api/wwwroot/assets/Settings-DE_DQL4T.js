import{r as s,j as e}from"./vendor-react-B6j9w5IJ.js";import{a as be,b as os,c as se,h as Ss,t as As,r as Cs,i as ks,L as bs,g as Rs,A as ds,u as Ms}from"./index-CDoNWBDE.js";import{S as ss}from"./SubAction-CMUbNneY.js";import{L as Es}from"./Loader-WjrgZmWo.js";import"./categoryGroups.constants-TqNJ0nIh.js";import{u as Bs,a as Ps,E as Ds}from"./ExternalProviderInstancesSection-Bz4t43Yi.js";import{n as ns,g as ms,i as Ns,a as Ts}from"./appTypes-BSxyKsC5.js";import{T as Pe,I as Ls}from"./ItemRow-BCjaWTF0.js";import{M as he}from"./Modal-nSKvSdtX.js";import{d as ys,c as Is}from"./formatters-CeDqR87H.js";import{u as Os}from"./vendor-router-DbNMZja2.js";import"./vendor-icons-CUZlM7O3.js";import"./uiText-DZWurmTv.js";const ws=r=>new Promise(d=>setTimeout(d,r)),_s=["sonarr","radarr","overseerr","jellyseerr","seer"];function qs(){const[r,d]=s.useState([]),[h,f]=s.useState(!1),[x,S]=s.useState(!1),[w,y]=s.useState("add"),[g,v]=s.useState(null),[m,M]=s.useState("sonarr"),[p,C]=s.useState(""),[a,c]=s.useState(""),[k,_]=s.useState(""),[j,K]=s.useState(!1),[L,b]=s.useState(!1),[n,t]=s.useState(""),[q,D]=s.useState(!1),[R,W]=s.useState(!1),[H,G]=s.useState(null),[B,Q]=s.useState(!1),[J,V]=s.useState(null),[P,I]=s.useState(""),[ae,$]=s.useState(""),[Y,N]=s.useState([]),[T,A]=s.useState("standard"),[me,xe]=s.useState(!0),[Ne,ge]=s.useState("all"),[De,te]=s.useState(!0),[Te,Le]=s.useState(!1),[Ge,Ie]=s.useState("released"),[Qe,re]=s.useState(!0),[Se,we]=s.useState(!1),[Ae,Oe]=s.useState(null),[Je,Ue]=s.useState(!1),[ie,ze]=s.useState(null),[Ze,ne]=s.useState({}),[le,fe]=s.useState(null),[Ce,ke]=s.useState({}),[Re,_e]=s.useState({arrSyncIntervalMinutes:60,arrAutoSyncEnabled:!0,requestIntegrationMode:"arr"}),[Ve,qe]=s.useState([]),[as,Ke]=s.useState(!1),[ts,O]=s.useState(!1),[ce,ee]=s.useState(!1),[Z,$e]=s.useState("arr"),[X,Me]=s.useState(()=>new Set),oe=s.useRef(null),ve=r.some(l=>l.isEnabled&&l.hasApiKey),de=new Set(r.map(l=>String(l.type||"").toLowerCase())),Xe=_s.filter(l=>!de.has(l)),i=Z!==ns(Re?.requestIntegrationMode);s.useEffect(()=>()=>{oe.current&&clearTimeout(oe.current)},[]);const o=s.useCallback(async()=>{f(!0);try{const l=await be("/api/apps");d(Array.isArray(l)?l:[])}catch{d([])}finally{f(!1)}},[]),F=s.useCallback(async()=>{try{const l=await be("/api/settings/general"),E={arrSyncIntervalMinutes:Number(l?.arrSyncIntervalMinutes??60),arrAutoSyncEnabled:l?.arrAutoSyncEnabled!==!1,requestIntegrationMode:ns(l?.requestIntegrationMode)};_e(E),$e(E.requestIntegrationMode)}catch{const l={arrSyncIntervalMinutes:60,arrAutoSyncEnabled:!0,requestIntegrationMode:"arr"};_e(l),$e(l.requestIntegrationMode)}},[]),z=s.useCallback(async()=>{Ke(!0);try{const l=await be("/api/arr/sync/status");qe(Array.isArray(l)?l:[])}catch{qe([])}finally{Ke(!1)}},[]),Fe=s.useCallback(async l=>{Q(!0);try{const E=await be(`/api/apps/${l}/config`);G(E)}catch{G(null)}finally{Q(!1)}},[]),je=s.useCallback(async l=>{O(!0);try{const E=Z!==ns(Re?.requestIntegrationMode),He={...await be("/api/settings/general"),arrSyncIntervalMinutes:l.arrSyncIntervalMinutes,arrAutoSyncEnabled:l.arrAutoSyncEnabled,requestIntegrationMode:ns(l.requestIntegrationMode)},Be=await os("/api/settings/general",He),ye={arrSyncIntervalMinutes:Number(Be?.arrSyncIntervalMinutes??60),arrAutoSyncEnabled:Be?.arrAutoSyncEnabled!==!1,requestIntegrationMode:ns(Be?.requestIntegrationMode)};_e(ye),E||$e(ye.requestIntegrationMode)}catch(E){throw new Error(E?.message||"Erreur sauvegarde paramètres sync")}finally{O(!1)}},[Z,Re]),Ee=s.useCallback(async()=>{if(!i)return;const l={...Re,requestIntegrationMode:Z};await je(l),oe.current&&clearTimeout(oe.current),Me(new Set(["arr.requestIntegrationMode"])),oe.current=setTimeout(()=>{Me(new Set)},1200)},[Z,Re,i,je]),ue=s.useCallback(async()=>{if(ve){ee(!0);try{await se("/api/arr/sync"),await z()}catch(l){throw new Error(l?.message||"Erreur synchronisation")}finally{ee(!1)}}},[z,ve]);function We(){y("add"),v(null),M("sonarr"),C(""),c(""),_(""),K(!1),b(!1),t(""),D(!1),W(!1),V(null),G(null),Q(!1),I(""),$(""),N([]),A("standard"),xe(!0),ge("all"),te(!0),Le(!1),Ie("released"),re(!0)}function es(){We(),y("add"),M(Xe[0]||""),S(!0)}function rs(l){We(),y("edit"),v(l),M(l.type),C(l.name||""),c(l.baseUrl||""),_(""),I(l.rootFolderPath||""),$(l.qualityProfileId?String(l.qualityProfileId):""),N(Array.isArray(l.tags)?l.tags:[]),A(l.seriesType||"standard"),xe(l.seasonFolder!==!1),ge(l.monitorMode||"all"),te(l.searchMissing!==!1),Le(!!l.searchCutoff),Ie(l.minimumAvailability||"released"),re(l.searchForMovie!==!1),S(!0),l.hasApiKey&&Fe(l.id)}function us(){S(!1),We()}async function xs(){if(!(!a.trim()||!k.trim())){K(!0),t(""),b(!1);try{const l=await se(`/api/apps/test?type=${m}`,{baseUrl:a.trim(),apiKey:k.trim()});l?.ok?(b(!0),t("")):t(l?.error||"Test échoué")}catch(l){t(l?.message||"Erreur test connexion")}finally{K(!1)}}}async function gs(){D(!0),t("");try{if(w==="add"&&!m)throw new Error("Aucun type disponible à ajouter");const l={type:m,name:p.trim()||null,baseUrl:a.trim(),rootFolderPath:P||null,qualityProfileId:ae?Number(ae):null,tags:Y.length>0?Y:null};k.trim()&&(l.apiKey=k.trim()),m==="sonarr"?(l.seriesType=T,l.seasonFolder=me,l.monitorMode=Ne,l.searchMissing=De,l.searchCutoff=Te):m==="radarr"&&(l.minimumAvailability=Ge,l.searchForMovie=Qe),w==="add"?await se("/api/apps",l):g&&await os(`/api/apps/${g.id}`,l),us(),await o()}catch(l){t(l?.message||"Erreur sauvegarde")}finally{D(!1)}}function fs(l){Oe(l),we(!0)}function ps(){we(!1),Oe(null)}async function hs(){if(Ae){Ue(!0);try{await Ss(`/api/apps/${Ae.id}`),ps(),await o()}catch(l){throw new Error(l?.message||"Erreur suppression")}finally{Ue(!1)}}}async function vs(l){ze(l),ne(E=>({...E,[l]:"pending"}));try{const E=await se(`/api/apps/${l}/test`);await ws(1500),ne(pe=>({...pe,[l]:E?.ok?"ok":"error"})),setTimeout(()=>{ne(pe=>{const He={...pe};return delete He[l],He})},1600)}catch{ne(E=>({...E,[l]:"error"})),setTimeout(()=>{ne(E=>{const pe={...E};return delete pe[l],pe})},1600)}finally{ze(null)}}async function u(l){if(!l?.id||!l.isEnabled||ie===l.id||ce||Ce[l.id]==="pending")return;const E=Date.now();fe(l.id),ke(pe=>({...pe,[l.id]:"pending"}));try{const pe=await se(`/api/arr/sync/${l.id}`);await z();const He=Date.now()-E,Be=Math.max(2e3-He,0);setTimeout(()=>{ke(ye=>({...ye,[l.id]:pe?.ok?"ok":"error"})),setTimeout(()=>{ke(ye=>{const ls={...ye};return delete ls[l.id],ls})},1600),fe(null)},Be)}catch{const pe=Date.now()-E,He=Math.max(2e3-pe,0);setTimeout(()=>{ke(Be=>({...Be,[l.id]:"error"})),setTimeout(()=>{ke(Be=>{const ye={...Be};return delete ye[l.id],ye})},1600),fe(null)},He)}}async function U(l){try{await os(`/api/apps/${l.id}/enabled`,{enabled:!l.isEnabled}),await o()}catch(E){throw new Error(E?.message||"Erreur activation/désactivation")}}async function is(l){try{await os(`/api/apps/${l}/default`),await o()}catch(E){throw new Error(E?.message||"Erreur définition par défaut")}}return{arrApps:r,arrAppsLoading:h,hasEnabledArrApps:ve,availableAddTypes:Xe,loadArrApps:o,arrSyncSettings:Re,arrSyncStatus:Ve,arrSyncStatusLoading:as,arrSyncSaving:ts,arrSyncing:ce,arrRequestModeDraft:Z,arrPulseKeys:X,isRequestModeDirty:i,setArrSyncSettings:_e,setArrRequestModeDraft:$e,loadArrSyncSettings:F,loadArrSyncStatus:z,saveArrSyncSettings:je,saveArrRequestModeDraft:Ee,triggerArrSync:ue,arrTestingId:ie,arrTestStatusById:Ze,arrSyncingId:le,arrSyncStatusById:Ce,testArrApp:vs,syncArrApp:u,toggleArrEnabled:U,setArrDefault:is,arrModalOpen:x,arrModalMode:w,arrModalApp:g,arrModalType:m,arrModalName:p,arrModalBaseUrl:a,arrModalApiKey:k,arrModalTesting:j,arrModalTested:L,arrModalError:n,arrModalSaving:q,arrModalAdvanced:R,arrModalConfig:H,arrModalConfigLoading:B,arrModalAdvancedInitial:J,arrModalRootFolder:P,arrModalQualityProfile:ae,arrModalTags:Y,arrModalSeriesType:T,arrModalSeasonFolder:me,arrModalMonitorMode:Ne,arrModalSearchMissing:De,arrModalSearchCutoff:Te,arrModalMinAvail:Ge,arrModalSearchForMovie:Qe,setArrModalType:M,setArrModalName:C,setArrModalBaseUrl:c,setArrModalApiKey:_,setArrModalTested:b,setArrModalError:t,setArrModalAdvanced:W,setArrModalAdvancedInitial:V,setArrModalRootFolder:I,setArrModalQualityProfile:$,setArrModalTags:N,setArrModalSeriesType:A,setArrModalSeasonFolder:xe,setArrModalMonitorMode:ge,setArrModalSearchMissing:te,setArrModalSearchCutoff:Le,setArrModalMinAvail:Ie,setArrModalSearchForMovie:re,openArrModalAdd:es,openArrModalEdit:rs,closeArrModal:us,testArrModal:xs,saveArrModal:gs,arrDeleteOpen:Se,arrDeleteApp:Ae,arrDeleteLoading:Je,openArrDelete:fs,closeArrDelete:ps,confirmArrDelete:hs}}function $s(){const[r,d]=s.useState(!1),[h,f]=s.useState(!1),[x,S]=s.useState(!1),[w,y]=s.useState(!1),[g,v]=s.useState(!1),[m,M]=s.useState(!1),[p,C]=s.useState("all"),[a,c]=s.useState(""),[k,_]=s.useState(null),[j,K]=s.useState(!1),[L,b]=s.useState(!1),[n,t]=s.useState(null),[q,D]=s.useState(null),[R,W]=s.useState(!1),[H,G]=s.useState(!1),[B,Q]=s.useState(!1),[J,V]=s.useState(null),[P,I]=s.useState(!1),[ae,$]=s.useState(null),[Y,N]=s.useState(!1),[T,A]=s.useState(!1),[me,xe]=s.useState(null),[Ne,ge]=s.useState(!1),[De,te]=s.useState(null),[Te,Le]=s.useState(!1),[Ge,Ie]=s.useState(!1),[Qe,re]=s.useState(!1),[Se,we]=s.useState(!1),[Ae,Oe]=s.useState([]),[Je,Ue]=s.useState(!1),[ie,ze]=s.useState(""),[Ze,ne]=s.useState(!1),[le,fe]=s.useState(null),[Ce,ke]=s.useState(!1),[Re,_e]=s.useState(!1),[Ve,qe]=s.useState(null),[as,Ke]=s.useState(!1),[ts,O]=s.useState(""),[ce,ee]=s.useState(""),[Z,$e]=s.useState(null),X=!!Z?.needsRestart,Me="Redemarrage requis apres restauration. Action impossible avant redemarrage.",oe=s.useCallback(async()=>{Ue(!0),O("");try{const u=await be("/api/system/backups");Oe(Array.isArray(u)?u:[])}catch(u){O(u?.message||"Erreur chargement backups"),Oe([])}finally{Ue(!1)}},[]),ve=s.useCallback(async()=>{try{const u=await be("/api/system/backups/state");$e(u||null)}catch{}},[]),de=s.useCallback(async()=>{W(!0);try{const u=await be("/api/maintenance/stats");D(u)}catch{D(null)}finally{W(!1)}},[]);async function Xe(u){d(!0);try{await se("/api/posters/cache/clear",{}),As("cache-clear"),f(!1),u&&await u()}catch(U){throw new Error(U?.message||"Erreur vider cache posters")}finally{d(!1)}}async function i(){S(!0);try{await se("/api/activity/purge",{}),y(!1)}catch(u){throw new Error(u?.message||"Erreur purge logs")}finally{S(!1)}}async function o(){M(!0),_(null);try{const u={scope:p},U=parseInt(a,10);U>0&&(u.olderThanDays=U);const is=await se("/api/maintenance/purge-logs",u);_(is),v(!1),de()}catch(u){throw new Error(u?.message||"Erreur purge sélective")}finally{M(!1)}}async function F(){b(!0),t(null);try{const u=await se("/api/maintenance/vacuum",{});t(u),K(!1),de()}catch(u){throw new Error(u?.message||"Erreur optimisation DB")}finally{b(!1)}}async function z(){Q(!0),V(null);try{const u=await se("/api/maintenance/cleanup-posters",{});V(u),G(!1),de()}catch(u){throw new Error(u?.message||"Erreur nettoyage posters")}finally{Q(!1)}}async function Fe(){I(!0),$(null);try{const u=await se("/api/maintenance/test-providers",{});$(u?.results||[])}catch{$([])}finally{I(!1)}}async function je(){A(!0),xe(null);try{const u=await se("/api/maintenance/reparse-titles",{});xe(u),N(!1),de()}catch(u){throw new Error(u?.message||"Erreur re-parsing")}finally{A(!1)}}async function Ee(){ge(!0),te(null);try{const u=await se("/api/maintenance/detect-duplicates",{});te(u)}catch{te(null)}finally{ge(!1)}}async function ue(){Ie(!0);try{const u=await se("/api/maintenance/detect-duplicates?purge=true",{});te(u),Le(!1),de()}catch(u){throw new Error(u?.message||"Erreur purge doublons")}finally{Ie(!1)}}function We(){X||Z?.isBusy||re(!0)}function es(){Se||re(!1)}async function rs(){if(!Z?.isBusy){if(X){O(Me);return}we(!0),O(""),ee("");try{await se("/api/system/backups",{}),re(!1),await oe(),await ve(),ee("Sauvegarde créée avec succès.")}catch(u){O(u?.message||"Erreur sauvegarde")}finally{we(!1)}}}async function us(u){if(X){O(Me);return}ze(u),O(""),ee("");try{const U=await fetch(Cs(`/api/system/backups/${encodeURIComponent(u)}/download`),{method:"GET",credentials:"include"});if(!U.ok){if((U.headers.get("content-type")||"").includes("application/json")){let ye="";try{const ls=await U.json();ye=ls?.error||ls?.message||""}catch{}throw new Error(ye?`HTTP ${U.status} - ${ye}`:`HTTP ${U.status}`)}const He=await U.text(),Be=String(He||"").replace(/\s+/g," ").trim();throw new Error(Be?`HTTP ${U.status} - ${Be.slice(0,180)}`:`HTTP ${U.status}`)}const is=await U.blob(),l=window.URL.createObjectURL(is),E=document.createElement("a");E.href=l,E.download=u,document.body.appendChild(E),E.click(),window.URL.revokeObjectURL(l),document.body.removeChild(E),ee("Téléchargement terminé.")}catch(U){O(U?.message||"Erreur telechargement backup")}finally{ze("")}}function xs(u){X||Z?.isBusy||(fe(u),ne(!0))}function gs(){Ce||(ne(!1),fe(null))}async function fs(){if(le&&!Z?.isBusy){if(X){O(Me);return}ke(!0),O(""),ee("");try{const u=await se(`/api/system/backups/${encodeURIComponent(le.name)}/restore`,{}),U=[];u?.needsRestart?U.push("Restauration terminée. Redémarrage de l'application requis."):U.push("Restauration terminée."),u?.warning&&U.push(u.warning),ee(U.join(" ")),ne(!1),fe(null),await oe(),await ve()}catch(u){O(u?.message||"Erreur restauration backup")}finally{ke(!1)}}}function ps(u){X||Z?.isBusy||(qe(u),_e(!0))}function hs(){_e(!1),qe(null)}async function vs(){if(Ve&&!Z?.isBusy){if(X){O(Me);return}Ke(!0),O(""),ee("");try{await Ss(`/api/system/backups/${encodeURIComponent(Ve.name)}`),hs(),await oe(),await ve(),ee("Sauvegarde supprimée.")}catch(u){O(u?.message||"Erreur suppression backup")}finally{Ke(!1)}}}return{clearCacheLoading:r,clearCacheOpen:h,setClearCacheOpen:f,handleClearCache:Xe,purgeLogsLoading:x,purgeLogsOpen:w,setPurgeLogsOpen:y,handlePurgeLogs:i,purgeSelectiveOpen:g,setPurgeSelectiveOpen:v,purgeSelectiveLoading:m,purgeScope:p,setPurgeScope:C,purgeOlderThanDays:a,setPurgeOlderThanDays:c,purgeSelectiveResult:k,handlePurgeSelective:o,vacuumOpen:j,setVacuumOpen:K,vacuumLoading:L,vacuumResult:n,handleVacuum:F,stats:q,statsLoading:R,loadStats:de,cleanupPostersOpen:H,setCleanupPostersOpen:G,cleanupPostersLoading:B,cleanupPostersResult:J,handleCleanupPosters:z,testProvidersLoading:P,testProvidersResults:ae,handleTestProviders:Fe,reparseOpen:Y,setReparseOpen:N,reparseLoading:T,reparseResult:me,handleReparse:je,duplicatesLoading:Ne,duplicatesResult:De,handleDetectDuplicates:Ee,duplicatesPurgeOpen:Te,setDuplicatesPurgeOpen:Le,duplicatesPurgeLoading:Ge,handlePurgeDuplicates:ue,backups:Ae,backupsLoading:Je,backupError:ts,backupNotice:ce,backupState:Z,loadBackups:oe,loadBackupState:ve,backupCreateOpen:Qe,backupCreateLoading:Se,openBackupCreate:We,closeBackupCreate:es,handleBackupCreate:rs,backupDownloadName:ie,handleBackupDownload:us,backupRestoreOpen:Ze,backupRestoreTarget:le,backupRestoreLoading:Ce,openBackupRestore:xs,closeBackupRestore:gs,handleBackupRestore:fs,backupDeleteOpen:Re,backupDeleteTarget:Ve,backupDeleteLoading:as,openBackupDelete:ps,closeBackupDelete:hs,handleBackupDelete:vs}}function Fs(){const[r,d]=s.useState({authentication:"none",authenticationRequired:"local",username:"",password:"",passwordConfirmation:"",hasPassword:!1}),[h,f]=s.useState({authentication:"none",authenticationRequired:"local",username:""}),[x,S]=s.useState([]),w=JSON.stringify({authentication:r.authentication,authenticationRequired:r.authenticationRequired,username:r.username})!==JSON.stringify(h)||!!r.password||!!r.passwordConfirmation,y=s.useCallback(async()=>{try{const v=await be("/api/settings/security");v&&(d(m=>({...m,authentication:v.authentication||"none",authenticationRequired:v.authenticationRequired||"local",username:v.username||"",hasPassword:!!v.hasPassword,password:"",passwordConfirmation:""})),f({authentication:v.authentication||"none",authenticationRequired:v.authenticationRequired||"local",username:v.username||""}))}catch{}},[]),g=s.useCallback(async()=>{S([]);const v={authentication:r.authentication,authenticationRequired:r.authenticationRequired,username:r.username};(r.password||r.passwordConfirmation)&&(v.password=r.password,v.passwordConfirmation=r.passwordConfirmation);try{await os("/api/settings/security",v),f({authentication:r.authentication,authenticationRequired:r.authenticationRequired,username:r.username}),d(m=>({...m,password:"",passwordConfirmation:""}))}catch(m){if(typeof m?.message=="string"){const M=m.message.toLowerCase(),p=[];M.includes("username")&&p.push("username"),M.includes("password")&&p.push("password","passwordConfirmation"),p.length>0&&S(p)}throw m}},[r]);return{security:r,setSecurity:d,initialSecurity:h,securityErrors:x,isDirty:w,loadSecuritySettings:y,saveSecuritySettings:g}}const Us={general:"Paramètres",ui:"UI",externals:"Métadonnées",applications:"Applications",users:"Sécurité",maintenance:"Maintenance",backup:"Sauvegarde"};function zs(r="general"){const d=r==="general",h=r==="ui",f=r==="externals",x=r==="applications",S=r==="users",w=r==="maintenance",y=r==="backup",g=Us[r]||"Paramètres",[v,m]=s.useState(!0),[M,p]=s.useState(""),[C,a]=s.useState("idle"),[c,k]=s.useState(""),[_,j]=s.useState(""),[K]=s.useState(""),L=Bs(),b=Ps(),n=qs(),t=$s(),q=Fs(),D=s.useRef(L.loadUiSettings),R=s.useRef(L.saveUiSettings),W=s.useRef(b.loadExternalFlags),H=s.useRef(b.loadProviderStats),G=s.useRef(b.saveExternalKeys),B=s.useRef(b.setReleasesCount),Q=s.useRef(q.loadSecuritySettings),J=s.useRef(q.saveSecuritySettings),V=s.useRef(t.loadBackups),P=s.useRef(t.loadBackupState),I=s.useRef(n.loadArrApps),ae=s.useRef(n.loadArrSyncSettings),$=s.useRef(n.loadArrSyncStatus),Y=s.useRef(t.handleClearCache),N=s.useRef(t.handlePurgeLogs),T=s.useRef(t.handleBackupCreate),A=s.useRef(t.handleBackupDownload),me=s.useRef(t.handleBackupRestore),xe=s.useRef(t.handleBackupDelete),Ne=s.useRef(t.loadStats),ge=s.useRef(t.handleVacuum),De=s.useRef(t.handlePurgeSelective),te=s.useRef(t.handleCleanupPosters),Te=s.useRef(t.handleTestProviders),Le=s.useRef(t.handleReparse),Ge=s.useRef(t.handleDetectDuplicates),Ie=s.useRef(t.handlePurgeDuplicates),Qe=s.useRef(n.triggerArrSync),re=s.useRef(n.saveArrSyncSettings),Se=s.useRef(n.saveArrRequestModeDraft),we=s.useRef(n.confirmArrDelete),Ae=s.useRef(n.toggleArrEnabled),Oe=s.useRef(b.confirmExternalDelete),Je=s.useRef(b.confirmExternalToggle);D.current=L.loadUiSettings,R.current=L.saveUiSettings,W.current=b.loadExternalFlags,H.current=b.loadProviderStats,G.current=b.saveExternalKeys,B.current=b.setReleasesCount,Q.current=q.loadSecuritySettings,J.current=q.saveSecuritySettings,V.current=t.loadBackups,P.current=t.loadBackupState,I.current=n.loadArrApps,ae.current=n.loadArrSyncSettings,$.current=n.loadArrSyncStatus,Y.current=t.handleClearCache,N.current=t.handlePurgeLogs,T.current=t.handleBackupCreate,A.current=t.handleBackupDownload,me.current=t.handleBackupRestore,xe.current=t.handleBackupDelete,Ne.current=t.loadStats,ge.current=t.handleVacuum,De.current=t.handlePurgeSelective,te.current=t.handleCleanupPosters,Te.current=t.handleTestProviders,Le.current=t.handleReparse,Ge.current=t.handleDetectDuplicates,Ie.current=t.handlePurgeDuplicates,Qe.current=n.triggerArrSync,re.current=n.saveArrSyncSettings,Se.current=n.saveArrRequestModeDraft,we.current=n.confirmArrDelete,Ae.current=n.toggleArrEnabled,Oe.current=b.confirmExternalDelete,Je.current=b.confirmExternalToggle;const Ue=L.isDirty||q.isDirty||n.isRequestModeDirty,ie=s.useCallback(async()=>{m(!0),p("");try{const o=await be("/api/system/status");B.current(Number(o?.releasesCount??o?.ReleasesCount??0)),await Promise.all([D.current(),W.current(),H.current(),Q.current()])}catch(o){p(o?.message||"Erreur chargement settings")}finally{m(!1)}},[]),ze=s.useCallback(async()=>{p("");const o=Date.now();let F=!1;a("loading");try{if(await R.current(),await G.current(),await J.current(),await Se.current(),typeof window<"u"){const z=String(c||"").trim(),Fe=String(_||"").trim();if(z&&z!==Fe){const{protocol:je,hostname:Ee,pathname:ue,search:We,hash:es}=window.location,rs=`${je}//${Ee}:${z}${ue}${We}${es}`;window.location.assign(rs);return}}F=!0}catch(z){p(z?.message||"Erreur sauvegarde settings")}finally{const z=Date.now()-o;z<1e3&&await ws(1e3-z),a(F?"success":"error"),setTimeout(()=>a("idle"),1e3)}},[c,_]),Ze=s.useCallback(()=>{ie(),x&&(I.current(),ae.current(),$.current()),y&&(V.current(),P.current()),w&&Ne.current()},[ie,x,y,w]),ne=s.useRef(!1);s.useEffect(()=>{ne.current||(ne.current=!0,ie())},[ie]);const le=s.useRef(!1);s.useEffect(()=>{if(!y){le.current=!1;return}le.current||(le.current=!0,V.current(),P.current())},[y]),s.useEffect(()=>{if(!y)return;const o=setInterval(()=>{P.current()},3e3);return()=>clearInterval(o)},[y]);const fe=s.useRef(!1);s.useEffect(()=>{if(!w){fe.current=!1;return}fe.current||(fe.current=!0,Ne.current())},[w]);const Ce=s.useRef(!1);s.useEffect(()=>{if(!x){Ce.current=!1;return}Ce.current||(Ce.current=!0,I.current(),ae.current(),$.current())},[x]),s.useEffect(()=>{if(typeof window>"u")return;const o=window.location.port||(window.location.protocol==="https:"?"443":"80");c||k(o),_||j(o)},[c,_]),s.useEffect(()=>{v||ks(L.ui?.theme)},[L.ui?.theme,v]);const ke=s.useCallback(async()=>{try{await Y.current(ie)}catch(o){p(o?.message||"Erreur")}},[ie]),Re=s.useCallback(async()=>{try{await N.current()}catch(o){p(o?.message||"Erreur")}},[]),_e=s.useCallback(async()=>{try{await ge.current()}catch(o){p(o?.message||"Erreur")}},[]),Ve=s.useCallback(async()=>{try{await De.current()}catch(o){p(o?.message||"Erreur")}},[]),qe=s.useCallback(async()=>{try{await te.current()}catch(o){p(o?.message||"Erreur")}},[]),as=s.useCallback(async()=>{try{await Te.current()}catch(o){p(o?.message||"Erreur")}},[]),Ke=s.useCallback(async()=>{try{await Le.current()}catch(o){p(o?.message||"Erreur")}},[]),ts=s.useCallback(async()=>{try{await Ge.current()}catch(o){p(o?.message||"Erreur")}},[]),O=s.useCallback(async()=>{try{await Ie.current()}catch(o){p(o?.message||"Erreur")}},[]),ce=s.useCallback(async()=>{try{await T.current()}catch(o){p(o?.message||"Erreur")}},[]),ee=s.useCallback(async o=>{try{await A.current(o)}catch(F){p(F?.message||"Erreur")}},[]),Z=s.useCallback(async()=>{try{await me.current()}catch(o){p(o?.message||"Erreur")}},[]),$e=s.useCallback(async()=>{try{await xe.current()}catch(o){p(o?.message||"Erreur")}},[]),X=s.useCallback(async()=>{try{await Qe.current()}catch(o){p(o?.message||"Erreur")}},[]),Me=s.useCallback(async o=>{try{await re.current(o)}catch(F){p(F?.message||"Erreur")}},[]),oe=s.useCallback(async()=>{try{await Se.current()}catch(o){p(o?.message||"Erreur")}},[]),ve=s.useCallback(async()=>{try{await we.current()}catch(o){p(o?.message||"Erreur")}},[]),de=s.useCallback(async o=>{try{await Ae.current(o)}catch(F){p(F?.message||"Erreur")}},[]),Xe=s.useCallback(async()=>{try{await Oe.current()}catch(o){p(o?.message||"Erreur")}},[]),i=s.useCallback(async()=>{try{await Je.current()}catch(o){p(o?.message||"Erreur")}},[]);return{section:r,settingsTitle:g,showGeneral:d,showUi:h,showExternals:f,showApplications:x,showUsers:S,showMaintenance:w,showBackup:y,loading:v,err:M,handleRefresh:Ze,handleSave:ze,saveState:C,isDirty:Ue,openArrModalAdd:n.openArrModalAdd,canAddArrApp:n.availableAddTypes.length>0,openExternalModalAdd:b.openExternalModalAdd,canAddExternalProvider:b.canAddExternalProvider,triggerArrSync:X,arrSyncing:n.arrSyncing,hasEnabledArrApps:n.hasEnabledArrApps,general:{hostPort:c,urlBase:K},ui:{ui:L.ui,setUi:L.setUi,pulseKeys:L.pulseKeys,handleThemeChange:L.handleThemeChange},providers:{...b,confirmExternalDelete:Xe,confirmExternalToggle:i},applications:{arrApps:n.arrApps,arrAppsLoading:n.arrAppsLoading,arrTestingId:n.arrTestingId,arrTestStatusById:n.arrTestStatusById,arrSyncingId:n.arrSyncingId,arrSyncStatusById:n.arrSyncStatusById,arrSyncing:n.arrSyncing,arrSyncSettings:n.arrSyncSettings,arrSyncStatus:n.arrSyncStatus,arrSyncSaving:n.arrSyncSaving,arrRequestModeDraft:n.arrRequestModeDraft,arrPulseKeys:n.arrPulseKeys,isRequestModeDirty:n.isRequestModeDirty,hasEnabledArrApps:n.hasEnabledArrApps,availableAddTypes:n.availableAddTypes,syncArrApp:n.syncArrApp,testArrApp:n.testArrApp,openArrModalEdit:n.openArrModalEdit,openArrDelete:n.openArrDelete,toggleArrEnabled:de,setArrSyncSettings:n.setArrSyncSettings,setArrRequestModeDraft:n.setArrRequestModeDraft,saveArrSyncSettings:Me,saveArrRequestModeDraft:oe,arrModalOpen:n.arrModalOpen,arrModalMode:n.arrModalMode,arrModalApp:n.arrModalApp,arrModalType:n.arrModalType,arrModalName:n.arrModalName,arrModalBaseUrl:n.arrModalBaseUrl,arrModalApiKey:n.arrModalApiKey,arrModalTesting:n.arrModalTesting,arrModalTested:n.arrModalTested,arrModalError:n.arrModalError,arrModalSaving:n.arrModalSaving,arrModalAdvanced:n.arrModalAdvanced,arrModalConfig:n.arrModalConfig,arrModalConfigLoading:n.arrModalConfigLoading,arrModalAdvancedInitial:n.arrModalAdvancedInitial,arrModalRootFolder:n.arrModalRootFolder,arrModalQualityProfile:n.arrModalQualityProfile,arrModalSeriesType:n.arrModalSeriesType,arrModalSeasonFolder:n.arrModalSeasonFolder,arrModalMonitorMode:n.arrModalMonitorMode,arrModalSearchMissing:n.arrModalSearchMissing,arrModalSearchCutoff:n.arrModalSearchCutoff,arrModalMinAvail:n.arrModalMinAvail,arrModalSearchForMovie:n.arrModalSearchForMovie,setArrModalType:n.setArrModalType,setArrModalName:n.setArrModalName,setArrModalBaseUrl:n.setArrModalBaseUrl,setArrModalApiKey:n.setArrModalApiKey,setArrModalTested:n.setArrModalTested,setArrModalError:n.setArrModalError,setArrModalRootFolder:n.setArrModalRootFolder,setArrModalQualityProfile:n.setArrModalQualityProfile,setArrModalSeriesType:n.setArrModalSeriesType,setArrModalSeasonFolder:n.setArrModalSeasonFolder,setArrModalMonitorMode:n.setArrModalMonitorMode,setArrModalSearchMissing:n.setArrModalSearchMissing,setArrModalSearchCutoff:n.setArrModalSearchCutoff,setArrModalMinAvail:n.setArrModalMinAvail,setArrModalSearchForMovie:n.setArrModalSearchForMovie,setArrModalAdvanced:n.setArrModalAdvanced,setArrModalAdvancedInitial:n.setArrModalAdvancedInitial,closeArrModal:n.closeArrModal,testArrModal:n.testArrModal,saveArrModal:n.saveArrModal,arrDeleteOpen:n.arrDeleteOpen,arrDeleteApp:n.arrDeleteApp,arrDeleteLoading:n.arrDeleteLoading,confirmArrDelete:ve,closeArrDelete:n.closeArrDelete},maintenance:{clearCacheLoading:t.clearCacheLoading,clearCacheOpen:t.clearCacheOpen,setClearCacheOpen:t.setClearCacheOpen,handleClearCache:ke,purgeLogsLoading:t.purgeLogsLoading,purgeLogsOpen:t.purgeLogsOpen,setPurgeLogsOpen:t.setPurgeLogsOpen,handlePurgeLogs:Re,purgeSelectiveOpen:t.purgeSelectiveOpen,setPurgeSelectiveOpen:t.setPurgeSelectiveOpen,purgeSelectiveLoading:t.purgeSelectiveLoading,purgeScope:t.purgeScope,setPurgeScope:t.setPurgeScope,purgeOlderThanDays:t.purgeOlderThanDays,setPurgeOlderThanDays:t.setPurgeOlderThanDays,purgeSelectiveResult:t.purgeSelectiveResult,handlePurgeSelective:Ve,vacuumOpen:t.vacuumOpen,setVacuumOpen:t.setVacuumOpen,vacuumLoading:t.vacuumLoading,vacuumResult:t.vacuumResult,handleVacuum:_e,stats:t.stats,statsLoading:t.statsLoading,loadStats:t.loadStats,cleanupPostersOpen:t.cleanupPostersOpen,setCleanupPostersOpen:t.setCleanupPostersOpen,cleanupPostersLoading:t.cleanupPostersLoading,cleanupPostersResult:t.cleanupPostersResult,handleCleanupPosters:qe,testProvidersLoading:t.testProvidersLoading,testProvidersResults:t.testProvidersResults,handleTestProviders:as,reparseOpen:t.reparseOpen,setReparseOpen:t.setReparseOpen,reparseLoading:t.reparseLoading,reparseResult:t.reparseResult,handleReparse:Ke,duplicatesLoading:t.duplicatesLoading,duplicatesResult:t.duplicatesResult,handleDetectDuplicates:ts,duplicatesPurgeOpen:t.duplicatesPurgeOpen,setDuplicatesPurgeOpen:t.setDuplicatesPurgeOpen,duplicatesPurgeLoading:t.duplicatesPurgeLoading,handlePurgeDuplicates:O},backup:{backupCreateOpen:t.backupCreateOpen,backupCreateLoading:t.backupCreateLoading,backups:t.backups,backupsLoading:t.backupsLoading,backupDownloadName:t.backupDownloadName,backupRestoreOpen:t.backupRestoreOpen,backupRestoreTarget:t.backupRestoreTarget,backupRestoreLoading:t.backupRestoreLoading,backupDeleteOpen:t.backupDeleteOpen,backupDeleteTarget:t.backupDeleteTarget,backupDeleteLoading:t.backupDeleteLoading,backupError:t.backupError,backupNotice:t.backupNotice,backupState:t.backupState,loadBackups:t.loadBackups,loadBackupState:t.loadBackupState,openBackupCreate:t.openBackupCreate,closeBackupCreate:t.closeBackupCreate,handleBackupCreate:ce,handleBackupDownload:ee,openBackupRestore:t.openBackupRestore,closeBackupRestore:t.closeBackupRestore,handleBackupRestore:Z,openBackupDelete:t.openBackupDelete,closeBackupDelete:t.closeBackupDelete,handleBackupDelete:$e},users:{security:q.security,setSecurity:q.setSecurity,securityErrors:q.securityErrors}}}function Vs({hostPort:r,urlBase:d}){return e.jsxs("div",{className:"settings-card",id:"host",children:[e.jsx("div",{className:"settings-card__title",children:"Host"}),e.jsxs("div",{className:"indexer-list",children:[e.jsxs("div",{className:"indexer-card",children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Port Number"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"number",value:r,readOnly:!0,disabled:!0,className:"input--readonly"})})]}),e.jsx("div",{className:"settings-help",children:"Configured via server settings (environment variable or appsettings.json)"})]}),e.jsxs("div",{className:"indexer-card",children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"URL Base"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"text",value:d||"(none)",readOnly:!0,disabled:!0,className:"input--readonly"})})]}),e.jsx("div",{className:"settings-help",children:"For reverse proxy support. Configured via server settings."})]})]})]})}const Ks=["2160p","1080p","720p","480p","WEB-DL","BluRay","HDTV"];function Ws({ui:r,setUi:d,pulseKeys:h,handleThemeChange:f}){const[x,S]=s.useState([]),[w,y]=s.useState([]),[g,v]=s.useState([]);s.useEffect(()=>{let a=!0;return(async()=>{try{const[c,k,_]=await Promise.all([be("/api/sources").catch(()=>[]),be("/api/apps").catch(()=>[]),be("/api/categories/stats").catch(()=>({stats:[]}))]);if(!a)return;S(Array.isArray(c)?c:[]),y(Array.isArray(k)?k:[]),v(Array.isArray(_?.stats)?_.stats:[])}catch{if(!a)return;S([]),y([]),v([])}})(),()=>{a=!1}},[]);const m=s.useMemo(()=>(x||[]).filter(a=>Number(a.enabled??1)===1).map(a=>({value:String(a.id??a.sourceId),label:a.name??a.title??`Source ${a.id??a.sourceId}`})),[x]),M=s.useMemo(()=>(g||[]).map(a=>({value:String(a?.key||"").trim().toLowerCase(),label:String(a?.name||a?.key||"").trim(),count:Number(a?.count||0)})).filter(a=>!!a.value).sort((a,c)=>c.count-a.count),[g]),p=s.useMemo(()=>(w||[]).filter(a=>a&&a.id!=null&&a.isEnabled!==!1&&a.hasApiKey!==!1).map(a=>({value:String(a.id),label:a.name||a.title||`${String(a.type||"App").toLowerCase()} ${a.id}`})).sort((a,c)=>a.label.localeCompare(c.label,r?.uiLanguage||"fr-FR",{sensitivity:"base"})),[w,r?.uiLanguage]),C=(a,c)=>`indexer-card${a&&h.has(a)?" pulse-ok":""}${c?"":" is-disabled"}`;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"settings-card",id:"language",children:[e.jsx("div",{className:"settings-card__title",children:"Language"}),e.jsxs("div",{className:"indexer-list",children:[e.jsxs("div",{className:C("ui.mediaInfoLanguage",!0),children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Media Info Language"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("select",{value:r.mediaInfoLanguage||"fr-FR",onChange:a=>d(c=>({...c,mediaInfoLanguage:a.target.value})),children:bs.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})})]}),e.jsx("div",{className:"settings-help",children:"Langue utilisee pour les infos media (TMDB: synopsis, titres, cast)."}),e.jsx("div",{className:"settings-help",style:{color:"#f59e0b"},children:"Rechargement du navigateur requis"})]}),e.jsxs("div",{className:C("ui.uiLanguage",!0),children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"UI Language"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("select",{value:r.uiLanguage||"fr-FR",onChange:a=>d(c=>({...c,uiLanguage:a.target.value})),children:bs.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})})]}),e.jsx("div",{className:"settings-help",children:"Langue de l'interface (formatage dates/heures et preference UI)."}),e.jsx("div",{className:"settings-help",style:{color:"#f59e0b"},children:"Rechargement du navigateur requis"})]})]})]}),e.jsxs("div",{className:"settings-card",id:"theme",children:[e.jsx("div",{className:"settings-card__title",children:"Thème"}),e.jsx("div",{className:`indexer-card${h.has("ui.theme")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Apparence"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.theme||"light",onChange:a=>f(a.target.value),children:[e.jsx("option",{value:"system",children:"Système"}),e.jsx("option",{value:"light",children:"Clair"}),e.jsx("option",{value:"dark",children:"Sombre"})]})})]})})]}),e.jsxs("div",{className:"settings-card",id:"ui",children:[e.jsx("div",{className:"settings-card__title",children:"UI"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:C("ui.hideSeen",!!r.hideSeenByDefault),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:'Marquer "vu" par défaut'}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:r.hideSeenByDefault?"Actif":"Désactivé"}),e.jsx(Pe,{checked:r.hideSeenByDefault,onIonChange:a=>d(c=>({...c,hideSeenByDefault:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:C("ui.showCategories",!!r.showCategories),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Afficher les catégories"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:r.showCategories?"Actif":"Désactivé"}),e.jsx(Pe,{checked:r.showCategories,onIonChange:a=>d(c=>({...c,showCategories:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:C("ui.missingPosterView",!!r.enableMissingPosterView),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Activer Vue Sans poster"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:r.enableMissingPosterView?"Actif":"Désactivé"}),e.jsx(Pe,{checked:r.enableMissingPosterView,onIonChange:a=>d(c=>({...c,enableMissingPosterView:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:C("ui.animations",!!r.animationsEnabled),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Animations de l'interface"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:r.animationsEnabled?"Actif":"Désactivé"}),e.jsx(Pe,{checked:r.animationsEnabled,onIonChange:a=>d(c=>({...c,animationsEnabled:a.detail.checked})),className:"settings-toggle"})]})]})})]})]}),e.jsxs("div",{className:"settings-card",id:"logs",children:[e.jsx("div",{className:"settings-card__title",children:"Logs"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:C(null,!!r.badgeInfo),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Badge pour Info"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:r.badgeInfo?"Actif":"Désactivé"}),e.jsx(Pe,{checked:r.badgeInfo,onIonChange:a=>d(c=>({...c,badgeInfo:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:C(null,!!r.badgeWarn),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Badge pour Warn"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:r.badgeWarn?"Actif":"Désactivé"}),e.jsx(Pe,{checked:r.badgeWarn,onIonChange:a=>d(c=>({...c,badgeWarn:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:C(null,!!r.badgeError),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Badge pour Error"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:r.badgeError?"Actif":"Désactivé"}),e.jsx(Pe,{checked:r.badgeError,onIonChange:a=>d(c=>({...c,badgeError:a.detail.checked})),className:"settings-toggle"})]})]})})]})]}),e.jsxs("div",{className:"settings-card",id:"defaults",children:[e.jsx("div",{className:"settings-card__title",children:"Bibliothèque"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:`indexer-card${h.has("ui.defaultSort")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Tri"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultSort||"date",onChange:a=>d(c=>({...c,defaultSort:a.target.value})),children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"seeders",children:"Seeders"}),e.jsx("option",{value:"downloads",children:"Téléchargé"})]})})]})}),e.jsx("div",{className:`indexer-card${h.has("ui.defaultView")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Vue"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultView||"grid",onChange:a=>d(c=>({...c,defaultView:a.target.value})),children:[e.jsx("option",{value:"grid",children:"Cartes"}),e.jsx("option",{value:"poster",children:"Poster"}),e.jsx("option",{value:"banner",children:"Banner"}),e.jsx("option",{value:"list",children:"Liste"})]})})]})}),e.jsx("div",{className:`indexer-card${h.has("ui.defaultLimit")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Limite"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultLimit??100,onChange:a=>{const c=a.target.value;d(k=>({...k,defaultLimit:c==="0"?0:Number(c)}))},children:[e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"}),e.jsx("option",{value:"200",children:"200"}),e.jsx("option",{value:"500",children:"500"}),e.jsx("option",{value:"0",children:"Tous"})]})})]})})]})]}),e.jsxs("div",{className:"settings-card",id:"filter-defaults",children:[e.jsx("div",{className:"settings-card__title",children:"Filtre"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:`indexer-card${h.has("ui.defaultMaxAgeDays")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Date"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultMaxAgeDays??"",onChange:a=>d(c=>({...c,defaultMaxAgeDays:a.target.value})),children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"1",children:"1 jour"}),e.jsx("option",{value:"2",children:"2 jours"}),e.jsx("option",{value:"3",children:"3 jours"}),e.jsx("option",{value:"7",children:"7 jours"}),e.jsx("option",{value:"15",children:"15 jours"}),e.jsx("option",{value:"30",children:"30 jours"})]})})]})}),e.jsx("div",{className:`indexer-card${h.has("ui.defaultFilterSourceId")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Source"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultFilterSourceId??"",onChange:a=>d(c=>({...c,defaultFilterSourceId:a.target.value})),children:[e.jsx("option",{value:"",children:"Toutes sources"}),m.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})})]})}),e.jsx("div",{className:`indexer-card${h.has("ui.defaultFilterCategoryId")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Catégorie"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultFilterCategoryId??"",onChange:a=>d(c=>({...c,defaultFilterCategoryId:a.target.value})),children:[e.jsx("option",{value:"",children:"Toutes catégories"}),M.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})})]})}),e.jsx("div",{className:`indexer-card${h.has("ui.defaultFilterApplication")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Application"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultFilterApplication??"",onChange:a=>d(c=>({...c,defaultFilterApplication:a.target.value})),children:[e.jsx("option",{value:"",children:"Toutes apps"}),e.jsx("option",{value:"__hide_apps__",children:"Masquer apps"}),p.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})})]})}),e.jsx("div",{className:`indexer-card${h.has("ui.defaultFilterSeen")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Vu"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultFilterSeen??"",onChange:a=>d(c=>({...c,defaultFilterSeen:a.target.value})),children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"1",children:"Vu"}),e.jsx("option",{value:"0",children:"Pas vu"})]})})]})}),e.jsx("div",{className:`indexer-card${h.has("ui.defaultFilterQuality")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Qualité"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.defaultFilterQuality??"",onChange:a=>d(c=>({...c,defaultFilterQuality:a.target.value})),children:[e.jsx("option",{value:"",children:"Toutes qualités"}),Ks.map(a=>e.jsx("option",{value:a,children:a},a))]})})]})})]})]})]})}function Hs({controller:r,posterModalOpen:d,closePosterModal:h}){const{posterCount:f,missingPosterCount:x,releasesCount:S,retroActive:w,retroLoading:y,retroStopLoading:g,retroPercent:v,retroDone:m,retroTotal:M,handleRetroFetch:p,handleRetroFetchStop:C}=r;return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"externals",children:e.jsx(Ds,{controller:r})}),e.jsx(he,{open:d,title:"Posters",onClose:h,width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Posters locaux"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("span",{className:"indexer-status",children:f})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Posters manquants"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("span",{className:"indexer-status",children:Math.max(0,x||0)})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Pourcentage de matching"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("span",{className:"indexer-status",children:[S>0?Math.round((S-(x||0))/S*100):0,"%"]})})]})})]}),e.jsxs("div",{style:{marginTop:16,display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.2,flex:1,minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Recherche des posters manquants via les providers configurés."}),w?e.jsx("button",{className:"btn btn-fixed-danger btn-nohover",type:"button",onClick:C,disabled:g,children:g?"Arrêt...":`Arrêter Retro Fetch (${v??0}% — ${m??0}/${M??0})`}):e.jsx("button",{className:"btn btn-hover-ok",type:"button",onClick:p,disabled:y,children:y?"Lancement...":"Retro Fetch"})]})]})})]})}function Gs({arrApps:r,availableAddTypes:d,arrAppsLoading:h,arrTestingId:f,arrTestStatusById:x,arrSyncingId:S,arrSyncStatusById:w,arrSyncing:y,arrSyncSettings:g,arrSyncStatus:v,arrSyncSaving:m,arrRequestModeDraft:M,arrPulseKeys:p,isRequestModeDirty:C,hasEnabledArrApps:a,syncArrApp:c,testArrApp:k,openArrModalEdit:_,openArrDelete:j,toggleArrEnabled:K,setArrSyncSettings:L,setArrRequestModeDraft:b,saveArrSyncSettings:n,optionsModalOpen:t,closeOptionsModal:q,arrModalOpen:D,arrModalMode:R,arrModalApp:W,arrModalType:H,arrModalName:G,arrModalBaseUrl:B,arrModalApiKey:Q,arrModalTesting:J,arrModalTested:V,arrModalError:P,arrModalSaving:I,arrModalAdvanced:ae,arrModalConfig:$,arrModalConfigLoading:Y,arrModalAdvancedInitial:N,arrModalRootFolder:T,arrModalQualityProfile:A,arrModalSeriesType:me,arrModalSeasonFolder:xe,arrModalMonitorMode:Ne,arrModalSearchMissing:ge,arrModalSearchCutoff:De,arrModalMinAvail:te,arrModalSearchForMovie:Te,setArrModalType:Le,setArrModalName:Ge,setArrModalBaseUrl:Ie,setArrModalApiKey:Qe,setArrModalTested:re,setArrModalError:Se,setArrModalRootFolder:we,setArrModalQualityProfile:Ae,setArrModalSeriesType:Oe,setArrModalSeasonFolder:Je,setArrModalMonitorMode:Ue,setArrModalSearchMissing:ie,setArrModalSearchCutoff:ze,setArrModalMinAvail:Ze,setArrModalSearchForMovie:ne,setArrModalAdvanced:le,setArrModalAdvancedInitial:fe,closeArrModal:Ce,testArrModal:ke,saveArrModal:Re,arrDeleteOpen:_e,arrDeleteApp:Ve,arrDeleteLoading:qe,confirmArrDelete:as,closeArrDelete:Ke}){const ts=(r||[]).length>0,O=(d||[]).length===0,[ce,ee]=s.useState(null),[Z,$e]=s.useState(()=>new Set),X=s.useRef(null),Me=s.useRef(!1);s.useEffect(()=>{t&&!Me.current&&ee({arrAutoSyncEnabled:!!g.arrAutoSyncEnabled,arrSyncIntervalMinutes:Number(g.arrSyncIntervalMinutes??60)}),Me.current=t},[t,g.arrAutoSyncEnabled,g.arrSyncIntervalMinutes]),s.useEffect(()=>()=>{X.current&&clearTimeout(X.current)},[]);const oe=s.useMemo(()=>ce?!!g.arrAutoSyncEnabled!==ce.arrAutoSyncEnabled||Number(g.arrSyncIntervalMinutes??60)!==ce.arrSyncIntervalMinutes:!1,[g.arrAutoSyncEnabled,g.arrSyncIntervalMinutes,ce]),ve=C||oe,de=i=>Z.has(i)?" pulse-ok":"";async function Xe(){if(!ve||m)return;const i=new Set;C&&i.add("arr.requestIntegrationMode"),ce&&(!!g.arrAutoSyncEnabled!==ce.arrAutoSyncEnabled&&i.add("arr.arrAutoSyncEnabled"),Number(g.arrSyncIntervalMinutes??60)!==ce.arrSyncIntervalMinutes&&i.add("arr.arrSyncIntervalMinutes")),await n({...g,requestIntegrationMode:M}),i.size>0&&(X.current&&clearTimeout(X.current),$e(new Set(i)),X.current=setTimeout(()=>{$e(new Set)},1200)),ee({arrAutoSyncEnabled:!!g.arrAutoSyncEnabled,arrSyncIntervalMinutes:Number(g.arrSyncIntervalMinutes??60)})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"indexer-list itemrow-grid",children:h?e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:"Chargement..."})})}):r.length===0?e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:"Aucune application configurée"})})}):r.map((i,o)=>{const F=ms(i.type),z=x[i.id],Fe=w[i.id],je=f===i.id,Ee=S===i.id||Fe==="pending",ue=je||Ee||y,We=[z==="ok"&&"test-ok",z==="error"&&"test-err",Fe==="ok"&&"sync-ok",Fe==="error"&&"sync-err"].filter(Boolean).join(" "),es=[{label:F},{label:i.hasApiKey?"API OK":"NO KEY",className:i.hasApiKey?"pill-ok":"pill-warn"}];return i.isDefault&&es.push({label:"Par défaut",className:"pill--accent"}),e.jsx(Ls,{id:o+1,title:i.name||F,meta:i.baseUrl||"",enabled:i.isEnabled,statusClass:We,badges:es,actions:[{icon:"sync",title:Ee?"Sync en cours...":"Sync",onClick:()=>c(i),disabled:ue||!i.isEnabled,spinning:Ee},{icon:"science",title:je?"Test en cours...":"Test",onClick:()=>k(i.id),disabled:ue||!i.isEnabled,spinning:je},{icon:"edit",title:"Modifier",onClick:()=>_(i),disabled:ue||!i.isEnabled},{icon:"delete",title:"Supprimer",onClick:()=>j(i),disabled:ue||!i.isEnabled,className:"iconbtn--danger"}],showToggle:!0,onToggle:()=>K(i),toggleDisabled:ue},i.id)})}),e.jsx(he,{open:t,title:"Options applications",onClose:q,width:560,children:e.jsx("div",{style:{padding:12},children:ts?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"settings-card",id:"request-integration",children:[e.jsx("div",{className:"settings-card__title",children:"Mode d'envoi"}),e.jsx("div",{className:"indexer-list",children:e.jsx("div",{className:`indexer-card${p?.has("arr.requestIntegrationMode")?" pulse-ok":""}${de("arr.requestIntegrationMode")}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Intégration active"}),e.jsxs("div",{className:"indexer-actions",children:[C&&e.jsx("span",{className:"indexer-status",children:"À sauvegarder"}),e.jsxs("select",{value:M,onChange:i=>b(ns(i.target.value)),disabled:m,children:[e.jsx("option",{value:"arr",children:"Sonarr/Radarr"}),e.jsx("option",{value:"overseerr",children:"Overseerr"}),e.jsx("option",{value:"jellyseerr",children:"Jellyseerr"}),e.jsx("option",{value:"seer",children:"Seer"})]})]})]})})})]}),e.jsxs("div",{className:"settings-card",id:"arr-sync",style:{marginTop:16},children:[e.jsx("div",{className:"settings-card__title",children:"Synchronisation"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:`indexer-card${de("arr.arrAutoSyncEnabled")}${a?"":" is-disabled"}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Synchronisation Automatique"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:g.arrAutoSyncEnabled?"Actif":"Desactive"}),e.jsx(Pe,{checked:g.arrAutoSyncEnabled,onIonChange:i=>{const o=i.detail.checked,F={...g,arrAutoSyncEnabled:o};L(F)},className:"settings-toggle",disabled:!a||m})]})]})}),e.jsx("div",{className:`indexer-card${de("arr.arrSyncIntervalMinutes")}${!a||!g.arrAutoSyncEnabled?" is-disabled":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Intervalle Sync (minutes)"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"number",min:1,max:1440,value:g.arrSyncIntervalMinutes,onChange:i=>{const o=Math.max(1,Math.min(1440,Number(i.target.value)||10));L(F=>({...F,arrSyncIntervalMinutes:o}))},disabled:!g.arrAutoSyncEnabled||!a})})]})})]}),v.length>0&&e.jsxs("div",{className:"indexer-list",style:{marginTop:16},children:[e.jsx("div",{className:"settings-card__title",style:{fontSize:14,marginBottom:8},children:"État de synchronisation"}),v.map(i=>{const o=!!i.lastError;let F="Jamais";if(i.lastSyncAt){const z=new Date(i.lastSyncAt),Fe=new Date,je=z.toDateString()===Fe.toDateString(),Ee=Rs(),ue=z.toLocaleTimeString(Ee,{hour:"2-digit",minute:"2-digit"});je?F=ue:F=`${z.toLocaleDateString(Ee,{day:"2-digit",month:"2-digit"})} ${ue}`}return e.jsxs("div",{className:`indexer-card ${i.isEnabled?"":"is-disabled"}`,children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:`dot ${o?"warn":i.isEnabled?"ok":"off"}`}),e.jsxs("span",{className:"indexer-title",children:[i.appName||`App ${i.appId}`,e.jsxs("span",{className:"muted",style:{marginLeft:8,fontSize:12},children:["(",ms(i.appType),")"]})]}),e.jsxs("div",{className:"indexer-actions",children:[e.jsxs("span",{className:"indexer-url muted",children:["Dernier sync: ",F]}),i.lastSyncCount>0&&e.jsxs("span",{className:"pill",children:[i.lastSyncCount," ",Ns(i.appType)?"items":"demandes"]}),o&&e.jsx("span",{className:"pill pill-warn",children:"Erreur"})]})]}),o&&e.jsx("div",{className:"settings-help",style:{color:"var(--color-warn)"},children:i.lastError})]},i.appId)})]})]}),ve&&e.jsx("div",{className:"formactions",style:{marginTop:16},children:e.jsx("button",{className:"btn btn-accent",type:"button",onClick:Xe,disabled:m,children:m?"Enregistrement...":"Enregistrer"})})]}):e.jsx("div",{className:"muted",children:"Aucune application configurée."})})}),e.jsx(he,{open:D,title:R==="add"?"Ajouter une application":`Modifier : ${W?.name||W?.type||"Application"}`,onClose:Ce,width:560,children:e.jsxs("div",{style:{padding:12},children:[R==="add"&&e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Type"}),e.jsxs("select",{value:H,onChange:i=>{Le(i.target.value),re(!1),Se("")},disabled:J||I,children:[O&&e.jsx("option",{value:"",children:"Aucun type disponible"}),(d||[]).map(i=>e.jsx("option",{value:i,children:ms(i)},i))]})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Nom (optionnel)"}),e.jsx("input",{type:"text",value:G,onChange:i=>Ge(i.target.value),placeholder:`Mon ${ms(H)}`,disabled:J||I})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"URL"}),e.jsx("input",{type:"text",value:B,onChange:i=>{Ie(i.target.value),re(!1),Se("")},placeholder:Ts(H),disabled:J||I}),e.jsx("span",{className:"field-hint",children:"IP, hostname ou URL reverse proxy (http/https)"})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsxs("label",{className:"muted",children:["Clé API",R==="edit"&&W?.hasApiKey&&e.jsx("span",{style:{fontStyle:"italic",marginLeft:6},children:"(laisser vide pour conserver)"})]}),e.jsx("input",{type:"password",value:Q,onChange:i=>{Qe(i.target.value),re(!1),Se("")},placeholder:R==="edit"&&W?.hasApiKey?"••••••••••••••••":"Entrez la clé API",disabled:J||I})]}),P&&e.jsx("div",{className:"onboarding__error",style:{marginBottom:12},children:P}),V&&e.jsx("div",{className:"onboarding__ok",style:{marginBottom:12},children:"Connexion réussie ! Vous pouvez enregistrer."}),R==="add"&&!V&&e.jsx("div",{className:"muted",style:{marginBottom:12},children:O?"Toutes les applications sont déjà ajoutées.":"Testez d'abord la connexion avant d'enregistrer."}),e.jsxs("div",{className:"formactions",children:[R==="add"&&!V?e.jsx("button",{className:"btn btn-accent",type:"button",onClick:ke,disabled:O||!B.trim()||!Q.trim()||J,children:J?e.jsxs(e.Fragment,{children:[e.jsx(ds,{name:"progress_activity",className:"iconbtn--spin",size:16,style:{marginRight:6}}),"Test en cours..."]}):"Tester"}):e.jsxs(e.Fragment,{children:[Ns(H)&&e.jsx("button",{className:"btn",type:"button",onClick:()=>{fe({rootFolder:T,qualityProfile:A,seriesType:me,seasonFolder:xe,monitorMode:Ne,searchMissing:ge,searchCutoff:De,minAvail:te,searchForMovie:Te}),le(!0)},disabled:I,children:"Options avancées"}),e.jsx("button",{className:"btn btn-accent",type:"button",onClick:Re,disabled:I||!B.trim()||R==="add"&&(O||!Q.trim()),children:I?e.jsxs(e.Fragment,{children:[e.jsx(ds,{name:"progress_activity",className:"iconbtn--spin",size:16,style:{marginRight:6}}),"Enregistrement..."]}):"Enregistrer"})]}),e.jsx("button",{className:"btn",type:"button",onClick:Ce,disabled:J||I,children:"Annuler"})]})]})}),e.jsx(he,{open:ae,title:"Options avancées",onClose:()=>le(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[Y?e.jsxs("div",{className:"muted",style:{textAlign:"center",padding:20},children:[e.jsx(ds,{name:"progress_activity",className:"iconbtn--spin",size:24}),e.jsx("div",{style:{marginTop:8},children:"Chargement de la configuration..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Dossier racine"}),$?.rootFolders?.length>0?e.jsxs("select",{value:T,onChange:i=>we(i.target.value),children:[e.jsx("option",{value:"",children:"-- Sélectionner --"}),$.rootFolders.map(i=>e.jsxs("option",{value:i.path,children:[i.path," (",ys(i.freeSpace)," libre)"]},i.id))]}):e.jsx("input",{type:"text",value:T,onChange:i=>we(i.target.value),placeholder:"/media/series"})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Profil qualité"}),$?.qualityProfiles?.length>0?e.jsxs("select",{value:A,onChange:i=>Ae(i.target.value),children:[e.jsx("option",{value:"",children:"-- Sélectionner --"}),$.qualityProfiles.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}):e.jsx("input",{type:"number",value:A,onChange:i=>Ae(i.target.value),placeholder:"ID du profil"})]}),H==="sonarr"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Type de série"}),e.jsxs("select",{value:me,onChange:i=>Oe(i.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"anime",children:"Anime"})]})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Mode de surveillance"}),e.jsxs("select",{value:Ne,onChange:i=>Ue(i.target.value),children:[e.jsx("option",{value:"all",children:"Tous les épisodes"}),e.jsx("option",{value:"future",children:"Futurs épisodes"}),e.jsx("option",{value:"missing",children:"Épisodes manquants"}),e.jsx("option",{value:"existing",children:"Épisodes existants"}),e.jsx("option",{value:"firstSeason",children:"Première saison"}),e.jsx("option",{value:"lastSeason",children:"Dernière saison"}),e.jsx("option",{value:"pilot",children:"Pilote"}),e.jsx("option",{value:"none",children:"Aucun"})]})]}),e.jsx("div",{className:"indexer-card",style:{marginBottom:8},children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Dossiers par saison"}),e.jsx("div",{className:"indexer-actions",children:e.jsx(Pe,{checked:xe,onIonChange:i=>Je(i.detail.checked),className:"settings-toggle"})})]})}),e.jsx("div",{className:"indexer-card",style:{marginBottom:8},children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Rechercher épisodes manquants"}),e.jsx("div",{className:"indexer-actions",children:e.jsx(Pe,{checked:ge,onIonChange:i=>ie(i.detail.checked),className:"settings-toggle"})})]})}),e.jsx("div",{className:"indexer-card",style:{marginBottom:8},children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Rechercher cutoff non atteint"}),e.jsx("div",{className:"indexer-actions",children:e.jsx(Pe,{checked:De,onIonChange:i=>ze(i.detail.checked),className:"settings-toggle"})})]})})]}),H==="radarr"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Disponibilité minimale"}),e.jsxs("select",{value:te,onChange:i=>Ze(i.target.value),children:[e.jsx("option",{value:"announced",children:"Annoncé"}),e.jsx("option",{value:"inCinemas",children:"En salle"}),e.jsx("option",{value:"released",children:"Sorti"})]})]}),e.jsx("div",{className:"indexer-card",style:{marginBottom:8},children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Rechercher le film à l'ajout"}),e.jsx("div",{className:"indexer-actions",children:e.jsx(Pe,{checked:Te,onIonChange:i=>ne(i.detail.checked),className:"settings-toggle"})})]})})]})]}),e.jsxs("div",{className:"formactions",style:{marginTop:16},children:[e.jsx("button",{className:"btn btn-accent",type:"button",onClick:()=>le(!1),disabled:N&&T===N.rootFolder&&A===N.qualityProfile&&me===N.seriesType&&xe===N.seasonFolder&&Ne===N.monitorMode&&ge===N.searchMissing&&De===N.searchCutoff&&te===N.minAvail&&Te===N.searchForMovie,children:"Enregistrer"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>{N&&(we(N.rootFolder),Ae(N.qualityProfile),Oe(N.seriesType),Je(N.seasonFolder),Ue(N.monitorMode),ie(N.searchMissing),ze(N.searchCutoff),Ze(N.minAvail),ne(N.searchForMovie)),le(!1)},children:"Retour"})]})]})}),e.jsx(he,{open:_e,title:"Supprimer l'application",onClose:Ke,width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer la suppression ?"}),e.jsxs("div",{className:"muted",style:{marginBottom:12},children:["Cette action va supprimer l'application"," ",e.jsx("strong",{children:Ve?.name||Ve?.type||"-"}),".",e.jsx("br",{}),"Cette action est définitive."]}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn btn-danger",type:"button",onClick:as,disabled:qe,children:qe?"Suppression...":"Supprimer"}),e.jsx("button",{className:"btn",type:"button",onClick:Ke,disabled:qe,children:"Annuler"})]})]})})]})}function Qs(r){if(!r||r<=0)return"0s";const d=Math.floor(r/86400),h=Math.floor(r%86400/3600),f=Math.floor(r%3600/60);return d>0?`${d}j ${h}h ${f}m`:h>0?`${h}h ${f}m`:`${f}m`}function Ye(){return e.jsx(ds,{name:"progress_activity",className:"iconbtn--spin",size:14,style:{marginRight:6,verticalAlign:"middle"}})}function cs({label:r,description:d,buttonLabel:h,loadingLabel:f,loading:x,disabled:S,onClick:w,result:y}){return e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsxs("div",{children:[e.jsx("span",{className:"indexer-title",children:r}),d&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:2},children:d}),y&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:4,color:"var(--success, #4caf50)"},children:y})]}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("button",{className:"btn",type:"button",onClick:w,disabled:x||S,children:[x&&e.jsx(Ye,{}),x?f||"...":h||"Exécuter"]})})]})})}function Js({clearCacheOpen:r,clearCacheLoading:d,setClearCacheOpen:h,handleClearCache:f,purgeSelectiveOpen:x,setPurgeSelectiveOpen:S,purgeSelectiveLoading:w,purgeScope:y,setPurgeScope:g,purgeOlderThanDays:v,setPurgeOlderThanDays:m,purgeSelectiveResult:M,handlePurgeSelective:p,vacuumOpen:C,setVacuumOpen:a,vacuumLoading:c,vacuumResult:k,handleVacuum:_,stats:j,statsLoading:K,cleanupPostersOpen:L,setCleanupPostersOpen:b,cleanupPostersLoading:n,cleanupPostersResult:t,handleCleanupPosters:q,testProvidersLoading:D,testProvidersResults:R,handleTestProviders:W,reparseOpen:H,setReparseOpen:G,reparseLoading:B,reparseResult:Q,handleReparse:J,duplicatesLoading:V,duplicatesResult:P,handleDetectDuplicates:I,duplicatesPurgeOpen:ae,setDuplicatesPurgeOpen:$,duplicatesPurgeLoading:Y,handlePurgeDuplicates:N}){const T=d||w||c||n||D||B||V||Y;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"settings-card settings-card--full",id:"maintenance",children:[e.jsx("div",{className:"settings-card__title",children:"Actions de maintenance"}),e.jsx(cs,{label:"Supprimer tous les posters en cache",description:"Supprime tous les posters téléchargés localement",loading:d,loadingLabel:"Suppression...",onClick:()=>h(!0),disabled:T||j&&j.posterCount===0}),e.jsx(cs,{label:"Purger logs",description:"Supprime les logs d'activité (tous, historique ou logs uniquement)",loading:w,loadingLabel:"Suppression...",onClick:()=>S(!0),disabled:T||j&&j.activityCount===0,result:M?.deleted>=0?`${M.deleted} entrées supprimées`:null}),e.jsx(cs,{label:"Optimiser la base de données",description:"Compacte la base SQLite (VACUUM) pour récupérer de l'espace",loading:c,loadingLabel:"Optimisation...",onClick:()=>a(!0),disabled:T,result:k?`${k.dbSizeBefore} MB → ${k.dbSizeAfter} MB (${k.savedMB} MB récupérés)`:null}),e.jsx(cs,{label:"Nettoyer posters orphelins",description:"Supprime les fichiers de posters non référencés en base",loading:n,loadingLabel:"Nettoyage...",onClick:()=>b(!0),disabled:T||j&&j.orphanedPosterCount===0,result:t?`${t.deleted} supprimés / ${t.scanned} scannés (${ys(t.freedBytes)||"0 B"} libérés)`:null}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsxs("div",{children:[e.jsx("span",{className:"indexer-title",children:"Tester connectivité providers"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:2},children:"Vérifie la connexion TMDB, TvMaze, Fanart, IGDB"}),R&&e.jsx("div",{style:{marginTop:6,display:"flex",gap:12,flexWrap:"wrap"},children:R.map(A=>e.jsxs("span",{style:{fontSize:12,padding:"2px 8px",borderRadius:4,background:A.ok?"var(--success-bg, rgba(76,175,80,0.15))":"var(--danger-bg, rgba(244,67,54,0.15))",color:A.ok?"var(--success, #4caf50)":"var(--danger, #f44336)"},children:[A.provider.toUpperCase()," ",A.ok?"OK":"ERREUR"," (",A.elapsedMs,"ms)"]},A.provider))})]}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("button",{className:"btn",type:"button",onClick:W,disabled:D||T,children:[D&&e.jsx(Ye,{}),D?"Test...":"Tester"]})})]})}),e.jsx(cs,{label:"Re-parser les titres",description:"Recalcule les métadonnées de toutes les releases (titre, saison, résolution...)",loading:B,loadingLabel:"Re-parsing...",onClick:()=>G(!0),disabled:T||j&&j.releasesCount===0,result:Q?`${Q.updated} / ${Q.total} releases mises à jour`:null}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsxs("div",{children:[e.jsx("span",{className:"indexer-title",children:"Détecter les doublons"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:2},children:"Identifie et supprime les releases en double par source"}),P&&!P.purged&&e.jsxs("div",{className:"muted",style:{fontSize:12,marginTop:4,color:"var(--warning, #ff9800)"},children:[P.groupsFound," groupes, ",P.duplicatesCount," doublons détectés"]}),P?.purged&&e.jsxs("div",{className:"muted",style:{fontSize:12,marginTop:4,color:"var(--success, #4caf50)"},children:[P.deleted," doublons supprimés"]})]}),e.jsxs("div",{className:"indexer-actions",style:{display:"flex",gap:6},children:[e.jsxs("button",{className:"btn",type:"button",onClick:I,disabled:V||T,children:[V&&e.jsx(Ye,{}),V?"Analyse...":"Analyser"]}),P&&P.duplicatesCount>0&&!P.purged&&e.jsx("button",{className:"btn btn-danger",type:"button",onClick:()=>$(!0),disabled:Y||T,children:"Purger"})]})]})})]}),e.jsxs("div",{className:"settings-card settings-card--full",id:"maintenance-stats",children:[e.jsx("div",{className:"settings-card__title",children:"Statistiques"}),K&&e.jsx("div",{className:"muted",style:{padding:"8px 0"},children:"Chargement..."}),!K&&j&&e.jsxs("div",{className:"stats-table table",children:[e.jsxs("div",{className:"thead",children:[e.jsx("div",{className:"th",children:"Métrique"}),e.jsx("div",{className:"th td-value",children:"Valeur"})]}),[["Releases en base",j.releasesCount?.toLocaleString()??"—"],["Sources",`${j.activeSourcesCount??0} actives / ${j.sourcesCount??0} total`],["Taille base de données",`${j.dbSizeMB??0} MB`],["Posters en cache",`${j.posterCount??0} (${j.posterSizeMB??0} MB)`],["Posters manquants",j.missingPosterCount?.toLocaleString()??"0"],["Posters orphelins",j.orphanedPosterCount?.toLocaleString()??"0"],["Cache de matching",`${j.matchCacheCount?.toLocaleString()??0} entrées`],["Entités média",j.mediaEntityCount?.toLocaleString()??"0"],["Doublons détectés",j.duplicateCount?.toLocaleString()??"0"],["Logs d'activité",j.activityCount?.toLocaleString()??"0"],["Uptime serveur",Qs(j.uptimeSeconds)]].map(([A,me])=>e.jsxs("div",{className:"trow",children:[e.jsx("div",{className:"td",children:A}),e.jsx("div",{className:"td td-value",children:me})]},A)),j.releasesPerCategory?.length>0&&e.jsxs("div",{className:"trow",children:[e.jsx("div",{className:"td",children:"Par catégorie"}),e.jsx("div",{className:"td td-categories",children:j.releasesPerCategory.map(A=>e.jsxs("span",{className:"cat-bubble",children:[A.category,": ",A.count]},A.category))})]})]})]}),e.jsx(he,{open:r,title:"Supprimer tous les posters en cache",onClose:()=>h(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer la suppression ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action va supprimer tous les posters téléchargés localement. Elle ne nettoie pas uniquement les orphelins. Ils seront re-téléchargés automatiquement lors du prochain affichage."}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-danger",type:"button",onClick:f,disabled:d,children:[d&&e.jsx(Ye,{}),d?"Suppression...":"Confirmer"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>h(!1),disabled:d,children:"Annuler"})]})]})}),e.jsx(he,{open:x,title:"Purger les logs",onClose:()=>S(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Options de purge"}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",style:{display:"block",marginBottom:4},children:"Scope"}),e.jsxs("select",{value:y,onChange:A=>g(A.target.value),style:{width:"100%"},children:[e.jsx("option",{value:"all",children:"Tous les logs"}),e.jsx("option",{value:"history",children:"Historique (sync uniquement)"}),e.jsx("option",{value:"logs",children:"Logs (hors sync)"})]})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",style:{display:"block",marginBottom:4},children:"Plus vieux que (jours) — laisser vide pour tout supprimer"}),e.jsx("input",{type:"number",min:"1",placeholder:"ex: 30",value:v,onChange:A=>m(A.target.value),style:{width:"100%"}})]}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-danger",type:"button",onClick:p,disabled:w,children:[w&&e.jsx(Ye,{}),w?"Suppression...":"Purger"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>S(!1),disabled:w,children:"Annuler"})]})]})}),e.jsx(he,{open:C,title:"Optimiser la base de données",onClose:()=>a(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer l'optimisation ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action exécute un VACUUM SQLite pour compacter la base de données et récupérer l'espace disque. L'opération peut prendre quelques secondes."}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-accent",type:"button",onClick:_,disabled:c,children:[c&&e.jsx(Ye,{}),c?"Optimisation...":"Confirmer"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>a(!1),disabled:c,children:"Annuler"})]})]})}),e.jsx(he,{open:L,title:"Nettoyer les posters orphelins",onClose:()=>b(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer le nettoyage ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action va scanner le dossier de posters et supprimer les fichiers qui ne sont plus référencés par aucune release en base. Cette action est définitive."}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-danger",type:"button",onClick:q,disabled:n,children:[n&&e.jsx(Ye,{}),n?"Nettoyage...":"Confirmer"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>b(!1),disabled:n,children:"Annuler"})]})]})}),e.jsx(he,{open:H,title:"Re-parser les titres",onClose:()=>G(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer le re-parsing ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action va re-parser tous les titres de releases pour recalculer les métadonnées (titre nettoyé, saison, épisode, résolution, codec, etc.). Utile après une mise à jour du parser. L'opération peut prendre un moment selon le nombre de releases."}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-accent",type:"button",onClick:J,disabled:B,children:[B&&e.jsx(Ye,{}),B?"Re-parsing...":"Confirmer"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>G(!1),disabled:B,children:"Annuler"})]})]})}),e.jsx(he,{open:ae,title:"Purger les doublons",onClose:()=>$(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer la suppression des doublons ?"}),e.jsxs("div",{className:"muted",style:{marginBottom:12},children:["Cette action va supprimer ",P?.duplicatesCount??0," releases en double. Pour chaque groupe de doublons, seule la release la plus récente sera conservée. Cette action est définitive."]}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-danger",type:"button",onClick:N,disabled:Y,children:[Y&&e.jsx(Ye,{}),Y?"Suppression...":"Purger"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>$(!1),disabled:Y,children:"Annuler"})]})]})})]})}function js({icon:r,title:d,onClick:h,disabled:f,className:x,spinning:S}){return e.jsx("button",{className:`iconbtn${x?` ${x}`:""}${S?" iconbtn--spin":""}`,onClick:h,disabled:f,title:d,style:{flexShrink:0},children:e.jsx(ds,{name:S?"progress_activity":r})})}function Ys({backupCreateOpen:r,backupCreateLoading:d,backups:h,backupsLoading:f,backupDownloadName:x,backupRestoreOpen:S,backupRestoreTarget:w,backupRestoreLoading:y,backupDeleteOpen:g,backupDeleteTarget:v,backupDeleteLoading:m,backupError:M,backupNotice:p,backupState:C,closeBackupCreate:a,handleBackupCreate:c,handleBackupDownload:k,openBackupRestore:_,closeBackupRestore:j,handleBackupRestore:K,openBackupDelete:L,closeBackupDelete:b,handleBackupDelete:n}){const t=!!C?.isBusy,q=!!C?.needsRestart,D=q||t||d||y||m||!!x;return e.jsxs(e.Fragment,{children:[M&&e.jsx("div",{className:"onboarding__error",style:{marginBottom:12,gridColumn:"1 / -1"},children:M}),p&&e.jsx("div",{className:"onboarding__ok",style:{marginBottom:12,gridColumn:"1 / -1"},children:p}),q&&e.jsx("div",{className:"onboarding__warn",style:{marginBottom:12,gridColumn:"1 / -1"},children:"Redemarrage requis apres restauration. Les actions de sauvegarde sont verrouillees jusqu'au redemarrage."}),t&&e.jsxs("div",{className:"onboarding__warn",style:{marginBottom:12,gridColumn:"1 / -1"},children:["Opération en cours: ",e.jsx("strong",{children:C?.operation||"backup"})," (",C?.phase||"running","). Les actions de sauvegarde sont temporairement verrouillées."]}),e.jsx("div",{className:"indexer-list",style:{gridColumn:"1 / -1"},children:f?e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:"Chargement..."})})}):h.length===0?e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:"Aucune sauvegarde présente"})})}):h.map((R,W)=>{const H=ys(R?.sizeBytes??R?.size_bytes??0)||"-",G=Is(R?.createdAtTs??R?.created_at_ts??0)||"-",B=x===R.name;return e.jsxs("div",{className:"settings-rowcard settings-rowcard--backup",children:[e.jsx("span",{className:"backup-row__dot"}),e.jsx("span",{className:"backup-row__idx",children:W+1}),e.jsx("span",{className:"backup-row__name",title:R.name,children:R.name}),e.jsxs("div",{className:"backup-row__meta",children:[e.jsx("span",{className:"pill pill-muted",children:H}),e.jsx("span",{className:"pill pill-muted",children:G})]}),e.jsxs("div",{className:"backup-row__actions",children:[e.jsx(js,{icon:"download",title:B?"Téléchargement...":"Télécharger",onClick:()=>k(R.name),disabled:D,spinning:B}),e.jsx(js,{icon:"restore",title:"Restaurer",onClick:()=>_(R),disabled:D,className:"iconbtn--warn"}),e.jsx(js,{icon:"delete",title:"Supprimer",onClick:()=>L(R),disabled:D,className:"iconbtn--danger"})]})]},R.name)})}),e.jsx(he,{open:r,title:"Nouvelle sauvegarde",onClose:a,width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Créer une nouvelle sauvegarde ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action crée une archive ZIP locale contenant la base de données et les métadonnées de configuration (sans exposer les secrets en clair dans `config.json`)."}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn btn-accent",type:"button",onClick:c,disabled:d||D,children:d?"Sauvegarde...":"Créer"}),e.jsx("button",{className:"btn",type:"button",onClick:a,disabled:d,children:"Annuler"})]})]})}),e.jsx(he,{open:S,title:"Restaurer une sauvegarde",onClose:j,width:640,children:e.jsxs("div",{className:"backup-confirm-modal__content",children:[e.jsx("div",{className:"backup-confirm-modal__lead",children:"Confirmer la restauration ?"}),e.jsxs("div",{className:"muted backup-confirm-modal__text",children:["Cette action remplace la base actuelle par la sauvegarde :",e.jsx("strong",{className:"backup-confirm-modal__name",children:w?.name||"-"}),"Un redémarrage de l'application sera requis après restauration."]}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn btn-danger",type:"button",onClick:K,disabled:y||D,children:y?"Restauration...":"Restaurer"}),e.jsx("button",{className:"btn",type:"button",onClick:j,disabled:y,children:"Annuler"})]})]})}),e.jsx(he,{open:g,title:"Supprimer une sauvegarde",onClose:b,width:640,children:e.jsxs("div",{className:"backup-confirm-modal__content",children:[e.jsx("div",{className:"backup-confirm-modal__lead",children:"Confirmer la suppression ?"}),e.jsxs("div",{className:"muted backup-confirm-modal__text",children:["Cette action va supprimer la sauvegarde :",e.jsx("strong",{className:"backup-confirm-modal__name",children:v?.name||"-"}),"Cette action est définitive."]}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn btn-danger",type:"button",onClick:n,disabled:m||D,children:m?"Suppression...":"Supprimer"}),e.jsx("button",{className:"btn",type:"button",onClick:b,disabled:m,children:"Annuler"})]})]})})]})}function Zs({security:r,setSecurity:d,securityErrors:h}){return e.jsxs("div",{className:"settings-card",id:"security",children:[e.jsx("div",{className:"settings-card__title",children:"Authentification"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Authentication"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.authentication,onChange:f=>d(x=>({...x,authentication:f.target.value})),children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"basic",children:"Basic (Browser Popup)"})]})})]})}),r.authentication==="basic"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"indexer-card",children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Authentication Required"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:r.authenticationRequired,onChange:f=>d(x=>({...x,authenticationRequired:f.target.value})),children:[e.jsx("option",{value:"local",children:"Disabled for Local Addresses"}),e.jsx("option",{value:"all",children:"Enabled for all Addresses"})]})})]}),e.jsx("div",{className:"settings-help",children:"Require Username and Password to access Feedarr"})]}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Username"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"text",value:r.username,onChange:f=>d(x=>({...x,username:f.target.value})),className:h.includes("username")?"is-error":"",placeholder:"Enter username"})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Password"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"password",value:r.password,onChange:f=>d(x=>({...x,password:f.target.value})),className:h.includes("password")?"is-error":"",placeholder:r.hasPassword?"Leave blank to keep current":"Enter password"})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Password Confirmation"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"password",value:r.passwordConfirmation,onChange:f=>d(x=>({...x,passwordConfirmation:f.target.value})),className:h.includes("passwordConfirmation")?"is-error":"",placeholder:"Confirm password"})})]})})]})]})]})}function pa(){const r=Ms(),h=Os().pathname.split("/")[2]||"general",f=zs(h),{settingsTitle:x,loading:S,err:w,showGeneral:y,showUi:g,showExternals:v,showApplications:m,showMaintenance:M,showBackup:p,showUsers:C,handleRefresh:a,handleSave:c,saveState:k,isDirty:_,openArrModalAdd:j,canAddArrApp:K,openExternalModalAdd:L,canAddExternalProvider:b,triggerArrSync:n,arrSyncing:t,hasEnabledArrApps:q,general:D,ui:R,providers:W,applications:H,maintenance:G,backup:B,users:Q}=f,J=s.useRef(null),V=s.useRef(null),P=s.useRef(null),I=s.useRef(null);J.current=B?.openBackupCreate,V.current=c,P.current=j,I.current=L;const[ae,$]=s.useState(!1),[Y,N]=s.useState(!1),T=!!B?.backupState?.isBusy||!!B?.backupState?.needsRestart,A=B?.backupState?.needsRestart?"Redemarrage requis apres restauration":"Operation de sauvegarde en cours";return s.useEffect(()=>{m||N(!1)},[m]),s.useEffect(()=>(r(e.jsxs("div",{className:"settings-subbar-content",subbarClassName:m?"subbar--settings-apps-sync":"",children:[e.jsx(ss,{icon:"refresh",label:"Rafraîchir",onClick:a}),m&&e.jsxs(e.Fragment,{children:[e.jsx(ss,{icon:"add_circle",label:"Ajouter",onClick:()=>P.current?.(),disabled:!K,title:K?"Ajouter":"Toutes les applications sont déjà ajoutées"}),e.jsx(ss,{icon:"settings",label:"Options",onClick:()=>N(!0)})]}),p&&e.jsx(ss,{icon:"add_circle",label:"Ajouter",onClick:()=>J.current?.(),disabled:T,title:T?A:"Ajouter"}),!M&&!p&&!v&&!m&&e.jsx(ss,{icon:k==="loading"?"progress_activity":k==="success"?"check_circle":k==="error"?"cancel":"save",label:"Enregistrer",onClick:()=>V.current?.(),disabled:k==="loading"||!_,className:k==="loading"?"is-loading":k==="success"?"is-success":k==="error"?"is-error":""}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"subspacer"}),e.jsx(ss,{icon:t?"progress_activity":"sync",label:"Sync all",onClick:n,disabled:!q||t,title:q?"Sync all":"Aucune application active",className:t?"is-loading":void 0})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx(ss,{icon:"add_circle",label:"Ajouter",onClick:()=>I.current?.(),disabled:!b,title:b?"Ajouter":"Aucun provider disponible"}),e.jsx(ss,{icon:"settings",label:"Options",onClick:()=>$(!0)})]})]})),()=>r(null)),[r,a,m,M,p,v,k,_,K,n,t,q,b,T,A]),e.jsxs("div",{className:"page page--settings",children:[e.jsx("div",{className:"pagehead",children:e.jsxs("div",{children:[e.jsx("h1",{children:x}),e.jsx("div",{className:"muted",children:"Configuration de l'application"})]})}),e.jsx("div",{className:"pagehead__divider"}),S&&e.jsx(Es,{label:"Chargement des paramètres…"}),!S&&w&&e.jsxs("div",{className:"errorbox",children:[e.jsx("div",{className:"errorbox__title",children:"Erreur"}),e.jsx("div",{className:"muted",children:w})]}),!S&&!w&&e.jsxs("div",{className:"settings-grid",children:[y&&e.jsx(Vs,{...D}),g&&e.jsx(Ws,{...R}),v&&e.jsx(Hs,{controller:W,posterModalOpen:ae,closePosterModal:()=>$(!1)}),m&&e.jsx(Gs,{...H,optionsModalOpen:Y,closeOptionsModal:()=>N(!1)}),M&&e.jsx(Js,{...G}),p&&e.jsx(Ys,{...B}),C&&e.jsx(Zs,{...Q})]})]})}export{pa as default};
