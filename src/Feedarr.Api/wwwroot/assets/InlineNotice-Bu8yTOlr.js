import{r as t,j as r}from"./vendor-react-B6j9w5IJ.js";import{k as Et,l as Mt,m as wt,D as Ct,a as Z,o as Ye,n as He,b as Oe,i as ze,j as Qe,d as Xe,c as me,e as Nt,h as kt,t as jt,A as At}from"./index-DavgMby8.js";import{M as Pe}from"./Modal-ulxqKDui.js";import{C as It,I as Lt,T as Ft}from"./ItemRow-Bu5Luasz.js";import{t as l}from"./uiText-Dk9tUI9L.js";const Ge={uiLanguage:Ct,mediaInfoLanguage:wt,hideSeenByDefault:!1,showCategories:!0,defaultView:"grid",defaultSort:"date",defaultMaxAgeDays:"",defaultLimit:100,defaultFilterSeen:"",defaultFilterApplication:"",defaultFilterSourceId:"",defaultFilterCategoryId:"",defaultFilterQuality:"",badgeInfo:!1,badgeWarn:!0,badgeError:!0,theme:"light",enableMissingPosterView:!1,animationsEnabled:!0,onboardingDone:!1};function Je(n,i={}){const e={...n,...i};return{uiLanguage:He(e.uiLanguage),mediaInfoLanguage:Ye(e.mediaInfoLanguage),hideSeenByDefault:!!e.hideSeenByDefault,showCategories:!!e.showCategories,defaultView:e.defaultView||"grid",defaultSort:e.defaultSort||"date",defaultMaxAgeDays:e.defaultMaxAgeDays??"",defaultLimit:e.defaultLimit??100,defaultFilterSeen:e.defaultFilterSeen??"",defaultFilterApplication:e.defaultFilterApplication??"",defaultFilterSourceId:e.defaultFilterSourceId??"",defaultFilterCategoryId:e.defaultFilterCategoryId??"",defaultFilterQuality:e.defaultFilterQuality??"",badgeInfo:!!e.badgeInfo,badgeWarn:!!e.badgeWarn,badgeError:!!e.badgeError,theme:e.theme||"light",enableMissingPosterView:!!e.enableMissingPosterView,animationsEnabled:e.animationsEnabled!==!1,onboardingDone:!!e.onboardingDone}}function Qt(){const n=Et(),i=Mt(),[e,h]=t.useState({...Ge,theme:n,uiLanguage:i}),[c,k]=t.useState({...Ge,theme:n,uiLanguage:i}),[K,f]=t.useState(()=>new Set),m=t.useRef(null),E=JSON.stringify(e)!==JSON.stringify(c),v=t.useCallback(async()=>{try{const s=await Z("/api/settings/ui");if(s){const x={...s,uiLanguage:He(s.uiLanguage),mediaInfoLanguage:Ye(s.mediaInfoLanguage),defaultSort:s.defaultSort||"date",defaultMaxAgeDays:s.defaultMaxAgeDays??"",defaultLimit:s.defaultLimit??100,defaultFilterSeen:s.defaultFilterSeen??"",defaultFilterApplication:s.defaultFilterApplication??"",defaultFilterSourceId:s.defaultFilterSourceId??"",defaultFilterCategoryId:s.defaultFilterCategoryId??"",defaultFilterQuality:s.defaultFilterQuality??"",theme:s.theme||"light",enableMissingPosterView:!!s.enableMissingPosterView,animationsEnabled:s.animationsEnabled!==!1,onboardingDone:!!s.onboardingDone};h(x),k(x)}}catch{}},[]),y=t.useCallback(async()=>{const s=new Set;return e.uiLanguage!==c.uiLanguage&&s.add("ui.uiLanguage"),e.mediaInfoLanguage!==c.mediaInfoLanguage&&s.add("ui.mediaInfoLanguage"),e.hideSeenByDefault!==c.hideSeenByDefault&&s.add("ui.hideSeen"),e.showCategories!==c.showCategories&&s.add("ui.showCategories"),e.defaultView!==c.defaultView&&s.add("ui.defaultView"),e.defaultSort!==c.defaultSort&&s.add("ui.defaultSort"),e.defaultMaxAgeDays!==c.defaultMaxAgeDays&&s.add("ui.defaultMaxAgeDays"),e.defaultLimit!==c.defaultLimit&&s.add("ui.defaultLimit"),e.defaultFilterSeen!==c.defaultFilterSeen&&s.add("ui.defaultFilterSeen"),e.defaultFilterApplication!==c.defaultFilterApplication&&s.add("ui.defaultFilterApplication"),e.defaultFilterSourceId!==c.defaultFilterSourceId&&s.add("ui.defaultFilterSourceId"),e.defaultFilterCategoryId!==c.defaultFilterCategoryId&&s.add("ui.defaultFilterCategoryId"),e.defaultFilterQuality!==c.defaultFilterQuality&&s.add("ui.defaultFilterQuality"),e.theme!==c.theme&&s.add("ui.theme"),e.enableMissingPosterView!==c.enableMissingPosterView&&s.add("ui.missingPosterView"),e.animationsEnabled!==c.animationsEnabled&&s.add("ui.animations"),await Oe("/api/settings/ui",Je(e)),k(Je(e)),ze(e.theme,!0),Qe(e.uiLanguage,!0),s.size>0&&(m.current&&clearTimeout(m.current),f(new Set(s)),m.current=setTimeout(()=>{f(new Set)},1200)),s},[e,c]),b=t.useCallback(s=>{h(x=>({...x,theme:s}))},[]);return t.useEffect(()=>{ze(e?.theme)},[e?.theme]),t.useEffect(()=>{Qe(e?.uiLanguage)},[e?.uiLanguage]),t.useEffect(()=>{if(typeof document>"u")return;document.documentElement.setAttribute("data-motion",e?.animationsEnabled===!1?"off":"on")},[e?.animationsEnabled]),{ui:e,setUi:h,initialUi:c,isDirty:E,pulseKeys:K,loadUiSettings:v,saveUiSettings:y,handleThemeChange:b}}const ae="feedarr:retroFetch",$e="retro-fetch-posters";function Be(){if(typeof window>"u")return null;try{const n=window.localStorage.getItem(ae);if(!n)return null;const i=JSON.parse(n);return!i||!i.active?null:i.startedAt&&Date.now()-i.startedAt>1e3*60*60*1?(window.localStorage.removeItem(ae),null):i}catch{return null}}function fe(n){if(!(typeof window>"u")){if(!n)window.localStorage.removeItem(ae),Nt($e);else{try{window.localStorage.setItem(ae,JSON.stringify(n))}catch{}if(n.active){const i=Number(n.total??0),e=Number(n.done??0),h=Number(n.percent??0),c=i>0?`${h}% (${e}/${i})`:"En cours...";Xe({key:$e,label:"Récupération de posters",meta:c,ttlMs:1e3*60*60})}}window.dispatchEvent(new CustomEvent("storage_change",{detail:{key:ae}}))}}let Ke=!1;function Dt(){const[n,i]=t.useState(()=>Be()),e=t.useRef(null);t.useEffect(()=>{const f=Be();if(f?.active){const m=Number(f.total??0),E=Number(f.done??0),v=Number(f.percent??0),y=m>0?`${v}% (${E}/${m})`:"En cours...";Xe({key:$e,label:"Récupération de posters",meta:y,ttlMs:1e3*60*60})}},[]);const h=t.useCallback(()=>{e.current&&(clearInterval(e.current),e.current=null),Ke=!1},[]),c=t.useCallback(f=>{if(f.detail.key===ae){const m=Be();i(m),m?.active||h()}},[h]);t.useEffect(()=>(window.addEventListener("storage_change",c),()=>{window.removeEventListener("storage_change",c)}),[c]),t.useEffect(()=>{if(!n?.active){h();return}if(Ke)return;Ke=!0;async function f(){try{const m=Array.isArray(n.ids)?n.ids:[],E=Number(n.startedAtTs??0);let v={...n};if(m.length>0){const y=await me("/api/posters/retro-fetch/progress",{ids:m,startedAtTs:E}),b=Number(y?.total??m.length),s=Number(y?.done??0);if(b>0&&s>=b){fe(null);return}v={...v,done:s,total:b,percent:b>0?Math.round(s/b*100):0}}else{const y=await Z("/api/posters/missing-count"),b=Number(y?.count??0),s=Number(n.startMissing??0),x=Number(n.targetMissing??0),U=Math.max(1,s-x),j=Math.max(0,s-b);if(b<=x||U===0){fe(null);return}v={...v,currentMissing:b,percent:Math.round(j/U*100)}}fe(v)}catch{}}return f(),e.current=setInterval(f,4e3),()=>{h()}},[n,h]);const k=t.useCallback(async()=>{try{const f=await Z("/api/posters/missing-count"),m=Number(f?.count??0),E=await me("/api/posters/retro-fetch",{limit:300}),v=Number(E?.enqueued??0),y=Array.isArray(E?.ids)?E.ids:[],b=Number(E?.startedAtTs??Math.floor(Date.now()/1e3)),s={active:!0,startedAt:Date.now(),startMissing:m,targetMissing:Math.max(0,m-v),enqueued:v,total:Number(E?.total??v),ids:y,startedAtTs:b,currentMissing:m,percent:0,done:0};return fe(s),{task:s,error:null}}catch(f){return{task:null,error:f.message||"Failed to start retro fetch"}}},[]),K=t.useCallback(async()=>{try{return await me("/api/posters/retro-fetch/stop",{}),fe(null),{error:null}}catch(f){return{error:f.message||"Failed to stop retro fetch"}}},[]);return{retroTask:n,startRetroFetch:k,stopRetroFetch:K}}async function Tt(){try{const n=await Z("/api/providers/external");return{ok:!0,data:{definitions:Array.isArray(n?.definitions)?n.definitions:[],instances:Array.isArray(n?.instances)?n.instances:[]}}}catch(n){return console.error("[providers.api] fetchProvidersConfig failed",n),{ok:!1,errorMessage:n?.message||"Chargement impossible."}}}async function Pt(n){try{return{ok:!0,data:await me("/api/providers/external",n)}}catch(i){return console.error("[providers.api] createProviderInstance failed",i),{ok:!1,errorMessage:i?.message||"Sauvegarde impossible."}}}async function Bt(n,i){try{return{ok:!0,data:await Oe(`/api/providers/external/${n}`,i)}}catch(e){return console.error("[providers.api] updateProviderInstance failed",e),{ok:!1,errorMessage:e?.message||"Sauvegarde impossible."}}}async function Kt(n){try{return await kt(`/api/providers/external/${n}`),{ok:!0}}catch(i){return console.error("[providers.api] deleteProviderInstance failed",i),{ok:!1,errorMessage:i?.message||"Suppression impossible."}}}async function Ut(n){try{const i=await me(`/api/providers/external/${n}/test`);return i?.ok===!1?{ok:!1,errorMessage:i?.error||"Test échoué."}:{ok:!0}}catch(i){return console.error("[providers.api] testProviderInstance failed",i),{ok:!1,errorMessage:i?.message||"Test échoué."}}}async function Rt(n,i){try{return await Oe(`/api/providers/external/${n}`,{enabled:i}),{ok:!0}}catch(e){return console.error("[providers.api] toggleProviderInstance failed",e),{ok:!1,errorMessage:e?.message||"Activation impossible."}}}const Ue=()=>{typeof window<"u"&&window.dispatchEvent(new Event("onboarding:refresh"))},Re={};function Ze(n){if(!n)return"";const i=String(n).trim();return i?`has${i.charAt(0).toUpperCase()}${i.slice(1)}`:""}function _e(n,i){if(!i)return!1;const e=(i.fieldsSchema||[]).filter(c=>c.required);if(e.length===0)return!0;const h=n?.authFlags||{};return e.every(c=>!!h[Ze(c.key)])}function Gt(){const[n,i]=t.useState([]),[e,h]=t.useState([]),[c,k]=t.useState(!1),[K,f]=t.useState(""),[m,E]=t.useState(null),[v,y]=t.useState({}),[b,s]=t.useState(!1),[x,U]=t.useState("add"),[j,R]=t.useState(1),[_,$]=t.useState(null),[C,A]=t.useState(""),[re,I]=t.useState(""),[Q,ne]=t.useState(!0),[se,O]=t.useState(""),[G,J]=t.useState({}),[W,ie]=t.useState(!1),[Ce,p]=t.useState(""),[pe,he]=t.useState(!1),[Y,xe]=t.useState(null),[oe,ve]=t.useState(!1),[ye,ee]=t.useState(!1),[V,be]=t.useState(null),[Ne,L]=t.useState(0),[le,Se]=t.useState(0),[de,H]=t.useState(0),[ke,ce]=t.useState(Re),[o,M]=t.useState(!1),[F,X]=t.useState(!1),[ue,D]=t.useState(""),{retroTask:S,startRetroFetch:Ee,stopRetroFetch:Me}=Dt(),N=t.useMemo(()=>{const a=new Map;return(n||[]).forEach(d=>{a.set(String(d.providerKey||"").toLowerCase(),d)}),a},[n]),q=t.useMemo(()=>{const a=new Set;return(e||[]).forEach(d=>{const u=String(d?.providerKey||"").trim().toLowerCase();u&&a.add(u)}),a},[e]),ge=t.useMemo(()=>(n||[]).filter(a=>{const d=String(a?.providerKey||"").trim().toLowerCase();return d?!q.has(d):!1}),[n,q]),T=t.useMemo(()=>C&&N.get(String(C).toLowerCase())||null,[N,C]),je=t.useMemo(()=>{const a={};return(n||[]).forEach(d=>{const u=String(d.providerKey||""),B=(e||[]).filter(g=>String(g.providerKey||"").toLowerCase()===u.toLowerCase()).some(g=>g.enabled&&_e(g,d));a[u]=B?"ok":null}),a},[n,e]),Ae=t.useMemo(()=>n?.length?n.every(a=>(e||[]).filter(u=>String(u.providerKey||"").toLowerCase()===String(a.providerKey||"").toLowerCase()).some(u=>_e(u,a))):!1,[n,e]),et=ge.length>0,te=t.useCallback(()=>{U("add"),R(1),$(null),A(""),I(""),ne(!0),O(""),J({}),ie(!1),p("")},[]),P=t.useCallback(async()=>{k(!0),f("");const a=await Tt();a.ok?(i(a.data.definitions),h(a.data.instances)):(f(a.errorMessage),i([]),h([])),k(!1)},[]),tt=t.useCallback(async()=>{try{const[a,d,u]=await Promise.all([Z("/api/posters/count"),Z("/api/posters/missing-count"),Z("/api/system/providers")]);if(L(Number(a?.count??0)),Se(Number(d?.count??0)),u&&typeof u=="object"){const w={};Object.entries(u).forEach(([B,g])=>{!g||typeof g!="object"||(w[String(B).toLowerCase()]={calls:Number(g.calls??0),failures:Number(g.failures??0),avgMs:Number(g.avgMs??0)})}),ce(w)}else ce(Re)}catch{L(0),Se(0),ce(Re)}},[]),at=t.useCallback((a="")=>{te(),U("add");const d=String(a||"").trim();if(d){if(q.has(d.toLowerCase())){p("Provider deja ajoute."),R(1),s(!0);return}const u=N.get(d.toLowerCase());A(d),O(u?.defaultBaseUrl||""),R(2)}else R(1);s(!0)},[N,q,te]),rt=t.useCallback(a=>{const d=String(a||"").trim();if(x==="add"&&q.has(d.toLowerCase())){A(""),O(""),J({}),p("Provider deja ajoute.");return}const u=N.get(d.toLowerCase());A(d),O(u?.defaultBaseUrl||""),J({}),p("")},[N,q,x]),nt=t.useCallback(a=>{if(!a)return;te();const d=String(a.providerKey||""),u=N.get(d.toLowerCase());U("edit"),R(2),$(a),A(d),I(a.displayName||""),ne(a.enabled!==!1),O(a.baseUrl||u?.defaultBaseUrl||""),J({}),s(!0)},[N,te]),Ie=t.useCallback(()=>{W||(s(!1),te())},[W,te]),st=t.useCallback((a,d)=>{J(u=>({...u,[a]:d})),p("")},[]),Le=t.useCallback(a=>{p(""),R(a)},[]),we=t.useCallback(()=>{const a=T;if(!a)return[];const d=(a.fieldsSchema||[]).filter(w=>w.required),u=[];return d.forEach(w=>{String(G[w.key]||"").trim()||x==="edit"&&_?.authFlags?.[Ze(w.key)]||u.push(w.key)}),u},[G,T,_,x]),it=t.useMemo(()=>!T||x==="add"&&j!==2||W?!1:we().length===0,[we,T,x,W,j]),ot=t.useCallback(async()=>{const a=T;if(!a){p("Provider invalide.");return}if(x==="add"&&j===1){if(!C){p("Selectionnez un provider.");return}Le(2);return}const d=we();if(d.length>0){p(`Champ(s) requis: ${d.join(", ")}`);return}const u={};(a.fieldsSchema||[]).forEach(g=>{const z=String(G[g.key]||"").trim();z&&(u[g.key]=z)});const w=String(re||"").trim(),B=String(se||"").trim();ie(!0),p("");try{let g;if(x==="add")g=await Pt({providerKey:C,displayName:w||null,enabled:Q,baseUrl:B||null,auth:u,options:{}});else if(_?.instanceId){const z={displayName:w||null,enabled:Q,baseUrl:B||null,options:{}};Object.keys(u).length>0&&(z.auth=u),g=await Bt(_.instanceId,z)}if(g&&!g.ok){p(g.errorMessage);return}Ue(),Ie(),await P()}catch(g){p(g?.message||"Erreur sauvegarde provider metadata")}finally{ie(!1)}},[Ie,we,G,se,T,re,Q,_,x,C,j,Le,P]),lt=t.useCallback(a=>{xe(a||null),he(!0)},[]),Fe=t.useCallback(()=>{oe||(he(!1),xe(null))},[oe]),dt=t.useCallback(async()=>{if(Y?.instanceId){ve(!0);try{const a=await Kt(Y.instanceId);if(!a.ok)throw new Error(a.errorMessage);Ue(),Fe(),await P()}catch(a){throw new Error(a?.message||"Erreur suppression provider metadata")}finally{ve(!1)}}},[Fe,Y,P]),ct=t.useCallback(a=>{be(a||null),ee(!0)},[]),De=t.useCallback(()=>{ee(!1),be(null)},[]),ut=t.useCallback(async()=>{if(V?.instanceId)try{const a=await Rt(V.instanceId,!V.enabled);if(!a.ok)throw new Error(a.errorMessage);Ue(),De(),await P()}catch(a){throw new Error(a?.message||"Erreur activation/desactivation provider metadata")}},[De,V,P]),gt=t.useCallback(async a=>{if(!a)return;const d=Date.now();E(a),y(g=>({...g,[a]:"pending"}));const u=await Ut(a),w=Date.now()-d,B=Math.max(2e3-w,0);setTimeout(()=>{y(g=>({...g,[a]:u.ok?"ok":"error"})),setTimeout(()=>{y(g=>{const z={...g};return delete z[a],z})},1600),E(null)},B)},[]),ft=t.useCallback(async()=>{await P()},[P]),mt=t.useCallback(async()=>!1,[]),pt=t.useCallback(a=>{const d=N.get(String(a?.providerKey||"").toLowerCase());return _e(a,d)},[N]),ht=!!S?.active,Ve=Number(S?.startMissing??0),xt=Number(S?.targetMissing??0),vt=Number(S?.currentMissing??le??0),Te=Number(S?.total??(Array.isArray(S?.ids)?S.ids.length:null)??Math.max(0,Ve-xt)),qe=Number(S?.done??Math.max(0,Ve-vt)),yt=Te>0?Math.min(100,Math.max(0,Math.round(qe/Te*100))):0;async function bt(){if(S?.active)return;M(!0),D("");const{error:a}=await Ee();a?(D(a),M(!1)):jt("retro-fetch")}async function St(){if(!S?.active||F)return;X(!0),D("");const{error:a}=await Me();D(a||"Retro fetch arrete"),X(!1),M(!1)}return{definitions:n,availableExternalDefinitions:ge,instances:e,externalLoading:c,externalError:K,providerStats:ke,loadExternalProviders:P,loadExternalFlags:ft,saveExternalKeys:mt,loadProviderStats:tt,canAddExternalProvider:et,externalValidationByProvider:je,allProvidersAdded:Ae,isInstanceConfigured:pt,testingExternal:m,testStatusByExternal:v,testExternal:gt,openExternalModalAdd:at,openExternalModalEdit:nt,closeExternalModal:Ie,goExternalModalStep:Le,saveExternalModal:ot,externalModalOpen:b,externalModalMode:x,externalModalStep:j,externalModalInstance:_,externalModalProviderKey:C,setExternalModalProviderKey:A,selectExternalModalProvider:rt,externalModalDefinition:T,externalModalDisplayName:re,setExternalModalDisplayName:I,externalModalEnabled:Q,setExternalModalEnabled:ne,externalModalBaseUrl:se,setExternalModalBaseUrl:O,externalModalAuth:G,setExternalModalAuthField:st,externalModalSaving:W,externalModalError:Ce,canSaveExternalModal:it,openExternalDelete:lt,closeExternalDelete:Fe,confirmExternalDelete:dt,externalDeleteOpen:pe,externalDeleteInstance:Y,externalDeleteLoading:oe,openExternalToggle:ct,closeExternalToggle:De,confirmExternalToggle:ut,externalToggleOpen:ye,externalToggleInstance:V,posterCount:Ne,missingPosterCount:le,releasesCount:de,setReleasesCount:H,retroActive:ht,retroLoading:o,retroStopLoading:F,retroMsg:ue,retroPercent:yt,retroDone:qe,retroTotal:Te,handleRetroFetch:bt,handleRetroFetchStop:St}}function _t(n){if(!n)return"";const i=String(n).trim();return i?`has${i.charAt(0).toUpperCase()}${i.slice(1)}`:""}function Jt({controller:n,showInlineAdd:i=!1}){const[e,h]=t.useState(""),{definitions:c,availableExternalDefinitions:k,instances:K,externalLoading:f,externalError:m,providerStats:E,testingExternal:v,testStatusByExternal:y,isInstanceConfigured:b,testExternal:s,openExternalModalAdd:x,openExternalModalEdit:U,openExternalDelete:j,openExternalToggle:R,externalModalOpen:_,externalModalMode:$,externalModalStep:C,externalModalProviderKey:A,selectExternalModalProvider:re,externalModalDefinition:I,externalModalInstance:Q,externalModalDisplayName:ne,setExternalModalDisplayName:se,externalModalEnabled:O,setExternalModalEnabled:G,externalModalBaseUrl:J,setExternalModalBaseUrl:W,externalModalAuth:ie,setExternalModalAuthField:Ce,externalModalSaving:p,externalModalError:pe,canSaveExternalModal:he,closeExternalModal:Y,goExternalModalStep:xe,saveExternalModal:oe,externalDeleteOpen:ve,externalDeleteInstance:ye,externalDeleteLoading:ee,closeExternalDelete:V,confirmExternalDelete:be,externalToggleOpen:Ne,externalToggleInstance:L,closeExternalToggle:le,confirmExternalToggle:Se}=n,de=k||[],H=de.length>0,ke=t.useMemo(()=>{const o=new Map;return(c||[]).forEach(M=>{o.set(String(M.providerKey||"").toLowerCase(),M)}),o},[c]);function ce(o){const M=o.target.value;h(M),M&&(x(M),h(""))}return r.jsxs(r.Fragment,{children:[i&&r.jsxs("div",{className:"setup-providers__add settings-row settings-row--ui-select",children:[r.jsx("label",{children:l("Provider","Provider")}),r.jsxs("select",{className:"settings-field",value:e,onChange:ce,disabled:!H,children:[r.jsx("option",{value:"",disabled:!0,children:H?l("Selectionner...","Select..."):l("Tous les providers sont deja ajoutes","All providers are already added")}),de.map(o=>r.jsx("option",{value:o.providerKey,children:o.displayName},o.providerKey))]})]}),m&&r.jsx("div",{className:"onboarding__error",children:m}),r.jsx("div",{className:"indexer-list itemrow-grid",children:f?r.jsx("div",{className:"indexer-card",children:r.jsx("div",{className:"indexer-row",children:r.jsx("span",{className:"indexer-url muted",children:l("Chargement...","Loading...")})})}):(K||[]).length===0?r.jsx("div",{className:"indexer-card",children:r.jsx("div",{className:"indexer-row",children:r.jsx("span",{className:"indexer-url muted",children:l("Aucun provider metadata configure","No configured metadata provider")})})}):(K||[]).map((o,M)=>{const F=String(o.providerKey||"").toLowerCase(),X=ke.get(F),ue=y[o.instanceId]==="ok",D=y[o.instanceId]==="error",S=v===o.instanceId,Ee=b(o),Me=E?.[F]||{calls:0,failures:0},N=[ue&&"test-ok",D&&"test-err"].filter(Boolean).join(" "),q={movie:["Films"],tv:["Séries","TV"],artwork:["Artwork"],game:["Games","Jeux"],anime:["Anime"],book:["Livres","Books"],audio:["Musique","Audio"],comic:["Comics","BD"]},ge=X?.kind,T=(q[ge]||[]).map((je,Ae)=>r.jsx(It,{unifiedKey:ge,label:je},Ae));return r.jsx(Lt,{id:M+1,title:o.displayName||X?.displayName||F.toUpperCase(),meta:`Appels: ${Number(Me.calls||0)} | Echecs: ${Number(Me.failures||0)}`,enabled:o.enabled!==!1,statusClass:N,badges:[...T,{label:Ee?"OK":"NO",className:`${Ee?"pill-ok":"pill-warn"} pill--trailing`}],actions:[{icon:"science",title:S?l("Test en cours...","Test in progress..."):o.enabled===!1?l("Activez d'abord le provider","Enable provider first"):l("Tester","Test"),onClick:()=>s(o.instanceId),disabled:S||o.enabled===!1,spinning:S},{icon:"edit",title:o.enabled===!1?l("Activez d'abord le provider","Enable provider first"):l("Modifier","Edit"),onClick:()=>U(o),disabled:S||o.enabled===!1},{icon:"delete",title:l("Supprimer","Delete"),onClick:()=>j(o),disabled:S,className:"iconbtn--danger"}],showToggle:!0,onToggle:()=>R(o),toggleDisabled:S},o.instanceId)})}),r.jsx(Pe,{open:_,title:$==="add"?C===1?l("Ajouter un provider metadata","Add a metadata provider"):`${l("Configurer","Configure")}: ${I?.displayName||l("Provider","Provider")}`:`${l("Modifier","Edit")}: ${Q?.displayName||I?.displayName||l("Provider","Provider")}`,onClose:Y,width:560,children:r.jsxs("div",{style:{padding:12},children:[$==="add"&&C===1&&r.jsxs("div",{className:"field",style:{marginBottom:12},children:[r.jsx("label",{className:"muted",children:l("Provider","Provider")}),r.jsxs("select",{value:A,onChange:o=>re(o.target.value),disabled:p||!H,children:[r.jsx("option",{value:"",disabled:!0,children:H?l("Selectionner...","Select..."):l("Tous les providers sont deja ajoutes","All providers are already added")}),de.map(o=>r.jsx("option",{value:o.providerKey,children:o.displayName},o.providerKey))]}),!H&&r.jsx("div",{className:"muted",style:{marginTop:8},children:l("Tous les providers sont deja ajoutes","All providers are already added")})]}),($==="edit"||C===2)&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"field",style:{marginBottom:12},children:[r.jsx("label",{className:"muted",children:l("Nom (optionnel)","Name (optional)")}),r.jsx("input",{type:"text",value:ne,onChange:o=>se(o.target.value),placeholder:I?.displayName||"Nom du provider",disabled:p})]}),r.jsxs("div",{className:"field",style:{marginBottom:12},children:[r.jsx("label",{className:"muted",children:l("Base URL (optionnel)","Base URL (optional)")}),r.jsx("input",{type:"text",value:J,onChange:o=>W(o.target.value),placeholder:I?.defaultBaseUrl||"https://",disabled:p})]}),r.jsx("div",{className:"indexer-card",style:{marginBottom:12},children:r.jsxs("div",{className:"indexer-row indexer-row--settings",children:[r.jsx("span",{className:"indexer-title",children:l("Actif","Active")}),r.jsx("div",{className:"indexer-actions",children:r.jsx(Ft,{checked:O,onIonChange:o=>G(o.detail.checked),className:"settings-toggle",disabled:p})})]})}),(I?.fieldsSchema||[]).map(o=>{const M=!!Q?.authFlags?.[_t(o.key)],F=ie[o.key]||"",X=o.secretPlaceholder||"•••••••• (laisser vide pour conserver)",ue=F||$==="edit"&&M&&o.secret?X:o.placeholder||"";return r.jsxs("div",{className:"field",style:{marginBottom:12},children:[r.jsxs("label",{className:"muted",children:[o.label,o.required?" *":""]}),r.jsx("input",{type:o.secret?"password":o.type||"text",value:F,onChange:D=>Ce(o.key,D.target.value),placeholder:ue,disabled:p})]},o.key)})]}),pe&&r.jsx("div",{className:"onboarding__error",style:{marginBottom:12},children:pe}),r.jsxs("div",{className:"formactions",children:[$==="add"&&C===1?r.jsx("button",{className:"btn btn-accent",type:"button",onClick:()=>xe(2),disabled:!A||p,children:l("Suivant","Next")}):r.jsx("button",{className:"btn btn-accent",type:"button",onClick:oe,disabled:!he||p,children:p?l("Enregistrement...","Saving..."):l("Enregistrer","Save")}),r.jsx("button",{className:"btn",type:"button",onClick:Y,disabled:p,children:l("Annuler","Cancel")})]})]})}),r.jsx(Pe,{open:ve,title:l("Supprimer le provider metadata","Delete metadata provider"),onClose:V,width:520,children:r.jsxs("div",{style:{padding:12},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:8},children:l("Confirmer la suppression ?","Confirm deletion?")}),r.jsxs("div",{className:"muted",style:{marginBottom:12},children:[l("Cette action va supprimer","This action will delete")," ",r.jsx("strong",{children:ye?.displayName||ye?.providerKey||"-"}),".",r.jsx("br",{}),l("Cette action est definitive.","This action is permanent.")]}),r.jsxs("div",{className:"formactions",children:[r.jsx("button",{className:"btn btn-danger",type:"button",onClick:be,disabled:ee,children:ee?l("Suppression...","Deleting..."):l("Supprimer","Delete")}),r.jsx("button",{className:"btn",type:"button",onClick:V,disabled:ee,children:l("Annuler","Cancel")})]})]})}),r.jsx(Pe,{open:Ne,title:L?`${L.enabled?l("Desactiver","Disable"):l("Activer","Enable")} : ${L.displayName||L.providerKey}`:l("Activer/Desactiver","Enable/Disable"),onClose:le,width:520,children:r.jsxs("div",{style:{padding:12},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:8},children:l("Confirmer l'action ?","Confirm action?")}),r.jsx("div",{className:"muted",style:{marginBottom:12},children:L?.enabled?l("Cette action va desactiver le provider.","This action will disable the provider."):l("Cette action va activer le provider.","This action will enable the provider.")}),r.jsxs("div",{className:"formactions",children:[r.jsx("button",{className:"btn",type:"button",onClick:Se,children:L?.enabled?l("Desactiver","Disable"):l("Activer","Enable")}),r.jsx("button",{className:"btn",type:"button",onClick:le,children:l("Annuler","Cancel")})]})]})})]})}const We={error:"error",warning:"warning",info:"lock",success:"check_circle"};function Wt({variant:n="info",title:i="",message:e=""}){if(!e)return null;const h=We[n]||We.info;return r.jsxs("div",{className:`inline-notice inline-notice--${n}`,role:"status","aria-live":"polite",children:[r.jsx("span",{className:"inline-notice__icon","aria-hidden":"true",children:r.jsx(At,{name:h,size:16})}),r.jsxs("div",{className:"inline-notice__content",children:[!!i&&r.jsx("div",{className:"inline-notice__title",children:i}),r.jsx("div",{className:"inline-notice__message",children:e})]})]})}export{Jt as E,Wt as I,Gt as a,Je as b,Qt as u};
