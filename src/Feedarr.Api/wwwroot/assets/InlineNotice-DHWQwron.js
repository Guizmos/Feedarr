import{r as t,j as r}from"./vendor-react-B6j9w5IJ.js";import{k as St,l as Et,m as Mt,D as wt,a as Z,o as We,n as Ye,b as $e,i as qe,j as ze,d as He,c as me,e as Ct,h as Nt,t as kt,A as jt}from"./index-w1EqWPJX.js";import{M as Pe}from"./Modal-D9seooTq.js";import{C as At,I as It,T as Lt}from"./ItemRow-Dnar6FKB.js";import{t as l}from"./uiText-BZ3z2hUD.js";const Qe={uiLanguage:wt,mediaInfoLanguage:Mt,hideSeenByDefault:!1,showCategories:!0,defaultView:"grid",defaultSort:"date",defaultMaxAgeDays:"",defaultLimit:100,defaultFilterSeen:"",defaultFilterApplication:"",defaultFilterSourceId:"",defaultFilterCategoryId:"",defaultFilterQuality:"",badgeInfo:!1,badgeWarn:!0,badgeError:!0,theme:"light",enableMissingPosterView:!1,animationsEnabled:!0,onboardingDone:!1};function Ge(n,i={}){const e={...n,...i};return{uiLanguage:Ye(e.uiLanguage),mediaInfoLanguage:We(e.mediaInfoLanguage),hideSeenByDefault:!!e.hideSeenByDefault,showCategories:!!e.showCategories,defaultView:e.defaultView||"grid",defaultSort:e.defaultSort||"date",defaultMaxAgeDays:e.defaultMaxAgeDays??"",defaultLimit:e.defaultLimit??100,defaultFilterSeen:e.defaultFilterSeen??"",defaultFilterApplication:e.defaultFilterApplication??"",defaultFilterSourceId:e.defaultFilterSourceId??"",defaultFilterCategoryId:e.defaultFilterCategoryId??"",defaultFilterQuality:e.defaultFilterQuality??"",badgeInfo:!!e.badgeInfo,badgeWarn:!!e.badgeWarn,badgeError:!!e.badgeError,theme:e.theme||"light",enableMissingPosterView:!!e.enableMissingPosterView,animationsEnabled:e.animationsEnabled!==!1,onboardingDone:!!e.onboardingDone}}function zt(){const n=St(),i=Et(),[e,v]=t.useState({...Qe,theme:n,uiLanguage:i}),[d,N]=t.useState({...Qe,theme:n,uiLanguage:i}),[U,A]=t.useState(()=>new Set),m=t.useRef(null),h=JSON.stringify(e)!==JSON.stringify(d),b=t.useCallback(async()=>{try{const s=await Z("/api/settings/ui");if(s){const f={...s,uiLanguage:Ye(s.uiLanguage),mediaInfoLanguage:We(s.mediaInfoLanguage),defaultSort:s.defaultSort||"date",defaultMaxAgeDays:s.defaultMaxAgeDays??"",defaultLimit:s.defaultLimit??100,defaultFilterSeen:s.defaultFilterSeen??"",defaultFilterApplication:s.defaultFilterApplication??"",defaultFilterSourceId:s.defaultFilterSourceId??"",defaultFilterCategoryId:s.defaultFilterCategoryId??"",defaultFilterQuality:s.defaultFilterQuality??"",theme:s.theme||"light",enableMissingPosterView:!!s.enableMissingPosterView,animationsEnabled:s.animationsEnabled!==!1,onboardingDone:!!s.onboardingDone};v(f),N(f)}}catch{}},[]),x=t.useCallback(async()=>{const s=new Set;return e.uiLanguage!==d.uiLanguage&&s.add("ui.uiLanguage"),e.mediaInfoLanguage!==d.mediaInfoLanguage&&s.add("ui.mediaInfoLanguage"),e.hideSeenByDefault!==d.hideSeenByDefault&&s.add("ui.hideSeen"),e.showCategories!==d.showCategories&&s.add("ui.showCategories"),e.defaultView!==d.defaultView&&s.add("ui.defaultView"),e.defaultSort!==d.defaultSort&&s.add("ui.defaultSort"),e.defaultMaxAgeDays!==d.defaultMaxAgeDays&&s.add("ui.defaultMaxAgeDays"),e.defaultLimit!==d.defaultLimit&&s.add("ui.defaultLimit"),e.defaultFilterSeen!==d.defaultFilterSeen&&s.add("ui.defaultFilterSeen"),e.defaultFilterApplication!==d.defaultFilterApplication&&s.add("ui.defaultFilterApplication"),e.defaultFilterSourceId!==d.defaultFilterSourceId&&s.add("ui.defaultFilterSourceId"),e.defaultFilterCategoryId!==d.defaultFilterCategoryId&&s.add("ui.defaultFilterCategoryId"),e.defaultFilterQuality!==d.defaultFilterQuality&&s.add("ui.defaultFilterQuality"),e.theme!==d.theme&&s.add("ui.theme"),e.enableMissingPosterView!==d.enableMissingPosterView&&s.add("ui.missingPosterView"),e.animationsEnabled!==d.animationsEnabled&&s.add("ui.animations"),await $e("/api/settings/ui",Ge(e)),N(Ge(e)),qe(e.theme,!0),ze(e.uiLanguage,!0),s.size>0&&(m.current&&clearTimeout(m.current),A(new Set(s)),m.current=setTimeout(()=>{A(new Set)},1200)),s},[e,d]),S=t.useCallback(s=>{v(f=>({...f,theme:s}))},[]);return t.useEffect(()=>{qe(e?.theme)},[e?.theme]),t.useEffect(()=>{ze(e?.uiLanguage)},[e?.uiLanguage]),t.useEffect(()=>{if(typeof document>"u")return;document.documentElement.setAttribute("data-motion",e?.animationsEnabled===!1?"off":"on")},[e?.animationsEnabled]),{ui:e,setUi:v,initialUi:d,isDirty:h,pulseKeys:U,loadUiSettings:b,saveUiSettings:x,handleThemeChange:S}}const ae="feedarr:retroFetch",_e="retro-fetch-posters";function Be(){if(typeof window>"u")return null;try{const n=window.localStorage.getItem(ae);if(!n)return null;const i=JSON.parse(n);return!i||!i.active?null:i.startedAt&&Date.now()-i.startedAt>1e3*60*60*1?(window.localStorage.removeItem(ae),null):i}catch{return null}}function fe(n){if(!(typeof window>"u")){if(!n)window.localStorage.removeItem(ae),Ct(_e);else{try{window.localStorage.setItem(ae,JSON.stringify(n))}catch{}if(n.active){const i=Number(n.total??0),e=Number(n.done??0),v=Number(n.percent??0),d=i>0?`${v}% (${e}/${i})`:"En cours...";He({key:_e,label:"Récupération de posters",meta:d,ttlMs:1e3*60*60})}}window.dispatchEvent(new CustomEvent("storage_change",{detail:{key:ae}}))}}function Ft(){const[n,i]=t.useState(()=>Be()),e=t.useRef(null),v=t.useRef(!1);t.useEffect(()=>{const m=Be();if(m?.active){const h=Number(m.total??0),b=Number(m.done??0),x=Number(m.percent??0),S=h>0?`${x}% (${b}/${h})`:"En cours...";He({key:_e,label:"Récupération de posters",meta:S,ttlMs:1e3*60*60})}},[]);const d=t.useCallback(()=>{e.current&&(clearInterval(e.current),e.current=null),v.current=!1},[]),N=t.useCallback(m=>{if(m.detail.key===ae){const h=Be();i(h),h?.active||d()}},[d]);t.useEffect(()=>(window.addEventListener("storage_change",N),()=>{window.removeEventListener("storage_change",N)}),[N]),t.useEffect(()=>{if(!n?.active){d();return}if(v.current)return;v.current=!0;async function m(){try{const h=Array.isArray(n.ids)?n.ids:[],b=Number(n.startedAtTs??0);let x={...n};if(h.length>0){const S=await me("/api/posters/retro-fetch/progress",{ids:h,startedAtTs:b}),s=Number(S?.total??h.length),f=Number(S?.done??0);if(s>0&&f>=s){fe(null);return}x={...x,done:f,total:s,percent:s>0?Math.round(f/s*100):0}}else{const S=await Z("/api/posters/missing-count"),s=Number(S?.count??0),f=Number(n.startMissing??0),R=Number(n.targetMissing??0),k=Math.max(1,f-R),j=Math.max(0,f-s);if(s<=R||k===0){fe(null);return}x={...x,currentMissing:s,percent:Math.round(j/k*100)}}fe(x)}catch{}}return m(),e.current=setInterval(m,4e3),()=>{d()}},[n,d]);const U=t.useCallback(async()=>{try{const m=await Z("/api/posters/missing-count"),h=Number(m?.count??0),b=await me("/api/posters/retro-fetch",{limit:300}),x=Number(b?.enqueued??0),S=Array.isArray(b?.ids)?b.ids:[],s=Number(b?.startedAtTs??Math.floor(Date.now()/1e3)),f={active:!0,startedAt:Date.now(),startMissing:h,targetMissing:Math.max(0,h-x),enqueued:x,total:Number(b?.total??x),ids:S,startedAtTs:s,currentMissing:h,percent:0,done:0};return fe(f),{task:f,error:null}}catch(m){return{task:null,error:m.message||"Failed to start retro fetch"}}},[]),A=t.useCallback(async()=>{try{return await me("/api/posters/retro-fetch/stop",{}),fe(null),{error:null}}catch(m){return{error:m.message||"Failed to stop retro fetch"}}},[]);return{retroTask:n,startRetroFetch:U,stopRetroFetch:A}}async function Dt(){try{const n=await Z("/api/providers/external");return{ok:!0,data:{definitions:Array.isArray(n?.definitions)?n.definitions:[],instances:Array.isArray(n?.instances)?n.instances:[]}}}catch(n){return console.error("[providers.api] fetchProvidersConfig failed",n),{ok:!1,errorMessage:n?.message||"Chargement impossible."}}}async function Tt(n){try{return{ok:!0,data:await me("/api/providers/external",n)}}catch(i){return console.error("[providers.api] createProviderInstance failed",i),{ok:!1,errorMessage:i?.message||"Sauvegarde impossible."}}}async function Pt(n,i){try{return{ok:!0,data:await $e(`/api/providers/external/${n}`,i)}}catch(e){return console.error("[providers.api] updateProviderInstance failed",e),{ok:!1,errorMessage:e?.message||"Sauvegarde impossible."}}}async function Bt(n){try{return await Nt(`/api/providers/external/${n}`),{ok:!0}}catch(i){return console.error("[providers.api] deleteProviderInstance failed",i),{ok:!1,errorMessage:i?.message||"Suppression impossible."}}}async function Kt(n){try{const i=await me(`/api/providers/external/${n}/test`);return i?.ok===!1?{ok:!1,errorMessage:i?.error||"Test échoué."}:{ok:!0}}catch(i){return console.error("[providers.api] testProviderInstance failed",i),{ok:!1,errorMessage:i?.message||"Test échoué."}}}async function Ut(n,i){try{return await $e(`/api/providers/external/${n}`,{enabled:i}),{ok:!0}}catch(e){return console.error("[providers.api] toggleProviderInstance failed",e),{ok:!1,errorMessage:e?.message||"Activation impossible."}}}const Ke=()=>{typeof window<"u"&&window.dispatchEvent(new Event("onboarding:refresh"))},Ue={};function Xe(n){if(!n)return"";const i=String(n).trim();return i?`has${i.charAt(0).toUpperCase()}${i.slice(1)}`:""}function Re(n,i){if(!i)return!1;const e=(i.fieldsSchema||[]).filter(d=>d.required);if(e.length===0)return!0;const v=n?.authFlags||{};return e.every(d=>!!v[Xe(d.key)])}function Qt(){const[n,i]=t.useState([]),[e,v]=t.useState([]),[d,N]=t.useState(!1),[U,A]=t.useState(""),[m,h]=t.useState(null),[b,x]=t.useState({}),[S,s]=t.useState(!1),[f,R]=t.useState("add"),[k,j]=t.useState(1),[_,$]=t.useState(null),[w,I]=t.useState(""),[re,L]=t.useState(""),[Q,ne]=t.useState(!0),[se,O]=t.useState(""),[G,J]=t.useState({}),[W,ie]=t.useState(!1),[Ce,p]=t.useState(""),[pe,he]=t.useState(!1),[Y,xe]=t.useState(null),[oe,ve]=t.useState(!1),[ye,ee]=t.useState(!1),[V,be]=t.useState(null),[Ne,F]=t.useState(0),[le,Se]=t.useState(0),[de,H]=t.useState(0),[ke,ce]=t.useState(Ue),[o,E]=t.useState(!1),[D,X]=t.useState(!1),[ue,T]=t.useState(""),{retroTask:y,startRetroFetch:Ee,stopRetroFetch:Me}=Ft(),C=t.useMemo(()=>{const a=new Map;return(n||[]).forEach(c=>{a.set(String(c.providerKey||"").toLowerCase(),c)}),a},[n]),q=t.useMemo(()=>{const a=new Set;return(e||[]).forEach(c=>{const u=String(c?.providerKey||"").trim().toLowerCase();u&&a.add(u)}),a},[e]),ge=t.useMemo(()=>(n||[]).filter(a=>{const c=String(a?.providerKey||"").trim().toLowerCase();return c?!q.has(c):!1}),[n,q]),P=t.useMemo(()=>w&&C.get(String(w).toLowerCase())||null,[C,w]),je=t.useMemo(()=>{const a={};return(n||[]).forEach(c=>{const u=String(c.providerKey||""),K=(e||[]).filter(g=>String(g.providerKey||"").toLowerCase()===u.toLowerCase()).some(g=>g.enabled&&Re(g,c));a[u]=K?"ok":null}),a},[n,e]),Ae=t.useMemo(()=>n?.length?n.every(a=>(e||[]).filter(u=>String(u.providerKey||"").toLowerCase()===String(a.providerKey||"").toLowerCase()).some(u=>Re(u,a))):!1,[n,e]),Ze=ge.length>0,te=t.useCallback(()=>{R("add"),j(1),$(null),I(""),L(""),ne(!0),O(""),J({}),ie(!1),p("")},[]),B=t.useCallback(async()=>{N(!0),A("");const a=await Dt();a.ok?(i(a.data.definitions),v(a.data.instances)):(A(a.errorMessage),i([]),v([])),N(!1)},[]),et=t.useCallback(async()=>{try{const[a,c,u]=await Promise.all([Z("/api/posters/count"),Z("/api/posters/missing-count"),Z("/api/system/providers")]);if(F(Number(a?.count??0)),Se(Number(c?.count??0)),u&&typeof u=="object"){const M={};Object.entries(u).forEach(([K,g])=>{!g||typeof g!="object"||(M[String(K).toLowerCase()]={calls:Number(g.calls??0),failures:Number(g.failures??0),avgMs:Number(g.avgMs??0)})}),ce(M)}else ce(Ue)}catch{F(0),Se(0),ce(Ue)}},[]),tt=t.useCallback((a="")=>{te(),R("add");const c=String(a||"").trim();if(c){if(q.has(c.toLowerCase())){p("Provider deja ajoute."),j(1),s(!0);return}const u=C.get(c.toLowerCase());I(c),O(u?.defaultBaseUrl||""),j(2)}else j(1);s(!0)},[C,q,te]),at=t.useCallback(a=>{const c=String(a||"").trim();if(f==="add"&&q.has(c.toLowerCase())){I(""),O(""),J({}),p("Provider deja ajoute.");return}const u=C.get(c.toLowerCase());I(c),O(u?.defaultBaseUrl||""),J({}),p("")},[C,q,f]),rt=t.useCallback(a=>{if(!a)return;te();const c=String(a.providerKey||""),u=C.get(c.toLowerCase());R("edit"),j(2),$(a),I(c),L(a.displayName||""),ne(a.enabled!==!1),O(a.baseUrl||u?.defaultBaseUrl||""),J({}),s(!0)},[C,te]),Ie=t.useCallback(()=>{W||(s(!1),te())},[W,te]),nt=t.useCallback((a,c)=>{J(u=>({...u,[a]:c})),p("")},[]),Le=t.useCallback(a=>{p(""),j(a)},[]),we=t.useCallback(()=>{const a=P;if(!a)return[];const c=(a.fieldsSchema||[]).filter(M=>M.required),u=[];return c.forEach(M=>{String(G[M.key]||"").trim()||f==="edit"&&_?.authFlags?.[Xe(M.key)]||u.push(M.key)}),u},[G,P,_,f]),st=t.useMemo(()=>!P||f==="add"&&k!==2||W?!1:we().length===0,[we,P,f,W,k]),it=t.useCallback(async()=>{const a=P;if(!a){p("Provider invalide.");return}if(f==="add"&&k===1){if(!w){p("Selectionnez un provider.");return}Le(2);return}const c=we();if(c.length>0){p(`Champ(s) requis: ${c.join(", ")}`);return}const u={};(a.fieldsSchema||[]).forEach(g=>{const z=String(G[g.key]||"").trim();z&&(u[g.key]=z)});const M=String(re||"").trim(),K=String(se||"").trim();ie(!0),p("");try{let g;if(f==="add")g=await Tt({providerKey:w,displayName:M||null,enabled:Q,baseUrl:K||null,auth:u,options:{}});else if(_?.instanceId){const z={displayName:M||null,enabled:Q,baseUrl:K||null,options:{}};Object.keys(u).length>0&&(z.auth=u),g=await Pt(_.instanceId,z)}if(g&&!g.ok){p(g.errorMessage);return}Ke(),Ie(),await B()}catch(g){p(g?.message||"Erreur sauvegarde provider metadata")}finally{ie(!1)}},[Ie,we,G,se,P,re,Q,_,f,w,k,Le,B]),ot=t.useCallback(a=>{xe(a||null),he(!0)},[]),Fe=t.useCallback(()=>{oe||(he(!1),xe(null))},[oe]),lt=t.useCallback(async()=>{if(Y?.instanceId){ve(!0);try{const a=await Bt(Y.instanceId);if(!a.ok)throw new Error(a.errorMessage);Ke(),Fe(),await B()}catch(a){throw new Error(a?.message||"Erreur suppression provider metadata")}finally{ve(!1)}}},[Fe,Y,B]),dt=t.useCallback(a=>{be(a||null),ee(!0)},[]),De=t.useCallback(()=>{ee(!1),be(null)},[]),ct=t.useCallback(async()=>{if(V?.instanceId)try{const a=await Ut(V.instanceId,!V.enabled);if(!a.ok)throw new Error(a.errorMessage);Ke(),De(),await B()}catch(a){throw new Error(a?.message||"Erreur activation/desactivation provider metadata")}},[De,V,B]),ut=t.useCallback(async a=>{if(!a)return;const c=Date.now();h(a),x(g=>({...g,[a]:"pending"}));const u=await Kt(a),M=Date.now()-c,K=Math.max(2e3-M,0);setTimeout(()=>{x(g=>({...g,[a]:u.ok?"ok":"error"})),setTimeout(()=>{x(g=>{const z={...g};return delete z[a],z})},1600),h(null)},K)},[]),gt=t.useCallback(async()=>{await B()},[B]),ft=t.useCallback(async()=>!1,[]),mt=t.useCallback(a=>{const c=C.get(String(a?.providerKey||"").toLowerCase());return Re(a,c)},[C]),pt=!!y?.active,Oe=Number(y?.startMissing??0),ht=Number(y?.targetMissing??0),xt=Number(y?.currentMissing??le??0),Te=Number(y?.total??(Array.isArray(y?.ids)?y.ids.length:null)??Math.max(0,Oe-ht)),Ve=Number(y?.done??Math.max(0,Oe-xt)),vt=Te>0?Math.min(100,Math.max(0,Math.round(Ve/Te*100))):0;async function yt(){if(y?.active)return;E(!0),T("");const{error:a}=await Ee();a?(T(a),E(!1)):kt("retro-fetch")}async function bt(){if(!y?.active||D)return;X(!0),T("");const{error:a}=await Me();T(a||"Retro fetch arrete"),X(!1),E(!1)}return{definitions:n,availableExternalDefinitions:ge,instances:e,externalLoading:d,externalError:U,providerStats:ke,loadExternalProviders:B,loadExternalFlags:gt,saveExternalKeys:ft,loadProviderStats:et,canAddExternalProvider:Ze,externalValidationByProvider:je,allProvidersAdded:Ae,isInstanceConfigured:mt,testingExternal:m,testStatusByExternal:b,testExternal:ut,openExternalModalAdd:tt,openExternalModalEdit:rt,closeExternalModal:Ie,goExternalModalStep:Le,saveExternalModal:it,externalModalOpen:S,externalModalMode:f,externalModalStep:k,externalModalInstance:_,externalModalProviderKey:w,setExternalModalProviderKey:I,selectExternalModalProvider:at,externalModalDefinition:P,externalModalDisplayName:re,setExternalModalDisplayName:L,externalModalEnabled:Q,setExternalModalEnabled:ne,externalModalBaseUrl:se,setExternalModalBaseUrl:O,externalModalAuth:G,setExternalModalAuthField:nt,externalModalSaving:W,externalModalError:Ce,canSaveExternalModal:st,openExternalDelete:ot,closeExternalDelete:Fe,confirmExternalDelete:lt,externalDeleteOpen:pe,externalDeleteInstance:Y,externalDeleteLoading:oe,openExternalToggle:dt,closeExternalToggle:De,confirmExternalToggle:ct,externalToggleOpen:ye,externalToggleInstance:V,posterCount:Ne,missingPosterCount:le,releasesCount:de,setReleasesCount:H,retroActive:pt,retroLoading:o,retroStopLoading:D,retroMsg:ue,retroPercent:vt,retroDone:Ve,retroTotal:Te,handleRetroFetch:yt,handleRetroFetchStop:bt}}function Rt(n){if(!n)return"";const i=String(n).trim();return i?`has${i.charAt(0).toUpperCase()}${i.slice(1)}`:""}function Gt({controller:n,showInlineAdd:i=!1}){const[e,v]=t.useState(""),{definitions:d,availableExternalDefinitions:N,instances:U,externalLoading:A,externalError:m,providerStats:h,testingExternal:b,testStatusByExternal:x,isInstanceConfigured:S,testExternal:s,openExternalModalAdd:f,openExternalModalEdit:R,openExternalDelete:k,openExternalToggle:j,externalModalOpen:_,externalModalMode:$,externalModalStep:w,externalModalProviderKey:I,selectExternalModalProvider:re,externalModalDefinition:L,externalModalInstance:Q,externalModalDisplayName:ne,setExternalModalDisplayName:se,externalModalEnabled:O,setExternalModalEnabled:G,externalModalBaseUrl:J,setExternalModalBaseUrl:W,externalModalAuth:ie,setExternalModalAuthField:Ce,externalModalSaving:p,externalModalError:pe,canSaveExternalModal:he,closeExternalModal:Y,goExternalModalStep:xe,saveExternalModal:oe,externalDeleteOpen:ve,externalDeleteInstance:ye,externalDeleteLoading:ee,closeExternalDelete:V,confirmExternalDelete:be,externalToggleOpen:Ne,externalToggleInstance:F,closeExternalToggle:le,confirmExternalToggle:Se}=n,de=N||[],H=de.length>0,ke=t.useMemo(()=>{const o=new Map;return(d||[]).forEach(E=>{o.set(String(E.providerKey||"").toLowerCase(),E)}),o},[d]);function ce(o){const E=o.target.value;v(E),E&&(f(E),v(""))}return r.jsxs(r.Fragment,{children:[i&&r.jsxs("div",{className:"setup-providers__add settings-row settings-row--ui-select",children:[r.jsx("label",{children:l("Provider","Provider")}),r.jsxs("select",{className:"settings-field",value:e,onChange:ce,disabled:!H,children:[r.jsx("option",{value:"",disabled:!0,children:H?l("Selectionner...","Select..."):l("Tous les providers sont deja ajoutes","All providers are already added")}),de.map(o=>r.jsx("option",{value:o.providerKey,children:o.displayName},o.providerKey))]})]}),m&&r.jsx("div",{className:"onboarding__error",children:m}),r.jsx("div",{className:"indexer-list itemrow-grid",children:A?r.jsx("div",{className:"indexer-card",children:r.jsx("div",{className:"indexer-row",children:r.jsx("span",{className:"indexer-url muted",children:l("Chargement...","Loading...")})})}):(U||[]).length===0?r.jsx("div",{className:"indexer-card",children:r.jsx("div",{className:"indexer-row",children:r.jsx("span",{className:"indexer-url muted",children:l("Aucun provider metadata configure","No configured metadata provider")})})}):(U||[]).map((o,E)=>{const D=String(o.providerKey||"").toLowerCase(),X=ke.get(D),ue=x[o.instanceId]==="ok",T=x[o.instanceId]==="error",y=b===o.instanceId,Ee=S(o),Me=h?.[D]||{calls:0,failures:0},C=[ue&&"test-ok",T&&"test-err"].filter(Boolean).join(" "),q={movie:["Films"],tv:["Séries","TV"],artwork:["Artwork"],game:["Games","Jeux"],anime:["Anime"],book:["Livres","Books"],audio:["Musique","Audio"],comic:["Comics","BD"]},ge=X?.kind,P=(q[ge]||[]).map((je,Ae)=>r.jsx(At,{unifiedKey:ge,label:je},Ae));return r.jsx(It,{id:E+1,title:o.displayName||X?.displayName||D.toUpperCase(),meta:`Appels: ${Number(Me.calls||0)} | Echecs: ${Number(Me.failures||0)}`,enabled:o.enabled!==!1,statusClass:C,badges:[...P,{label:Ee?"OK":"NO",className:`${Ee?"pill-ok":"pill-warn"} pill--trailing`}],actions:[{icon:"science",title:y?l("Test en cours...","Test in progress..."):o.enabled===!1?l("Activez d'abord le provider","Enable provider first"):l("Tester","Test"),onClick:()=>s(o.instanceId),disabled:y||o.enabled===!1,spinning:y},{icon:"edit",title:o.enabled===!1?l("Activez d'abord le provider","Enable provider first"):l("Modifier","Edit"),onClick:()=>R(o),disabled:y||o.enabled===!1},{icon:"delete",title:l("Supprimer","Delete"),onClick:()=>k(o),disabled:y,className:"iconbtn--danger"}],showToggle:!0,onToggle:()=>j(o),toggleDisabled:y},o.instanceId)})}),r.jsx(Pe,{open:_,title:$==="add"?w===1?l("Ajouter un provider metadata","Add a metadata provider"):`${l("Configurer","Configure")}: ${L?.displayName||l("Provider","Provider")}`:`${l("Modifier","Edit")}: ${Q?.displayName||L?.displayName||l("Provider","Provider")}`,onClose:Y,width:560,children:r.jsxs("div",{style:{padding:12},children:[$==="add"&&w===1&&r.jsxs("div",{className:"field",style:{marginBottom:12},children:[r.jsx("label",{className:"muted",children:l("Provider","Provider")}),r.jsxs("select",{value:I,onChange:o=>re(o.target.value),disabled:p||!H,children:[r.jsx("option",{value:"",disabled:!0,children:H?l("Selectionner...","Select..."):l("Tous les providers sont deja ajoutes","All providers are already added")}),de.map(o=>r.jsx("option",{value:o.providerKey,children:o.displayName},o.providerKey))]}),!H&&r.jsx("div",{className:"muted",style:{marginTop:8},children:l("Tous les providers sont deja ajoutes","All providers are already added")})]}),($==="edit"||w===2)&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"field",style:{marginBottom:12},children:[r.jsx("label",{className:"muted",children:l("Nom (optionnel)","Name (optional)")}),r.jsx("input",{type:"text",value:ne,onChange:o=>se(o.target.value),placeholder:L?.displayName||"Nom du provider",disabled:p})]}),r.jsxs("div",{className:"field",style:{marginBottom:12},children:[r.jsx("label",{className:"muted",children:l("Base URL (optionnel)","Base URL (optional)")}),r.jsx("input",{type:"text",value:J,onChange:o=>W(o.target.value),placeholder:L?.defaultBaseUrl||"https://",disabled:p})]}),r.jsx("div",{className:"indexer-card",style:{marginBottom:12},children:r.jsxs("div",{className:"indexer-row indexer-row--settings",children:[r.jsx("span",{className:"indexer-title",children:l("Actif","Active")}),r.jsx("div",{className:"indexer-actions",children:r.jsx(Lt,{checked:O,onIonChange:o=>G(o.detail.checked),className:"settings-toggle",disabled:p})})]})}),(L?.fieldsSchema||[]).map(o=>{const E=!!Q?.authFlags?.[Rt(o.key)],D=ie[o.key]||"",X=o.secretPlaceholder||"•••••••• (laisser vide pour conserver)",ue=D||$==="edit"&&E&&o.secret?X:o.placeholder||"";return r.jsxs("div",{className:"field",style:{marginBottom:12},children:[r.jsxs("label",{className:"muted",children:[o.label,o.required?" *":""]}),r.jsx("input",{type:o.secret?"password":o.type||"text",value:D,onChange:T=>Ce(o.key,T.target.value),placeholder:ue,disabled:p})]},o.key)})]}),pe&&r.jsx("div",{className:"onboarding__error",style:{marginBottom:12},children:pe}),r.jsxs("div",{className:"formactions",children:[$==="add"&&w===1?r.jsx("button",{className:"btn btn-accent",type:"button",onClick:()=>xe(2),disabled:!I||p,children:l("Suivant","Next")}):r.jsx("button",{className:"btn btn-accent",type:"button",onClick:oe,disabled:!he||p,children:p?l("Enregistrement...","Saving..."):l("Enregistrer","Save")}),r.jsx("button",{className:"btn",type:"button",onClick:Y,disabled:p,children:l("Annuler","Cancel")})]})]})}),r.jsx(Pe,{open:ve,title:l("Supprimer le provider metadata","Delete metadata provider"),onClose:V,width:520,children:r.jsxs("div",{style:{padding:12},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:8},children:l("Confirmer la suppression ?","Confirm deletion?")}),r.jsxs("div",{className:"muted",style:{marginBottom:12},children:[l("Cette action va supprimer","This action will delete")," ",r.jsx("strong",{children:ye?.displayName||ye?.providerKey||"-"}),".",r.jsx("br",{}),l("Cette action est definitive.","This action is permanent.")]}),r.jsxs("div",{className:"formactions",children:[r.jsx("button",{className:"btn btn-danger",type:"button",onClick:be,disabled:ee,children:ee?l("Suppression...","Deleting..."):l("Supprimer","Delete")}),r.jsx("button",{className:"btn",type:"button",onClick:V,disabled:ee,children:l("Annuler","Cancel")})]})]})}),r.jsx(Pe,{open:Ne,title:F?`${F.enabled?l("Desactiver","Disable"):l("Activer","Enable")} : ${F.displayName||F.providerKey}`:l("Activer/Desactiver","Enable/Disable"),onClose:le,width:520,children:r.jsxs("div",{style:{padding:12},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:8},children:l("Confirmer l'action ?","Confirm action?")}),r.jsx("div",{className:"muted",style:{marginBottom:12},children:F?.enabled?l("Cette action va desactiver le provider.","This action will disable the provider."):l("Cette action va activer le provider.","This action will enable the provider.")}),r.jsxs("div",{className:"formactions",children:[r.jsx("button",{className:"btn",type:"button",onClick:Se,children:F?.enabled?l("Desactiver","Disable"):l("Activer","Enable")}),r.jsx("button",{className:"btn",type:"button",onClick:le,children:l("Annuler","Cancel")})]})]})})]})}const Je={error:"error",warning:"warning",info:"lock",success:"check_circle"};function Jt({variant:n="info",title:i="",message:e=""}){if(!e)return null;const v=Je[n]||Je.info;return r.jsxs("div",{className:`inline-notice inline-notice--${n}`,role:"status","aria-live":"polite",children:[r.jsx("span",{className:"inline-notice__icon","aria-hidden":"true",children:r.jsx(jt,{name:v,size:16})}),r.jsxs("div",{className:"inline-notice__content",children:[!!i&&r.jsx("div",{className:"inline-notice__title",children:i}),r.jsx("div",{className:"inline-notice__message",children:e})]})]})}export{Gt as E,Jt as I,Qt as a,Ge as b,zt as u};
