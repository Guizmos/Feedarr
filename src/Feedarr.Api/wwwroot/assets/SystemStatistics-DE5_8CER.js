import{r as g,j as e,b as V}from"./vendor-react-B6j9w5IJ.js";import{a as K,g as q}from"./index-DavgMby8.js";import{f as F,b as O}from"./systemUtils-B-2RKve6.js";import{t as P}from"./uiText-Dk9tUI9L.js";import{n as E,C as w}from"./categoryGroups.constants-TqNJ0nIh.js";function f(a){return a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(a>=1e4?0:1)+"K":a.toString()}const z="var(--cat-stats-unknown)",T=new Map;function U(a){if(T.has(a))return T.get(a);const t=getComputedStyle(document.documentElement).getPropertyValue(a).trim();return T.set(a,t),t}function N(a){const t=String(a||"").trim().toLowerCase();return t?typeof window>"u"||typeof document>"u"?`var(--cat-${t})`:U(`--cat-${t}`)||z:z}const X={1:{tokenKey:"stats-games",name:"Console"},2:{tokenKey:"stats-films",name:"Films"},3:{tokenKey:"stats-audio",name:"Audio"},4:{tokenKey:"stats-pc",name:"PC"},5:{tokenKey:"stats-series",name:"Séries"},6:{tokenKey:"stats-xxx",name:"XXX"},7:{tokenKey:"stats-books",name:"Livres"},8:{tokenKey:"stats-other",name:"Autre"}},Y={2145:{tokenKey:"stats-animation",name:"Animation"},2185:{tokenKey:"stats-animation",name:"Animation"},5070:{tokenKey:"stats-animation",name:"Anime"},2182:{tokenKey:"stats-emissions",name:"Émissions"},5080:{tokenKey:"stats-emissions",name:"Émissions"},2090:{tokenKey:"stats-spectacle",name:"Spectacle"},2190:{tokenKey:"stats-spectacle",name:"Spectacle"},2178:{tokenKey:"stats-documentaire",name:"Documentaire"},2070:{tokenKey:"stats-documentaire",name:"Documentaire"},2181:{tokenKey:"stats-sport",name:"Sport"},5060:{tokenKey:"stats-sport",name:"Sport"},2188:{tokenKey:"stats-pc",name:"Clip"},2189:{tokenKey:"stats-other",name:"Autre Vidéo"}},$={films:{tokenKey:"stats-films",name:w.films||"Films"},series:{tokenKey:"stats-series",name:w.series||"Série TV"},emissions:{tokenKey:"stats-emissions",name:w.emissions||"Émissions"},games:{tokenKey:"stats-pc",name:w.games||"Jeux Vidéo"},comics:{tokenKey:"stats-books",name:w.comics||"Comics"},books:{tokenKey:"stats-books",name:w.books||"Livres"},audio:{tokenKey:"stats-audio",name:w.audio||"Audio"},anime:{tokenKey:"stats-animation",name:w.anime||"Anime"},spectacle:{tokenKey:"stats-spectacle",name:w.spectacle||"Spectacle"},animation:{tokenKey:"stats-animation",name:w.animation||"Animation"},jeuwindows:{tokenKey:"stats-pc",name:"PC Games"},autre:{tokenKey:"stats-unknown",name:"Autre"}},L={films:"stats-films",series:"stats-series",animation:"stats-animation",anime:"stats-animation",games:"stats-pc",comics:"stats-books",books:"stats-books",audio:"stats-audio",spectacle:"stats-spectacle",emissions:"stats-emissions"};function J(a){if(!a)return{color:N("stats-unknown"),name:"Autre"};let t=a;a>=1e5&&(t=a%1e5);const u=Y[t];if(u)return{color:N(u.tokenKey),name:u.name};const n=Math.floor(t/1e3),x=X[n];return x?{color:N(x.tokenKey),name:x.name}:{color:N("stats-unknown"),name:"Autre"}}function W(a,t){const u=E(t);if(u){const x=$[u],y=x?.tokenKey||L[u]||"stats-unknown",l=w[u]||x?.name||u;return{color:N(y),name:l}}const n=String(t||"").trim().toLowerCase();if(n&&$[n]){const x=$[n];return{color:N(x.tokenKey),name:x.name}}return J(a)}const B=["Films","Séries","Émissions","Spectacle","Documentaire","Animation","Anime","Sport","Musique","Audio","Jeux Vidéo","PC Games","Console","Livres","BD","Mangas","Comics","XXX","Autre"];function A({data:a,valueKey:t,labelKey:u,secondaryKey:n,color:x="#5cb3ff",secondaryColor:y="#f0c54d",height:l=280,showLegend:d=!1,legendLabels:r=[],barGap:s=16,barMaxWidth:m,stretchBars:o=!1,valueFormatter:p=f}){const C=Math.max(...a.map(i=>Math.max(i[t]||0,i[n]||0)),1),k=Math.max(1,a.length),c=o&&k>0?`calc((100% - ${Math.max(0,k-1)*s}px) / ${k})`:void 0,v=o?"space-between":"flex-start";return e.jsxs("div",{style:{height:l,width:"100%",display:"flex",flexDirection:"column"},children:[d&&r.length>0&&e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:24,marginBottom:12,fontSize:12},children:r.map((i,h)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{width:16,height:12,backgroundColor:h===0?x:y,borderRadius:2}}),e.jsx("span",{children:i})]},h))}),e.jsx("div",{style:{flex:1,width:"100%",display:"flex",alignItems:"stretch",gap:s,justifyContent:v},children:a.map((i,h)=>{const j=i[t]||0,b=n&&i[n]||0,M=j/C*100,D=b>0?b/C*100:0;return e.jsxs("div",{style:{flex:o?`0 0 ${c}`:1,width:o?c:"100%",display:"flex",flexDirection:"column",alignItems:"center",minWidth:0},children:[e.jsx("div",{style:{fontSize:12,marginBottom:6,color:"var(--muted)",fontWeight:600},children:j>0?p(j):""}),e.jsxs("div",{style:{flex:1,width:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end",gap:2},children:[n&&b>0&&e.jsx("div",{style:{width:"100%",maxWidth:m??void 0,height:`${Math.max(D,3)}%`,backgroundColor:y,borderRadius:"4px 4px 0 0",margin:"0 auto",transition:"height 0.3s ease"}}),e.jsx("div",{style:{width:"100%",maxWidth:m??void 0,height:`${Math.max(M,3)}%`,backgroundColor:i.color||x,borderRadius:n&&b>0?"0 0 4px 4px":4,margin:"0 auto",transition:"height 0.3s ease"}})]}),e.jsx("div",{style:{fontSize:11,marginTop:8,color:"var(--text)",textAlign:"center",width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i[u]})]},h)})})]})}function H({data:a,valueKey:t,labelKey:u,height:n=200,barGap:x=24}){const y=Math.max(...a.map(l=>l[t]||0),0);return e.jsx("div",{style:{height:n,width:"100%",display:"flex",alignItems:"stretch",gap:x},children:a.map((l,d)=>{const r=l[t]||0,s=y>0?r/y*100:0,m=r<=0?{height:2}:{height:`${Math.max(s,3)}%`};return e.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,marginBottom:6,color:"var(--muted)"},children:r.toFixed(2)}),e.jsx("div",{style:{flex:1,width:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:e.jsx("div",{style:{width:"100%",...m,backgroundColor:r>0?"#f8a0a0":"rgba(248,160,160,0.25)",borderRadius:4,transition:"height 0.3s ease"}})}),e.jsx("div",{style:{fontSize:11,marginTop:8,color:"var(--text)",textAlign:"center",width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l[u]})]},d)})})}function Q({data:a,height:t=260,barGap:u=12}){if(!a||a.length===0)return e.jsx("div",{style:{height:t,display:"flex",alignItems:"center",justifyContent:"center",color:"var(--muted)"},children:"Aucune donnée"});const n=Math.max(...a.map(l=>l.total||0),1),x=new Map;a.forEach(l=>{(l.categories||[]).forEach(d=>{if(!x.has(d.name)){const r=W(d.categoryId,d.unifiedCategory);x.set(d.name,{name:d.name,color:r.color})}})});const y=Array.from(x.values()).sort((l,d)=>{const r=B.indexOf(l.name),s=B.indexOf(d.name);return(r===-1?999:r)-(s===-1?999:s)});return e.jsxs("div",{style:{height:t,width:"100%",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:12,marginTop:20,marginBottom:50,fontSize:11},children:y.slice(0,8).map(l=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("div",{style:{width:10,height:10,backgroundColor:l.color,borderRadius:2}}),e.jsx("span",{style:{color:"var(--muted)"},children:l.name})]},l.name))}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:u,overflow:"auto"},children:a.map((l,d)=>{const r=l.total/n*100;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,minHeight:24},children:[e.jsx("div",{style:{width:50,fontSize:11,color:"var(--text)",textAlign:"right",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexShrink:0},children:l.name}),e.jsx("div",{style:{flex:1,height:20,display:"flex",borderRadius:4,overflow:"hidden",backgroundColor:"var(--page-bg)"},children:(l.categories||[]).map((s,m)=>{const o=l.total>0?s.count/l.total*r:0,p=W(s.categoryId,s.unifiedCategory);return e.jsx("div",{style:{width:`${o}%`,height:"100%",backgroundColor:p.color,transition:"width 0.3s ease"},title:`${p.name}: ${s.count}`},m)})}),e.jsx("div",{style:{width:40,fontSize:11,color:"var(--muted)",textAlign:"right",flexShrink:0},children:f(l.total)})]},d)})})]})}function G({data:a,size:t=200,thickness:u=40}){if(!a||a.length===0)return e.jsx("div",{style:{width:t,height:t,display:"flex",alignItems:"center",justifyContent:"center",color:"var(--muted)"},children:"Aucune donnée"});const n=a.reduce((r,s)=>r+s.value,0);if(n===0)return e.jsx("div",{style:{width:t,height:t,display:"flex",alignItems:"center",justifyContent:"center",color:"var(--muted)"},children:"Aucune donnée"});const x=(t-u)/2,y=t/2,l=2*Math.PI*x;let d=0;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:24,justifyContent:"center"},children:[e.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[a.map((r,s)=>{const m=r.value/n,o=m*l,p=l-o,C=d;return d+=o,e.jsx("circle",{cx:y,cy:y,r:x,fill:"none",stroke:r.color,strokeWidth:u,strokeDasharray:`${o} ${p}`,strokeDashoffset:-C,style:{transition:"stroke-dasharray 0.4s ease, stroke-dashoffset 0.4s ease"},children:e.jsx("title",{children:`${r.label}: ${f(r.value)} (${(m*100).toFixed(1)}%)`})},s)}),e.jsx("text",{x:y,y:y-6,textAnchor:"middle",fill:"var(--text)",fontSize:"18",fontWeight:"800",children:f(n)}),e.jsx("text",{x:y,y:y+14,textAnchor:"middle",fill:"var(--muted)",fontSize:"11",children:"total"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:a.map((r,s)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:2,backgroundColor:r.color,flexShrink:0}}),e.jsx("span",{style:{color:"var(--text)"},children:r.label}),e.jsx("span",{style:{color:"var(--muted)",marginLeft:"auto",fontWeight:600},children:f(r.value)})]},s))})]})}function Z({data:a,height:t=200,color:u="#5cb3ff"}){const n=V.useRef(null),[x,y]=g.useState(0);if(g.useEffect(()=>{if(!n.current)return;const h=new ResizeObserver(j=>{for(const b of j)y(Math.floor(b.contentRect.width))});return h.observe(n.current),()=>h.disconnect()},[]),!a||a.length===0)return e.jsx("div",{ref:n,style:{height:t,display:"flex",alignItems:"center",justifyContent:"center",color:"var(--muted)"},children:"Aucune donnée"});const l=Math.max(...a.map(h=>h.value),1),d={top:20,right:16,bottom:36,left:48},r=Math.max(x,300),s=t,m=r-d.left-d.right,o=s-d.top-d.bottom,p=a.map((h,j)=>{const b=d.left+(a.length>1?j/(a.length-1)*m:m/2),M=d.top+o-h.value/l*o;return{x:b,y:M,...h}}),C=p.map((h,j)=>`${j===0?"M":"L"}${h.x},${h.y}`).join(" "),k=`${C} L${p[p.length-1].x},${d.top+o} L${p[0].x},${d.top+o} Z`,c=4,v=Array.from({length:c+1},(h,j)=>Math.round(l/c*j)),i=Math.max(1,Math.floor(a.length/8));return e.jsx("div",{ref:n,style:{width:"100%"},children:x>0&&e.jsxs("svg",{width:r,height:s,style:{display:"block"},children:[v.map((h,j)=>{const b=d.top+o-h/l*o;return e.jsxs("g",{children:[e.jsx("line",{x1:d.left,y1:b,x2:r-d.right,y2:b,stroke:"var(--panel-border)",strokeWidth:"1"}),e.jsx("text",{x:d.left-8,y:b+4,textAnchor:"end",fill:"var(--muted)",fontSize:"10",children:f(h)})]},j)}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"lineChartGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:u,stopOpacity:"0.25"}),e.jsx("stop",{offset:"100%",stopColor:u,stopOpacity:"0.02"})]})}),e.jsx("path",{d:k,fill:"url(#lineChartGrad)"}),e.jsx("path",{d:C,fill:"none",stroke:u,strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"}),p.map((h,j)=>e.jsxs("g",{children:[e.jsx("circle",{cx:h.x,cy:h.y,r:"3",fill:u,stroke:"var(--panel)",strokeWidth:"1.5",children:e.jsx("title",{children:`${h.label}: ${f(h.value)}`})}),j%i===0&&e.jsx("text",{x:h.x,y:d.top+o+20,textAnchor:"middle",fill:"var(--muted)",fontSize:"10",children:h.label})]},j))]})})}function ee({value:a,onChange:t}){const u=[{v:7,l:"7j"},{v:30,l:"30j"},{v:90,l:"90j"}];return e.jsx("div",{className:"period-selector",children:u.map(n=>e.jsx("button",{className:`period-btn${a===n.v?" period-btn--active":""}`,onClick:()=>t(n.v),children:n.l},n.v))})}function R({id:a,label:t,value:u,sub:n,active:x,onClick:y}){const l=x===a;return e.jsxs("button",{className:`card card-fourth stat-tab${l?" stat-tab--active":""}`,onClick:()=>y(a),type:"button",children:[e.jsx("div",{className:"card-title",style:{fontSize:13},children:t}),e.jsx("div",{className:"card-value",style:{fontSize:22},children:u??"-"}),n&&e.jsx("div",{className:"stat-tab__sub",style:{fontSize:11,color:"var(--muted)",marginTop:2},children:n})]})}function I(){return e.jsx("div",{className:"card",style:{padding:32,textAlign:"center",color:"var(--muted)"},children:"Chargement..."})}function S({title:a,value:t,color:u}){return e.jsxs("div",{style:{textAlign:"center",padding:16,background:"var(--page-bg)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:24,fontWeight:800,color:u||"var(--accent)"},children:t}),e.jsx("div",{style:{fontSize:12,color:"var(--muted)",marginTop:4},children:a})]})}function te({refreshKey:a}){const[t,u]=g.useState(null),[n,x]=g.useState(30),[y,l]=g.useState(""),d=g.useCallback(async c=>{l("");try{const v=await K(`/api/system/stats/feedarr?days=${c}`);u(v)}catch(v){l(v?.message||"Erreur")}},[]);g.useEffect(()=>{d(n)},[a,n,d]);const r=g.useCallback(c=>{x(c)},[]);if(y)return e.jsxs("div",{className:"card",style:{color:"red",fontWeight:700},children:["Erreur: ",y]});if(!t)return e.jsx(I,{});const s=t.releasesCount-(t.missingPosters||0),m=t.releasesCount>0?Math.round(s/t.releasesCount*100):0,o=[];t.storage?.databaseBytes>0&&o.push({label:"Base de données",value:t.storage.databaseBytes,color:"#5cb3ff"}),t.storage?.postersBytes>0&&o.push({label:"Posters",value:t.storage.postersBytes,color:"#22c55e"}),t.storage?.backupsBytes>0&&o.push({label:"Backups",value:t.storage.backupsBytes,color:"#f59e0b"});const p=(t.releasesPerDay||[]).map(c=>({label:c.date?.slice(5)||"",value:c.count})),C={sonarr:{color:"#5cb3ff",label:"Sonarr"},radarr:{color:"#f59e0b",label:"Radarr"},overseerr:{color:"#ef4444",label:"Overseerr"},jellyseerr:{color:"#14b8a6",label:"Jellyseerr"},seer:{color:"#a855f7",label:"Seer"}},k=(Array.isArray(t.arrApps)?t.arrApps:[]).map(c=>{const v=String(c?.type||"").toLowerCase(),i=v==="overseerr"||v==="jellyseerr"||v==="seer",h=Math.max(0,Math.trunc(Number(t?.sonarrMatchedCount||0))),j=Math.max(0,Math.trunc(Number(t?.radarrMatchedCount||0))),b=v==="sonarr"?h:v==="radarr"?j:Number.isFinite(Number(c?.displayCount))?Number(c.displayCount):Number(c?.lastSyncCount||0),M=c?.countMode||(i?"requests":"matches"),D=C[v]||{color:"var(--accent)",label:v||"Application"},_=!!c?.enabled;return{id:c?.id??`${v}-${c?.name||"app"}`,name:String(c?.name||D.label),typeLabel:D.label,color:D.color,enabled:_,displayCount:Math.max(0,Math.trunc(b)),metricLabel:M==="requests"?"demandes":"éléments matchés"}});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card",style:{padding:20,marginBottom:20},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[e.jsx(S,{title:"Uptime",value:F(t.uptimeSeconds)}),e.jsx(S,{title:"Taille base",value:`${t.dbSizeMB||0} Mo`}),e.jsx(S,{title:"Posters locaux",value:f(t.localPosters||0)})]})}),e.jsxs("div",{className:"card",style:{padding:"12px 16px",marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[e.jsx("div",{className:"card-title",children:"Releases par jour"}),e.jsx(ee,{value:n,onChange:r})]}),e.jsx(Z,{data:p,height:220,color:"#5cb3ff"})]}),e.jsxs("div",{className:"card-row card-row-third",style:{marginBottom:20},children:[e.jsxs("div",{className:"card card-third",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Couverture Posters"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,padding:"8px 0"},children:[e.jsxs("div",{style:{fontSize:40,fontWeight:800,color:m>=70?"#22c55e":m>=50?"#f59e0b":"#ef4444"},children:[m,"%"]}),e.jsx("div",{style:{width:"85%",height:10,background:"var(--page-bg)",borderRadius:5,overflow:"hidden"},children:e.jsx("div",{style:{width:`${m}%`,height:"100%",background:m>=70?"#22c55e":m>=50?"#f59e0b":"#ef4444",borderRadius:5,transition:"width 0.4s ease"}})}),e.jsxs("div",{style:{fontSize:11,color:"var(--muted)",textAlign:"center"},children:[f(s)," / ",f(t.releasesCount)," releases"]})]})]}),e.jsxs("div",{className:"card card-third",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Posters Affichés"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,padding:"8px 0"},children:[e.jsxs("div",{style:{fontSize:40,fontWeight:800,color:m>=80?"#22c55e":m>=50?"#f59e0b":"#ef4444"},children:[m,"%"]}),e.jsx("div",{style:{display:"flex",gap:16,fontSize:12,color:"var(--muted)"},children:e.jsxs("span",{children:[f(t.distinctPosterFiles||t.localPosters||0)," fichiers uniques"]})}),e.jsxs("div",{style:{fontSize:11,color:"var(--muted)",textAlign:"center"},children:[f(t.missingPosters||0)," manquants"]})]})]}),e.jsxs("div",{className:"card card-third",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Réutilisation Posters"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,padding:"8px 0"},children:[e.jsxs("div",{style:{fontSize:40,fontWeight:800,color:(t.posterReuseRatio||0)>=2?"#8b5cf6":"var(--accent)"},children:[t.posterReuseRatio||"—","x"]}),e.jsx("div",{style:{fontSize:12,color:"var(--muted)",textAlign:"center"},children:"releases par poster"}),e.jsxs("div",{style:{fontSize:11,color:"var(--muted)",textAlign:"center"},children:[f(t.distinctPosterFiles||0)," posters pour ",f(t.releasesWithPoster||0)," releases"]})]})]})]}),e.jsxs("div",{className:"card-row card-row-half system-feedarr-wide",style:{marginBottom:20},children:[e.jsxs("div",{className:"card card-half system-feedarr-wide-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:16},children:"Répartition stockage"}),o.length>0?e.jsx(G,{data:o.map(c=>({...c,label:`${c.label} (${O(c.value)})`,value:c.value})),size:160,thickness:32}):e.jsx("div",{style:{color:"var(--muted)",textAlign:"center",padding:24},children:"Aucune donnée"})]}),e.jsxs("div",{className:"card card-half system-feedarr-wide-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:16},children:"Applications"}),k.length>0?e.jsxs(e.Fragment,{children:[e.jsx(A,{data:k.map(c=>({name:c.name,count:c.displayCount,color:c.enabled?c.color:"var(--panel-border)"})),labelKey:"name",valueKey:"count",height:180,stretchBars:!0}),e.jsx("div",{style:{marginTop:12,display:"flex",flexWrap:"wrap",gap:10,justifyContent:"center"},children:k.map(c=>e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:11,color:"var(--muted)",padding:"4px 8px",background:"var(--page-bg)",borderRadius:999},children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:c.enabled?c.color:"var(--panel-border)",display:"inline-block"}}),e.jsx("span",{style:{color:"var(--text)"},children:c.name}),!c.enabled&&e.jsx("span",{children:"(désactivée)"})]}),e.jsxs("span",{style:{fontWeight:700,color:"var(--text)"},children:[f(c.displayCount)," ",c.metricLabel]})]},c.id))})]}):e.jsx("div",{style:{color:"var(--muted)",textAlign:"center",padding:24},children:"Aucune application connectée"})]})]})]})}function se({refreshKey:a}){const[t,u]=g.useState(null),[n,x]=g.useState("");g.useEffect(()=>{(async()=>{x("");try{u(await K("/api/system/stats/indexers"))}catch(r){x(r?.message||"Erreur")}})()},[a]);const y=g.useMemo(()=>{if(!t?.releasesByCategoryByIndexer)return[];const r={};return t.releasesByCategoryByIndexer.forEach(s=>{r[s.sourceName]||(r[s.sourceName]={name:s.sourceName,categoriesMap:{},total:0});const m=W(s.categoryId,s.unifiedCategory),o=m.name;r[s.sourceName].categoriesMap[o]||(r[s.sourceName].categoriesMap[o]={categoryId:s.categoryId,unifiedCategory:s.unifiedCategory,name:m.name,count:0}),r[s.sourceName].categoriesMap[o].count+=s.count,r[s.sourceName].total+=s.count}),Object.values(r).map(s=>({name:s.name,total:s.total,categories:Object.values(s.categoriesMap).sort((m,o)=>(B.indexOf(m.name)===-1?999:B.indexOf(m.name))-(B.indexOf(o.name)===-1?999:B.indexOf(o.name)))})).sort((s,m)=>m.total-s.total).slice(0,8)},[t?.releasesByCategoryByIndexer]);if(n)return e.jsxs("div",{className:"card",style:{color:"red",fontWeight:700},children:["Erreur: ",n]});if(!t)return e.jsx(I,{});const l=(t.indexerStatsBySource||[]).map(r=>({name:r.name,releases:r.releaseCount,failed:r.lastStatus==="error"?1:0})),d=(t.indexerResponseMsBySource||[]).map(r=>({name:r.name,avgMs:Number(r.avgMs||0)}));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card",style:{padding:20,marginBottom:20},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16},children:[e.jsx(S,{title:"Requêtes totales",value:f(t.queries||0)}),e.jsx(S,{title:"Échecs requêtes",value:t.failures||0,color:t.failures>0?"#ef4444":void 0}),e.jsx(S,{title:"Sync Jobs",value:f(t.syncJobs||0)}),e.jsx(S,{title:"Échecs sync",value:t.syncFailures||0,color:t.syncFailures>0?"#ef4444":void 0})]})}),(l.length>0||d.length>0)&&e.jsxs("div",{className:"card-row card-row-half system-mobile-full-row",style:{marginBottom:20},children:[l.length>0&&e.jsxs("div",{className:"card card-half system-mobile-full-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Releases par fournisseur"}),e.jsx(A,{data:l,valueKey:"releases",labelKey:"name",color:"#5cb3ff",height:260,barGap:24,barMaxWidth:110})]}),d.length>0&&e.jsxs("div",{className:"card card-half system-mobile-full-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Temps de réponse"}),e.jsx(A,{data:d,valueKey:"avgMs",labelKey:"name",color:"#22c55e",height:260,barGap:24,barMaxWidth:110,valueFormatter:r=>`${Math.round(r)} ms`})]})]}),y.length>0&&e.jsxs("div",{className:"card",style:{padding:"12px 12px 12px 8px",marginBottom:20},children:[e.jsx("div",{className:"card-title",style:{marginBottom:8},children:"Catégories par indexeur"}),e.jsx(Q,{data:y,height:260,barGap:8})]}),t.indexerDetails?.length>0&&e.jsxs("div",{className:"card",style:{padding:20},children:[e.jsx("div",{className:"card-title",style:{marginBottom:16},children:"Détail fournisseurs"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"stats-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:P("Nom","Name")}),e.jsx("th",{children:P("Actif","Active")}),e.jsx("th",{children:"Releases"}),e.jsx("th",{children:"Dernier Sync"}),e.jsx("th",{children:"Statut"}),e.jsx("th",{children:P("Derniers items","Last items")})]})}),e.jsx("tbody",{children:t.indexerDetails.map(r=>e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:600},children:r.name}),e.jsx("td",{children:e.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",backgroundColor:r.enabled?"#22c55e":"#94a3b8"}})}),e.jsx("td",{children:f(r.releaseCount)}),e.jsx("td",{style:{fontSize:12,color:"var(--muted)"},children:r.lastSyncAtTs?new Date(r.lastSyncAtTs*1e3).toLocaleString(q()):"-"}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-badge--${r.lastStatus==="ok"?"ok":r.lastStatus==="error"?"error":"unknown"}`,children:r.lastStatus||"-"})}),e.jsx("td",{children:r.lastItemCount||0})]},r.id))})]})})]})]})}function ae({refreshKey:a}){const[t,u]=g.useState(null),[n,x]=g.useState({definitions:[],instances:[]}),[y,l]=g.useState("");if(g.useEffect(()=>{(async()=>{l("");try{const[i,h]=await Promise.all([K("/api/system/stats/providers"),K("/api/providers/external")]);u(i||{}),x({definitions:Array.isArray(h?.definitions)?h.definitions:[],instances:Array.isArray(h?.instances)?h.instances:[]})}catch(i){l(i?.message||"Erreur")}})()},[a]),y)return e.jsxs("div",{className:"card",style:{color:"red",fontWeight:700},children:["Erreur: ",y]});if(!t)return e.jsx(I,{});const d={tmdb:"TMDB",tvmaze:"TVmaze",fanart:"Fanart",igdb:"IGDB",jikan:"Jikan (MAL)",googlebooks:"Google Books",theaudiodb:"TheAudioDB",comicvine:"Comic Vine"},r=(n?.instances||[]).filter(i=>i?.enabled!==!1).map(i=>String(i?.providerKey||"").toLowerCase()).filter(Boolean),s=Array.from(new Set(r)).sort((i,h)=>i.localeCompare(h)),m=s.map(i=>({provider:d[i]||i.toUpperCase(),calls:Number(t?.[i]?.calls||0),failures:Number(t?.[i]?.failures||0),avgMs:Number(t?.[i]?.avgMs||0)})),o=t?._matchingByProvider&&typeof t._matchingByProvider=="object"?t._matchingByProvider:{},p=s.map(i=>({provider:d[i]||i.toUpperCase(),matched:Number(o[i]||0)})),C=m.map(i=>({provider:i.provider,rate:i.calls>0?i.failures/i.calls:0})),k=m.reduce((i,h)=>i+h.calls,0),c=m.reduce((i,h)=>i+h.failures,0),v=k>0?(c/k*100).toFixed(1)+"%":"0%";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card",style:{padding:20,marginBottom:20},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[e.jsx(S,{title:"Total Appels",value:f(k)}),e.jsx(S,{title:"Total échecs",value:f(c),color:c>0?"#ef4444":void 0}),e.jsx(S,{title:"Taux d'échec global",value:v,color:c>0?"#f59e0b":void 0})]})}),e.jsxs("div",{className:"card-row card-row-third system-mobile-full-row",style:{marginBottom:20},children:[e.jsxs("div",{className:"card card-third system-mobile-full-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Appels API"}),e.jsx(A,{data:m,valueKey:"calls",labelKey:"provider",color:"#5cb3ff",height:200,barGap:8,stretchBars:!0})]}),e.jsxs("div",{className:"card card-third system-mobile-full-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Taux d'échec"}),e.jsx(H,{data:C,valueKey:"rate",labelKey:"provider",height:200})]}),e.jsxs("div",{className:"card card-third system-mobile-full-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Temps de réponse moyen"}),e.jsx(A,{data:m,valueKey:"avgMs",labelKey:"provider",color:"#22c55e",height:200,barGap:8,stretchBars:!0})]})]}),e.jsxs("div",{className:"card",style:{padding:"12px 16px",marginBottom:20},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Matching"}),e.jsx(A,{data:p,valueKey:"matched",labelKey:"provider",color:"#f59e0b",height:220,barGap:12,stretchBars:!0})]}),e.jsxs("div",{className:"card",style:{padding:20},children:[e.jsx("div",{className:"card-title",style:{marginBottom:16},children:"Détail Métadonnées"}),e.jsxs("table",{className:"stats-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Provider"}),e.jsx("th",{children:"Appels"}),e.jsx("th",{children:"Échecs"}),e.jsx("th",{children:"Taux échec"}),e.jsx("th",{children:P("Temps moyen","Average time")})]})}),e.jsx("tbody",{children:m.map(i=>e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:600},children:i.provider}),e.jsx("td",{children:f(i.calls)}),e.jsx("td",{style:{color:i.failures>0?"#ef4444":void 0},children:i.failures}),e.jsx("td",{children:i.calls>0?(i.failures/i.calls*100).toFixed(2)+"%":"0%"}),e.jsx("td",{children:i.avgMs>0?`${i.avgMs} ms`:"-"})]},i.provider))})]})]})]})}function re({refreshKey:a}){const[t,u]=g.useState(null),[n,x]=g.useState("");if(g.useEffect(()=>{(async()=>{x("");try{u(await K("/api/system/stats/releases"))}catch(s){x(s?.message||"Erreur")}})()},[a]),n)return e.jsxs("div",{className:"card",style:{color:"red",fontWeight:700},children:["Erreur: ",n]});if(!t)return e.jsx(I,{});const y=(t.releasesByCategory||[]).slice().sort((s,m)=>(m.count||0)-(s.count||0)).slice(0,10).map(s=>{const m=s.key||s.categoryKey||"",o=E(m),p=o&&L[o]||"stats-unknown";return{key:o||String(m||"").toLowerCase(),label:o?w[o]||s.label||o:s.label||s.key||"Autre",value:s.count||0,color:N(p)}}),l=new Map(y.map(s=>[String(s.key||"").toLowerCase(),s.color])),d=(t.sizeDistribution||[]).filter(s=>s.range!=="Inconnu"),r=(t.seedersDistribution||[]).filter(s=>s.range!=="Inconnu");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card",style:{padding:20,marginBottom:20},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[e.jsx(S,{title:"Total Releases",value:f(t.releasesCount||0)}),e.jsx(S,{title:"Avec Poster",value:f(t.withPoster||0),color:"#22c55e"}),e.jsx(S,{title:"Sans Poster",value:f(t.missingPoster||0),color:t.missingPoster>0?"#f59e0b":"#22c55e"})]})}),e.jsxs("div",{className:"card-row card-row-half system-mobile-full-row",style:{marginBottom:20},children:[e.jsxs("div",{className:"card card-half system-mobile-full-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:16},children:"Top Catégories"}),e.jsx(G,{data:y,size:190,thickness:36})]}),e.jsxs("div",{className:"card card-half system-mobile-full-card",style:{padding:"12px 16px"},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Distribution par taille"}),e.jsx(A,{data:d.map(s=>({label:s.range,value:s.count})),valueKey:"value",labelKey:"label",color:"#8b5cf6",height:200,barGap:8,stretchBars:!0})]})]}),e.jsxs("div",{className:"card",style:{padding:"12px 16px",marginBottom:20},children:[e.jsx("div",{className:"card-title",style:{marginBottom:12},children:"Distribution Seeders"}),e.jsx(A,{data:r.map(s=>({label:s.range,value:s.count})),valueKey:"value",labelKey:"label",color:"#22c55e",height:200,barGap:12,stretchBars:!0})]}),t.topGrabbed?.length>0&&e.jsxs("div",{className:"card",style:{padding:20},children:[e.jsx("div",{className:"card-title",style:{marginBottom:16},children:"Top Releases (Grabs)"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"stats-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"45%"},children:"Titre"}),e.jsx("th",{children:"Catégorie"}),e.jsx("th",{children:"Grabs"}),e.jsx("th",{children:"Seeders"}),e.jsx("th",{children:"Taille"})]})}),e.jsx("tbody",{children:t.topGrabbed.map((s,m)=>{const o=E(s.categoryKey)||String(s.categoryKey||"").toLowerCase(),p=o?w[o]||s.categoryLabel||s.categoryKey||"Autre":s.categoryLabel||s.categoryKey||"Autre",C=l.get(o)||N(o&&L[o]||"stats-unknown");return e.jsxs("tr",{children:[e.jsx("td",{style:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:s.title,children:s.title}),e.jsx("td",{children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:2,backgroundColor:C,display:"inline-block"}}),p]})}),e.jsx("td",{style:{fontWeight:700,color:"var(--accent)"},children:s.grabs}),e.jsx("td",{children:s.seeders}),e.jsx("td",{children:O(s.sizeBytes)})]},m)})})]})})]})]})}function de({refreshKey:a=0}){const[t,u]=g.useState("feedarr"),[n,x]=g.useState(null),[y,l]=g.useState("");return g.useEffect(()=>{(async()=>{l("");try{x(await K("/api/system/stats/summary"))}catch(d){l(d?.message||"Erreur chargement statistiques")}})()},[a]),y?e.jsxs("div",{className:"card",style:{color:"red",fontWeight:700},children:["Erreur: ",y]}):e.jsxs("section",{className:"system-section",children:[e.jsxs("div",{className:"card-row card-row-fourth",style:{marginBottom:0},children:[e.jsx(R,{id:"feedarr",label:"Feedarr",active:t,onClick:u,value:n?.version??"...",sub:n?F(n.uptimeSeconds):null}),e.jsx(R,{id:"indexers",label:"Fournisseurs",active:t,onClick:u,value:n?`${n.activeIndexers} actifs`:"...",sub:n?`${f(n.totalQueries)} requêtes`:null}),e.jsx(R,{id:"providers",label:"Métadonnées",active:t,onClick:u,value:n?f(n.totalCalls):"...",sub:n?`${n.totalFailures} échecs`:null}),e.jsx(R,{id:"releases",label:"Releases",active:t,onClick:u,value:n?f(n.releasesCount):"...",sub:n?`${n.matchingPercent}% matchés`:null})]}),t==="feedarr"&&e.jsx(te,{refreshKey:a}),t==="indexers"&&e.jsx(se,{refreshKey:a}),t==="providers"&&e.jsx(ae,{refreshKey:a}),t==="releases"&&e.jsx(re,{refreshKey:a})]})}export{de as S};
