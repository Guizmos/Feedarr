import{r as o,j as r}from"./vendor-react-B6j9w5IJ.js";import{r as Y,A as q,c as ae,a as oe}from"./index-CDoNWBDE.js";import{M as Ne}from"./Modal-nSKvSdtX.js";import{b as pe}from"./sourceColors-KACkINRj.js";import{n as ne,g as H}from"./appTypes-BSxyKsC5.js";import{n as X}from"./categoryGroups.constants-TqNJ0nIh.js";import{p as ve,K as ye,h as Me,N as Ae,J as Se,I as Ce,C as ie}from"./vendor-icons-CUZlM7O3.js";function ce(s){const e=X(s?.mediaType||s?.unifiedCategoryKey);return e==="series"||e==="anime"||e==="emissions"}function de(s){const e=X(s?.mediaType||s?.unifiedCategoryKey);return e==="films"||e==="spectacle"}function we(s){const e=Number(s?.season),a=Number(s?.episode);return Number.isFinite(e)&&e>0&&Number.isFinite(a)&&a>0?`S${String(e).padStart(2,"0")}E${String(a).padStart(2,"0")}`:Number.isFinite(e)&&e>0?`S${String(e).padStart(2,"0")}`:""}function ue(s){const e=String(s||"").trim();if(!e)return"";const a=e.toUpperCase();return/(^|[^A-Z0-9])(VFF|TRUEFRENCH|FR[-_. ]?FR)(?=[^A-Z0-9]|$)/.test(a)?"VFF":/(^|[^A-Z0-9])(VFQ)(?=[^A-Z0-9]|$)/.test(a)?"VFQ":/(^|[^A-Z0-9])(VQ|QCF|FR[-_. ]?CA|QUEBEC)(?=[^A-Z0-9]|$)/.test(a)?"VQ":/(^|[^A-Z0-9])(VOSTFR)(?=[^A-Z0-9]|$)/.test(a)?"VOSTFR":/(^|[^A-Z0-9])(VO)(?=[^A-Z0-9]|$)/.test(a)?"VO":/(^|[^A-Z0-9])(VF|FRENCH|FR)(?=[^A-Z0-9]|$)/.test(a)?"VF":""}function j(s,e){if(Array.isArray(e)){e.forEach(l=>j(s,l));return}if(e==null)return;if(typeof e=="object"){j(s,e?.code),j(s,e?.name),j(s,e?.label),j(s,e?.value),j(s,e?.lang),j(s,e?.language);return}const a=String(e).trim();a&&s.push(a)}function Re(s){if(!s)return"";const e=[];j(e,s?.language),j(e,s?.lang),j(e,s?.languages),j(e,s?.audioLanguage),j(e,s?.audioLanguages),j(e,s?.audioLang);for(const l of e){const m=ue(l);if(m)return m}const a=[];j(a,s?.title),j(a,s?.titleClean),j(a,s?.releaseGroup);for(const l of a){const m=ue(l);if(m)return m}return""}function Le(s){const e=String(s||"").toUpperCase();return e==="VFF"?"banner-pill banner-pill--lang-vff":e==="VFQ"||e==="VQ"?"banner-pill banner-pill--lang-vfq":e==="VOSTFR"?"banner-pill banner-pill--lang-vostfr":e==="VO"?"banner-pill banner-pill--lang-vo":e?"banner-pill banner-pill--lang":"banner-pill"}function Te(s){const e=String(s?.mediaType||s?.unifiedCategoryKey||"").toLowerCase(),a=X(e);return e?a==="films"?"Films":a==="series"?"Serie TV":a==="anime"?"Anime":a==="emissions"?"Emission":a==="games"?"Jeu":a==="spectacle"?"Spectacle":a==="audio"?"Audio":a==="books"?"Livre":a==="comics"?"Comic":a==="animation"?"Animation":["audio","music"].includes(e)?"Audio":["book","books","livre","livres"].includes(e)?"Livre":["comic","comics","bd","manga"].includes(e)?"Comic":s?.unifiedCategoryLabel||e:s?.unifiedCategoryLabel||""}function Ie(s){const e=Number(s);if(!Number.isFinite(e)||e<=0)return"";const a=Math.floor(e/60),l=Math.round(e%60);return a<=0?`${l}m`:`${a}h${String(l).padStart(2,"0")}`}function Ue(s){if(!s)return null;if(s.igdbUrl)return s.igdbUrl;if(String(s.detailsProvider||"").toLowerCase()==="igdb"&&s.detailsProviderId)return null;const a=Number(s.tmdbId);if(Number.isFinite(a)&&a>0){const l=X(s.mediaType||s.unifiedCategoryKey);return l==="series"||l==="anime"||l==="emissions"?`https://www.themoviedb.org/tv/${a}`:`https://www.themoviedb.org/movie/${a}`}return null}function Ee(s){const e=String(s?.unifiedCategoryKey||"").toLowerCase(),a=String(s?.mediaType||"").toLowerCase(),l=String(s?.detailsProvider||"").toLowerCase();return e==="games"||a==="game"||l==="igdb"}function Fe(s,e){const a=Number(s);return!Number.isFinite(a)||a<=0?null:(Ee(e),a>10?a/10:a)}function $e(s){const e=Fe(s?.rating,s);if(!Number.isFinite(e)||e<=0)return"";const a=Number(s?.ratingVotes),l=Number.isFinite(a)&&a>0?` (${a})`:"";return`${e.toFixed(1)}/10${l}`}function ke(s){return String(s||"").toUpperCase().replace(/[^A-Z0-9]/g,"")}function Be(s){const e=ke(s);return e==="YGEGE"?"banner-pill--indexer-ygege":e==="C411"?"banner-pill--indexer-c411":e==="TOS"?"banner-pill--indexer-tos":e==="LACALE"?"banner-pill--indexer-lacale":""}function nr({open:s,item:e,onClose:a,onDownload:l,categoryLabel:m,indexerLabel:f,indexerColor:_,hasSonarr:h=!1,hasRadarr:g=!1,hasOverseerr:u=!1,hasJellyseerr:x=!1,hasSeer:c=!1,integrationMode:y="arr",arrStatus:t=null,onArrStatusChange:M}){const[N,C]=o.useState("main"),[L,b]=o.useState(!1),[w,n]=o.useState(""),[p,A]=o.useState(null),B=e?.titleClean?.trim()||e?.title||"Details",E=Y(e?.posterUrl||""),D=o.useMemo(()=>we(e),[e]),V=o.useMemo(()=>Te(e),[e]),F=o.useMemo(()=>Re(e),[e]),T=e?.resolution||"",G=o.useMemo(()=>[V,D,F,T,e?.codec,e?.releaseGroup].filter(Boolean),[e,V,D,F,T]),$=String(f||"").trim(),W=Be($),S=o.useMemo(()=>pe(_),[_]),I=e?.overview||e?.synopsis||e?.description||e?.plot||e?.summary||"",P=o.useMemo(()=>[{label:"Sortie",value:e?.releaseDate},{label:"Duree",value:Ie(e?.runtimeMinutes)},{label:"Note",value:$e(e)},{label:"Genres",value:e?.genres},{label:"Realisateur",value:e?.directors},{label:"Scenaristes",value:e?.writers},{label:"Cast",value:e?.cast}].filter(i=>i.value),[e]),Z=o.useMemo(()=>Ue(e),[e]),O=(()=>{const i=String(T).toLowerCase();return i.includes("2160")||i.includes("4k")?"banner-pill banner-pill--4k":i.includes("1080")?"banner-pill banner-pill--1080":i.includes("720")?"banner-pill banner-pill--720":"banner-pill"})();o.useEffect(()=>{s&&(C("main"),b(!1),n(""),A(null))},[s,e?.id]);const v=ne(y),Q=h&&ce(e),ee=g&&de(e),R=v==="arr"?Q?"sonarr":ee?"radarr":null:null,d=v==="overseerr"||v==="jellyseerr"||v==="seer"?v:null,le=d==="overseerr"?u:d==="jellyseerr"?x:d==="seer"?c:!1,J=de(e)?"movie":ce(e)?"tv":null,fe=!!d&&!!J,z=d||R,U=z?H(z):"",he=t?.inSonarr||p?.status==="exists"||p?.status==="added",me=t?.inRadarr||p?.status==="exists"||p?.status==="added",_e=t?.inOverseerr||p?.status==="exists"||p?.status==="added",ge=t?.inJellyseerr||p?.status==="exists"||p?.status==="added",xe=t?.inSeer||p?.status==="exists"||p?.status==="added",be=v==="arr"?Q&&he||ee&&me:d==="overseerr"&&_e||d==="jellyseerr"&&ge||d==="seer"&&xe,te=p?.openUrl||(v==="arr"?Q?t?.sonarrUrl:t?.radarrUrl:d==="overseerr"?t?.overseerrUrl:d==="jellyseerr"?t?.jellyseerrUrl:t?.seerUrl);async function je(){if(!(!z||!e)){b(!0),n(""),A(null);try{if(v==="arr"){const i=R==="sonarr"?"/api/arr/sonarr/add":"/api/arr/radarr/add",re=R==="sonarr"?{tvdbId:e.tvdbId||0,title:e.titleClean||e.title}:{tmdbId:e.tmdbId||0,title:e.titleClean||e.title,year:e.year||null};if(R==="sonarr"&&!e.tvdbId){n("ID TVDB manquant pour cet élément"),b(!1);return}if(R==="radarr"&&!e.tmdbId){n("ID TMDB manquant pour cet élément"),b(!1);return}const k=await ae(i,re);k?.ok?(A({status:k.status,openUrl:k.openUrl,appName:k.appName}),M?.(e.id,R,{inSonarr:R==="sonarr",inRadarr:R==="radarr",sonarrUrl:R==="sonarr"?k.openUrl:t?.sonarrUrl,radarrUrl:R==="radarr"?k.openUrl:t?.radarrUrl})):n(k?.message||"Erreur lors de l'ajout")}else{if(!d||!J)return;if(!le){n(`${H(d)} non configuré`),b(!1);return}if(J==="movie"&&!e.tmdbId){n("ID TMDB manquant pour créer une demande"),b(!1);return}const i=await ae("/api/arr/request/add",{appType:d,releaseId:e.id||null,tmdbId:e.tmdbId||null,tvdbId:e.tvdbId||null,mediaType:J,title:e.titleClean||e.title,year:e.year||null});i?.ok?(A({status:i.status,openUrl:i.openUrl,appName:i.appName||H(d)}),M?.(e.id,d,{inOverseerr:d==="overseerr",inJellyseerr:d==="jellyseerr",inSeer:d==="seer",overseerrUrl:d==="overseerr"?i.openUrl:t?.overseerrUrl,jellyseerrUrl:d==="jellyseerr"?i.openUrl:t?.jellyseerrUrl,seerUrl:d==="seer"?i.openUrl:t?.seerUrl})):n(i?.message||"Erreur lors de la demande")}}catch(i){n(i?.message||"Erreur lors de l'action")}finally{b(!1)}}}return r.jsx(Ne,{open:s,onClose:a,title:B,width:920,modalClassName:"modal--details",children:e?r.jsx("div",{className:"releaseModal",children:r.jsxs("div",{className:"releaseModal__grid",children:[r.jsxs("div",{className:"releaseModal__poster",children:[E?r.jsx("img",{src:E,alt:B,loading:"lazy"}):r.jsx("div",{className:"releaseModal__posterFallback",children:"??"}),Z&&r.jsx("a",{href:Z,target:"_blank",rel:"noopener noreferrer",className:"releaseModal__externalLink",title:"Voir sur TMDB / IGDB",children:"i"})]}),r.jsxs("div",{className:"releaseModal__meta",children:[r.jsx("div",{className:"releaseModal__content",children:N==="main"?r.jsxs(r.Fragment,{children:[(G.length>0||$)&&r.jsxs("div",{className:"releaseModal__pills",children:[r.jsx("div",{className:"releaseModal__pillsLeft",children:G.map((i,re)=>r.jsx("span",{className:i===D?"banner-pill banner-pill--episode":i===T?O:i===F?Le(F):"banner-pill",children:i},`${i}-${re}`))}),$?r.jsx("div",{className:"releaseModal__pillsRight",children:r.jsx("span",{className:`banner-pill banner-pill--indexer${W?` ${W}`:""}`,style:S||void 0,children:$})}):null]}),r.jsxs("div",{className:"releaseModal__overview",children:[P.length>0&&r.jsx("div",{className:"releaseModal__info",children:P.map(i=>r.jsxs("div",{className:"releaseModal__infoRow",children:[r.jsx("span",{className:"releaseModal__infoLabel",children:i.label}),r.jsx("span",{className:"releaseModal__infoValue",children:i.value})]},i.label))}),r.jsx("div",{className:"releaseModal__overviewLabel",children:"Synopsis"}),r.jsx("div",{className:"releaseModal__overviewText",children:I||"Aucune description disponible."})]})]}):r.jsxs("div",{className:"releaseModal__rows",children:[r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Titre clean"}),r.jsx("span",{className:"releaseModal__value",children:e.titleClean||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Annee"}),r.jsx("span",{className:"releaseModal__value",children:e.year||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Saison / Episode"}),r.jsx("span",{className:"releaseModal__value",children:D||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Groupe"}),r.jsx("span",{className:"releaseModal__value",children:e.releaseGroup||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Categorie"}),r.jsx("span",{className:"releaseModal__value",children:m||e.categoryId||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Media type"}),r.jsx("span",{className:"releaseModal__value",children:e.mediaType||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Qualite"}),r.jsx("span",{className:"releaseModal__value",children:e.resolution||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Langue"}),r.jsx("span",{className:"releaseModal__value",children:F||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Source"}),r.jsx("span",{className:"releaseModal__value",children:e.source||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"Codec"}),r.jsx("span",{className:"releaseModal__value",children:e.codec||"-"})]}),r.jsxs("div",{className:"releaseModal__row",children:[r.jsx("span",{className:"releaseModal__label",children:"ID"}),r.jsx("span",{className:"releaseModal__value",children:e.id??"-"})]})]})}),r.jsxs("div",{className:"releaseModal__bottom",children:[r.jsxs("div",{className:"releaseModal__footer",children:[r.jsxs("div",{className:"releaseModal__footerItem",children:[r.jsx("span",{className:"releaseModal__footerLabel",children:"Seeders"}),r.jsx("span",{className:"releaseModal__footerValue",children:e.seeders??"-"}),r.jsx("span",{className:"releaseModal__footerSep",children:"•"}),r.jsx("span",{className:"releaseModal__footerLabel",children:"Leechers"}),r.jsx("span",{className:"releaseModal__footerValue",children:e.leechers??"-"})]}),r.jsxs("div",{className:"releaseModal__footerItem releaseModal__footerItem--center",children:[r.jsx("span",{className:"releaseModal__footerLabel",children:"Taille"}),r.jsx("span",{className:"releaseModal__footerValue",children:e.size||"-"})]}),r.jsxs("div",{className:"releaseModal__footerItem releaseModal__footerItem--right",children:[r.jsx("span",{className:"releaseModal__footerLabel",children:"Publie"}),r.jsx("span",{className:"releaseModal__footerValue",children:e.date||"-"})]})]}),w&&r.jsx("div",{className:"releaseModal__arrError",children:w}),r.jsxs("div",{className:"releaseModal__actions",children:[r.jsxs("div",{className:"releaseModal__actionsLeft",children:[r.jsxs("button",{className:"btn-icon btn-icon--accent releaseModal__expandBtn releaseModal__expandBtn--download",type:"button",onClick:()=>l?.(e),"aria-label":"Télécharger cette release",title:"Télécharger",children:[r.jsx(ve,{size:18,strokeWidth:2.5}),r.jsx("span",{className:"releaseModal__expandBtnLabel",children:"Télécharger"})]}),N==="main"?r.jsxs("button",{className:"btn-icon btn-icon--details releaseModal__expandBtn releaseModal__expandBtn--details",type:"button",onClick:()=>C("details"),"aria-label":"Afficher les détails",title:"Détails",children:[r.jsx(ye,{size:18,strokeWidth:2.5}),r.jsx("span",{className:"releaseModal__expandBtnLabel",children:"Détails"})]}):null,(Q||ee||fe)&&(be?r.jsx("div",{className:"releaseModal__arrStatus",children:te?r.jsxs("a",{href:te,target:"_blank",rel:"noopener noreferrer",className:`releaseModal__arrBadge releaseModal__arrBadge--${z} releaseModal__arrBadge--link`,children:[r.jsx(q,{name:"check_circle",size:16}),U]}):r.jsxs("span",{className:`releaseModal__arrBadge releaseModal__arrBadge--${z}`,children:[r.jsx(q,{name:"check_circle",size:16}),U]})}):v==="arr"&&p?.status==="fallback"?r.jsx("div",{className:"releaseModal__arrStatus",children:p.openUrl?r.jsxs("a",{href:p.openUrl,target:"_blank",rel:"noopener noreferrer",className:"releaseModal__arrBadge releaseModal__arrBadge--warn releaseModal__arrBadge--link",children:[r.jsx(q,{name:"warning",size:16}),"Non trouvé - Ouvrir ",p.appName||U]}):r.jsxs("span",{className:"releaseModal__arrBadge releaseModal__arrBadge--warn",children:[r.jsx(q,{name:"warning",size:16}),"Non trouvé"]})}):r.jsx("button",{className:`btn-icon releaseModal__expandBtn releaseModal__expandBtn--add btn-soft--${z}${L?" releaseModal__expandBtn--loading":""}`,type:"button",onClick:je,"aria-label":v==="arr"?`Ajouter à ${U}`:`Ajouter à ${U}`,title:v==="arr"?`Ajouter à ${U}`:`Ajouter à ${U}`,disabled:L||v!=="arr"&&!le,children:L?r.jsxs(r.Fragment,{children:[r.jsx(Me,{size:16,strokeWidth:2.5,className:"releaseModal__arrSpin"}),r.jsx("span",{className:"releaseModal__expandBtnLabel",children:v==="arr"?"Ajout...":"Demande..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(Ae,{size:18,strokeWidth:2.75}),r.jsx("span",{className:"releaseModal__expandBtnLabel",children:v==="arr"?`Ajouter à ${U}`:`Ajouter à ${U}`})]})}))]}),N!=="main"?r.jsx("button",{className:"btn-soft",type:"button",onClick:()=>C("main"),children:"Retour"}):r.jsx("button",{className:"btn-soft",type:"button",onClick:a,children:"Fermer"})]})]})]})]})}):null})}function K(s,e,a){console.error(e,a),typeof s=="function"&&s(e)}function lr(s,e={}){const{onError:a}=e;if(typeof window>"u")return!1;try{const l=String(s||"").trim();if(!l)return K(a,"URL de telechargement manquante.",null),!1;if(!l.startsWith("/api/"))return K(a,"URL de telechargement invalide.",null),!1;const m=Y(l),f=new URL(m,window.location.origin);if(!(f.protocol==="http:"||f.protocol==="https:")||!f.pathname.startsWith("/api/"))return K(a,"URL de telechargement refusee.",null),!1;const h=window.open(f.toString(),"_blank","noopener,noreferrer");return h?(h.opener=null,!0):(K(a,"Le telechargement a ete bloque par le navigateur.",null),!1)}catch(l){return K(a,"Impossible d'ouvrir le lien de telechargement.",l),!1}}function De(s,e="Une erreur est survenue"){const a=s?.message;return typeof a=="string"&&a.trim()?a.trim():e}async function tr(s,e={}){const{context:a="Async operation failed",setError:l,fallbackMessage:m="Une erreur est survenue",clearError:f,onError:_,onFinally:h,rethrow:g=!1}=e;typeof f=="function"&&f();try{return await s()}catch(u){if(e.ignoreAbort&&u?.name==="AbortError")return null;console.error(a,u);const x=De(u,m);if(typeof l=="function"&&l(x),typeof _=="function"&&_(u,x),g)throw u;return null}finally{typeof h=="function"&&h()}}function or({pollMs:s=6e4}={}){const[e,a]=o.useState([]),[l,m]=o.useState("arr"),[f,_]=o.useState(!0),h=o.useRef(null),g=o.useRef(!1),u=o.useCallback(async()=>{if(!g.current){g.current=!0;try{const[n,p]=await Promise.allSettled([oe("/api/apps"),oe("/api/settings/general")]),A=n.status==="fulfilled"?n.value:[],B=p.status==="fulfilled"?p.value:null,E=ne(B?.requestIntegrationMode);a(Array.isArray(A)?A:[]),m(E)}catch{}finally{_(!1),g.current=!1}}},[]);o.useEffect(()=>{if(u(),s>0)return h.current=setInterval(u,s),()=>h.current&&clearInterval(h.current)},[u,s]);const x=e.filter(n=>n.type==="sonarr"&&n.isEnabled&&n.hasApiKey),c=e.filter(n=>n.type==="radarr"&&n.isEnabled&&n.hasApiKey),y=e.filter(n=>n.type==="overseerr"&&n.isEnabled&&n.hasApiKey),t=e.filter(n=>n.type==="jellyseerr"&&n.isEnabled&&n.hasApiKey),M=e.filter(n=>n.type==="seer"&&n.isEnabled&&n.hasApiKey),N=()=>x.find(n=>n.isDefault)||x[0]||null,C=()=>c.find(n=>n.isDefault)||c[0]||null,L=()=>y.find(n=>n.isDefault)||y[0]||null,b=()=>t.find(n=>n.isDefault)||t[0]||null,w=()=>M.find(n=>n.isDefault)||M[0]||null;return{apps:e,integrationMode:l,loading:f,refresh:u,sonarrApps:x,radarrApps:c,overseerrApps:y,jellyseerrApps:t,seerApps:M,hasSonarr:x.length>0,hasRadarr:c.length>0,hasOverseerr:y.length>0,hasJellyseerr:t.length>0,hasSeer:M.length>0,getDefaultSonarr:N,getDefaultRadarr:C,getDefaultOverseerr:L,getDefaultJellyseerr:b,getDefaultSeer:w}}const se=[2e3,4e3,8e3,15e3,3e4,6e4,12e4,18e4,3e5,6e5],Ve=2e4;function Pe(s){if(!s)return!1;const e=String(s);if(e.startsWith("/api/posters/")||e.startsWith("/posters/"))return!0;if(/^https?:\/\//i.test(e))try{const a=new URL(e);return a.pathname.startsWith("/api/posters/")||a.pathname.startsWith("/posters/")}catch{return!1}return!1}function Oe(s,e){if(!s||!e)return s;const a=s.includes("?")?"&":"?";return`${s}${a}cb=${e}`}function ze(s,e){const[a,l]=o.useState(0),[m,f]=o.useState(!1),[_,h]=o.useState(!1),g=o.useRef(null),u=o.useRef(!1),x=o.useRef(0),c=o.useRef(null),y=o.useRef(!1),t=o.useMemo(()=>e||(s?`/api/posters/release/${s}`:""),[s,e]),M=o.useMemo(()=>{const b=Oe(t,a);return Y(b)},[t,a]),N=o.useCallback(()=>{g.current&&(clearTimeout(g.current),g.current=null),c.current&&(clearTimeout(c.current),c.current=null)},[]);o.useEffect(()=>{N(),f(!1),h(!1),l(0),u.current=!1,x.current=0,y.current=!1},[t,N]),o.useEffect(()=>()=>N(),[N]);const C=o.useCallback(()=>{f(!1),_&&h(!1),c.current&&(clearTimeout(c.current),c.current=null)},[_]),L=o.useCallback(async()=>{if(f(!0),!s||!t||!Pe(t))return;if(!g.current&&x.current<se.length&&(c.current||(c.current=setTimeout(()=>{c.current=null,h(!1)},Ve)),h(!0)),!y.current&&!u.current){u.current=!0;let w=!1;try{w=(await fetch(Y(t),{method:"HEAD",cache:"no-store",credentials:"include"})).status===404}catch{w=!1}if(w){y.current=!0;try{await ae(`/api/posters/${s}/refresh`)}catch{}}u.current=!1}if(g.current)return;if(x.current>=se.length){c.current&&(clearTimeout(c.current),c.current=null),h(!1);return}const b=se[x.current];x.current+=1,g.current=setTimeout(()=>{g.current=null,l(Date.now()),f(!1)},b)},[t,s]);return{posterSrc:M,imgError:m,refreshing:_,handleImageError:L,handleImageLoad:C}}function ir({item:s,onOpen:e,selectionMode:a=!1,selected:l=!1,onToggleSelect:m,onRename:f,sortBy:_="date",hideRename:h=!1,indexerLabel:g,indexerColor:u,showIndexerPill:x=!1,indexerPillPosition:c="left",integrationMode:y="arr",arrStatus:t=null}){const M=!!s.seen,N=ne(y),C=o.useMemo(()=>s.titleClean?.trim()?s.titleClean:s.title,[s.titleClean,s.title]),L=s.posterUrl||(s.id?`/api/posters/release/${s.id}`:""),{posterSrc:b,imgError:w,handleImageError:n,handleImageLoad:p}=ze(s.id,L),A=String(g||"").trim(),B=x&&A,E=Ge(A),D=o.useMemo(()=>pe(u),[u]),V=String(s?.posterLastError||"").toLowerCase(),F=!!V&&V!=="pending",T=!!s?.posterUrl&&!!b&&!w,G=!T&&V==="pending",$=!T&&F,W=!T&&!G&&!$;return r.jsxs("div",{className:"posterCard"+(l?" posterCard--selected":""),onClick:()=>{a?m?.(s):e?.(s)},style:a||e?{cursor:"pointer"}:void 0,title:a?"Cliquer pour sélectionner":"Ouvrir les détails",children:[r.jsxs("div",{className:"poster",children:[T?r.jsx("img",{src:b,alt:C||"",loading:"lazy",onError:n,onLoad:p}):r.jsx("div",{className:"posterFallback",children:G?r.jsx("div",{className:"posterLoader"}):$?r.jsx(Se,{className:"posterFallback__icon"}):W?r.jsx(Ce,{className:"posterFallback__icon"}):null}),B?r.jsx("div",{className:`posterIndexerPill posterIndexerPill--${c==="right"?"right":"left"}`,children:r.jsx("span",{className:`banner-pill banner-pill--indexer${E?` ${E}`:""}`,style:D||void 0,children:A})}):null,!a&&(()=>{let S=null,I=null;if(N==="overseerr"&&t?.inOverseerr)S="overseerr",I=t?.overseerrUrl||null;else if(N==="jellyseerr"&&t?.inJellyseerr)S="jellyseerr",I=t?.jellyseerrUrl||null;else if(N==="seer"&&t?.inSeer)S="seer",I=t?.seerUrl||null;else if(N==="arr"&&(t?.inSonarr||t?.inRadarr)){const O=!!t.inSonarr;S=O?"sonarr":"radarr",I=O?t?.sonarrUrl||null:t?.radarrUrl||null}if(!S)return null;const P=H(S),Z=`posterArrBadge posterArrBadge--${S}`+(I?" posterArrBadge--link":"");return I?r.jsxs("a",{href:I,target:"_blank",rel:"noopener noreferrer",className:Z,onClick:O=>O.stopPropagation(),title:`Ouvrir dans ${P}`,children:[r.jsx(ie,{className:"posterArrBadge__icon"}),r.jsx("span",{className:"posterArrBadge__label",children:P})]}):r.jsxs("div",{className:Z,children:[r.jsx(ie,{className:"posterArrBadge__icon"}),r.jsx("span",{className:"posterArrBadge__label",children:P})]})})(),!a&&!h&&f&&r.jsx("button",{type:"button",className:"posterRenameBtn",title:"Renommer",onClick:S=>{S.stopPropagation(),f?.(s)},children:r.jsx(q,{name:"edit"})}),a&&r.jsx("div",{className:"selectBadge"+(l?" on":""),children:l?r.jsx(q,{name:"check"}):""})]}),r.jsx("div",{className:"statusline"+(M?"":" on")}),r.jsxs("div",{className:"posterMeta",children:[r.jsx("div",{className:"posterTitle",title:s.title,children:C}),_==="seeders"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"posterSub posterSubAlt",children:r.jsxs("span",{children:["Date: ",s.date||"-"]})}),r.jsx("div",{className:"posterSub",children:r.jsxs("span",{children:["Seeders: ",s.seeders??"-"]})})]}):_==="rating"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"posterSub posterSubAlt",children:r.jsxs("span",{children:["Date: ",s.date||"-"]})}),r.jsx("div",{className:"posterSub",children:r.jsxs("span",{children:["Note: ",We(s)]})})]}):_==="downloads"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"posterSub posterSubAlt",children:r.jsxs("span",{children:["Date: ",s.date||"-"]})}),r.jsx("div",{className:"posterSub",children:r.jsxs("span",{children:["Téléchargé: ",s.grabs??"-"]})})]}):_==="recent"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"posterSub posterSubAlt",children:r.jsxs("span",{children:["Seeders: ",s.seeders??"-"]})}),r.jsx("div",{className:"posterSub",children:r.jsxs("span",{children:["Date: ",s.date||"-"]})})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"posterSub posterSubAlt",children:r.jsxs("span",{children:["Seeders: ",s.seeders??"-"]})}),r.jsx("div",{className:"posterSub",children:r.jsxs("span",{children:["Date: ",s.date||"-"]})})]})]})]})}function qe(s){return String(s||"").toUpperCase().replace(/[^A-Z0-9]/g,"")}function Ge(s){const e=qe(s);return e==="YGEGE"?"banner-pill--indexer-ygege":e==="C411"?"banner-pill--indexer-c411":e==="TOS"?"banner-pill--indexer-tos":e==="LACALE"?"banner-pill--indexer-lacale":""}function Ze(s){const e=String(s?.unifiedCategoryKey||"").toLowerCase(),a=String(s?.mediaType||"").toLowerCase(),l=String(s?.detailsProvider||"").toLowerCase();return e==="games"||a==="game"||l==="igdb"}function Ke(s,e){const a=Number(s);return!Number.isFinite(a)||a<=0?null:(Ze(e),a>10?a/10:a)}function We(s){const e=Ke(s?.rating,s);if(!Number.isFinite(e)||e<=0)return"-";const a=Number(s?.ratingVotes),l=Number.isFinite(a)&&a>0?` (${a})`:"";return`${e.toFixed(1)}/10${l}`}export{ir as P,nr as R,or as a,tr as e,lr as o,ze as u};
