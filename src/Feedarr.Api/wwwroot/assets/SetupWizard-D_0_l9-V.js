import{r as s,j as e}from"./vendor-react-B6j9w5IJ.js";import{D as _e,a as ie,n as qe,j as ra,b as ze,L as xa,c as Ae,f as ta,h as fa}from"./index-Dw1RV2ov.js";import{t as a}from"./uiText-D9t7ygxs.js";import{b as Oe,a as va,E as ja}from"./ExternalProviderInstancesSection-Cy1oqaoH.js";import{I as aa}from"./ItemRow-CUbYQkrM.js";import{M as sa}from"./Modal-CnEzehYC.js";import{C as wa,m as na,e as ba,c as ia}from"./CategoryMappingBoard-Ckj4q9xo.js";import{n as oa,C as Sa}from"./categoryGroups.constants-TqNJ0nIh.js";import{i as ka,g as Ee,a as Na}from"./appTypes-BSxyKsC5.js";import{W as Ca}from"./vendor-icons-BuPyRjLk.js";import{b as Aa}from"./vendor-router-DbNMZja2.js";import"./Loader-WjrgZmWo.js";import"./formatters-Bh97CVLp.js";function Ia({onStatusChange:o}){const[t,f]=s.useState(!0),[l,j]=s.useState(!1),[_,P]=s.useState(""),[M,A]=s.useState(_e),[K,i]=s.useState(null),J=s.useRef(0),U=s.useCallback(async()=>{f(!0),P("");try{const y=await ie("/api/settings/ui"),E=Oe(y||{}),k=qe(E.uiLanguage||_e);i(E),A(k),ra(k,!0)}catch(y){i(Oe({uiLanguage:_e,mediaInfoLanguage:_e})),A(_e),P(y?.message||a("Erreur chargement langue","Language loading error"))}finally{f(!1)}},[]);s.useEffect(()=>{U()},[U]);const V=s.useCallback(async y=>{const E=K||Oe({}),k=qe(y||_e),G=J.current+1;J.current=G,j(!0),P("");try{const F=Oe(E,{uiLanguage:k,mediaInfoLanguage:k}),D=await ze("/api/settings/ui",F);if(G!==J.current)return;const u=Oe(D||F),w=qe(u.uiLanguage||k);i(u),A(w),ra(w,!0)}catch(F){if(G!==J.current)return;P(F?.message||a("Erreur sauvegarde langue","Language save error"))}finally{G===J.current&&j(!1)}},[K]);function Y(y){const E=qe(y.target.value);A(E),V(E)}const b=s.useMemo(()=>({ready:!t&&!l&&!!M&&!_,saving:l,error:_}),[_,t,l,M]);return s.useEffect(()=>{o?.(b)},[o,b]),e.jsxs("div",{className:"setup-step setup-language",children:[e.jsx("h2",{children:a("Langue","Language")}),e.jsx("p",{children:a("Choisis la langue par defaut de Feedarr.","Choose Feedarr default language.")}),e.jsxs("div",{className:"setup-providers__add settings-row settings-row--ui-select",children:[e.jsx("label",{children:a("Langue par defaut","Default language")}),e.jsx("select",{className:"settings-field",value:M,onChange:Y,disabled:t||l,children:xa.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))})]}),e.jsx("div",{className:"muted",children:a("Cette etape applique la langue UI et la langue metadata par defaut.","This step sets both UI and metadata default language.")}),t&&e.jsx("div",{className:"muted",children:a("Chargement...","Loading...")}),l&&e.jsx("div",{className:"muted",children:a("Enregistrement...","Saving...")}),_&&e.jsx("div",{className:"onboarding__error",style:{marginTop:12},children:_}),_&&e.jsx("div",{className:"setup-jackett__actions",style:{marginTop:12},children:e.jsx("button",{className:"btn",type:"button",onClick:()=>U(),disabled:t||l,children:a("Reessayer","Retry")})})]})}function Pa(){return e.jsxs("div",{className:"setup-step",children:[e.jsx("h2",{children:a("Bienvenue","Welcome")}),e.jsx("p",{children:a("Configuration rapide en 7 etapes.","Quick setup in 7 steps.")}),e.jsx("p",{className:"muted",children:a("Resume : langue -> metadata -> fournisseurs RSS -> indexeurs -> applications.","Summary: language -> metadata -> RSS providers -> indexers -> applications.")})]})}function Ma(o){if(!o)return!1;const t=String(o).trim().replace(/^\[(.*)\]$/,"$1").toLowerCase();return t==="localhost"||t==="127.0.0.1"||t==="::1"}function Ua(o){const t=String(o||"").trim();if(!t)return!1;try{const f=new URL(t);return!Ma(f.hostname)}catch{return!1}}function _a({required:o=!1,onStatusChange:t}){const[f,l]=s.useState(!0),[j,_]=s.useState(!1),[P,M]=s.useState(""),A=s.useRef(null),K=s.useRef(null),[i,J]=s.useState({authMode:"smart",publicBaseUrl:"",username:"",password:"",passwordConfirmation:"",hasPassword:!1,authConfigured:!1,authRequired:o}),U=s.useCallback(async()=>{l(!0),M("");try{const m=await ie("/api/settings/security");J(h=>({...h,authMode:m?.authMode||"smart",publicBaseUrl:m?.publicBaseUrl||"",username:m?.username||"",password:"",passwordConfirmation:"",hasPassword:!!m?.hasPassword,authConfigured:!!m?.authConfigured,authRequired:!!m?.authRequired}))}catch(m){M(m?.message||a("Erreur chargement securite","Security loading error"))}finally{l(!1)}},[]);s.useEffect(()=>{U()},[U]);const V=i.authMode==="smart"||i.authMode==="strict",Y=Ua(i.publicBaseUrl),b=V&&!!i.authRequired&&!i.authConfigured,y=V&&(Y||b),E=y&&!String(i.username||"").trim(),k=i.hasPassword||!!String(i.password||"").trim(),G=y&&!k,D=(!!i.password||!!i.passwordConfirmation)&&(!String(i.password||"").trim()||!String(i.passwordConfirmation||"").trim()||i.password!==i.passwordConfirmation),u=E||G||D,w=y?a("Identifiants obligatoires: en mode Smart/Strict quand l'auth est requise (URL publique ou proxy), renseigne username et password.","Credentials required: in Smart/Strict mode when auth is required (public URL or proxy), set username and password."):"",O=s.useCallback(async()=>{if(u){const m=E||G?w:a("Password et confirmation doivent etre renseignes et identiques.","Password and confirmation are required and must match.");M(m),E?A.current?.focus():(G||D)&&K.current?.focus();return}_(!0),M("");try{const m={authMode:i.authMode,publicBaseUrl:i.publicBaseUrl,username:i.username};(i.password||i.passwordConfirmation)&&(m.password=i.password,m.passwordConfirmation=i.passwordConfirmation);const h=await ze("/api/settings/security",m);J(S=>({...S,authMode:h?.authMode||S.authMode,publicBaseUrl:h?.publicBaseUrl||S.publicBaseUrl,username:h?.username||S.username,password:"",passwordConfirmation:"",hasPassword:!!h?.hasPassword,authConfigured:!!h?.authConfigured,authRequired:!!h?.authRequired}))}catch(m){const h=m?.message||a("Erreur sauvegarde securite","Security save error"),S=String(h).toLowerCase();S.includes("credentials_required")||S.includes("credentials are required")?(M(h),String(i.username||"").trim()?i.hasPassword||String(i.password||"").trim()||K.current?.focus():A.current?.focus()):M(h)}finally{_(!1)}},[u,i,G,D,E,w]),R=s.useMemo(()=>{const m=!!i.authRequired||!!o;return{ready:(!m||i.authConfigured||i.authMode==="open")&&!u&&!j,saving:j,error:P,authRequired:m,authConfigured:!!i.authConfigured,authMode:i.authMode}},[u,P,i.authConfigured,i.authMode,i.authRequired,o,j]);return s.useEffect(()=>{t?.(R)},[t,R]),e.jsxs("div",{className:"setup-step setup-security",children:[e.jsx("h2",{children:a("Securite","Security")}),e.jsx("p",{children:a("Configure le mode d'acces de Feedarr.","Configure Feedarr access mode.")}),f&&e.jsx("div",{className:"muted",children:a("Chargement...","Loading...")}),P&&e.jsx("div",{className:"onboarding__error",children:P}),!f&&e.jsxs(e.Fragment,{children:[R.authRequired&&!R.authConfigured&&e.jsx("div",{className:"onboarding__error",children:a("Configuration securite requise avant de continuer.","Security setup is required before continuing.")}),y&&e.jsx("div",{className:"onboarding__error",children:w}),e.jsxs("div",{className:"indexer-list",children:[e.jsxs("div",{className:"indexer-card",children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Auth Mode"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:i.authMode,onChange:m=>J(h=>({...h,authMode:m.target.value})),disabled:j,children:[e.jsx("option",{value:"smart",children:"Smart (default)"}),e.jsx("option",{value:"strict",children:"Strict"}),e.jsx("option",{value:"open",children:"Open"})]})})]}),e.jsx("div",{className:"settings-help",children:a("Smart protege automatiquement si instance exposee.","Smart mode protects automatically if the instance is exposed.")})]}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Public Base URL"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"text",value:i.publicBaseUrl,onChange:m=>J(h=>({...h,publicBaseUrl:m.target.value})),placeholder:"https://example.com/feedarr",disabled:j})})]})}),i.authMode!=="open"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Username"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{ref:A,type:"text",value:i.username,onChange:m=>J(h=>({...h,username:m.target.value})),placeholder:a("Entrez username","Enter username"),className:E?"is-error":"",required:y,disabled:j})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Password"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{ref:K,type:"password",value:i.password,onChange:m=>J(h=>({...h,password:m.target.value})),placeholder:i.hasPassword?a("Laisser vide pour conserver","Leave blank to keep current"):a("Entrez password","Enter password"),className:G||D?"is-error":"",required:y&&!i.hasPassword,disabled:j})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Password Confirmation"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"password",value:i.passwordConfirmation,onChange:m=>J(h=>({...h,passwordConfirmation:m.target.value})),placeholder:a("Confirmez password","Confirm password"),className:D?"is-error":"",required:y&&!i.hasPassword,disabled:j})})]})})]})]}),e.jsx("div",{className:"setup-jackett__actions",style:{marginTop:16},children:e.jsx("button",{className:"btn btn-accent",type:"button",onClick:O,disabled:j||u,children:j?a("Enregistrement...","Saving..."):a("Enregistrer","Save")})})]})]})}const Ea={};function La({validation:o,onValidationChange:t,onAllProvidersAddedChange:f}){const l=va();s.useEffect(()=>{l.loadExternalProviders(),l.loadProviderStats()},[l.loadExternalProviders,l.loadProviderStats]),s.useEffect(()=>{t&&t(_=>({..._||Ea,...l.externalValidationByProvider}))},[l.externalValidationByProvider,t]),s.useEffect(()=>{f?.(l.allProvidersAdded)},[l.allProvidersAdded,f]);const j=Object.values(o||l.externalValidationByProvider||{}).some(_=>_==="ok");return e.jsxs("div",{className:"setup-step setup-providers",children:[e.jsx("h2",{children:a("Metadonnees","Metadata")}),e.jsx("p",{children:a("Ajoute au moins un provider metadata configure et actif.","Add at least one configured and enabled metadata provider.")}),!j&&e.jsx("div",{className:"onboarding__error",children:a("Configure au moins un provider metadata pour continuer.","Configure at least one metadata provider to continue.")}),e.jsx(ja,{controller:l,showInlineAdd:!0})]})}const $e="feedarr:jackettProvider",Le=[{key:"jackett",label:"Jackett",placeholder:"http://192.168.1.x:9117 ou https://domaine.tld/jackett",endpoint:"/api/jackett/indexers"},{key:"prowlarr",label:"Prowlarr",placeholder:"http://192.168.1.x:9696 ou https://domaine.tld/prowlarr",endpoint:"/api/prowlarr/indexers"}],Ce={jackett:{baseUrl:"feedarr:jackettBaseUrl",apiKey:"feedarr:jackettApiKey",indexers:"feedarr:jackettIndexersCache",configured:"feedarr:jackettConfigured",manualOnly:"feedarr:jackettManualOnly"},prowlarr:{baseUrl:"feedarr:prowlarrBaseUrl",apiKey:"feedarr:prowlarrApiKey",indexers:"feedarr:prowlarrIndexersCache",configured:"feedarr:prowlarrConfigured",manualOnly:"feedarr:prowlarrManualOnly"}},Se={baseUrl:"",indexers:[],configured:!1,manualOnly:!1};function He(o){return String(o||"").trim().replace(/\/+$/,"")}function Qe(o){return Le.find(t=>t.key===o)||Le[0]}function la(o){const t=Ce[o];if(!t||typeof window>"u")return{...Se};const f=window.localStorage.getItem(t.baseUrl)||"",l=window.localStorage.getItem(t.configured)==="true",j=window.localStorage.getItem(t.indexers)||"",_=j?JSON.parse(j)||[]:[],P=window.localStorage.getItem(t.manualOnly)==="true";return{baseUrl:f,configured:l&&!!f,indexers:Array.isArray(_)?_:[],manualOnly:P}}function Ta({onStatusChange:o,resetToken:t,initialStatus:f}){const[l,j]=s.useState(""),[_,P]=s.useState(""),[M,A]=s.useState(""),[K,i]=s.useState(""),[J,U]=s.useState(!1),[V,Y]=s.useState(!1),[b,y]=s.useState("idle"),[E,k]=s.useState(""),[G,F]=s.useState(0),[D,u]=s.useState(""),[w,O]=s.useState(!1),[R,m]=s.useState([]),[h,S]=s.useState({jackett:{...Se},prowlarr:{...Se}}),[se,N]=s.useState(!1),C=s.useRef(!1),z=s.useRef(null);s.useEffect(()=>{if(typeof window>"u")return;Object.values(Ce).forEach(L=>{window.localStorage.removeItem(L.apiKey)});const d=window.localStorage.getItem($e)||"";if(d==="prowlarr"){const L=Ce.jackett,pe=Ce.prowlarr,Q=window.localStorage.getItem(pe.configured)==="true",ne=window.localStorage.getItem(L.baseUrl)||"",de=window.localStorage.getItem(L.configured)==="true",ue=window.localStorage.getItem(L.indexers)||"";!Q&&(de||ne)&&(window.localStorage.setItem(pe.baseUrl,ne),ue&&window.localStorage.setItem(pe.indexers,ue),window.localStorage.setItem(pe.configured,de?"true":"false"),window.localStorage.removeItem(L.baseUrl),window.localStorage.removeItem(L.apiKey),window.localStorage.removeItem(L.indexers),window.localStorage.removeItem(L.configured))}const v={jackett:la("jackett"),prowlarr:la("prowlarr")};S(v);const T=d==="prowlarr"?"prowlarr":"jackett",q=v[T],B=Le.find(L=>v[L.key]?.configured),te=q?.configured?T:B?.key||"";if(te){const L=v[te]||{...Se};C.current=!0,j(te),P(""),A(L.baseUrl),i(""),m(Array.isArray(L.indexers)?L.indexers:[]),F(Array.isArray(L.indexers)?L.indexers.length:0),y(L.manualOnly?"manual":"ok"),k(L.manualOnly?a("Configuration enregistree. Ajoute les indexeurs manuellement a l'etape suivante.","Configuration saved. Add indexers manually at the next step."):a("Cles deja enregistrees.","Keys already saved.")),O(!0),o?.({provider:te,ready:!0,baseUrl:L.baseUrl,indexers:Array.isArray(L.indexers)?L.indexers:[],manualOnly:!!L.manualOnly})}N(!0)},[o]),s.useEffect(()=>{if(!f?.ready)return;const d=String(f.baseUrl||"");if(!d)return;const v=f.provider||"jackett";C.current=!0,j(v),P(""),A(d),i(""),m(Array.isArray(f.indexers)?f.indexers:[]),y(f?.manualOnly?"manual":"ok"),k(f?.manualOnly?a("Configuration enregistree. Ajoute les indexeurs manuellement a l'etape suivante.","Configuration saved. Add indexers manually at the next step."):a("Cles deja enregistrees.","Keys already saved.")),F(Array.isArray(f.indexers)?f.indexers.length:0),O(!0),S(T=>({...T,[v]:{baseUrl:d,indexers:Array.isArray(f.indexers)?f.indexers:[],configured:!0,manualOnly:!!f?.manualOnly}}))},[f]),s.useEffect(()=>{t&&(typeof window<"u"&&(Object.values(Ce).forEach(d=>{window.localStorage.removeItem(d.baseUrl),window.localStorage.removeItem(d.apiKey),window.localStorage.removeItem(d.indexers),window.localStorage.removeItem(d.configured),window.localStorage.removeItem(d.manualOnly)}),window.localStorage.removeItem($e)),S({jackett:{...Se},prowlarr:{...Se}}),j(""),P(""),A(""),i(""),O(!1),y("idle"),k(""),F(0),u(""),m([]),o?.({provider:"",ready:!1,baseUrl:"",indexers:[],manualOnly:!1}),Y(!1))},[t,o]),s.useEffect(()=>{if(se){if(C.current){C.current=!1;return}y("idle"),k(""),F(0),u(""),O(!1)}},[M,K,l,se]);const H=s.useMemo(()=>(l==="jackett"||l==="prowlarr")&&!!M.trim()&&!!K.trim()&&b!=="testing",[l,M,K,b]),re=b==="testing",le=b==="ok"||b==="manual"?!!M.trim()&&!!K.trim()&&!re:H,ee=s.useMemo(()=>Le.filter(d=>h[d.key]?.configured),[h]),W=s.useMemo(()=>Le.filter(d=>!h[d.key]?.configured),[h]),Z=Qe(l||"jackett");function ce(d){const v=h[d]||{...Se};C.current=!0,j(d),P(""),A(v.baseUrl||""),i(""),m(Array.isArray(v.indexers)?v.indexers:[]),F(Array.isArray(v.indexers)?v.indexers.length:0),v.configured?(y(v.manualOnly?"manual":"ok"),k(v.manualOnly?a("Configuration enregistree. Ajoute les indexeurs manuellement a l'etape suivante.","Configuration saved. Add indexers manually at the next step."):a("Cles deja enregistrees.","Keys already saved.")),O(!0)):(y("idle"),k(""),O(!1)),u(""),U(!1),Y(!0)}function ge(d){z.current&&clearTimeout(z.current),u(d),z.current=setTimeout(()=>{u("")},1200)}async function he(){if(!H)return;y("testing"),k(""),F(0);const d=Date.now();let v="error",T="",q=0,B=[];const te=Qe(l),L=te.label;for(let Q=0;Q<2;Q+=1)try{const ne=He(M),de=te.endpoint,ue=await Ae(de,{baseUrl:ne,apiKey:K.trim()}),fe=Array.isArray(ue)?ue:ue?.indexers,me=Array.isArray(fe)?fe.length:0;me>0?(v="ok",T=a(`Connexion OK (${me} indexeur${me>1?"s":""})`,`Connection OK (${me} indexer${me>1?"s":""})`),q=me,B=Array.isArray(fe)?fe:[]):(v="manual",T=a("Connexion OK, mais aucun indexeur recupere automatiquement. Tu pourras les ajouter manuellement a l'etape suivante (Copy Torznab Feed + cle API).","Connection OK, but no indexer was auto-fetched. You can add them manually at the next step (Copy Torznab Feed + API key)."));break}catch(ne){const de=ne?.message||`Erreur de connexion ${L}.`;if(Q===0&&/invalid start of a value|unexpected token\s*</i.test(de)){await new Promise(ue=>setTimeout(ue,350));continue}v="manual",T=/invalid start of a value|unexpected token\s*</i.test(de)?a(`Recuperation auto des indexeurs ${L} impossible. Enregistre la config puis ajoute les indexeurs manuellement a l'etape suivante (Copy Torznab Feed + cle API).`,`Unable to auto-fetch ${L} indexers. Save the config then add indexers manually at the next step (Copy Torznab Feed + API key).`):`${de} ${a("Tu peux quand meme enregistrer et ajouter les indexeurs manuellement a l'etape suivante.","You can still save and add indexers manually at the next step.")}`;break}const pe=Date.now()-d;if(pe<2e3&&await new Promise(Q=>setTimeout(Q,2e3-pe)),y(v),k(T),F(q),v==="ok"||v==="manual"){if(m(B),typeof window<"u"){const Q=Ce[l];Q&&window.localStorage.setItem(Q.indexers,JSON.stringify(B))}if(q>200){const Q=B.slice(0,3).map(ne=>({id:ne?.id,name:ne?.name}));console.log(`[${L}] indexers count suspicious`,{url:He(M),status:"ok",size:q,shape:Array.isArray(B)?"array":typeof B,sample:Q})}}ge(v==="error"?"error":"ok")}async function ye(){if(b!=="ok"&&b!=="manual")return;const d=He(M),v=K.trim();if(!d||!v)return;const T=Ce[l];if(!(!T||typeof window>"u")){try{await ze(`/api/setup/indexer-providers/${l}`,{baseUrl:d,apiKey:v,enabled:!0}),console.info("[setup/providers] persisted",{provider:l,baseUrl:d})}catch(q){const B=Qe(l).label;y("error"),O(!1),k(q?.message||a(`Impossible d'enregistrer ${B}.`,`Unable to save ${B}.`));return}window.localStorage.setItem(T.baseUrl,d),window.localStorage.removeItem(T.apiKey),window.localStorage.setItem(T.configured,"true"),window.localStorage.setItem(T.manualOnly,b==="manual"?"true":"false"),window.localStorage.setItem($e,l),window.localStorage.setItem(T.indexers,JSON.stringify(R||[])),C.current=!0,A(d),O(!0),Y(!1),S(q=>({...q,[l]:{baseUrl:d,indexers:Array.isArray(R)?R:[],configured:!0,manualOnly:b==="manual"}})),o?.({provider:l,ready:!0,baseUrl:d,indexers:Array.isArray(R)?R:[],manualOnly:b==="manual"})}}function xe(d){const v=Ce[d];typeof window<"u"&&v&&(window.localStorage.removeItem(v.baseUrl),window.localStorage.removeItem(v.apiKey),window.localStorage.removeItem(v.indexers),window.localStorage.removeItem(v.configured),window.localStorage.removeItem(v.manualOnly));const T={...h,[d]:{...Se}};S(T),d===l&&(j(""),P(""),A(""),i(""),O(!1),y("idle"),k(""),F(0),u(""),m([]),Y(!1));const q=Le.find(B=>B.key!==d&&T[B.key]?.configured);if(q){const B=T[q.key]||{...Se};typeof window<"u"&&window.localStorage.setItem($e,q.key),o?.({provider:q.key,ready:B.configured,baseUrl:B.baseUrl,indexers:Array.isArray(B.indexers)?B.indexers:[],manualOnly:!!B.manualOnly})}else typeof window<"u"&&window.localStorage.removeItem($e),o?.({provider:"",ready:!1,baseUrl:"",indexers:[],manualOnly:!1})}return e.jsxs("div",{className:"setup-step setup-jackett-conn",children:[e.jsx("h2",{children:a("Fournisseurs","Providers")}),e.jsx("p",{children:a("Choisis ton fournisseur d'indexeurs.","Choose your indexer provider.")}),W.length>0&&e.jsxs("div",{className:"setup-providers__add settings-row settings-row--ui-select",children:[e.jsx("label",{children:a("Fournisseur","Provider")}),e.jsxs("select",{className:"settings-field",value:_,onChange:d=>{const v=d.target.value;P(""),v&&ce(v)},children:[e.jsx("option",{value:"",disabled:!0,children:a("Selectionner...","Select...")}),W.map(d=>e.jsx("option",{value:d.key,children:d.label},d.key))]})]}),e.jsxs("div",{className:"setup-providers__list",children:[e.jsx("h4",{children:a("Fournisseurs configures","Configured providers")}),ee.length===0&&e.jsx("div",{className:"muted",children:a("Aucun fournisseur configure.","No provider configured.")}),ee.length>0&&e.jsx("div",{className:"indexer-list",children:ee.map((d,v)=>{const T=h[d.key]?.baseUrl||"",q=[{label:a("Configure","Configured"),className:"pill-ok"}];return h[d.key]?.manualOnly&&q.push({label:a("Ajout manuel","Manual add"),className:"pill-warn"}),e.jsx(aa,{id:v+1,title:d.label,meta:T,enabled:!0,badges:q,actions:[{icon:"edit",title:a("Modifier","Edit"),onClick:()=>ce(d.key),disabled:b==="testing"},{icon:"delete",title:a("Supprimer","Delete"),onClick:()=>xe(d.key),disabled:b==="testing",className:"iconbtn--danger"}],showToggle:!1},d.key)})})]}),e.jsxs(sa,{open:V,title:`${a("Configurer","Configure")} ${Z.label}`,onClose:()=>Y(!1),width:520,children:[e.jsxs("div",{className:"formgrid formgrid--edit",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:a("Base URL","Base URL")}),e.jsx("input",{value:M,onChange:d=>A(d.target.value),placeholder:Z.placeholder,disabled:b==="testing"}),e.jsx("span",{className:"field-hint",children:a("IP, hostname ou URL reverse proxy (http/https)","IP, hostname or reverse proxy URL (http/https)")})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:a("API key","API key")}),e.jsxs("div",{className:"setup-jackett-key",children:[e.jsx("input",{type:J?"text":"password",value:K,onChange:d=>i(d.target.value),placeholder:`${a("Cle API","API key")} ${Z.label}`,disabled:b==="testing"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>U(d=>!d),disabled:b==="testing",children:J?a("Masquer","Hide"):a("Afficher","Show")})]})]})]}),e.jsxs("div",{className:"setup-jackett-hint",children:[a("Indexeurs detectes","Detected indexers"),": ",G||0]}),b==="error"&&e.jsx("div",{className:"onboarding__error",children:E}),b==="ok"&&e.jsxs("div",{className:"onboarding__ok",children:[E," ",w?` - ${a("enregistre","saved")}`:""]}),b==="manual"&&e.jsxs("div",{className:"onboarding__warn",children:[E," ",w?` - ${a("enregistre","saved")}`:""]}),e.jsx("div",{className:"setup-jackett-footer",children:e.jsx("button",{className:`btn btn-accent btn-test${D==="ok"?" btn-pulse-ok":""}${D==="error"?" btn-pulse-err":""}`,type:"button",onClick:b==="ok"||b==="manual"?ye:()=>he(),disabled:!le,children:re?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),a("Test en cours...","Test in progress...")]}):D==="ok"?a("Valide","Valid"):D==="error"?a("Invalide","Invalid"):b==="ok"?a("Sauvegarder","Save"):b==="manual"?a("Sauvegarder (manuel)","Save (manual)"):a("Tester","Test")})})]})]})}const Je={jackett:{baseUrl:"feedarr:jackettBaseUrl",apiKey:"feedarr:jackettApiKey",indexers:"feedarr:jackettIndexersCache",configured:"feedarr:jackettConfigured",manualOnly:"feedarr:jackettManualOnly"},prowlarr:{baseUrl:"feedarr:prowlarrBaseUrl",apiKey:"feedarr:prowlarrApiKey",indexers:"feedarr:prowlarrIndexersCache",configured:"feedarr:prowlarrConfigured",manualOnly:"feedarr:prowlarrManualOnly"}},Ie=[{key:"jackett",label:"Jackett"},{key:"prowlarr",label:"Prowlarr"}],ea={baseUrl:"",providerId:null,indexers:[],configured:!1,manualOnly:!1},da="__manual__";function oe(o){return String(o||"").trim().replace(/\/+$/,"")}function ca(o){const t=Je[o];if(!t||typeof window>"u")return{...ea};const f=window.localStorage.getItem(t.baseUrl)||"",l=window.localStorage.getItem(t.configured)==="true",j=window.localStorage.getItem(t.indexers)||"",_=j?JSON.parse(j)||[]:[],P=window.localStorage.getItem(t.manualOnly)==="true";return{baseUrl:f,providerId:null,configured:l&&!!f,indexers:Array.isArray(_)?_:[],manualOnly:P}}function Xe(o){return Ie.find(t=>t.key===o)?.label||a("Fournisseur","Provider")}function Ra({onHasSourcesChange:o,onBack:t,jackettConfig:f}){const[l,j]=s.useState({jackett:{...ea},prowlarr:{...ea}}),[_,P]=s.useState({jackett:"",prowlarr:""}),[M,A]=s.useState([]),[K,i]=s.useState({jackett:"",prowlarr:""}),[J,U]=s.useState(!1),[V,Y]=s.useState(null),[b,y]=s.useState(""),[E,k]=s.useState(!1),[G,F]=s.useState(""),[D,u]=s.useState(""),[w,O]=s.useState(null),[R,m]=s.useState(!1),[h,S]=s.useState(""),[se,N]=s.useState(""),[C,z]=s.useState(""),[H,re]=s.useState([]),[le,ee]=s.useState(()=>new Map),[W,Z]=s.useState(!1),[ce,ge]=s.useState(!1),[he,ye]=s.useState(null),[xe,d]=s.useState(""),v=s.useCallback(async()=>{d("");const n={jackett:ca("jackett"),prowlarr:ca("prowlarr")},x={jackett:"",prowlarr:""};try{const p=await ie("/api/providers"),g=new Map((Array.isArray(p)?p:[]).map(c=>[String(c?.type||"").toLowerCase(),c]));for(const c of Ie){const I=g.get(c.key);if(!I)continue;const X=Number(I?.id),r=oe(I?.baseUrl),$=!!I?.enabled&&!!I?.hasApiKey&&!!r;if(n[c.key]={...n[c.key],providerId:Number.isFinite(X)&&X>0?X:null,baseUrl:r,configured:$,manualOnly:n[c.key]?.manualOnly||!1},typeof window<"u"){const ae=Je[c.key];window.localStorage.setItem(ae.baseUrl,r||""),window.localStorage.setItem(ae.configured,$?"true":"false"),window.localStorage.removeItem(ae.apiKey),$||(window.localStorage.setItem(ae.indexers,JSON.stringify([])),window.localStorage.setItem(ae.manualOnly,"false"))}}await Promise.all(Ie.map(async c=>{const I=n[c.key];if(!(!I?.configured||!I.providerId))try{const X=await ie(`/api/providers/${I.providerId}/indexers`),r=Array.isArray(X)?X:[];n[c.key]={...n[c.key],indexers:r,manualOnly:r.length===0},typeof window<"u"&&(window.localStorage.setItem(Je[c.key].indexers,JSON.stringify(r)),window.localStorage.setItem(Je[c.key].manualOnly,r.length===0?"true":"false")),r.length===0&&(x[c.key]=`Récupération automatique indisponible pour ${c.label}. Ajoute les indexeurs manuellement via "Copy Torznab Feed".`)}catch(X){console.error(`[Step3 Indexers] Chargement indexeurs ${c.label} échoué.`,X);const $=(Array.isArray(n[c.key]?.indexers)?n[c.key].indexers:[]).length===0||!!n[c.key]?.manualOnly;n[c.key]={...n[c.key],manualOnly:$},$&&(x[c.key]=`Impossible de récupérer la liste auto pour ${c.label}. Ajoute les indexeurs manuellement via "Copy Torznab Feed".`)}}))}catch(p){console.error("[Step3 Indexers] Impossible de charger les fournisseurs depuis l'API.",p),d("Impossible de charger les fournisseurs. La configuration locale est utilisée.")}j(n),P(x)},[]),T=s.useCallback(async()=>{try{const n=await ie("/api/sources");A(Array.isArray(n)?n:[])}catch(n){console.error("[Step3 Indexers] Impossible de charger les sources.",n),A([]),d("Erreur lors du chargement des sources.")}},[]);s.useEffect(()=>{v()},[v]),s.useEffect(()=>{f&&v()},[f,v]),s.useEffect(()=>{T()},[T]);const q=s.useMemo(()=>Ie.filter(n=>l[n.key]?.configured),[l]),B=q.length>0,te=s.useMemo(()=>{const n=Object.fromEntries(Ie.map(p=>[p.key,[]])),x=Ie.map(p=>({key:p.key,base:oe(l[p.key]?.baseUrl)})).filter(p=>p.base);return M.forEach(p=>{const g=oe(p?.torznabUrl),c=x.find(I=>g.startsWith(I.base));c&&n[c.key]&&n[c.key].push(p)}),n},[M,l]),L=s.useMemo(()=>q.reduce((n,x)=>n+(te[x.key]?.length||0),0),[q,te]);s.useEffect(()=>{o?.(L>0)},[L,o]);const pe=s.useMemo(()=>{const n={};return q.forEach(x=>{const p=new Set((te[x.key]||[]).map(I=>oe(I?.torznabUrl))),g=l[x.key]?.indexers||[],c=Array.isArray(g)?g:[];n[x.key]=c.filter(I=>!p.has(oe(I?.torznabUrl)))}),n},[q,l,te]);function Q(){S(""),N(""),z(""),re([]),ee(new Map),Y(null),O(null),k(!1),F(""),u("")}function ne(){W||(U(!1),y(""),Q())}function de(n,x){Q(),k(!1),y(n),Y(x),U(!0),Pe(n,x)}function ue(n){Q(),k(!0),y(n),U(!0)}function fe(n){const x=oe(n?.torznabUrl),p=Ie.map(g=>({key:g.key,base:oe(l[g.key]?.baseUrl)})).find(g=>g.base&&x.startsWith(g.base));return p?.key?p.key:q[0]?.key||""}function me(n){const x=new URLSearchParams;Object.entries(n||{}).forEach(([g,c])=>{if(c==null)return;const I=String(c).trim();I&&x.set(g,I)});const p=x.toString();return p?`/api/categories/caps?${p}`:"/api/categories/caps"}async function Pe(n,x){if(S(""),N(""),z(""),re([]),ee(new Map),!x?.torznabUrl){S(a("Indexeur invalide.","Invalid indexer."));return}const p=Number(l[n]?.providerId||0);if(!p){S(a("Fournisseur non configure cote API.","Provider not configured in API."));return}m(!0);try{const g=await Ae("/api/categories/caps/provider",{providerId:p,torznabUrl:x.torznabUrl,indexerId:x?.id,indexerName:x?.name,includeStandardCatalog:!0,includeSpecific:!0}),c=Array.isArray(g?.categories)?g.categories:[],I=Array.isArray(g?.warnings)?g.warnings:[];I.length>0&&z(I.join(" ")),re(c),ee(na(c)),c.length>0?N(a("Categories chargees.","Categories loaded.")):I.length===0&&z(a("Aucune categorie disponible.","No category available."))}catch(g){z(g?.message||a("Caps indisponible. Aucune categorie disponible.","Caps unavailable. No category available."))}finally{m(!1)}}async function ve(){const n=b;if(!n){S(a("Fournisseur non selectionne.","Provider not selected."));return}const x=oe(D);if(!x){S(a("URL Torznab requise.","Torznab URL required."));return}const p=Xe(n);await Pe(n,{id:"manual",name:G.trim()||`${p} manuel`,torznabUrl:x})}async function Te(){S(""),N("");const n=b,x=Xe(n),p=E?{id:"manual",name:G.trim()||`${x} manuel`,torznabUrl:oe(D)}:V;if(!p?.torznabUrl||!oe(p?.torznabUrl)){S(E?a("URL Torznab requise.","Torznab URL required."):a("Indexeur invalide.","Invalid indexer."));return}if(M.find(I=>oe(I?.torznabUrl)===oe(p.torznabUrl))){S(a("Cet indexeur est déjà ajouté.","This indexer is already added."));return}const c=Number(l[n]?.providerId||0);if(!c){S(a("Fournisseur non configure cote API.","Provider not configured in API."));return}Z(!0);try{const I=await Ae("/api/sources",{name:p.name||x,torznabUrl:oe(p.torznabUrl),authMode:"query",providerId:c});if(I?.id){await ze(`/api/sources/${I.id}/enabled`,{enabled:!0});const X=ba(le),r=[...le.keys()].map($=>Number($)).filter($=>Number.isFinite($)&&$>0).sort(($,ae)=>$-ae);await ta(`/api/sources/${I.id}/category-mappings`,ia({mappings:X,selectedCategoryIds:r}))}await T(),N(a("Indexeur ajoute.","Indexer added.")),ne()}catch(I){S(I?.message||"Erreur ajout indexeur")}finally{Z(!1)}}async function Me(n){const x=fe(n);y(x),O(n),k(!1),F(""),u(""),U(!0),S(""),N(""),z(""),re([]),ee(new Map),m(!0);try{const p=await ie(me({sourceId:n.id,indexerName:n?.name,includeStandardCatalog:!0,includeSpecific:!0}));let g=Array.isArray(p?.categories)?p.categories:[];const c=Array.isArray(p?.warnings)?p.warnings:[];c.length>0&&z(c.join(" ")),re(g),ee(na(g)),g.length>0?N(a("Categories chargees.","Categories loaded.")):c.length===0&&z(a("Aucune categorie disponible.","No category available."))}catch(p){S(p?.message||"Erreur chargement categories")}finally{m(!1)}}async function Re(){if(!w?.id)return;const n=(H||[]).map(p=>{const g=Number(p?.id);if(!Number.isFinite(g)||g<=0)return null;const c=oa(le.get(g))||null,I=c?Sa[c]||c:null;return{categoryId:g,unifiedKey:c,unifiedLabel:I,catId:g,groupKey:c,groupLabel:I}}).filter(Boolean),x=[...le.keys()].map(p=>Number(p)).filter(p=>Number.isFinite(p)&&p>0).sort((p,g)=>p-g);if(n.length===0){S(a("Aucune categorie a mettre a jour.","No category to update."));return}Z(!0);try{await ta(`/api/sources/${w.id}/category-mappings`,ia({mappings:n,selectedCategoryIds:x})),await T(),N(a("Categories mises a jour.","Categories updated.")),ne()}catch(p){S(p?.message||"Erreur sauvegarde categories")}finally{Z(!1)}}async function Ge(n){if(n?.id){ye(n.id);try{await fa(`/api/sources/${n.id}`),await T()}catch(x){console.error("[Step3 Indexers] Impossible de supprimer la source.",x),d("Impossible de supprimer la source.")}ye(null)}}async function Ve(){if(!(!w?.id||ce||!(typeof window>"u"||window.confirm("Reclasser l'existant pour cette source ?")))){S(""),ge(!0);try{await Ae(`/api/sources/${w.id}/reclassify`),N(a("Reclassement termine.","Reclassification done.")),await T()}catch(x){S(x?.message||a("Erreur reclassification","Reclassification error"))}finally{ge(!1)}}}const Ke=s.useMemo(()=>H||[],[H]),Ne=le.size,We=s.useMemo(()=>!(E&&!oe(D)),[E,D]),Ue=!!b,je=Ue?Xe(b):"",Ye=w?`${a("Modifier","Edit")} : ${w.name}${Ue?` (${je})`:""}`:E?`${a("Ajouter manuellement","Add manually")}${Ue?` (${je})`:""}`:`${a("Ajouter","Add")} : ${V?.name||a("Indexeur","Indexer")}${Ue?` (${je})`:""}`;return e.jsxs("div",{className:"setup-step setup-jackett",children:[e.jsx("h2",{children:a("Indexeurs","Indexers")}),xe&&e.jsx("div",{className:"onboarding__error",children:xe}),!B&&e.jsxs("div",{className:"setup-jackett__guard",children:[e.jsx("div",{className:"onboarding__error",children:a("Aucun fournisseur configure, reviens a l'etape Fournisseurs.","No configured provider. Go back to Providers step.")}),e.jsx("button",{className:"btn btn-accent",type:"button",onClick:t,disabled:!t,children:a("Retour etape 3","Back to step 3")})]}),B&&e.jsx("div",{className:"setup-jackett__columns",children:q.map(n=>{const x=pe[n.key]||[],p=te[n.key]||[];return e.jsxs("div",{className:"setup-jackett__column",children:[e.jsx("div",{className:"setup-jackett__provider-title",children:n.label}),e.jsxs("div",{className:"setup-providers__add settings-row settings-row--ui-select",children:[e.jsx("label",{children:a("Ajouter un indexeur","Add an indexer")}),e.jsxs("select",{className:"settings-field",value:K[n.key]||"",onChange:g=>{const c=g.target.value;if(i(X=>({...X,[n.key]:c})),c===da){ue(n.key),i(X=>({...X,[n.key]:""}));return}const I=x.find(X=>String(X.id)===String(c));I&&de(n.key,I),i(X=>({...X,[n.key]:""}))},children:[e.jsx("option",{value:"",disabled:!0,children:a("Selectionner...","Select...")}),x.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id)),e.jsx("option",{value:da,children:a("Ajouter manuellement...","Add manually...")})]}),x.length===0&&l[n.key]?.indexers?.length>0&&e.jsx("div",{className:"muted",children:a("Tous les indexeurs detectes sont deja ajoutes.","All detected indexers are already added.")}),x.length===0&&l[n.key]?.indexers?.length===0&&e.jsx("div",{className:"onboarding__warn",children:_[n.key]||a(`Aucun indexeur detecte automatiquement pour ${n.label}.`,`No indexer auto-detected for ${n.label}.`)}),l[n.key]?.manualOnly&&e.jsx("div",{className:"muted",children:a(`Dans ${n.label}, utilise "Copy Torznab Feed" puis colle l'URL ici. La cle API du fournisseur configuree a l'etape 3 sera utilisee.`,`In ${n.label}, use "Copy Torznab Feed" and paste the URL here. The API key configured at step 3 will be used.`)})]}),e.jsxs("div",{className:"setup-jackett__list",children:[e.jsx("h4",{children:a("Indexeurs ajoutes","Added indexers")}),p.length===0?e.jsx("div",{className:"muted",children:a("Aucun indexeur ajoute.","No indexer added.")}):e.jsx("div",{className:"indexer-list",children:p.map((g,c)=>e.jsx(aa,{id:c+1,title:g.name,meta:g.torznabUrl,enabled:!!g.enabled,actions:[{icon:"edit",title:a("Modifier","Edit"),onClick:()=>Me(g),disabled:he===g.id},{icon:"delete",title:a("Supprimer","Delete"),onClick:()=>Ge(g),disabled:he===g.id,className:"iconbtn--danger"}],showToggle:!1},g.id))})]})]},n.key)})}),e.jsxs(sa,{open:J,title:Ye,onClose:ne,width:840,children:[E&&!w&&e.jsxs("div",{className:"formgrid formgrid--edit",style:{marginBottom:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:a("Nom (optionnel)","Name (optional)")}),e.jsx("input",{value:G,onChange:n=>F(n.target.value),placeholder:a(`Nom ${je||"indexeur"}`,`Name ${je||"indexer"}`),disabled:W||R})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:a("Torznab Feed URL","Torznab Feed URL")}),e.jsx("input",{value:D,onChange:n=>{u(n.target.value),S(""),N(""),z(""),re([]),ee(new Map)},placeholder:a("Colle l'URL Copy Torznab Feed","Paste the Copy Torznab Feed URL"),disabled:W||R}),e.jsx("span",{className:"field-hint",children:a(`Depuis ${je||"le fournisseur"}, clique "Copy Torznab Feed", puis colle l'URL complete.`,`From ${je||"the provider"}, click "Copy Torznab Feed" and paste the full URL.`)})]}),e.jsx("div",{className:"setup-jackett__actions",style:{gridColumn:"1 / -1"},children:e.jsx("button",{className:"btn",type:"button",onClick:ve,disabled:W||R||!oe(D),children:R?a("Test...","Test..."):a("Tester les categories (caps)","Test categories (caps)")})})]}),h&&e.jsx("div",{className:"onboarding__error",children:h}),C&&e.jsx("div",{className:"onboarding__warn",children:C}),se&&e.jsx("div",{className:"onboarding__ok",children:se}),R&&e.jsx("div",{className:"muted",children:a("Chargement des categories...","Loading categories...")}),Ke.length>0&&e.jsxs("div",{className:"setup-jackett__categories",children:[e.jsx(wa,{variant:"wizard",categories:H,mappings:le,sourceId:w?.id,onChangeMapping:(n,x)=>{const p=oa(x);ee(g=>{const c=new Map(g);return p?c.set(n,p):c.delete(n),c})}}),e.jsx("div",{className:"muted",style:{marginTop:8},children:a(`${Ne} categorie${Ne>1?"s":""} selectionnee${Ne>1?"s":""}`,`${Ne} selected categor${Ne>1?"ies":"y"}`)})]}),e.jsxs("div",{className:"setup-jackett__actions setup-jackett__footer",children:[e.jsxs("div",{className:"setup-jackett__footer-note",role:"note",children:[e.jsx("span",{className:"setup-jackett__footer-note-icon","aria-hidden":"true",children:"i"}),e.jsx("span",{children:a('Choisissez de preference les categories specifiques, plus pertinentes. Les categories "parents" incluent souvent des sous-categories qui peuvent provoquer un mauvais tri.',"Prefer specific categories when possible. Parent categories often include subcategories that can cause incorrect sorting.")})]}),w?e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn",type:"button",onClick:Ve,disabled:W||ce,children:ce?a("Reclassement...","Reclassifying..."):a("Reclasser l'existant","Reclassify existing")}),e.jsx("button",{className:"btn btn-accent",type:"button",onClick:Re,disabled:W||!1,children:W?a("Enregistrement...","Saving..."):a("Mettre a jour","Update")})]}):e.jsx("button",{className:"btn btn-accent",type:"button",onClick:Te,disabled:W||!We,children:W?a("Enregistrement...","Saving..."):E?a("Ajouter manuellement","Add manually"):a("Ajouter l'indexeur","Add Indexer")})]})]})]})}const Oa=["sonarr","radarr","overseerr","jellyseerr","seer"];function $a(){const[o,t]=s.useState([]),[f,l]=s.useState(!1),[j,_]=s.useState(""),[P,M]=s.useState(!1),[A,K]=s.useState("add"),[i,J]=s.useState(null),[U,V]=s.useState("sonarr"),[Y,b]=s.useState(""),[y,E]=s.useState(""),[k,G]=s.useState(""),[F,D]=s.useState(!1),[u,w]=s.useState("idle"),[O,R]=s.useState(""),[m,h]=s.useState(""),[S,se]=s.useState(!1),[N,C]=s.useState(""),z=s.useRef(null),[H,re]=s.useState(!1),[le,ee]=s.useState(!1),[W,Z]=s.useState(null),[ce,ge]=s.useState(""),[he,ye]=s.useState(""),[xe,d]=s.useState([]),[v,T]=s.useState("standard"),[q,B]=s.useState(!0),[te,L]=s.useState("all"),[pe,Q]=s.useState(!0),[ne,de]=s.useState(!1),[ue,fe]=s.useState("released"),[me,Pe]=s.useState(!0),ve=s.useMemo(()=>{const r=new Set((o||[]).map($=>String($?.type||"").toLowerCase()));return Oa.filter($=>!r.has($))},[o]),Te=ve.length===0,Me=s.useCallback(async()=>{l(!0),_("");try{const r=await ie("/api/apps");t(Array.isArray(r)?r:[])}catch(r){_(r?.message||a("Erreur chargement applications","Applications loading error")),t([])}finally{l(!1)}},[]);s.useEffect(()=>{Me()},[Me]),s.useEffect(()=>{P&&(w("idle"),R(""),h(""))},[y,k,U,P]),s.useEffect(()=>{if(!(!P||A!=="add")){if(ve.length===0){V("");return}ve.includes(U)||V(ve[0])}},[A,P,U,ve]);function Re(){K("add"),J(null),V("sonarr"),b(""),E(""),G(""),D(!1),w("idle"),R(""),h(""),se(!1),re(!1),Z(null),ee(!1),ge(""),ye(""),d([]),T("standard"),B(!0),L("all"),Q(!0),de(!1),fe("released"),Pe(!0)}function Ge(r){r&&(Re(),K("add"),V(r),M(!0))}function Ve(r){Re(),K("edit"),J(r),V(r.type),b(r.name||""),E(r.baseUrl||""),G(""),ge(r.rootFolderPath||""),ye(r.qualityProfileId?String(r.qualityProfileId):""),d(Array.isArray(r.tags)?r.tags:[]),T(r.seriesType||"standard"),B(r.seasonFolder!==!1),L(r.monitorMode||"all"),Q(r.searchMissing!==!1),de(!!r.searchCutoff),fe(r.minimumAvailability||"released"),Pe(r.searchForMovie!==!1),M(!0),r.hasApiKey&&Ne(r.id)}function Ke(){M(!1),Re()}async function Ne(r){ee(!0);try{const $=await ie(`/api/apps/${r}/config`);Z($)}catch{Z(null)}finally{ee(!1)}}function We(r){z.current&&clearTimeout(z.current),R(r),z.current=setTimeout(()=>{R("")},1200)}async function Ue(){const r=A==="edit"&&i?.id&&!k.trim();if(!y.trim()||!k.trim()&&!r)return;D(!0),h(""),w("idle"),R("");const $=Date.now();let ae=!1,we="";try{let be;r?be=await Ae(`/api/apps/${i.id}/test`):be=await Ae(`/api/apps/test?type=${U}`,{baseUrl:y.trim(),apiKey:k.trim()}),ae=!!be?.ok,ae||(we=be?.error||a("Test echoue","Test failed"))}catch(be){we=be?.message||a("Erreur test connexion","Connection test error")}finally{const be=Date.now()-$;be<2e3&&await new Promise(ya=>setTimeout(ya,2e3-be)),D(!1),w(ae?"ok":"error"),h(ae?"":we||a("Test echoue","Test failed")),We(ae?"ok":"error")}}async function je(){se(!0),h("");try{if(A==="add"&&!U)throw new Error(a("Toutes les applications sont deja ajoutees.","All applications are already added."));const r={type:U,name:Y.trim()||null,baseUrl:y.trim(),rootFolderPath:ce||null,qualityProfileId:he?Number(he):null,tags:xe.length>0?xe:null};k.trim()&&(r.apiKey=k.trim()),U==="sonarr"?(r.seriesType=v,r.seasonFolder=q,r.monitorMode=te,r.searchMissing=pe,r.searchCutoff=ne):U==="radarr"&&(r.minimumAvailability=ue,r.searchForMovie=me),A==="add"?await Ae("/api/apps",r):i&&await ze(`/api/apps/${i.id}`,r),Ke(),await Me()}catch(r){h(r?.message||a("Erreur sauvegarde","Save error"))}finally{se(!1)}}async function Ye(r){if(r?.id&&window.confirm(a(`Supprimer ${r.name||r.type} ?`,`Delete ${r.name||r.type}?`)))try{await fa(`/api/apps/${r.id}`),await Me()}catch($){console.error("[Step4 ArrApps] Impossible de supprimer l'application.",$),_($?.message||a("Impossible de supprimer l'application.","Failed to delete the application."))}}const n=s.useMemo(()=>Array.isArray(W?.tags)?W.tags:[],[W]),x=ka(U),p=A!=="add"||!!U,g=A==="edit"&&i?.id&&!k.trim(),c=p&&!!y.trim()&&(k.trim()||g)&&!F&&!S,I=p&&!!y.trim()&&!S&&!F,X=u==="ok"?I:c;return e.jsxs("div",{className:"setup-step setup-arr",children:[e.jsxs("div",{className:"setup-arr__header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:a("Applications (Sonarr / Radarr / Overseerr / Jellyseerr / Seer)","Applications (Sonarr / Radarr / Overseerr / Jellyseerr / Seer)")}),e.jsx("p",{children:a("Optionnel - configure une ou plusieurs apps.","Optional - configure one or more apps.")})]}),e.jsxs("div",{className:"setup-arr__add settings-row settings-row--ui-select",children:[e.jsx("label",{children:a("Ajouter","Add")}),e.jsxs("select",{className:"settings-field",value:N,disabled:Te,onChange:r=>{const $=r.target.value;C(""),$&&Ge($)},children:[e.jsx("option",{value:"",disabled:!0,children:Te?a("Toutes les applications sont deja ajoutees","All applications are already added"):a("Selectionner...","Select...")}),ve.map(r=>e.jsx("option",{value:r,children:Ee(r)},r))]})]})]}),j&&e.jsx("div",{className:"onboarding__error",children:j}),e.jsxs("div",{className:"indexer-list",children:[f&&e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:a("Chargement...","Loading...")})})}),!f&&o.length===0&&e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:a("Aucune application configuree","No configured application")})})}),!f&&o.map((r,$)=>{const ae=Ee(r.type),we=[{label:ae},{label:r.hasApiKey?"API OK":"NO KEY",className:r.hasApiKey?"pill-ok":"pill-warn"}];return e.jsx(aa,{id:$+1,title:r.name||ae,meta:r.baseUrl||"",enabled:r.isEnabled,badges:we,actions:[{icon:"edit",title:a("Editer","Edit"),onClick:()=>Ve(r)},{icon:"delete",title:a("Supprimer","Delete"),onClick:()=>Ye(r),className:"iconbtn--danger"}],showToggle:!1},r.id)})]}),e.jsxs(sa,{open:P,title:A==="add"?a("Ajouter une application","Add an application"):`${a("Editer","Edit")}: ${i?.name||i?.type||a("Application","Application")}`,onClose:Ke,width:620,children:[e.jsxs("div",{className:"formgrid",children:[A==="add"&&e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Type"}),e.jsxs("select",{value:U,onChange:r=>V(r.target.value),children:[Te&&e.jsx("option",{value:"",children:"Aucun type disponible"}),ve.map(r=>e.jsx("option",{value:r,children:Ee(r)},r))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:a("Nom","Name")}),e.jsx("input",{value:Y,onChange:r=>b(r.target.value),placeholder:`Mon ${Ee(U)}`,disabled:S||F})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Base URL"}),e.jsx("input",{value:y,onChange:r=>E(r.target.value),placeholder:Na(U),disabled:S||F}),e.jsx("span",{className:"field-hint",children:"IP, hostname ou URL reverse proxy (http/https)"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:a("Cle API","API key")}),e.jsx("input",{value:k,onChange:r=>G(r.target.value),placeholder:A==="edit"?"••••••••••••••••":a("Entrez la cle API","Enter API key"),disabled:S||F})]})]}),e.jsx("div",{className:"setup-arr__modal-actions",children:x&&e.jsx("button",{className:"btn",type:"button",onClick:()=>re(r=>!r),children:H?a("Masquer options avancees","Hide advanced options"):a("Options avancees","Advanced options")})}),m&&e.jsx("div",{className:"onboarding__error",children:m}),u==="ok"&&e.jsx("div",{className:"onboarding__ok",children:a("Connexion OK","Connection OK")}),H&&x&&e.jsxs("div",{className:"setup-arr__advanced",children:[A==="edit"&&i?.hasApiKey&&e.jsx("div",{className:"setup-arr__config",children:e.jsx("button",{className:"btn",type:"button",onClick:()=>Ne(i.id),disabled:le,children:le?a("Chargement...","Loading..."):a("Charger la config","Load config")})}),e.jsxs("div",{className:"formgrid",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Root folder"}),W?.rootFolders?.length>0?e.jsxs("select",{value:ce,onChange:r=>ge(r.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:a("Selectionner...","Select...")}),W.rootFolders.map(r=>e.jsx("option",{value:r.path,children:r.path},r.id))]}):e.jsx("input",{value:ce,onChange:r=>ge(r.target.value),placeholder:"/data/series"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Quality profile"}),W?.qualityProfiles?.length>0?e.jsxs("select",{value:he,onChange:r=>ye(r.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:a("Selectionner...","Select...")}),W.qualityProfiles.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}):e.jsx("input",{value:he,onChange:r=>ye(r.target.value),placeholder:"1"})]})]}),n.length>0&&e.jsx("div",{className:"setup-arr__tags",children:n.map(r=>{const $=xe.includes(r.id);return e.jsxs("label",{className:"pill",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:ae=>{const we=new Set(xe);ae.target.checked?we.add(r.id):we.delete(r.id),d(Array.from(we))}}),r.label]},r.id)})}),U==="sonarr"?e.jsxs("div",{className:"formgrid",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Series type"}),e.jsxs("select",{value:v,onChange:r=>T(r.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"anime",children:"Anime"})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Monitor mode"}),e.jsxs("select",{value:te,onChange:r=>L(r.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"future",children:"Future"}),e.jsx("option",{value:"missing",children:"Missing"}),e.jsx("option",{value:"existing",children:"Existing"}),e.jsx("option",{value:"latest",children:"Latest"}),e.jsx("option",{value:"pilot",children:"Pilot"}),e.jsx("option",{value:"firstSeason",children:"First Season"})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Season folder"}),e.jsxs("select",{value:q?"yes":"no",onChange:r=>B(r.target.value==="yes"),children:[e.jsx("option",{value:"yes",children:a("Oui","Yes")}),e.jsx("option",{value:"no",children:a("Non","No")})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Search missing"}),e.jsxs("select",{value:pe?"yes":"no",onChange:r=>Q(r.target.value==="yes"),children:[e.jsx("option",{value:"yes",children:a("Oui","Yes")}),e.jsx("option",{value:"no",children:a("Non","No")})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Search cutoff"}),e.jsxs("select",{value:ne?"yes":"no",onChange:r=>de(r.target.value==="yes"),children:[e.jsx("option",{value:"yes",children:a("Oui","Yes")}),e.jsx("option",{value:"no",children:a("Non","No")})]})]})]}):U==="radarr"?e.jsxs("div",{className:"formgrid",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Minimum availability"}),e.jsxs("select",{value:ue,onChange:r=>fe(r.target.value),children:[e.jsx("option",{value:"announced",children:"Announced"}),e.jsx("option",{value:"inCinemas",children:"In Cinemas"}),e.jsx("option",{value:"released",children:"Released"})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Search for movie"}),e.jsxs("select",{value:me?"yes":"no",onChange:r=>Pe(r.target.value==="yes"),children:[e.jsx("option",{value:"yes",children:a("Oui","Yes")}),e.jsx("option",{value:"no",children:a("Non","No")})]})]})]}):null]}),H&&!x&&e.jsx("div",{className:"setup-arr__advanced",children:e.jsxs("div",{className:"muted",children:[a("Pas d'options avancees pour","No advanced options for")," ",Ee(U),"."]})}),e.jsx("div",{className:"setup-arr__footer",children:e.jsx("button",{className:`btn btn-accent btn-test${O==="ok"?" btn-pulse-ok":""}${O==="error"?" btn-pulse-err":""}`,type:"button",onClick:u==="ok"?je:Ue,disabled:!X,children:F?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),a("Test en cours...","Test in progress...")]}):O==="ok"?a("Valide","Valid"):O==="error"?a("Invalide","Invalid"):u==="ok"?a("Sauvegarder","Save"):a("Tester","Test")})})]})]})}const ua={jackett:"feedarr:jackettConfigured",prowlarr:"feedarr:prowlarrConfigured"};function Be({children:o}){const t=s.useRef(null),f=s.useRef(null),[l,j]=s.useState(!1),[_,P]=s.useState(0);return s.useEffect(()=>{const M=()=>{if(t.current&&f.current){const A=t.current.scrollWidth,K=f.current.clientWidth,i=A>K;j(i),i&&P(-(A-K+10))}};return M(),window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)},[o]),e.jsx("div",{className:"text-scroll-wrapper",ref:f,children:e.jsx("span",{className:`text-scroll-content${l?" is-overflowing":""}`,ref:t,style:l?{"--scroll-distance":`${_}px`}:void 0,children:o})})}function Fa(o){if(!o)return"—";try{const t=new URL(o),f=t.host;return`${t.protocol}//${f}/•••`}catch{return o.length<=8?"•••":`${o.slice(0,8)}•••`}}function pa(o){return o==="prowlarr"?"Prowlarr":"Jackett"}function za(o){if(!o)return"";const t=String(o).trim();return t?`has${t.charAt(0).toUpperCase()}${t.slice(1)}`:""}function Ka(o,t){if(!t)return!1;const f=(t.fieldsSchema||[]).filter(j=>j.required);if(f.length===0)return!0;const l=o?.authFlags||{};return f.every(j=>!!l[za(j.key)])}function qa({onFinish:o,finishing:t}){const[f,l]=s.useState(!0),[j,_]=s.useState([]),[P,M]=s.useState([]),[A,K]=s.useState([]),[i,J]=s.useState({}),[U,V]=s.useState([]),[Y,b]=s.useState(""),[y,E]=s.useState(""),k=s.useCallback(async()=>{l(!0),b("");try{const[u,w,O,R]=await Promise.all([ie("/api/providers/external"),ie("/api/providers"),ie("/api/sources"),ie("/api/apps")]),m=Array.isArray(u?.definitions)?u.definitions:[],h=new Map(m.map(C=>[String(C?.providerKey||"").toLowerCase(),C])),S=(Array.isArray(u?.instances)?u.instances:[]).map(C=>{const z=String(C?.providerKey||"").toLowerCase(),H=h.get(z),re=Ka(C,H);return{key:String(C?.instanceId||z),label:C?.displayName||H?.displayName||z||a("Provider","Provider"),configured:re,enabled:C?.enabled!==!1}});_(S),M(Array.isArray(w)?w:[]);const se=Array.isArray(O)?O:[];K(se);const N={};await Promise.all(se.map(async C=>{if(C?.id)try{const z=await ie(`/api/categories/${C.id}`);N[C.id]=Array.isArray(z)?z:[]}catch{N[C.id]=[]}})),J(N),V(Array.isArray(R)?R:[])}catch(u){b(u?.message||a("Erreur chargement resume","Summary loading error"))}finally{l(!1)}},[]);s.useEffect(()=>{k()},[k]);const G=s.useMemo(()=>{const u=new Map((Array.isArray(P)?P:[]).map(w=>[String(w?.type||"").toLowerCase(),w]));return["jackett","prowlarr"].map(w=>{const O=u.get(w),R=!!O?.hasApiKey,m=!!String(O?.baseUrl||"").trim(),h=!!O?.enabled;return{type:w,configured:R&&m&&h,maskedUrl:Fa(O?.baseUrl||"")}})},[P]),F=s.useMemo(()=>G.filter(u=>u.configured),[G]),D=s.useCallback(async()=>{if(t)return;E("");const u=[];if(typeof window<"u"&&(window.localStorage.getItem(ua.jackett)==="true"&&u.push("jackett"),window.localStorage.getItem(ua.prowlarr)==="true"&&u.push("prowlarr")),u.length>0)try{const w=await ie("/api/providers"),O=new Set((Array.isArray(w)?w:[]).map(m=>String(m?.type||"").toLowerCase())),R=u.filter(m=>!O.has(m));if(R.length>0){const m=R.map(h=>pa(h)).join(", ");E(a(`Verification echouee: fournisseur manquant en API (${m}).`,`Verification failed: missing provider in API (${m}).`));return}}catch(w){E(w?.message||a("Impossible de verifier les fournisseurs avant lancement.","Unable to verify providers before launch."));return}o?.()},[t,o]);return e.jsxs("div",{className:"setup-step setup-summary",children:[e.jsx("div",{className:`launch-transition-overlay${t?" is-active":""}`}),e.jsx("div",{className:"setup-summary__header",children:e.jsxs("div",{children:[e.jsx("h2",{children:a("Resume","Summary")}),e.jsx("p",{children:a("Verifie la configuration puis lance Feedarr.","Check the configuration then launch Feedarr.")})]})}),Y&&e.jsx("div",{className:"onboarding__error",children:Y}),y&&e.jsx("div",{className:"onboarding__error",children:y}),f?e.jsx("div",{className:"muted",children:a("Chargement...","Loading...")}):e.jsxs("div",{className:"setup-summary__grid",children:[e.jsxs("div",{className:"setup-summary__card",children:[e.jsx("h3",{children:a("Metadonnees","Metadata")}),e.jsx("ul",{children:j.map(u=>e.jsxs("li",{children:[e.jsx(Be,{children:u.label||u.key||a("Provider","Provider")}),e.jsx("span",{className:`pill ${u.enabled?"pill-ok":"pill-warn"}`,children:u.enabled?a("Actif","Active"):a("Inactif","Inactive")}),e.jsx("span",{className:`pill ${u.configured?"pill-ok":"pill-warn"}`,children:u.configured?a("Auth OK","Auth OK"):a("Auth manquante","Auth missing")})]},u.key))})]}),e.jsxs("div",{className:"setup-summary__card",children:[e.jsx("h3",{children:a("Fournisseurs","Providers")}),F.length===0?e.jsx("div",{className:"muted",children:a("Aucun fournisseur configure","No configured provider")}):e.jsx("ul",{children:F.map(u=>e.jsxs("li",{children:[e.jsx(Be,{children:pa(u.type)}),e.jsx("span",{className:"pill pill-ok",children:a("Configure","Configured")})]},u.type))})]}),e.jsxs("div",{className:"setup-summary__card",children:[e.jsx("h3",{children:a("Sources","Sources")}),A.length===0?e.jsx("div",{className:"muted",children:a("Aucune source ajoutee","No source added")}):e.jsx("ul",{children:A.map(u=>{const w=i[u.id]||[];return e.jsxs("li",{children:[e.jsx(Be,{children:u.name}),e.jsxs("span",{className:"pill pill-blue",children:[w.length," ",a("categorie","category"),w.length>1?"s":""]})]},u.id)})})]}),e.jsxs("div",{className:"setup-summary__card",children:[e.jsx("h3",{children:a("Applications","Applications")}),U.length===0?e.jsx("div",{className:"muted",children:a("Aucune application","No application")}):e.jsx("ul",{children:U.map(u=>e.jsxs("li",{children:[e.jsx(Be,{children:u.name||Ee(u.type)}),e.jsx("span",{className:"pill pill-ok",children:a("Configure","Configured")})]},u.id))})]})]}),e.jsx("div",{className:"setup-summary__cta",children:e.jsxs("button",{className:`btn-launch${t?" is-launching":""}`,type:"button",onClick:D,disabled:t,children:[t?a("Lancement...","Launching..."):a("Lancer Feedarr","Launch Feedarr"),e.jsx(Ca,{className:"launch-icon"})]})})]})}const Fe="feedarr:setupStep",De="feedarr:onboardingDone",ma="feedarr:setupHasJackettSource",Ze=["feedarr:jackettBaseUrl","feedarr:jackettApiKey","feedarr:jackettProvider","feedarr:jackettIndexersCache","feedarr:jackettConfigured","feedarr:jackettManualOnly","feedarr:prowlarrBaseUrl","feedarr:prowlarrApiKey","feedarr:prowlarrIndexersCache","feedarr:prowlarrConfigured","feedarr:prowlarrManualOnly"],ke=1,ga=8;function ha(o){return Number.isFinite(o)?Math.min(ga,Math.max(ke,Math.floor(o))):ke}function Ba(){if(typeof window>"u")return ke;const o=window.localStorage.getItem(Fe),t=Number(o);return ha(t||ke)}function rs(){const o=Aa(),[t,f]=s.useState(Ba),[l,j]=s.useState(t),[_,P]=s.useState(!1),[M,A]=s.useState({ready:!1,saving:!1,error:""}),[K,i]=s.useState({}),[J,U]=s.useState(!1),[V,Y]=s.useState({ready:!0,saving:!1,error:"",authRequired:!1,authConfigured:!0,authMode:"smart"}),[b,y]=s.useState({provider:"",ready:!1,baseUrl:"",manualOnly:!1}),[E,k]=s.useState(!1),[G,F]=s.useState(0);s.useEffect(()=>{j(N=>Math.max(N,t)),typeof window<"u"&&window.localStorage.setItem(Fe,String(t))},[t]),s.useEffect(()=>{let N=!0;return ie("/api/system/onboarding").then(C=>{if(!N||typeof window>"u")return;const z=window.localStorage.getItem(De)==="true";if(C?.onboardingDone){window.localStorage.setItem(De,"true"),o("/library",{replace:!0});return}z&&(window.localStorage.setItem(De,"false"),window.localStorage.removeItem(Fe),Ze.forEach(H=>window.localStorage.removeItem(H)),f(ke),j(ke))}).catch(C=>{console.error("Failed to load onboarding status in setup wizard",C)}),()=>{N=!1}},[o]),s.useEffect(()=>{let N=!0;return ie("/api/setup/state").then(C=>{if(!N||typeof window>"u")return;const z=window.localStorage.getItem(ma),H=Ze.some(Z=>{const ce=window.localStorage.getItem(Z);return ce!==null&&ce!==""}),re=!!C?.hasJackettSource||!!C?.hasProwlarrSource,le=!!C?.authRequired,ee=!!C?.authConfigured,W=!re&&(z==="true"||H);window.localStorage.setItem(ma,C?.hasJackettSource?"true":"false"),Y(Z=>({...Z,authRequired:le,authConfigured:ee,ready:!le||ee||Z.authMode==="open"})),W&&(Ze.forEach(Z=>window.localStorage.removeItem(Z)),window.localStorage.removeItem(Fe),y({provider:"",ready:!1,baseUrl:"",manualOnly:!1}),k(!1),f(ke),j(ke),F(Date.now()))}).catch(C=>{console.error("Failed to load setup state in setup wizard",C)}),()=>{N=!1}},[]);const D=s.useCallback(async()=>{if(!_){P(!0);try{await Ae("/api/system/onboarding/complete"),typeof window<"u"&&(window.localStorage.removeItem(Fe),window.localStorage.setItem(De,"true")),o("/library",{replace:!0})}catch(N){console.error("Failed to complete onboarding from setup wizard",N),P(!1)}}},[_,o]),u=[{id:1,title:a("Langue","Language"),content:e.jsx(Ia,{onStatusChange:A})},{id:2,title:a("Intro","Intro"),content:e.jsx(Pa,{})},{id:3,title:a("Securite","Security"),content:e.jsx(_a,{required:V.authRequired&&!V.authConfigured,onStatusChange:Y})},{id:4,title:a("Metadonnees","Metadata"),content:e.jsx(La,{validation:K,onValidationChange:i,onAllProvidersAddedChange:U})},{id:5,title:a("Fournisseurs RSS","RSS providers"),content:e.jsx(Ta,{onStatusChange:y,resetToken:G,initialStatus:b})},{id:6,title:a("Indexeurs","Indexers"),content:e.jsx(Ra,{onHasSourcesChange:k,onBack:()=>f(5),jackettConfig:b})},{id:7,title:a("Applications","Applications"),content:e.jsx($a,{})},{id:8,title:a("Resume","Summary"),content:e.jsx(qa,{onFinish:D,finishing:_})}],w=s.useMemo(()=>Object.values(K||{}).some(N=>N==="ok"),[K]),O=u[t-1],R=t===4||t===7,m=!!b?.ready,h=t===4?w:!0,S=R&&!(t===4&&J);function se(N){f(ha(N))}return e.jsxs("div",{className:"setup-container",children:[e.jsx("div",{className:"setup-stepper",children:u.map(N=>{const C=N.id===t,z=N.id<=l,H=N.id<=l;return e.jsxs("button",{type:"button",className:`setup-stepper-item${C?" is-active":""}${z?" is-done":""}`,onClick:()=>H&&se(N.id),disabled:!H,"aria-current":C?"step":void 0,children:[e.jsx("span",{className:"setup-stepper-num",children:N.id}),e.jsx("span",{className:"setup-stepper-label",children:N.title})]},N.id)})}),e.jsxs("div",{className:"setup-card setupWizardFrame",children:[e.jsx("div",{className:"setupWizardBody",children:e.jsx("div",{className:"setup-card__content",children:O?.content})}),e.jsx("div",{className:"setupWizardFooter",children:e.jsxs("div",{className:"setup-actions",children:[t>ke&&e.jsx("button",{className:"btn",type:"button",onClick:()=>se(t-1),children:a("Precedent","Previous")}),e.jsxs("div",{className:"setup-actions-right",style:{marginLeft:"auto"},children:[S&&e.jsx("button",{className:"btn",type:"button",onClick:()=>se(t+1),disabled:!h,children:a("Passer","Skip")}),t<ga&&e.jsx("button",{className:"btn btn-accent",type:"button",onClick:()=>se(t+1),disabled:t===1&&(!M.ready||M.saving)||t===3&&(!V.ready||V.saving)||t===4&&!w||t===5&&!m||t===6&&!E,children:a("Suivant","Next")})]})]})})]})]})}export{rs as default};
