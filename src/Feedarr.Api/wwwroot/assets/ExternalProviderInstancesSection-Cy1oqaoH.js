import{r as e,j as n}from"./vendor-react-B6j9w5IJ.js";import{k as St,l as Et,m as Mt,D as wt,a as Z,o as We,n as Ye,b as _e,i as ze,j as Qe,d as He,c as me,e as Ct,h as kt,t as Nt}from"./index-Dw1RV2ov.js";import{M as Pe}from"./Modal-CnEzehYC.js";import{C as At,I as jt,T as It}from"./ItemRow-CUbYQkrM.js";import{t as l}from"./uiText-D9t7ygxs.js";const Ge={uiLanguage:wt,mediaInfoLanguage:Mt,hideSeenByDefault:!1,showCategories:!0,defaultView:"grid",defaultSort:"date",defaultMaxAgeDays:"",defaultLimit:100,defaultFilterSeen:"",defaultFilterApplication:"",defaultFilterSourceId:"",defaultFilterCategoryId:"",defaultFilterQuality:"",badgeInfo:!1,badgeWarn:!0,badgeError:!0,theme:"light",enableMissingPosterView:!1,animationsEnabled:!0,onboardingDone:!1};function Je(r,o={}){const t={...r,...o};return{uiLanguage:Ye(t.uiLanguage),mediaInfoLanguage:We(t.mediaInfoLanguage),hideSeenByDefault:!!t.hideSeenByDefault,showCategories:!!t.showCategories,defaultView:t.defaultView||"grid",defaultSort:t.defaultSort||"date",defaultMaxAgeDays:t.defaultMaxAgeDays??"",defaultLimit:t.defaultLimit??100,defaultFilterSeen:t.defaultFilterSeen??"",defaultFilterApplication:t.defaultFilterApplication??"",defaultFilterSourceId:t.defaultFilterSourceId??"",defaultFilterCategoryId:t.defaultFilterCategoryId??"",defaultFilterQuality:t.defaultFilterQuality??"",badgeInfo:!!t.badgeInfo,badgeWarn:!!t.badgeWarn,badgeError:!!t.badgeError,theme:t.theme||"light",enableMissingPosterView:!!t.enableMissingPosterView,animationsEnabled:t.animationsEnabled!==!1,onboardingDone:!!t.onboardingDone}}function qt(){const r=St(),o=Et(),[t,x]=e.useState({...Ge,theme:r,uiLanguage:o}),[c,N]=e.useState({...Ge,theme:r,uiLanguage:o}),[K,f]=e.useState(()=>new Set),m=e.useRef(null),E=JSON.stringify(t)!==JSON.stringify(c),v=e.useCallback(async()=>{try{const s=await Z("/api/settings/ui");if(s){const h={...s,uiLanguage:Ye(s.uiLanguage),mediaInfoLanguage:We(s.mediaInfoLanguage),defaultSort:s.defaultSort||"date",defaultMaxAgeDays:s.defaultMaxAgeDays??"",defaultLimit:s.defaultLimit??100,defaultFilterSeen:s.defaultFilterSeen??"",defaultFilterApplication:s.defaultFilterApplication??"",defaultFilterSourceId:s.defaultFilterSourceId??"",defaultFilterCategoryId:s.defaultFilterCategoryId??"",defaultFilterQuality:s.defaultFilterQuality??"",theme:s.theme||"light",enableMissingPosterView:!!s.enableMissingPosterView,animationsEnabled:s.animationsEnabled!==!1,onboardingDone:!!s.onboardingDone};x(h),N(h)}}catch{}},[]),y=e.useCallback(async()=>{const s=new Set;return t.uiLanguage!==c.uiLanguage&&s.add("ui.uiLanguage"),t.mediaInfoLanguage!==c.mediaInfoLanguage&&s.add("ui.mediaInfoLanguage"),t.hideSeenByDefault!==c.hideSeenByDefault&&s.add("ui.hideSeen"),t.showCategories!==c.showCategories&&s.add("ui.showCategories"),t.defaultView!==c.defaultView&&s.add("ui.defaultView"),t.defaultSort!==c.defaultSort&&s.add("ui.defaultSort"),t.defaultMaxAgeDays!==c.defaultMaxAgeDays&&s.add("ui.defaultMaxAgeDays"),t.defaultLimit!==c.defaultLimit&&s.add("ui.defaultLimit"),t.defaultFilterSeen!==c.defaultFilterSeen&&s.add("ui.defaultFilterSeen"),t.defaultFilterApplication!==c.defaultFilterApplication&&s.add("ui.defaultFilterApplication"),t.defaultFilterSourceId!==c.defaultFilterSourceId&&s.add("ui.defaultFilterSourceId"),t.defaultFilterCategoryId!==c.defaultFilterCategoryId&&s.add("ui.defaultFilterCategoryId"),t.defaultFilterQuality!==c.defaultFilterQuality&&s.add("ui.defaultFilterQuality"),t.theme!==c.theme&&s.add("ui.theme"),t.enableMissingPosterView!==c.enableMissingPosterView&&s.add("ui.missingPosterView"),t.animationsEnabled!==c.animationsEnabled&&s.add("ui.animations"),await _e("/api/settings/ui",Je(t)),N(Je(t)),ze(t.theme,!0),Qe(t.uiLanguage,!0),s.size>0&&(m.current&&clearTimeout(m.current),f(new Set(s)),m.current=setTimeout(()=>{f(new Set)},1200)),s},[t,c]),b=e.useCallback(s=>{x(h=>({...h,theme:s}))},[]);return e.useEffect(()=>{ze(t?.theme)},[t?.theme]),e.useEffect(()=>{Qe(t?.uiLanguage)},[t?.uiLanguage]),e.useEffect(()=>{if(typeof document>"u")return;document.documentElement.setAttribute("data-motion",t?.animationsEnabled===!1?"off":"on")},[t?.animationsEnabled]),{ui:t,setUi:x,initialUi:c,isDirty:E,pulseKeys:K,loadUiSettings:v,saveUiSettings:y,handleThemeChange:b}}const ae="feedarr:retroFetch",Oe="retro-fetch-posters";function Be(){if(typeof window>"u")return null;try{const r=window.localStorage.getItem(ae);if(!r)return null;const o=JSON.parse(r);return!o||!o.active?null:o.startedAt&&Date.now()-o.startedAt>1e3*60*60*1?(window.localStorage.removeItem(ae),null):o}catch{return null}}function fe(r){if(!(typeof window>"u")){if(!r)window.localStorage.removeItem(ae),Ct(Oe);else{try{window.localStorage.setItem(ae,JSON.stringify(r))}catch{}if(r.active){const o=Number(r.total??0),t=Number(r.done??0),x=Number(r.percent??0),c=o>0?`${x}% (${t}/${o})`:"En cours...";He({key:Oe,label:"Récupération de posters",meta:c,ttlMs:1e3*60*60})}}window.dispatchEvent(new CustomEvent("storage_change",{detail:{key:ae}}))}}let Ke=!1;function Lt(){const[r,o]=e.useState(()=>Be()),t=e.useRef(null);e.useEffect(()=>{const f=Be();if(f?.active){const m=Number(f.total??0),E=Number(f.done??0),v=Number(f.percent??0),y=m>0?`${v}% (${E}/${m})`:"En cours...";He({key:Oe,label:"Récupération de posters",meta:y,ttlMs:1e3*60*60})}},[]);const x=e.useCallback(()=>{t.current&&(clearInterval(t.current),t.current=null),Ke=!1},[]),c=e.useCallback(f=>{if(f.detail.key===ae){const m=Be();o(m),m?.active||x()}},[x]);e.useEffect(()=>(window.addEventListener("storage_change",c),()=>{window.removeEventListener("storage_change",c)}),[c]),e.useEffect(()=>{if(!r?.active){x();return}if(Ke)return;Ke=!0;async function f(){try{const m=Array.isArray(r.ids)?r.ids:[],E=Number(r.startedAtTs??0);let v={...r};if(m.length>0){const y=await me("/api/posters/retro-fetch/progress",{ids:m,startedAtTs:E}),b=Number(y?.total??m.length),s=Number(y?.done??0);if(b>0&&s>=b){fe(null);return}v={...v,done:s,total:b,percent:b>0?Math.round(s/b*100):0}}else{const y=await Z("/api/posters/missing-count"),b=Number(y?.count??0),s=Number(r.startMissing??0),h=Number(r.targetMissing??0),U=Math.max(1,s-h),A=Math.max(0,s-b);if(b<=h||U===0){fe(null);return}v={...v,currentMissing:b,percent:Math.round(A/U*100)}}fe(v)}catch{}}return f(),t.current=setInterval(f,4e3),()=>{x()}},[r,x]);const N=e.useCallback(async()=>{try{const f=await Z("/api/posters/missing-count"),m=Number(f?.count??0),E=await me("/api/posters/retro-fetch",{limit:300}),v=Number(E?.enqueued??0),y=Array.isArray(E?.ids)?E.ids:[],b=Number(E?.startedAtTs??Math.floor(Date.now()/1e3)),s={active:!0,startedAt:Date.now(),startMissing:m,targetMissing:Math.max(0,m-v),enqueued:v,total:Number(E?.total??v),ids:y,startedAtTs:b,currentMissing:m,percent:0,done:0};return fe(s),{task:s,error:null}}catch(f){return{task:null,error:f.message||"Failed to start retro fetch"}}},[]),K=e.useCallback(async()=>{try{return await me("/api/posters/retro-fetch/stop",{}),fe(null),{error:null}}catch(f){return{error:f.message||"Failed to stop retro fetch"}}},[]);return{retroTask:r,startRetroFetch:N,stopRetroFetch:K}}async function Ft(){try{const r=await Z("/api/providers/external");return{ok:!0,data:{definitions:Array.isArray(r?.definitions)?r.definitions:[],instances:Array.isArray(r?.instances)?r.instances:[]}}}catch(r){return console.error("[providers.api] fetchProvidersConfig failed",r),{ok:!1,errorMessage:r?.message||"Chargement impossible."}}}async function Dt(r){try{return{ok:!0,data:await me("/api/providers/external",r)}}catch(o){return console.error("[providers.api] createProviderInstance failed",o),{ok:!1,errorMessage:o?.message||"Sauvegarde impossible."}}}async function Tt(r,o){try{return{ok:!0,data:await _e(`/api/providers/external/${r}`,o)}}catch(t){return console.error("[providers.api] updateProviderInstance failed",t),{ok:!1,errorMessage:t?.message||"Sauvegarde impossible."}}}async function Pt(r){try{return await kt(`/api/providers/external/${r}`),{ok:!0}}catch(o){return console.error("[providers.api] deleteProviderInstance failed",o),{ok:!1,errorMessage:o?.message||"Suppression impossible."}}}async function Bt(r){try{const o=await me(`/api/providers/external/${r}/test`);return o?.ok===!1?{ok:!1,errorMessage:o?.error||"Test échoué."}:{ok:!0}}catch(o){return console.error("[providers.api] testProviderInstance failed",o),{ok:!1,errorMessage:o?.message||"Test échoué."}}}async function Kt(r,o){try{return await _e(`/api/providers/external/${r}`,{enabled:o}),{ok:!0}}catch(t){return console.error("[providers.api] toggleProviderInstance failed",t),{ok:!1,errorMessage:t?.message||"Activation impossible."}}}const Ue=()=>{typeof window<"u"&&window.dispatchEvent(new Event("onboarding:refresh"))},Re={};function Xe(r){if(!r)return"";const o=String(r).trim();return o?`has${o.charAt(0).toUpperCase()}${o.slice(1)}`:""}function $e(r,o){if(!o)return!1;const t=(o.fieldsSchema||[]).filter(c=>c.required);if(t.length===0)return!0;const x=r?.authFlags||{};return t.every(c=>!!x[Xe(c.key)])}function zt(){const[r,o]=e.useState([]),[t,x]=e.useState([]),[c,N]=e.useState(!1),[K,f]=e.useState(""),[m,E]=e.useState(null),[v,y]=e.useState({}),[b,s]=e.useState(!1),[h,U]=e.useState("add"),[A,R]=e.useState(1),[$,O]=e.useState(null),[C,j]=e.useState(""),[re,I]=e.useState(""),[Q,ne]=e.useState(!0),[se,_]=e.useState(""),[G,J]=e.useState({}),[W,ie]=e.useState(!1),[Ce,p]=e.useState(""),[pe,he]=e.useState(!1),[Y,xe]=e.useState(null),[oe,ve]=e.useState(!1),[ye,ee]=e.useState(!1),[V,be]=e.useState(null),[ke,L]=e.useState(0),[le,Se]=e.useState(0),[de,H]=e.useState(0),[Ne,ce]=e.useState(Re),[i,M]=e.useState(!1),[F,X]=e.useState(!1),[ue,D]=e.useState(""),{retroTask:S,startRetroFetch:Ee,stopRetroFetch:Me}=Lt(),k=e.useMemo(()=>{const a=new Map;return(r||[]).forEach(d=>{a.set(String(d.providerKey||"").toLowerCase(),d)}),a},[r]),q=e.useMemo(()=>{const a=new Set;return(t||[]).forEach(d=>{const u=String(d?.providerKey||"").trim().toLowerCase();u&&a.add(u)}),a},[t]),ge=e.useMemo(()=>(r||[]).filter(a=>{const d=String(a?.providerKey||"").trim().toLowerCase();return d?!q.has(d):!1}),[r,q]),T=e.useMemo(()=>C&&k.get(String(C).toLowerCase())||null,[k,C]),Ae=e.useMemo(()=>{const a={};return(r||[]).forEach(d=>{const u=String(d.providerKey||""),B=(t||[]).filter(g=>String(g.providerKey||"").toLowerCase()===u.toLowerCase()).some(g=>g.enabled&&$e(g,d));a[u]=B?"ok":null}),a},[r,t]),je=e.useMemo(()=>r?.length?r.every(a=>(t||[]).filter(u=>String(u.providerKey||"").toLowerCase()===String(a.providerKey||"").toLowerCase()).some(u=>$e(u,a))):!1,[r,t]),Ze=ge.length>0,te=e.useCallback(()=>{U("add"),R(1),O(null),j(""),I(""),ne(!0),_(""),J({}),ie(!1),p("")},[]),P=e.useCallback(async()=>{N(!0),f("");const a=await Ft();a.ok?(o(a.data.definitions),x(a.data.instances)):(f(a.errorMessage),o([]),x([])),N(!1)},[]),et=e.useCallback(async()=>{try{const[a,d,u]=await Promise.all([Z("/api/posters/count"),Z("/api/posters/missing-count"),Z("/api/system/providers")]);if(L(Number(a?.count??0)),Se(Number(d?.count??0)),u&&typeof u=="object"){const w={};Object.entries(u).forEach(([B,g])=>{!g||typeof g!="object"||(w[String(B).toLowerCase()]={calls:Number(g.calls??0),failures:Number(g.failures??0),avgMs:Number(g.avgMs??0)})}),ce(w)}else ce(Re)}catch{L(0),Se(0),ce(Re)}},[]),tt=e.useCallback((a="")=>{te(),U("add");const d=String(a||"").trim();if(d){if(q.has(d.toLowerCase())){p("Provider deja ajoute."),R(1),s(!0);return}const u=k.get(d.toLowerCase());j(d),_(u?.defaultBaseUrl||""),R(2)}else R(1);s(!0)},[k,q,te]),at=e.useCallback(a=>{const d=String(a||"").trim();if(h==="add"&&q.has(d.toLowerCase())){j(""),_(""),J({}),p("Provider deja ajoute.");return}const u=k.get(d.toLowerCase());j(d),_(u?.defaultBaseUrl||""),J({}),p("")},[k,q,h]),rt=e.useCallback(a=>{if(!a)return;te();const d=String(a.providerKey||""),u=k.get(d.toLowerCase());U("edit"),R(2),O(a),j(d),I(a.displayName||""),ne(a.enabled!==!1),_(a.baseUrl||u?.defaultBaseUrl||""),J({}),s(!0)},[k,te]),Ie=e.useCallback(()=>{W||(s(!1),te())},[W,te]),nt=e.useCallback((a,d)=>{J(u=>({...u,[a]:d})),p("")},[]),Le=e.useCallback(a=>{p(""),R(a)},[]),we=e.useCallback(()=>{const a=T;if(!a)return[];const d=(a.fieldsSchema||[]).filter(w=>w.required),u=[];return d.forEach(w=>{String(G[w.key]||"").trim()||h==="edit"&&$?.authFlags?.[Xe(w.key)]||u.push(w.key)}),u},[G,T,$,h]),st=e.useMemo(()=>!T||h==="add"&&A!==2||W?!1:we().length===0,[we,T,h,W,A]),it=e.useCallback(async()=>{const a=T;if(!a){p("Provider invalide.");return}if(h==="add"&&A===1){if(!C){p("Selectionnez un provider.");return}Le(2);return}const d=we();if(d.length>0){p(`Champ(s) requis: ${d.join(", ")}`);return}const u={};(a.fieldsSchema||[]).forEach(g=>{const z=String(G[g.key]||"").trim();z&&(u[g.key]=z)});const w=String(re||"").trim(),B=String(se||"").trim();ie(!0),p("");try{let g;if(h==="add")g=await Dt({providerKey:C,displayName:w||null,enabled:Q,baseUrl:B||null,auth:u,options:{}});else if($?.instanceId){const z={displayName:w||null,enabled:Q,baseUrl:B||null,options:{}};Object.keys(u).length>0&&(z.auth=u),g=await Tt($.instanceId,z)}if(g&&!g.ok){p(g.errorMessage);return}Ue(),Ie(),await P()}catch(g){p(g?.message||"Erreur sauvegarde provider metadata")}finally{ie(!1)}},[Ie,we,G,se,T,re,Q,$,h,C,A,Le,P]),ot=e.useCallback(a=>{xe(a||null),he(!0)},[]),Fe=e.useCallback(()=>{oe||(he(!1),xe(null))},[oe]),lt=e.useCallback(async()=>{if(Y?.instanceId){ve(!0);try{const a=await Pt(Y.instanceId);if(!a.ok)throw new Error(a.errorMessage);Ue(),Fe(),await P()}catch(a){throw new Error(a?.message||"Erreur suppression provider metadata")}finally{ve(!1)}}},[Fe,Y,P]),dt=e.useCallback(a=>{be(a||null),ee(!0)},[]),De=e.useCallback(()=>{ee(!1),be(null)},[]),ct=e.useCallback(async()=>{if(V?.instanceId)try{const a=await Kt(V.instanceId,!V.enabled);if(!a.ok)throw new Error(a.errorMessage);Ue(),De(),await P()}catch(a){throw new Error(a?.message||"Erreur activation/desactivation provider metadata")}},[De,V,P]),ut=e.useCallback(async a=>{if(!a)return;const d=Date.now();E(a),y(g=>({...g,[a]:"pending"}));const u=await Bt(a),w=Date.now()-d,B=Math.max(2e3-w,0);setTimeout(()=>{y(g=>({...g,[a]:u.ok?"ok":"error"})),setTimeout(()=>{y(g=>{const z={...g};return delete z[a],z})},1600),E(null)},B)},[]),gt=e.useCallback(async()=>{await P()},[P]),ft=e.useCallback(async()=>!1,[]),mt=e.useCallback(a=>{const d=k.get(String(a?.providerKey||"").toLowerCase());return $e(a,d)},[k]),pt=!!S?.active,Ve=Number(S?.startMissing??0),ht=Number(S?.targetMissing??0),xt=Number(S?.currentMissing??le??0),Te=Number(S?.total??(Array.isArray(S?.ids)?S.ids.length:null)??Math.max(0,Ve-ht)),qe=Number(S?.done??Math.max(0,Ve-xt)),vt=Te>0?Math.min(100,Math.max(0,Math.round(qe/Te*100))):0;async function yt(){if(S?.active)return;M(!0),D("");const{error:a}=await Ee();a?(D(a),M(!1)):Nt("retro-fetch")}async function bt(){if(!S?.active||F)return;X(!0),D("");const{error:a}=await Me();D(a||"Retro fetch arrete"),X(!1),M(!1)}return{definitions:r,availableExternalDefinitions:ge,instances:t,externalLoading:c,externalError:K,providerStats:Ne,loadExternalProviders:P,loadExternalFlags:gt,saveExternalKeys:ft,loadProviderStats:et,canAddExternalProvider:Ze,externalValidationByProvider:Ae,allProvidersAdded:je,isInstanceConfigured:mt,testingExternal:m,testStatusByExternal:v,testExternal:ut,openExternalModalAdd:tt,openExternalModalEdit:rt,closeExternalModal:Ie,goExternalModalStep:Le,saveExternalModal:it,externalModalOpen:b,externalModalMode:h,externalModalStep:A,externalModalInstance:$,externalModalProviderKey:C,setExternalModalProviderKey:j,selectExternalModalProvider:at,externalModalDefinition:T,externalModalDisplayName:re,setExternalModalDisplayName:I,externalModalEnabled:Q,setExternalModalEnabled:ne,externalModalBaseUrl:se,setExternalModalBaseUrl:_,externalModalAuth:G,setExternalModalAuthField:nt,externalModalSaving:W,externalModalError:Ce,canSaveExternalModal:st,openExternalDelete:ot,closeExternalDelete:Fe,confirmExternalDelete:lt,externalDeleteOpen:pe,externalDeleteInstance:Y,externalDeleteLoading:oe,openExternalToggle:dt,closeExternalToggle:De,confirmExternalToggle:ct,externalToggleOpen:ye,externalToggleInstance:V,posterCount:ke,missingPosterCount:le,releasesCount:de,setReleasesCount:H,retroActive:pt,retroLoading:i,retroStopLoading:F,retroMsg:ue,retroPercent:vt,retroDone:qe,retroTotal:Te,handleRetroFetch:yt,handleRetroFetchStop:bt}}function Ut(r){if(!r)return"";const o=String(r).trim();return o?`has${o.charAt(0).toUpperCase()}${o.slice(1)}`:""}function Qt({controller:r,showInlineAdd:o=!1}){const[t,x]=e.useState(""),{definitions:c,availableExternalDefinitions:N,instances:K,externalLoading:f,externalError:m,providerStats:E,testingExternal:v,testStatusByExternal:y,isInstanceConfigured:b,testExternal:s,openExternalModalAdd:h,openExternalModalEdit:U,openExternalDelete:A,openExternalToggle:R,externalModalOpen:$,externalModalMode:O,externalModalStep:C,externalModalProviderKey:j,selectExternalModalProvider:re,externalModalDefinition:I,externalModalInstance:Q,externalModalDisplayName:ne,setExternalModalDisplayName:se,externalModalEnabled:_,setExternalModalEnabled:G,externalModalBaseUrl:J,setExternalModalBaseUrl:W,externalModalAuth:ie,setExternalModalAuthField:Ce,externalModalSaving:p,externalModalError:pe,canSaveExternalModal:he,closeExternalModal:Y,goExternalModalStep:xe,saveExternalModal:oe,externalDeleteOpen:ve,externalDeleteInstance:ye,externalDeleteLoading:ee,closeExternalDelete:V,confirmExternalDelete:be,externalToggleOpen:ke,externalToggleInstance:L,closeExternalToggle:le,confirmExternalToggle:Se}=r,de=N||[],H=de.length>0,Ne=e.useMemo(()=>{const i=new Map;return(c||[]).forEach(M=>{i.set(String(M.providerKey||"").toLowerCase(),M)}),i},[c]);function ce(i){const M=i.target.value;x(M),M&&(h(M),x(""))}return n.jsxs(n.Fragment,{children:[o&&n.jsxs("div",{className:"setup-providers__add settings-row settings-row--ui-select",children:[n.jsx("label",{children:l("Provider","Provider")}),n.jsxs("select",{className:"settings-field",value:t,onChange:ce,disabled:!H,children:[n.jsx("option",{value:"",disabled:!0,children:H?l("Selectionner...","Select..."):l("Tous les providers sont deja ajoutes","All providers are already added")}),de.map(i=>n.jsx("option",{value:i.providerKey,children:i.displayName},i.providerKey))]})]}),m&&n.jsx("div",{className:"onboarding__error",children:m}),n.jsx("div",{className:"indexer-list itemrow-grid",children:f?n.jsx("div",{className:"indexer-card",children:n.jsx("div",{className:"indexer-row",children:n.jsx("span",{className:"indexer-url muted",children:l("Chargement...","Loading...")})})}):(K||[]).length===0?n.jsx("div",{className:"indexer-card",children:n.jsx("div",{className:"indexer-row",children:n.jsx("span",{className:"indexer-url muted",children:l("Aucun provider metadata configure","No configured metadata provider")})})}):(K||[]).map((i,M)=>{const F=String(i.providerKey||"").toLowerCase(),X=Ne.get(F),ue=y[i.instanceId]==="ok",D=y[i.instanceId]==="error",S=v===i.instanceId,Ee=b(i),Me=E?.[F]||{calls:0,failures:0},k=[ue&&"test-ok",D&&"test-err"].filter(Boolean).join(" "),q={movie:["Films"],tv:["Séries","TV"],artwork:["Artwork"],game:["Games","Jeux"],anime:["Anime"],book:["Livres","Books"],audio:["Musique","Audio"],comic:["Comics","BD"]},ge=X?.kind,T=(q[ge]||[]).map((Ae,je)=>n.jsx(At,{unifiedKey:ge,label:Ae},je));return n.jsx(jt,{id:M+1,title:i.displayName||X?.displayName||F.toUpperCase(),meta:`Appels: ${Number(Me.calls||0)} | Echecs: ${Number(Me.failures||0)}`,enabled:i.enabled!==!1,statusClass:k,badges:[...T,{label:Ee?"OK":"NO",className:`${Ee?"pill-ok":"pill-warn"} pill--trailing`}],actions:[{icon:"science",title:S?l("Test en cours...","Test in progress..."):i.enabled===!1?l("Activez d'abord le provider","Enable provider first"):l("Tester","Test"),onClick:()=>s(i.instanceId),disabled:S||i.enabled===!1,spinning:S},{icon:"edit",title:i.enabled===!1?l("Activez d'abord le provider","Enable provider first"):l("Modifier","Edit"),onClick:()=>U(i),disabled:S||i.enabled===!1},{icon:"delete",title:l("Supprimer","Delete"),onClick:()=>A(i),disabled:S,className:"iconbtn--danger"}],showToggle:!0,onToggle:()=>R(i),toggleDisabled:S},i.instanceId)})}),n.jsx(Pe,{open:$,title:O==="add"?C===1?l("Ajouter un provider metadata","Add a metadata provider"):`${l("Configurer","Configure")}: ${I?.displayName||l("Provider","Provider")}`:`${l("Modifier","Edit")}: ${Q?.displayName||I?.displayName||l("Provider","Provider")}`,onClose:Y,width:560,children:n.jsxs("div",{style:{padding:12},children:[O==="add"&&C===1&&n.jsxs("div",{className:"field",style:{marginBottom:12},children:[n.jsx("label",{className:"muted",children:l("Provider","Provider")}),n.jsxs("select",{value:j,onChange:i=>re(i.target.value),disabled:p||!H,children:[n.jsx("option",{value:"",disabled:!0,children:H?l("Selectionner...","Select..."):l("Tous les providers sont deja ajoutes","All providers are already added")}),de.map(i=>n.jsx("option",{value:i.providerKey,children:i.displayName},i.providerKey))]}),!H&&n.jsx("div",{className:"muted",style:{marginTop:8},children:l("Tous les providers sont deja ajoutes","All providers are already added")})]}),(O==="edit"||C===2)&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"field",style:{marginBottom:12},children:[n.jsx("label",{className:"muted",children:l("Nom (optionnel)","Name (optional)")}),n.jsx("input",{type:"text",value:ne,onChange:i=>se(i.target.value),placeholder:I?.displayName||"Nom du provider",disabled:p})]}),n.jsxs("div",{className:"field",style:{marginBottom:12},children:[n.jsx("label",{className:"muted",children:l("Base URL (optionnel)","Base URL (optional)")}),n.jsx("input",{type:"text",value:J,onChange:i=>W(i.target.value),placeholder:I?.defaultBaseUrl||"https://",disabled:p})]}),n.jsx("div",{className:"indexer-card",style:{marginBottom:12},children:n.jsxs("div",{className:"indexer-row indexer-row--settings",children:[n.jsx("span",{className:"indexer-title",children:l("Actif","Active")}),n.jsx("div",{className:"indexer-actions",children:n.jsx(It,{checked:_,onIonChange:i=>G(i.detail.checked),className:"settings-toggle",disabled:p})})]})}),(I?.fieldsSchema||[]).map(i=>{const M=!!Q?.authFlags?.[Ut(i.key)],F=ie[i.key]||"",X=i.secretPlaceholder||"•••••••• (laisser vide pour conserver)",ue=F||O==="edit"&&M&&i.secret?X:i.placeholder||"";return n.jsxs("div",{className:"field",style:{marginBottom:12},children:[n.jsxs("label",{className:"muted",children:[i.label,i.required?" *":""]}),n.jsx("input",{type:i.secret?"password":i.type||"text",value:F,onChange:D=>Ce(i.key,D.target.value),placeholder:ue,disabled:p})]},i.key)})]}),pe&&n.jsx("div",{className:"onboarding__error",style:{marginBottom:12},children:pe}),n.jsxs("div",{className:"formactions",children:[O==="add"&&C===1?n.jsx("button",{className:"btn btn-accent",type:"button",onClick:()=>xe(2),disabled:!j||p,children:l("Suivant","Next")}):n.jsx("button",{className:"btn btn-accent",type:"button",onClick:oe,disabled:!he||p,children:p?l("Enregistrement...","Saving..."):l("Enregistrer","Save")}),n.jsx("button",{className:"btn",type:"button",onClick:Y,disabled:p,children:l("Annuler","Cancel")})]})]})}),n.jsx(Pe,{open:ve,title:l("Supprimer le provider metadata","Delete metadata provider"),onClose:V,width:520,children:n.jsxs("div",{style:{padding:12},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:8},children:l("Confirmer la suppression ?","Confirm deletion?")}),n.jsxs("div",{className:"muted",style:{marginBottom:12},children:[l("Cette action va supprimer","This action will delete")," ",n.jsx("strong",{children:ye?.displayName||ye?.providerKey||"-"}),".",n.jsx("br",{}),l("Cette action est definitive.","This action is permanent.")]}),n.jsxs("div",{className:"formactions",children:[n.jsx("button",{className:"btn btn-danger",type:"button",onClick:be,disabled:ee,children:ee?l("Suppression...","Deleting..."):l("Supprimer","Delete")}),n.jsx("button",{className:"btn",type:"button",onClick:V,disabled:ee,children:l("Annuler","Cancel")})]})]})}),n.jsx(Pe,{open:ke,title:L?`${L.enabled?l("Desactiver","Disable"):l("Activer","Enable")} : ${L.displayName||L.providerKey}`:l("Activer/Desactiver","Enable/Disable"),onClose:le,width:520,children:n.jsxs("div",{style:{padding:12},children:[n.jsx("div",{style:{fontWeight:700,marginBottom:8},children:l("Confirmer l'action ?","Confirm action?")}),n.jsx("div",{className:"muted",style:{marginBottom:12},children:L?.enabled?l("Cette action va desactiver le provider.","This action will disable the provider."):l("Cette action va activer le provider.","This action will enable the provider.")}),n.jsxs("div",{className:"formactions",children:[n.jsx("button",{className:"btn",type:"button",onClick:Se,children:L?.enabled?l("Desactiver","Disable"):l("Activer","Enable")}),n.jsx("button",{className:"btn",type:"button",onClick:le,children:l("Annuler","Cancel")})]})]})})]})}export{Qt as E,zt as a,Je as b,qt as u};
