import{r as s,j as e}from"./vendor-react-B6j9w5IJ.js";import{a as Ee,b as ys,c as ge,h as ks,t as Rs,r as Es,g as ws,i as Bs,L as Ns,A as os,u as Ps}from"./index-CFeG2zFp.js";import{S as es}from"./SubAction-Chy9oen0.js";import{L as Ds}from"./Loader-WjrgZmWo.js";import{M as xe}from"./Modal-CuzTGtmL.js";import"./categoryGroups.constants-TqNJ0nIh.js";import{u as Ts,a as Ls,E as qs}from"./ExternalProviderInstancesSection-HnEtGTfH.js";import{n as cs,g as vs,i as Cs,a as Is}from"./appTypes-BSxyKsC5.js";import{t as Os}from"./uiText-P7c8BdcQ.js";import{T as _e,I as _s}from"./ItemRow-CmVCROir.js";import{d as Ss,c as $s}from"./formatters-_WhZHARF.js";import{u as Fs}from"./vendor-router-DbNMZja2.js";import"./vendor-icons-BuPyRjLk.js";const Ms=t=>new Promise(o=>setTimeout(o,t)),Us=["sonarr","radarr","overseerr","jellyseerr","seer"];function Ws(){const[t,o]=s.useState([]),[i,A]=s.useState(!1),[v,k]=s.useState(!1),[B,f]=s.useState("add"),[j,M]=s.useState(null),[P,N]=s.useState("sonarr"),[h,b]=s.useState(""),[a,d]=s.useState(""),[x,w]=s.useState(""),[y,Q]=s.useState(!1),[ee,_]=s.useState(!1),[L,g]=s.useState(""),[n,r]=s.useState(!1),[p,V]=s.useState(!1),[W,K]=s.useState(null),[$,z]=s.useState(!1),[S,C]=s.useState(null),[q,R]=s.useState(""),[Y,F]=s.useState(""),[H,E]=s.useState([]),[G,D]=s.useState("standard"),[ie,le]=s.useState(!0),[I,se]=s.useState("all"),[te,X]=s.useState(!0),[ce,ue]=s.useState(!1),[T,U]=s.useState("released"),[oe,ve]=s.useState(!0),[$e,Be]=s.useState(!1),[Ne,Fe]=s.useState(null),[Ye,Ue]=s.useState(!1),[Ke,He]=s.useState(null),[ts,ae]=s.useState({}),[fe,We]=s.useState(null),[Ge,Pe]=s.useState({}),[De,Te]=s.useState({arrSyncIntervalMinutes:60,arrAutoSyncEnabled:!0,requestIntegrationMode:"arr"}),[Le,Ce]=s.useState([]),[Xe,Qe]=s.useState(!1),[rs,J]=s.useState(!1),[je,pe]=s.useState(!1),[re,ze]=s.useState("arr"),[de,qe]=s.useState(()=>new Set),be=s.useRef(null),Ae=t.some(c=>c.isEnabled&&c.hasApiKey),we=new Set(t.map(c=>String(c.type||"").toLowerCase())),as=Us.filter(c=>!we.has(c)),l=re!==cs(De?.requestIntegrationMode);s.useEffect(()=>()=>{be.current&&clearTimeout(be.current)},[]);const ne=s.useCallback(async()=>{A(!0);try{const c=await Ee("/api/apps");o(Array.isArray(c)?c:[])}catch{o([])}finally{A(!1)}},[]),me=s.useCallback(async()=>{try{const c=await Ee("/api/settings/general"),O={arrSyncIntervalMinutes:Number(c?.arrSyncIntervalMinutes??60),arrAutoSyncEnabled:c?.arrAutoSyncEnabled!==!1,requestIntegrationMode:cs(c?.requestIntegrationMode)};Te(O),ze(O.requestIntegrationMode)}catch{const c={arrSyncIntervalMinutes:60,arrAutoSyncEnabled:!0,requestIntegrationMode:"arr"};Te(c),ze(c.requestIntegrationMode)}},[]),ye=s.useCallback(async()=>{Qe(!0);try{const c=await Ee("/api/arr/sync/status");Ce(Array.isArray(c)?c:[])}catch{Ce([])}finally{Qe(!1)}},[]),Ve=s.useCallback(async c=>{z(!0);try{const O=await Ee(`/api/apps/${c}/config`);K(O)}catch{K(null)}finally{z(!1)}},[]),ke=s.useCallback(async c=>{J(!0);try{const O=re!==cs(De?.requestIntegrationMode),Je={...await Ee("/api/settings/general"),arrSyncIntervalMinutes:c.arrSyncIntervalMinutes,arrAutoSyncEnabled:c.arrAutoSyncEnabled,requestIntegrationMode:cs(c.requestIntegrationMode)},Oe=await ys("/api/settings/general",Je),Re={arrSyncIntervalMinutes:Number(Oe?.arrSyncIntervalMinutes??60),arrAutoSyncEnabled:Oe?.arrAutoSyncEnabled!==!1,requestIntegrationMode:cs(Oe?.requestIntegrationMode)};Te(Re),O||ze(Re.requestIntegrationMode)}catch(O){throw new Error(O?.message||"Erreur sauvegarde paramètres sync")}finally{J(!1)}},[re,De]),Ie=s.useCallback(async()=>{if(!l)return;const c={...De,requestIntegrationMode:re};await ke(c),be.current&&clearTimeout(be.current),qe(new Set(["arr.requestIntegrationMode"])),be.current=setTimeout(()=>{qe(new Set)},1200)},[re,De,l,ke]),u=s.useCallback(async()=>{if(Ae){pe(!0);try{await ge("/api/arr/sync"),await ye()}catch(c){throw new Error(c?.message||"Erreur synchronisation")}finally{pe(!1)}}},[ye,Ae]);function he(){f("add"),M(null),N("sonarr"),b(""),d(""),w(""),Q(!1),_(!1),g(""),r(!1),V(!1),C(null),K(null),z(!1),R(""),F(""),E([]),D("standard"),le(!0),se("all"),X(!0),ue(!1),U("released"),ve(!0)}function Ze(){he(),f("add"),N(as[0]||""),k(!0)}function Me(c){he(),f("edit"),M(c),N(c.type),b(c.name||""),d(c.baseUrl||""),w(""),R(c.rootFolderPath||""),F(c.qualityProfileId?String(c.qualityProfileId):""),E(Array.isArray(c.tags)?c.tags:[]),D(c.seriesType||"standard"),le(c.seasonFolder!==!1),se(c.monitorMode||"all"),X(c.searchMissing!==!1),ue(!!c.searchCutoff),U(c.minimumAvailability||"released"),ve(c.searchForMovie!==!1),k(!0),c.hasApiKey&&Ve(c.id)}function ns(){k(!1),he()}async function ds(){if(!(!a.trim()||!x.trim())){Q(!0),g(""),_(!1);try{const c=await ge(`/api/apps/test?type=${P}`,{baseUrl:a.trim(),apiKey:x.trim()});c?.ok?(_(!0),g("")):g(c?.error||"Test échoué")}catch(c){g(c?.message||"Erreur test connexion")}finally{Q(!1)}}}async function us(){r(!0),g("");try{if(B==="add"&&!P)throw new Error("Aucun type disponible à ajouter");const c={type:P,name:h.trim()||null,baseUrl:a.trim(),rootFolderPath:q||null,qualityProfileId:Y?Number(Y):null,tags:H.length>0?H:null};x.trim()&&(c.apiKey=x.trim()),P==="sonarr"?(c.seriesType=G,c.seasonFolder=ie,c.monitorMode=I,c.searchMissing=te,c.searchCutoff=ce):P==="radarr"&&(c.minimumAvailability=T,c.searchForMovie=oe),B==="add"?await ge("/api/apps",c):j&&await ys(`/api/apps/${j.id}`,c),ns(),await ne()}catch(c){g(c?.message||"Erreur sauvegarde")}finally{r(!1)}}function ps(c){Fe(c),Be(!0)}function is(){Be(!1),Fe(null)}async function ls(){if(Ne){Ue(!0);try{await ks(`/api/apps/${Ne.id}`),is(),await ne()}catch(c){throw new Error(c?.message||"Erreur suppression")}finally{Ue(!1)}}}async function ms(c){He(c),ae(O=>({...O,[c]:"pending"}));try{const O=await ge(`/api/apps/${c}/test`);await Ms(1500),ae(Se=>({...Se,[c]:O?.ok?"ok":"error"})),setTimeout(()=>{ae(Se=>{const Je={...Se};return delete Je[c],Je})},1600)}catch{ae(O=>({...O,[c]:"error"})),setTimeout(()=>{ae(O=>{const Se={...O};return delete Se[c],Se})},1600)}finally{He(null)}}async function m(c){if(!c?.id||!c.isEnabled||Ke===c.id||je||Ge[c.id]==="pending")return;const O=Date.now();We(c.id),Pe(Se=>({...Se,[c.id]:"pending"}));try{const Se=await ge(`/api/arr/sync/${c.id}`);await ye();const Je=Date.now()-O,Oe=Math.max(2e3-Je,0);setTimeout(()=>{Pe(Re=>({...Re,[c.id]:Se?.ok?"ok":"error"})),setTimeout(()=>{Pe(Re=>{const gs={...Re};return delete gs[c.id],gs})},1600),We(null)},Oe)}catch{const Se=Date.now()-O,Je=Math.max(2e3-Se,0);setTimeout(()=>{Pe(Oe=>({...Oe,[c.id]:"error"})),setTimeout(()=>{Pe(Oe=>{const Re={...Oe};return delete Re[c.id],Re})},1600),We(null)},Je)}}async function Z(c){try{await ys(`/api/apps/${c.id}/enabled`,{enabled:!c.isEnabled}),await ne()}catch(O){throw new Error(O?.message||"Erreur activation/désactivation")}}async function hs(c){try{await ys(`/api/apps/${c}/default`),await ne()}catch(O){throw new Error(O?.message||"Erreur définition par défaut")}}return{arrApps:t,arrAppsLoading:i,hasEnabledArrApps:Ae,availableAddTypes:as,loadArrApps:ne,arrSyncSettings:De,arrSyncStatus:Le,arrSyncStatusLoading:Xe,arrSyncSaving:rs,arrSyncing:je,arrRequestModeDraft:re,arrPulseKeys:de,isRequestModeDirty:l,setArrSyncSettings:Te,setArrRequestModeDraft:ze,loadArrSyncSettings:me,loadArrSyncStatus:ye,saveArrSyncSettings:ke,saveArrRequestModeDraft:Ie,triggerArrSync:u,arrTestingId:Ke,arrTestStatusById:ts,arrSyncingId:fe,arrSyncStatusById:Ge,testArrApp:ms,syncArrApp:m,toggleArrEnabled:Z,setArrDefault:hs,arrModalOpen:v,arrModalMode:B,arrModalApp:j,arrModalType:P,arrModalName:h,arrModalBaseUrl:a,arrModalApiKey:x,arrModalTesting:y,arrModalTested:ee,arrModalError:L,arrModalSaving:n,arrModalAdvanced:p,arrModalConfig:W,arrModalConfigLoading:$,arrModalAdvancedInitial:S,arrModalRootFolder:q,arrModalQualityProfile:Y,arrModalTags:H,arrModalSeriesType:G,arrModalSeasonFolder:ie,arrModalMonitorMode:I,arrModalSearchMissing:te,arrModalSearchCutoff:ce,arrModalMinAvail:T,arrModalSearchForMovie:oe,setArrModalType:N,setArrModalName:b,setArrModalBaseUrl:d,setArrModalApiKey:w,setArrModalTested:_,setArrModalError:g,setArrModalAdvanced:V,setArrModalAdvancedInitial:C,setArrModalRootFolder:R,setArrModalQualityProfile:F,setArrModalTags:E,setArrModalSeriesType:D,setArrModalSeasonFolder:le,setArrModalMonitorMode:se,setArrModalSearchMissing:X,setArrModalSearchCutoff:ue,setArrModalMinAvail:U,setArrModalSearchForMovie:ve,openArrModalAdd:Ze,openArrModalEdit:Me,closeArrModal:ns,testArrModal:ds,saveArrModal:us,arrDeleteOpen:$e,arrDeleteApp:Ne,arrDeleteLoading:Ye,openArrDelete:ps,closeArrDelete:is,confirmArrDelete:ls}}function zs(){const[t,o]=s.useState(!1),[i,A]=s.useState(!1),[v,k]=s.useState(!1),[B,f]=s.useState(!1),[j,M]=s.useState(!1),[P,N]=s.useState(!1),[h,b]=s.useState("all"),[a,d]=s.useState(""),[x,w]=s.useState(null),[y,Q]=s.useState(!1),[ee,_]=s.useState(!1),[L,g]=s.useState(null),[n,r]=s.useState(null),[p,V]=s.useState(!1),[W,K]=s.useState(!1),[$,z]=s.useState(!1),[S,C]=s.useState(null),[q,R]=s.useState(!1),[Y,F]=s.useState(null),[H,E]=s.useState(!1),[G,D]=s.useState(!1),[ie,le]=s.useState(null),[I,se]=s.useState(!1),[te,X]=s.useState(null),[ce,ue]=s.useState(!1),[T,U]=s.useState(!1),[oe,ve]=s.useState(!1),[$e,Be]=s.useState(!1),[Ne,Fe]=s.useState([]),[Ye,Ue]=s.useState(!1),[Ke,He]=s.useState(""),[ts,ae]=s.useState(!1),[fe,We]=s.useState(null),[Ge,Pe]=s.useState(!1),[De,Te]=s.useState(!1),[Le,Ce]=s.useState(null),[Xe,Qe]=s.useState(!1),[rs,J]=s.useState(""),[je,pe]=s.useState(""),[re,ze]=s.useState(null),de=!!re?.needsRestart,qe="Redemarrage requis apres restauration. Action impossible avant redemarrage.",be=s.useCallback(async()=>{Ue(!0),J("");try{const m=await Ee("/api/system/backups");Fe(Array.isArray(m)?m:[])}catch(m){J(m?.message||"Erreur chargement backups"),Fe([])}finally{Ue(!1)}},[]),Ae=s.useCallback(async()=>{try{const m=await Ee("/api/system/backups/state");ze(m||null)}catch{}},[]),we=s.useCallback(async()=>{V(!0);try{const m=await Ee("/api/maintenance/stats");r(m)}catch{r(null)}finally{V(!1)}},[]);async function as(m){o(!0);try{await ge("/api/posters/cache/clear",{}),Rs("cache-clear"),A(!1),m&&await m()}catch(Z){throw new Error(Z?.message||"Erreur vider cache posters")}finally{o(!1)}}async function l(){k(!0);try{await ge("/api/activity/purge",{}),f(!1)}catch(m){throw new Error(m?.message||"Erreur purge logs")}finally{k(!1)}}async function ne(){N(!0),w(null);try{const m={scope:h},Z=parseInt(a,10);Z>0&&(m.olderThanDays=Z);const hs=await ge("/api/maintenance/purge-logs",m);w(hs),M(!1),we()}catch(m){throw new Error(m?.message||"Erreur purge sélective")}finally{N(!1)}}async function me(){_(!0),g(null);try{const m=await ge("/api/maintenance/vacuum",{});g(m),Q(!1),we()}catch(m){throw new Error(m?.message||"Erreur optimisation DB")}finally{_(!1)}}async function ye(){z(!0),C(null);try{const m=await ge("/api/maintenance/cleanup-posters",{});C(m),K(!1),we()}catch(m){throw new Error(m?.message||"Erreur nettoyage posters")}finally{z(!1)}}async function Ve(){R(!0),F(null);try{const m=await ge("/api/maintenance/test-providers",{});F(m?.results||[])}catch{F([])}finally{R(!1)}}async function ke(){D(!0),le(null);try{const m=await ge("/api/maintenance/reparse-titles",{});le(m),E(!1),we()}catch(m){throw new Error(m?.message||"Erreur re-parsing")}finally{D(!1)}}async function Ie(){se(!0),X(null);try{const m=await ge("/api/maintenance/detect-duplicates",{});X(m)}catch{X(null)}finally{se(!1)}}async function u(){U(!0);try{const m=await ge("/api/maintenance/detect-duplicates?purge=true",{});X(m),ue(!1),we()}catch(m){throw new Error(m?.message||"Erreur purge doublons")}finally{U(!1)}}function he(){de||re?.isBusy||ve(!0)}function Ze(){$e||ve(!1)}async function Me(){if(!re?.isBusy){if(de){J(qe);return}Be(!0),J(""),pe("");try{await ge("/api/system/backups",{}),ve(!1),await be(),await Ae(),pe("Sauvegarde créée avec succès.")}catch(m){J(m?.message||"Erreur sauvegarde")}finally{Be(!1)}}}async function ns(m){if(de){J(qe);return}He(m),J(""),pe("");try{const Z=await fetch(Es(`/api/system/backups/${encodeURIComponent(m)}/download`),{method:"GET",credentials:"include"});if(!Z.ok){if((Z.headers.get("content-type")||"").includes("application/json")){let Re="";try{const gs=await Z.json();Re=gs?.error||gs?.message||""}catch{}throw new Error(Re?`HTTP ${Z.status} - ${Re}`:`HTTP ${Z.status}`)}const Je=await Z.text(),Oe=String(Je||"").replace(/\s+/g," ").trim();throw new Error(Oe?`HTTP ${Z.status} - ${Oe.slice(0,180)}`:`HTTP ${Z.status}`)}const hs=await Z.blob(),c=window.URL.createObjectURL(hs),O=document.createElement("a");O.href=c,O.download=m,document.body.appendChild(O),O.click(),window.URL.revokeObjectURL(c),document.body.removeChild(O),pe("Téléchargement terminé.")}catch(Z){J(Z?.message||"Erreur telechargement backup")}finally{He("")}}function ds(m){de||re?.isBusy||(We(m),ae(!0))}function us(){Ge||(ae(!1),We(null))}async function ps(){if(fe&&!re?.isBusy){if(de){J(qe);return}Pe(!0),J(""),pe("");try{const m=await ge(`/api/system/backups/${encodeURIComponent(fe.name)}/restore`,{}),Z=[];m?.needsRestart?Z.push("Restauration terminée. Redémarrage de l'application requis."):Z.push("Restauration terminée."),m?.warning&&Z.push(m.warning),pe(Z.join(" ")),ae(!1),We(null),await be(),await Ae()}catch(m){J(m?.message||"Erreur restauration backup")}finally{Pe(!1)}}}function is(m){de||re?.isBusy||(Ce(m),Te(!0))}function ls(){Te(!1),Ce(null)}async function ms(){if(Le&&!re?.isBusy){if(de){J(qe);return}Qe(!0),J(""),pe("");try{await ks(`/api/system/backups/${encodeURIComponent(Le.name)}`),ls(),await be(),await Ae(),pe("Sauvegarde supprimée.")}catch(m){J(m?.message||"Erreur suppression backup")}finally{Qe(!1)}}}return{clearCacheLoading:t,clearCacheOpen:i,setClearCacheOpen:A,handleClearCache:as,purgeLogsLoading:v,purgeLogsOpen:B,setPurgeLogsOpen:f,handlePurgeLogs:l,purgeSelectiveOpen:j,setPurgeSelectiveOpen:M,purgeSelectiveLoading:P,purgeScope:h,setPurgeScope:b,purgeOlderThanDays:a,setPurgeOlderThanDays:d,purgeSelectiveResult:x,handlePurgeSelective:ne,vacuumOpen:y,setVacuumOpen:Q,vacuumLoading:ee,vacuumResult:L,handleVacuum:me,stats:n,statsLoading:p,loadStats:we,cleanupPostersOpen:W,setCleanupPostersOpen:K,cleanupPostersLoading:$,cleanupPostersResult:S,handleCleanupPosters:ye,testProvidersLoading:q,testProvidersResults:Y,handleTestProviders:Ve,reparseOpen:H,setReparseOpen:E,reparseLoading:G,reparseResult:ie,handleReparse:ke,duplicatesLoading:I,duplicatesResult:te,handleDetectDuplicates:Ie,duplicatesPurgeOpen:ce,setDuplicatesPurgeOpen:ue,duplicatesPurgeLoading:T,handlePurgeDuplicates:u,backups:Ne,backupsLoading:Ye,backupError:rs,backupNotice:je,backupState:re,loadBackups:be,loadBackupState:Ae,backupCreateOpen:oe,backupCreateLoading:$e,openBackupCreate:he,closeBackupCreate:Ze,handleBackupCreate:Me,backupDownloadName:Ke,handleBackupDownload:ns,backupRestoreOpen:ts,backupRestoreTarget:fe,backupRestoreLoading:Ge,openBackupRestore:ds,closeBackupRestore:us,handleBackupRestore:ps,backupDeleteOpen:De,backupDeleteTarget:Le,backupDeleteLoading:Xe,openBackupDelete:is,closeBackupDelete:ls,handleBackupDelete:ms}}const Vs={"settings.security.title":{fr:"Authentification",en:"Authentication"},"settings.security.authMode":{fr:"Mode d'authentification",en:"Auth mode"},"settings.security.authMode.none":{fr:"Aucune",en:"Open"},"settings.security.authMode.smart":{fr:"Smart",en:"Smart"},"settings.security.authMode.strict":{fr:"Stricte",en:"Strict"},"settings.security.authMode.open":{fr:"Aucune",en:"Open"},"settings.security.help.smartExposure":{fr:"Le mode Smart protège automatiquement quand l'instance est exposée.",en:"Smart mode automatically protects when the instance is exposed."},"settings.security.publicBaseUrl":{fr:"URL publique de base",en:"Public base URL"},"settings.security.status":{fr:"Statut",en:"Status"},"settings.security.status.configured":{fr:"Configuré",en:"Configured"},"settings.security.status.notConfigured":{fr:"Non configuré",en:"Not configured"},"settings.security.status.authRequired":{fr:"Auth requise",en:"Auth required"},"settings.security.status.authNotRequired":{fr:"Auth non requise",en:"Auth not required"},"settings.security.username":{fr:"Nom d'utilisateur",en:"Username"},"settings.security.username.placeholder":{fr:"Saisir un nom d'utilisateur",en:"Enter username"},"settings.security.password":{fr:"Mot de passe",en:"Password"},"settings.security.password.placeholderKeepCurrent":{fr:"Laisser vide pour conserver le mot de passe actuel",en:"Leave blank to keep current password"},"settings.security.password.placeholderEnter":{fr:"Saisir un mot de passe",en:"Enter password"},"settings.security.confirm":{fr:"Confirmation du mot de passe",en:"Password confirmation"},"settings.security.confirm.placeholder":{fr:"Confirmer le mot de passe",en:"Confirm password"},"settings.security.notice.credsRequired":{fr:"Identifiants requis : en mode Smart/Strict quand l'authentification est requise (URL publique ou proxy), renseigne un nom d'utilisateur et un mot de passe.",en:"Credentials required: in Smart/Strict mode when authentication is required (public URL or proxy), set username and password."},"settings.security.notice.credsExisting":{fr:"Identifiants déjà configurés. Laisse vide pour conserver le mot de passe actuel.",en:"Credentials already configured. Leave blank to keep the current password."},"settings.security.warning.downgradeOpen":{fr:"Passer en mode Open désactive l'authentification. Confirme la désactivation pour enregistrer.",en:"Switching to Open mode disables authentication. Confirm the downgrade to save."},"settings.security.error.passwordComplexityFallback":{fr:"Mot de passe trop simple : minimum 12 caractères avec au moins une majuscule, une minuscule, un chiffre et un caractère spécial.",en:"Password is too weak: minimum 12 characters with at least one uppercase, one lowercase, one digit, and one special character."},"settings.security.error.passwordAndConfirmationRequired":{fr:"Mot de passe et confirmation requis.",en:"Password and confirmation are required."},"settings.security.error.passwordConfirmationMismatch":{fr:"La confirmation du mot de passe ne correspond pas.",en:"Password confirmation does not match."},"settings.security.error.passwordComplexityPrefix":{fr:"Mot de passe trop simple : minimum",en:"Password is too weak: minimum"},"settings.security.error.passwordComplexityWithAtLeast":{fr:"avec au moins",en:"with at least"},"settings.security.error.passwordClause.upper":{fr:"une majuscule",en:"one uppercase letter"},"settings.security.error.passwordClause.lower":{fr:"une minuscule",en:"one lowercase letter"},"settings.security.error.passwordClause.digit":{fr:"un chiffre",en:"one digit"},"settings.security.error.passwordClause.symbol":{fr:"un caractère spécial",en:"one special character"},"settings.security.modal.disableAuth.title":{fr:"Désactiver l'authentification ?",en:"Disable authentication?"},"settings.security.modal.disableAuth.message":{fr:"Passer en mode Open désactive l'authentification et supprime les identifiants.",en:"Switching to Open mode disables authentication and removes credentials."},"settings.security.modal.cancel":{fr:"Annuler",en:"Cancel"},"settings.security.modal.confirm":{fr:"Confirmer",en:"Confirm"},"settings.security.subbar.info":{fr:"Infos",en:"Info"},"settings.security.infoModal.title":{fr:"Modes d'authentification",en:"Authentication modes"},"settings.security.infoModal.none.title":{fr:"Aucune",en:"Open"},"settings.security.infoModal.none.description":{fr:"Aucune authentification. Tout le monde peut accéder à l'interface et à l'API.",en:"No authentication. Anyone can access the UI and the API."},"settings.security.infoModal.smart.title":{fr:"Smart",en:"Smart"},"settings.security.infoModal.smart.description":{fr:"Authentification activée seulement si l'instance est exposée (URL publique / proxy). En local, peut rester sans authentification.",en:"Authentication enabled only when the instance is exposed (public URL / proxy). Locally, it may stay without authentication."},"settings.security.infoModal.strict.title":{fr:"Stricte",en:"Strict"},"settings.security.infoModal.strict.description":{fr:"Authentification toujours activée, même en local. Recommandé en production.",en:"Authentication always enabled, even locally. Recommended for production."},"settings.security.infoModal.note":{fr:"Les identifiants existants peuvent être conservés : laisse les champs mot de passe vides pour garder le mot de passe actuel.",en:"Existing credentials can be kept: leave password fields empty to keep the current password."},"settings.security.infoModal.close":{fr:"Fermer",en:"Close"}};function Ks(t,o=ws()){const i=Vs[t];return i?Os(i.fr,i.en,o):t}function js(t=ws()){return o=>Ks(o,t)}function Hs(t){if(!t)return!1;const o=String(t).trim().replace(/^\[(.*)\]$/,"$1").toLowerCase();return o==="localhost"||o==="127.0.0.1"||o==="::1"}function Gs(t){const o=String(t||"").trim();if(!o)return!1;try{const i=new URL(o);return!Hs(i.hostname)}catch{return!1}}function Qs(t){const o=String(t?.title||"").toLowerCase(),i=String(t?.message||"").toLowerCase();return o==="password_complexity_required"||i.includes("password_complexity_required")}function Js(t){const o=js(),i=t?.requirements;if(i&&typeof i=="object"){const A=Number(i.minLength),v=[];if(i.requireUpper&&v.push(o("settings.security.error.passwordClause.upper")),i.requireLower&&v.push(o("settings.security.error.passwordClause.lower")),i.requireDigit&&v.push(o("settings.security.error.passwordClause.digit")),i.requireSymbol&&v.push(o("settings.security.error.passwordClause.symbol")),A>0&&v.length>0)return`${o("settings.security.error.passwordComplexityPrefix")} ${A} ${o("settings.security.error.passwordComplexityWithAtLeast")} ${v.join(", ")}.`}return o("settings.security.error.passwordComplexityFallback")}function xs(t){if(t&&typeof t=="object")return t.isSecuritySettingsError=!0,t;const o=new Error(String(t||"Security settings error"));return o.isSecuritySettingsError=!0,o}function Ys(){const[t,o]=s.useState(!1),[i,A]=s.useState({authMode:"smart",publicBaseUrl:"",username:"",password:"",passwordConfirmation:"",hasPassword:!1,authConfigured:!1,authRequired:!1}),[v,k]=s.useState({authMode:"smart",publicBaseUrl:"",username:""}),[B,f]=s.useState([]),[j,M]=s.useState(""),[P,N]=s.useState(""),h=JSON.stringify({authMode:i.authMode,publicBaseUrl:i.publicBaseUrl,username:i.username})!==JSON.stringify(v)||!!i.password||!!i.passwordConfirmation,b=i.authMode==="strict",a=i.authMode==="smart",d=b||a,x=i.hasPassword,w=String(i.username||"").trim(),y=String(i.password||"").trim(),Q=String(i.passwordConfirmation||"").trim(),ee=Gs(i.publicBaseUrl),_=b?!0:!!i.authRequired,L=a&&_&&!i.authConfigured,g=b||a&&(ee||L),n=t&&d&&g&&!i.authConfigured,r=!!y||!!Q,p=t&&d&&(n||r||g&&!x),V=t&&d&&(g||p),W=p,K=p,$=t&&d&&g&&i.authConfigured&&!!w&&x&&!r,z=V?w?"valid":"error":"",S=!t||!d?"":$?"valid":W?y?"valid":"error":"",C=!t||!d?"":$?"valid":K?!Q||i.password!==i.passwordConfirmation?"error":"valid":"",q=V&&!w,R=W&&!y,Y=K&&(!Q||i.password!==i.passwordConfirmation),F=q||R||Y,H=t&&i.authMode==="open"&&(v.authMode!=="open"||i.authConfigured),E=t&&h&&!F,G=t&&d&&i.authConfigured&&x&&!r,D=s.useCallback(I=>{M(""),f([]),N(""),A(I)},[]),ie=s.useCallback(async()=>{try{const I=await Ee("/api/settings/security");I&&(A(se=>({...se,authMode:I.authMode||"smart",publicBaseUrl:I.publicBaseUrl||"",username:I.username||"",hasPassword:!!I.hasPassword,authConfigured:!!I.authConfigured,authRequired:!!I.authRequired,password:"",passwordConfirmation:""})),k({authMode:I.authMode||"smart",publicBaseUrl:I.publicBaseUrl||"",username:I.username||""}),f([]),M(""),N(""))}catch{}finally{o(!0)}},[]),le=s.useCallback(async(I={})=>{const se=js(),te=se("settings.security.notice.credsRequired"),X=se("settings.security.warning.downgradeOpen");if(f([]),M(""),N(""),F){const T=[];throw q&&T.push("username"),(R||Y)&&T.push("password","passwordConfirmation"),f(T),M(te),xs(new Error(te))}const ce=I?.allowDowngradeToOpen===!0;if(H&&!ce)throw M(X),xs(new Error(X));const ue={authMode:i.authMode,publicBaseUrl:i.publicBaseUrl,username:i.username};H&&ce&&(ue.allowDowngradeToOpen=!0),i.authMode!=="open"&&(i.password||i.passwordConfirmation)&&(ue.password=i.password,ue.passwordConfirmation=i.passwordConfirmation);try{const T=await ys("/api/settings/security",ue);k({authMode:T?.authMode??i.authMode,publicBaseUrl:T?.publicBaseUrl??i.publicBaseUrl,username:T?.username??i.username}),A(U=>({...U,authMode:T?.authMode??U.authMode,publicBaseUrl:T?.publicBaseUrl??U.publicBaseUrl,username:T?.username??U.username,hasPassword:!!T?.hasPassword,authConfigured:!!T?.authConfigured,authRequired:!!T?.authRequired,password:"",passwordConfirmation:""})),M("")}catch(T){if(Qs(T)){const U=Js(T);throw f(["password","passwordConfirmation"]),N(U),M(U),T&&typeof T=="object"&&(T.message=U),xs(T)}if(String(T?.error||"").toLowerCase()==="downgrade_confirmation_required")throw M(X),xs(T);if(typeof T?.message=="string"){const U=T.message.toLowerCase(),oe=[];U.includes("credentials_required")||U.includes("credentials are required")||U.includes("identifiants requis")?(w||oe.push("username"),y||oe.push("password","passwordConfirmation"),M(te)):U.includes("password and confirmation required")?M(se("settings.security.error.passwordAndConfirmationRequired")):U.includes("password confirmation mismatch")?M(se("settings.security.error.passwordConfirmationMismatch")):(U.includes("username")&&oe.push("username"),U.includes("password")&&oe.push("password","passwordConfirmation"),oe.length>0&&M(T.message)),oe.length>0&&f(oe)}throw xs(T)}},[F,q,R,Y,H,i,w,y]);return{security:i,setSecurity:D,initialSecurity:v,loaded:t,securityErrors:B,securityMessage:j,passwordMessage:P,requiresDowngradeConfirmation:H,credentialsRequiredForMode:g,effectiveAuthRequired:_,usernameRequired:V,passwordRequired:W,confirmRequired:K,credsRequired:p,credsMissing:F,canSave:E,isDirty:h,showExistingCredentialsHint:G,usernameFieldState:z,passwordFieldState:S,confirmFieldState:C,loadSecuritySettings:ie,saveSecuritySettings:le}}const Xs={general:"Paramètres",ui:"UI",externals:"Métadonnées",applications:"Applications",users:"Sécurité",maintenance:"Maintenance",backup:"Sauvegarde"};function Zs(t="general"){const o=t==="general",i=t==="ui",A=t==="externals",v=t==="applications",k=t==="users",B=t==="maintenance",f=t==="backup",j=Xs[t]||"Paramètres",[M,P]=s.useState(!0),[N,h]=s.useState(""),[b,a]=s.useState("idle"),[d,x]=s.useState(""),[w,y]=s.useState(""),[Q]=s.useState(""),[ee,_]=s.useState(!1),L=Ts(),g=Ls(),n=Ws(),r=zs(),p=Ys(),V=s.useRef(L.loadUiSettings),W=s.useRef(L.saveUiSettings),K=s.useRef(g.loadExternalFlags),$=s.useRef(g.loadProviderStats),z=s.useRef(g.saveExternalKeys),S=s.useRef(g.setReleasesCount),C=s.useRef(p.loadSecuritySettings),q=s.useRef(p.saveSecuritySettings),R=s.useRef(r.loadBackups),Y=s.useRef(r.loadBackupState),F=s.useRef(n.loadArrApps),H=s.useRef(n.loadArrSyncSettings),E=s.useRef(n.loadArrSyncStatus),G=s.useRef(r.handleClearCache),D=s.useRef(r.handlePurgeLogs),ie=s.useRef(r.handleBackupCreate),le=s.useRef(r.handleBackupDownload),I=s.useRef(r.handleBackupRestore),se=s.useRef(r.handleBackupDelete),te=s.useRef(r.loadStats),X=s.useRef(r.handleVacuum),ce=s.useRef(r.handlePurgeSelective),ue=s.useRef(r.handleCleanupPosters),T=s.useRef(r.handleTestProviders),U=s.useRef(r.handleReparse),oe=s.useRef(r.handleDetectDuplicates),ve=s.useRef(r.handlePurgeDuplicates),$e=s.useRef(n.triggerArrSync),Be=s.useRef(n.saveArrSyncSettings),Ne=s.useRef(n.saveArrRequestModeDraft),Fe=s.useRef(n.confirmArrDelete),Ye=s.useRef(n.toggleArrEnabled),Ue=s.useRef(g.confirmExternalDelete),Ke=s.useRef(g.confirmExternalToggle);V.current=L.loadUiSettings,W.current=L.saveUiSettings,K.current=g.loadExternalFlags,$.current=g.loadProviderStats,z.current=g.saveExternalKeys,S.current=g.setReleasesCount,C.current=p.loadSecuritySettings,q.current=p.saveSecuritySettings,R.current=r.loadBackups,Y.current=r.loadBackupState,F.current=n.loadArrApps,H.current=n.loadArrSyncSettings,E.current=n.loadArrSyncStatus,G.current=r.handleClearCache,D.current=r.handlePurgeLogs,ie.current=r.handleBackupCreate,le.current=r.handleBackupDownload,I.current=r.handleBackupRestore,se.current=r.handleBackupDelete,te.current=r.loadStats,X.current=r.handleVacuum,ce.current=r.handlePurgeSelective,ue.current=r.handleCleanupPosters,T.current=r.handleTestProviders,U.current=r.handleReparse,oe.current=r.handleDetectDuplicates,ve.current=r.handlePurgeDuplicates,$e.current=n.triggerArrSync,Be.current=n.saveArrSyncSettings,Ne.current=n.saveArrRequestModeDraft,Fe.current=n.confirmArrDelete,Ye.current=n.toggleArrEnabled,Ue.current=g.confirmExternalDelete,Ke.current=g.confirmExternalToggle;const He=L.isDirty||p.isDirty||n.isRequestModeDirty,ts=k&&!p.canSave,ae=s.useCallback(async()=>{P(!0),h("");try{const u=await Ee("/api/system/status");S.current(Number(u?.releasesCount??u?.ReleasesCount??0)),await Promise.all([V.current(),K.current(),$.current(),C.current()])}catch(u){h(u?.message||"Erreur chargement settings")}finally{P(!1)}},[]),fe=s.useCallback(async(u={})=>{h("");const he=Date.now();let Ze=!1;a("loading");try{if(await W.current(),await z.current(),await q.current(u),await Ne.current(),typeof window<"u"){const Me=String(d||"").trim(),ns=String(w||"").trim();if(Me&&Me!==ns){const{protocol:ds,hostname:us,pathname:ps,search:is,hash:ls}=window.location,ms=`${ds}//${us}:${Me}${ps}${is}${ls}`;window.location.assign(ms);return}}Ze=!0}catch(Me){Me?.isSecuritySettingsError||h(Me?.message||"Erreur sauvegarde settings")}finally{const Me=Date.now()-he;Me<1e3&&await Ms(1e3-Me),a(Ze?"success":"error"),setTimeout(()=>a("idle"),1e3)}},[d,w]),We=s.useCallback(async()=>{if(k&&p.requiresDowngradeConfirmation){_(!0);return}await fe()},[k,p.requiresDowngradeConfirmation,fe]),Ge=s.useCallback(()=>{_(!1)},[]),Pe=s.useCallback(async()=>{_(!1),await fe({allowDowngradeToOpen:!0})},[fe]),De=s.useCallback(()=>{ae(),v&&(F.current(),H.current(),E.current()),f&&(R.current(),Y.current()),B&&te.current()},[ae,v,f,B]),Te=s.useRef(!1);s.useEffect(()=>{Te.current||(Te.current=!0,ae())},[ae]);const Le=s.useRef(!1);s.useEffect(()=>{if(!f){Le.current=!1;return}Le.current||(Le.current=!0,R.current(),Y.current())},[f]),s.useEffect(()=>{if(!f)return;const u=setInterval(()=>{Y.current()},3e3);return()=>clearInterval(u)},[f]);const Ce=s.useRef(!1);s.useEffect(()=>{if(!B){Ce.current=!1;return}Ce.current||(Ce.current=!0,te.current())},[B]);const Xe=s.useRef(!1);s.useEffect(()=>{if(!v){Xe.current=!1;return}Xe.current||(Xe.current=!0,F.current(),H.current(),E.current())},[v]),s.useEffect(()=>{if(typeof window>"u")return;const u=window.location.port||(window.location.protocol==="https:"?"443":"80");d||x(u),w||y(u)},[d,w]),s.useEffect(()=>{M||Bs(L.ui?.theme)},[L.ui?.theme,M]);const Qe=s.useCallback(async()=>{try{await G.current(ae)}catch(u){h(u?.message||"Erreur")}},[ae]),rs=s.useCallback(async()=>{try{await D.current()}catch(u){h(u?.message||"Erreur")}},[]),J=s.useCallback(async()=>{try{await X.current()}catch(u){h(u?.message||"Erreur")}},[]),je=s.useCallback(async()=>{try{await ce.current()}catch(u){h(u?.message||"Erreur")}},[]),pe=s.useCallback(async()=>{try{await ue.current()}catch(u){h(u?.message||"Erreur")}},[]),re=s.useCallback(async()=>{try{await T.current()}catch(u){h(u?.message||"Erreur")}},[]),ze=s.useCallback(async()=>{try{await U.current()}catch(u){h(u?.message||"Erreur")}},[]),de=s.useCallback(async()=>{try{await oe.current()}catch(u){h(u?.message||"Erreur")}},[]),qe=s.useCallback(async()=>{try{await ve.current()}catch(u){h(u?.message||"Erreur")}},[]),be=s.useCallback(async()=>{try{await ie.current()}catch(u){h(u?.message||"Erreur")}},[]),Ae=s.useCallback(async u=>{try{await le.current(u)}catch(he){h(he?.message||"Erreur")}},[]),we=s.useCallback(async()=>{try{await I.current()}catch(u){h(u?.message||"Erreur")}},[]),as=s.useCallback(async()=>{try{await se.current()}catch(u){h(u?.message||"Erreur")}},[]),l=s.useCallback(async()=>{try{await $e.current()}catch(u){h(u?.message||"Erreur")}},[]),ne=s.useCallback(async u=>{try{await Be.current(u)}catch(he){h(he?.message||"Erreur")}},[]),me=s.useCallback(async()=>{try{await Ne.current()}catch(u){h(u?.message||"Erreur")}},[]),ye=s.useCallback(async()=>{try{await Fe.current()}catch(u){h(u?.message||"Erreur")}},[]),Ve=s.useCallback(async u=>{try{await Ye.current(u)}catch(he){h(he?.message||"Erreur")}},[]),ke=s.useCallback(async()=>{try{await Ue.current()}catch(u){h(u?.message||"Erreur")}},[]),Ie=s.useCallback(async()=>{try{await Ke.current()}catch(u){h(u?.message||"Erreur")}},[]);return{section:t,settingsTitle:j,showGeneral:o,showUi:i,showExternals:A,showApplications:v,showUsers:k,showMaintenance:B,showBackup:f,loading:M,err:N,handleRefresh:De,handleSave:We,saveState:b,securityDowngradeModalOpen:ee,closeSecurityDowngradeModal:Ge,confirmSecurityDowngradeSave:Pe,isDirty:He,isSaveBlocked:ts,openArrModalAdd:n.openArrModalAdd,canAddArrApp:n.availableAddTypes.length>0,openExternalModalAdd:g.openExternalModalAdd,canAddExternalProvider:g.canAddExternalProvider,triggerArrSync:l,arrSyncing:n.arrSyncing,hasEnabledArrApps:n.hasEnabledArrApps,general:{hostPort:d,urlBase:Q},ui:{ui:L.ui,setUi:L.setUi,pulseKeys:L.pulseKeys,handleThemeChange:L.handleThemeChange},providers:{...g,confirmExternalDelete:ke,confirmExternalToggle:Ie},applications:{arrApps:n.arrApps,arrAppsLoading:n.arrAppsLoading,arrTestingId:n.arrTestingId,arrTestStatusById:n.arrTestStatusById,arrSyncingId:n.arrSyncingId,arrSyncStatusById:n.arrSyncStatusById,arrSyncing:n.arrSyncing,arrSyncSettings:n.arrSyncSettings,arrSyncStatus:n.arrSyncStatus,arrSyncSaving:n.arrSyncSaving,arrRequestModeDraft:n.arrRequestModeDraft,arrPulseKeys:n.arrPulseKeys,isRequestModeDirty:n.isRequestModeDirty,hasEnabledArrApps:n.hasEnabledArrApps,availableAddTypes:n.availableAddTypes,syncArrApp:n.syncArrApp,testArrApp:n.testArrApp,openArrModalEdit:n.openArrModalEdit,openArrDelete:n.openArrDelete,toggleArrEnabled:Ve,setArrSyncSettings:n.setArrSyncSettings,setArrRequestModeDraft:n.setArrRequestModeDraft,saveArrSyncSettings:ne,saveArrRequestModeDraft:me,arrModalOpen:n.arrModalOpen,arrModalMode:n.arrModalMode,arrModalApp:n.arrModalApp,arrModalType:n.arrModalType,arrModalName:n.arrModalName,arrModalBaseUrl:n.arrModalBaseUrl,arrModalApiKey:n.arrModalApiKey,arrModalTesting:n.arrModalTesting,arrModalTested:n.arrModalTested,arrModalError:n.arrModalError,arrModalSaving:n.arrModalSaving,arrModalAdvanced:n.arrModalAdvanced,arrModalConfig:n.arrModalConfig,arrModalConfigLoading:n.arrModalConfigLoading,arrModalAdvancedInitial:n.arrModalAdvancedInitial,arrModalRootFolder:n.arrModalRootFolder,arrModalQualityProfile:n.arrModalQualityProfile,arrModalSeriesType:n.arrModalSeriesType,arrModalSeasonFolder:n.arrModalSeasonFolder,arrModalMonitorMode:n.arrModalMonitorMode,arrModalSearchMissing:n.arrModalSearchMissing,arrModalSearchCutoff:n.arrModalSearchCutoff,arrModalMinAvail:n.arrModalMinAvail,arrModalSearchForMovie:n.arrModalSearchForMovie,setArrModalType:n.setArrModalType,setArrModalName:n.setArrModalName,setArrModalBaseUrl:n.setArrModalBaseUrl,setArrModalApiKey:n.setArrModalApiKey,setArrModalTested:n.setArrModalTested,setArrModalError:n.setArrModalError,setArrModalRootFolder:n.setArrModalRootFolder,setArrModalQualityProfile:n.setArrModalQualityProfile,setArrModalSeriesType:n.setArrModalSeriesType,setArrModalSeasonFolder:n.setArrModalSeasonFolder,setArrModalMonitorMode:n.setArrModalMonitorMode,setArrModalSearchMissing:n.setArrModalSearchMissing,setArrModalSearchCutoff:n.setArrModalSearchCutoff,setArrModalMinAvail:n.setArrModalMinAvail,setArrModalSearchForMovie:n.setArrModalSearchForMovie,setArrModalAdvanced:n.setArrModalAdvanced,setArrModalAdvancedInitial:n.setArrModalAdvancedInitial,closeArrModal:n.closeArrModal,testArrModal:n.testArrModal,saveArrModal:n.saveArrModal,arrDeleteOpen:n.arrDeleteOpen,arrDeleteApp:n.arrDeleteApp,arrDeleteLoading:n.arrDeleteLoading,confirmArrDelete:ye,closeArrDelete:n.closeArrDelete},maintenance:{clearCacheLoading:r.clearCacheLoading,clearCacheOpen:r.clearCacheOpen,setClearCacheOpen:r.setClearCacheOpen,handleClearCache:Qe,purgeLogsLoading:r.purgeLogsLoading,purgeLogsOpen:r.purgeLogsOpen,setPurgeLogsOpen:r.setPurgeLogsOpen,handlePurgeLogs:rs,purgeSelectiveOpen:r.purgeSelectiveOpen,setPurgeSelectiveOpen:r.setPurgeSelectiveOpen,purgeSelectiveLoading:r.purgeSelectiveLoading,purgeScope:r.purgeScope,setPurgeScope:r.setPurgeScope,purgeOlderThanDays:r.purgeOlderThanDays,setPurgeOlderThanDays:r.setPurgeOlderThanDays,purgeSelectiveResult:r.purgeSelectiveResult,handlePurgeSelective:je,vacuumOpen:r.vacuumOpen,setVacuumOpen:r.setVacuumOpen,vacuumLoading:r.vacuumLoading,vacuumResult:r.vacuumResult,handleVacuum:J,stats:r.stats,statsLoading:r.statsLoading,loadStats:r.loadStats,cleanupPostersOpen:r.cleanupPostersOpen,setCleanupPostersOpen:r.setCleanupPostersOpen,cleanupPostersLoading:r.cleanupPostersLoading,cleanupPostersResult:r.cleanupPostersResult,handleCleanupPosters:pe,testProvidersLoading:r.testProvidersLoading,testProvidersResults:r.testProvidersResults,handleTestProviders:re,reparseOpen:r.reparseOpen,setReparseOpen:r.setReparseOpen,reparseLoading:r.reparseLoading,reparseResult:r.reparseResult,handleReparse:ze,duplicatesLoading:r.duplicatesLoading,duplicatesResult:r.duplicatesResult,handleDetectDuplicates:de,duplicatesPurgeOpen:r.duplicatesPurgeOpen,setDuplicatesPurgeOpen:r.setDuplicatesPurgeOpen,duplicatesPurgeLoading:r.duplicatesPurgeLoading,handlePurgeDuplicates:qe},backup:{backupCreateOpen:r.backupCreateOpen,backupCreateLoading:r.backupCreateLoading,backups:r.backups,backupsLoading:r.backupsLoading,backupDownloadName:r.backupDownloadName,backupRestoreOpen:r.backupRestoreOpen,backupRestoreTarget:r.backupRestoreTarget,backupRestoreLoading:r.backupRestoreLoading,backupDeleteOpen:r.backupDeleteOpen,backupDeleteTarget:r.backupDeleteTarget,backupDeleteLoading:r.backupDeleteLoading,backupError:r.backupError,backupNotice:r.backupNotice,backupState:r.backupState,loadBackups:r.loadBackups,loadBackupState:r.loadBackupState,openBackupCreate:r.openBackupCreate,closeBackupCreate:r.closeBackupCreate,handleBackupCreate:be,handleBackupDownload:Ae,openBackupRestore:r.openBackupRestore,closeBackupRestore:r.closeBackupRestore,handleBackupRestore:we,openBackupDelete:r.openBackupDelete,closeBackupDelete:r.closeBackupDelete,handleBackupDelete:as},users:{security:p.security,setSecurity:p.setSecurity,securityErrors:p.securityErrors,securityMessage:p.securityMessage,passwordMessage:p.passwordMessage,showExistingCredentialsHint:p.showExistingCredentialsHint,credentialsRequiredForMode:p.credentialsRequiredForMode,effectiveAuthRequired:p.effectiveAuthRequired,usernameRequired:p.usernameRequired,passwordRequired:p.passwordRequired,confirmRequired:p.confirmRequired,usernameFieldState:p.usernameFieldState,passwordFieldState:p.passwordFieldState,confirmFieldState:p.confirmFieldState}}}function et({hostPort:t,urlBase:o}){return e.jsxs("div",{className:"settings-card",id:"host",children:[e.jsx("div",{className:"settings-card__title",children:"Host"}),e.jsxs("div",{className:"indexer-list",children:[e.jsxs("div",{className:"indexer-card",children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Port Number"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"number",value:t,readOnly:!0,disabled:!0,className:"input--readonly"})})]}),e.jsx("div",{className:"settings-help",children:"Configured via server settings (environment variable or appsettings.json)"})]}),e.jsxs("div",{className:"indexer-card",children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"URL Base"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"text",value:o||"(none)",readOnly:!0,disabled:!0,className:"input--readonly"})})]}),e.jsx("div",{className:"settings-help",children:"For reverse proxy support. Configured via server settings."})]})]})]})}const st=["2160p","1080p","720p","480p","WEB-DL","BluRay","HDTV"];function tt({ui:t,setUi:o,pulseKeys:i,handleThemeChange:A}){const[v,k]=s.useState([]),[B,f]=s.useState([]),[j,M]=s.useState([]);s.useEffect(()=>{let a=!0;return(async()=>{try{const[d,x,w]=await Promise.all([Ee("/api/sources").catch(()=>[]),Ee("/api/apps").catch(()=>[]),Ee("/api/categories/stats").catch(()=>({stats:[]}))]);if(!a)return;k(Array.isArray(d)?d:[]),f(Array.isArray(x)?x:[]),M(Array.isArray(w?.stats)?w.stats:[])}catch{if(!a)return;k([]),f([]),M([])}})(),()=>{a=!1}},[]);const P=s.useMemo(()=>(v||[]).filter(a=>Number(a.enabled??1)===1).map(a=>({value:String(a.id??a.sourceId),label:a.name??a.title??`Source ${a.id??a.sourceId}`})),[v]),N=s.useMemo(()=>(j||[]).map(a=>({value:String(a?.key||"").trim().toLowerCase(),label:String(a?.name||a?.key||"").trim(),count:Number(a?.count||0)})).filter(a=>!!a.value).sort((a,d)=>d.count-a.count),[j]),h=s.useMemo(()=>(B||[]).filter(a=>a&&a.id!=null&&a.isEnabled!==!1&&a.hasApiKey!==!1).map(a=>({value:String(a.id),label:a.name||a.title||`${String(a.type||"App").toLowerCase()} ${a.id}`})).sort((a,d)=>a.label.localeCompare(d.label,t?.uiLanguage||"fr-FR",{sensitivity:"base"})),[B,t?.uiLanguage]),b=(a,d)=>`indexer-card${a&&i.has(a)?" pulse-ok":""}${d?"":" is-disabled"}`;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"settings-card",id:"language",children:[e.jsx("div",{className:"settings-card__title",children:"Language"}),e.jsxs("div",{className:"indexer-list",children:[e.jsxs("div",{className:b("ui.mediaInfoLanguage",!0),children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Media Info Language"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("select",{value:t.mediaInfoLanguage||"fr-FR",onChange:a=>o(d=>({...d,mediaInfoLanguage:a.target.value})),children:Ns.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})})]}),e.jsx("div",{className:"settings-help",children:"Langue utilisee pour les infos media (TMDB: synopsis, titres, cast)."}),e.jsx("div",{className:"settings-help",style:{color:"#f59e0b"},children:"Rechargement du navigateur requis"})]}),e.jsxs("div",{className:b("ui.uiLanguage",!0),children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"UI Language"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("select",{value:t.uiLanguage||"fr-FR",onChange:a=>o(d=>({...d,uiLanguage:a.target.value})),children:Ns.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})})]}),e.jsx("div",{className:"settings-help",children:"Langue de l'interface (formatage dates/heures et preference UI)."}),e.jsx("div",{className:"settings-help",style:{color:"#f59e0b"},children:"Rechargement du navigateur requis"})]})]})]}),e.jsxs("div",{className:"settings-card",id:"theme",children:[e.jsx("div",{className:"settings-card__title",children:"Thème"}),e.jsx("div",{className:`indexer-card${i.has("ui.theme")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Apparence"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.theme||"light",onChange:a=>A(a.target.value),children:[e.jsx("option",{value:"system",children:"Système"}),e.jsx("option",{value:"light",children:"Clair"}),e.jsx("option",{value:"dark",children:"Sombre"})]})})]})})]}),e.jsxs("div",{className:"settings-card",id:"ui",children:[e.jsx("div",{className:"settings-card__title",children:"UI"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:b("ui.hideSeen",!!t.hideSeenByDefault),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:'Marquer "vu" par défaut'}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:t.hideSeenByDefault?"Actif":"Désactivé"}),e.jsx(_e,{checked:t.hideSeenByDefault,onIonChange:a=>o(d=>({...d,hideSeenByDefault:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:b("ui.showCategories",!!t.showCategories),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Afficher les catégories"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:t.showCategories?"Actif":"Désactivé"}),e.jsx(_e,{checked:t.showCategories,onIonChange:a=>o(d=>({...d,showCategories:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:b("ui.missingPosterView",!!t.enableMissingPosterView),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Activer Vue Sans poster"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:t.enableMissingPosterView?"Actif":"Désactivé"}),e.jsx(_e,{checked:t.enableMissingPosterView,onIonChange:a=>o(d=>({...d,enableMissingPosterView:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:b("ui.animations",!!t.animationsEnabled),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Animations de l'interface"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:t.animationsEnabled?"Actif":"Désactivé"}),e.jsx(_e,{checked:t.animationsEnabled,onIonChange:a=>o(d=>({...d,animationsEnabled:a.detail.checked})),className:"settings-toggle"})]})]})})]})]}),e.jsxs("div",{className:"settings-card",id:"logs",children:[e.jsx("div",{className:"settings-card__title",children:"Logs"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:b(null,!!t.badgeInfo),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Badge pour Info"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:t.badgeInfo?"Actif":"Désactivé"}),e.jsx(_e,{checked:t.badgeInfo,onIonChange:a=>o(d=>({...d,badgeInfo:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:b(null,!!t.badgeWarn),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Badge pour Warn"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:t.badgeWarn?"Actif":"Désactivé"}),e.jsx(_e,{checked:t.badgeWarn,onIonChange:a=>o(d=>({...d,badgeWarn:a.detail.checked})),className:"settings-toggle"})]})]})}),e.jsx("div",{className:b(null,!!t.badgeError),children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Badge pour Error"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:t.badgeError?"Actif":"Désactivé"}),e.jsx(_e,{checked:t.badgeError,onIonChange:a=>o(d=>({...d,badgeError:a.detail.checked})),className:"settings-toggle"})]})]})})]})]}),e.jsxs("div",{className:"settings-card",id:"defaults",children:[e.jsx("div",{className:"settings-card__title",children:"Bibliothèque"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:`indexer-card${i.has("ui.defaultSort")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Tri"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultSort||"date",onChange:a=>o(d=>({...d,defaultSort:a.target.value})),children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"seeders",children:"Seeders"}),e.jsx("option",{value:"downloads",children:"Téléchargé"})]})})]})}),e.jsx("div",{className:`indexer-card${i.has("ui.defaultView")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Vue"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultView||"grid",onChange:a=>o(d=>({...d,defaultView:a.target.value})),children:[e.jsx("option",{value:"grid",children:"Cartes"}),e.jsx("option",{value:"poster",children:"Poster"}),e.jsx("option",{value:"banner",children:"Banner"}),e.jsx("option",{value:"list",children:"Liste"})]})})]})}),e.jsx("div",{className:`indexer-card${i.has("ui.defaultLimit")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Limite"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultLimit??100,onChange:a=>{const d=a.target.value;o(x=>({...x,defaultLimit:d==="0"?0:Number(d)}))},children:[e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"}),e.jsx("option",{value:"200",children:"200"}),e.jsx("option",{value:"500",children:"500"}),e.jsx("option",{value:"0",children:"Tous"})]})})]})})]})]}),e.jsxs("div",{className:"settings-card",id:"filter-defaults",children:[e.jsx("div",{className:"settings-card__title",children:"Filtre"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:`indexer-card${i.has("ui.defaultMaxAgeDays")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Date"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultMaxAgeDays??"",onChange:a=>o(d=>({...d,defaultMaxAgeDays:a.target.value})),children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"1",children:"1 jour"}),e.jsx("option",{value:"2",children:"2 jours"}),e.jsx("option",{value:"3",children:"3 jours"}),e.jsx("option",{value:"7",children:"7 jours"}),e.jsx("option",{value:"15",children:"15 jours"}),e.jsx("option",{value:"30",children:"30 jours"})]})})]})}),e.jsx("div",{className:`indexer-card${i.has("ui.defaultFilterSourceId")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Source"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultFilterSourceId??"",onChange:a=>o(d=>({...d,defaultFilterSourceId:a.target.value})),children:[e.jsx("option",{value:"",children:"Toutes sources"}),P.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})})]})}),e.jsx("div",{className:`indexer-card${i.has("ui.defaultFilterCategoryId")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Catégorie"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultFilterCategoryId??"",onChange:a=>o(d=>({...d,defaultFilterCategoryId:a.target.value})),children:[e.jsx("option",{value:"",children:"Toutes catégories"}),N.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})})]})}),e.jsx("div",{className:`indexer-card${i.has("ui.defaultFilterApplication")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Application"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultFilterApplication??"",onChange:a=>o(d=>({...d,defaultFilterApplication:a.target.value})),children:[e.jsx("option",{value:"",children:"Toutes apps"}),e.jsx("option",{value:"__hide_apps__",children:"Masquer apps"}),h.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})})]})}),e.jsx("div",{className:`indexer-card${i.has("ui.defaultFilterSeen")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Vu"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultFilterSeen??"",onChange:a=>o(d=>({...d,defaultFilterSeen:a.target.value})),children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"1",children:"Vu"}),e.jsx("option",{value:"0",children:"Pas vu"})]})})]})}),e.jsx("div",{className:`indexer-card${i.has("ui.defaultFilterQuality")?" pulse-ok":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Qualité"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.defaultFilterQuality??"",onChange:a=>o(d=>({...d,defaultFilterQuality:a.target.value})),children:[e.jsx("option",{value:"",children:"Toutes qualités"}),st.map(a=>e.jsx("option",{value:a,children:a},a))]})})]})})]})]})]})}function at({controller:t,posterModalOpen:o,closePosterModal:i}){const{posterCount:A,missingPosterCount:v,releasesCount:k,retroActive:B,retroLoading:f,retroStopLoading:j,retroPercent:M,retroDone:P,retroTotal:N,handleRetroFetch:h,handleRetroFetchStop:b}=t;return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"externals",children:e.jsx(qs,{controller:t})}),e.jsx(xe,{open:o,title:"Posters",onClose:i,width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Posters locaux"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("span",{className:"indexer-status",children:A})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Posters manquants"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("span",{className:"indexer-status",children:Math.max(0,v||0)})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Pourcentage de matching"}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("span",{className:"indexer-status",children:[k>0?Math.round((k-(v||0))/k*100):0,"%"]})})]})})]}),e.jsxs("div",{style:{marginTop:16,display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{className:"muted",style:{fontSize:11,lineHeight:1.2,flex:1,minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Recherche des posters manquants via les providers configurés."}),B?e.jsx("button",{className:"btn btn-fixed-danger btn-nohover",type:"button",onClick:b,disabled:j,children:j?"Arrêt...":`Arrêter Retro Fetch (${M??0}% — ${P??0}/${N??0})`}):e.jsx("button",{className:"btn btn-hover-ok",type:"button",onClick:h,disabled:f,children:f?"Lancement...":"Retro Fetch"})]})]})})]})}function rt({arrApps:t,availableAddTypes:o,arrAppsLoading:i,arrTestingId:A,arrTestStatusById:v,arrSyncingId:k,arrSyncStatusById:B,arrSyncing:f,arrSyncSettings:j,arrSyncStatus:M,arrSyncSaving:P,arrRequestModeDraft:N,arrPulseKeys:h,isRequestModeDirty:b,hasEnabledArrApps:a,syncArrApp:d,testArrApp:x,openArrModalEdit:w,openArrDelete:y,toggleArrEnabled:Q,setArrSyncSettings:ee,setArrRequestModeDraft:_,saveArrSyncSettings:L,optionsModalOpen:g,closeOptionsModal:n,arrModalOpen:r,arrModalMode:p,arrModalApp:V,arrModalType:W,arrModalName:K,arrModalBaseUrl:$,arrModalApiKey:z,arrModalTesting:S,arrModalTested:C,arrModalError:q,arrModalSaving:R,arrModalAdvanced:Y,arrModalConfig:F,arrModalConfigLoading:H,arrModalAdvancedInitial:E,arrModalRootFolder:G,arrModalQualityProfile:D,arrModalSeriesType:ie,arrModalSeasonFolder:le,arrModalMonitorMode:I,arrModalSearchMissing:se,arrModalSearchCutoff:te,arrModalMinAvail:X,arrModalSearchForMovie:ce,setArrModalType:ue,setArrModalName:T,setArrModalBaseUrl:U,setArrModalApiKey:oe,setArrModalTested:ve,setArrModalError:$e,setArrModalRootFolder:Be,setArrModalQualityProfile:Ne,setArrModalSeriesType:Fe,setArrModalSeasonFolder:Ye,setArrModalMonitorMode:Ue,setArrModalSearchMissing:Ke,setArrModalSearchCutoff:He,setArrModalMinAvail:ts,setArrModalSearchForMovie:ae,setArrModalAdvanced:fe,setArrModalAdvancedInitial:We,closeArrModal:Ge,testArrModal:Pe,saveArrModal:De,arrDeleteOpen:Te,arrDeleteApp:Le,arrDeleteLoading:Ce,confirmArrDelete:Xe,closeArrDelete:Qe}){const rs=(t||[]).length>0,J=(o||[]).length===0,[je,pe]=s.useState(null),[re,ze]=s.useState(()=>new Set),de=s.useRef(null),qe=s.useRef(!1);s.useEffect(()=>{g&&!qe.current&&pe({arrAutoSyncEnabled:!!j.arrAutoSyncEnabled,arrSyncIntervalMinutes:Number(j.arrSyncIntervalMinutes??60)}),qe.current=g},[g,j.arrAutoSyncEnabled,j.arrSyncIntervalMinutes]),s.useEffect(()=>()=>{de.current&&clearTimeout(de.current)},[]);const be=s.useMemo(()=>je?!!j.arrAutoSyncEnabled!==je.arrAutoSyncEnabled||Number(j.arrSyncIntervalMinutes??60)!==je.arrSyncIntervalMinutes:!1,[j.arrAutoSyncEnabled,j.arrSyncIntervalMinutes,je]),Ae=b||be,we=l=>re.has(l)?" pulse-ok":"";async function as(){if(!Ae||P)return;const l=new Set;b&&l.add("arr.requestIntegrationMode"),je&&(!!j.arrAutoSyncEnabled!==je.arrAutoSyncEnabled&&l.add("arr.arrAutoSyncEnabled"),Number(j.arrSyncIntervalMinutes??60)!==je.arrSyncIntervalMinutes&&l.add("arr.arrSyncIntervalMinutes")),await L({...j,requestIntegrationMode:N}),l.size>0&&(de.current&&clearTimeout(de.current),ze(new Set(l)),de.current=setTimeout(()=>{ze(new Set)},1200)),pe({arrAutoSyncEnabled:!!j.arrAutoSyncEnabled,arrSyncIntervalMinutes:Number(j.arrSyncIntervalMinutes??60)})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"indexer-list itemrow-grid",children:i?e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:"Chargement..."})})}):t.length===0?e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:"Aucune application configurée"})})}):t.map((l,ne)=>{const me=vs(l.type),ye=v[l.id],Ve=B[l.id],ke=A===l.id,Ie=k===l.id||Ve==="pending",u=ke||Ie||f,he=[ye==="ok"&&"test-ok",ye==="error"&&"test-err",Ve==="ok"&&"sync-ok",Ve==="error"&&"sync-err"].filter(Boolean).join(" "),Ze=[{label:me},{label:l.hasApiKey?"API OK":"NO KEY",className:l.hasApiKey?"pill-ok":"pill-warn"}];return l.isDefault&&Ze.push({label:"Par défaut",className:"pill--accent"}),e.jsx(_s,{id:ne+1,title:l.name||me,meta:l.baseUrl||"",enabled:l.isEnabled,statusClass:he,badges:Ze,actions:[{icon:"sync",title:Ie?"Sync en cours...":"Sync",onClick:()=>d(l),disabled:u||!l.isEnabled,spinning:Ie},{icon:"science",title:ke?"Test en cours...":"Test",onClick:()=>x(l.id),disabled:u||!l.isEnabled,spinning:ke},{icon:"edit",title:"Modifier",onClick:()=>w(l),disabled:u||!l.isEnabled},{icon:"delete",title:"Supprimer",onClick:()=>y(l),disabled:u||!l.isEnabled,className:"iconbtn--danger"}],showToggle:!0,onToggle:()=>Q(l),toggleDisabled:u},l.id)})}),e.jsx(xe,{open:g,title:"Options applications",onClose:n,width:560,children:e.jsx("div",{style:{padding:12},children:rs?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"settings-card",id:"request-integration",children:[e.jsx("div",{className:"settings-card__title",children:"Mode d'envoi"}),e.jsx("div",{className:"indexer-list",children:e.jsx("div",{className:`indexer-card${h?.has("arr.requestIntegrationMode")?" pulse-ok":""}${we("arr.requestIntegrationMode")}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Intégration active"}),e.jsxs("div",{className:"indexer-actions",children:[b&&e.jsx("span",{className:"indexer-status",children:"À sauvegarder"}),e.jsxs("select",{value:N,onChange:l=>_(cs(l.target.value)),disabled:P,children:[e.jsx("option",{value:"arr",children:"Sonarr/Radarr"}),e.jsx("option",{value:"overseerr",children:"Overseerr"}),e.jsx("option",{value:"jellyseerr",children:"Jellyseerr"}),e.jsx("option",{value:"seer",children:"Seer"})]})]})]})})})]}),e.jsxs("div",{className:"settings-card",id:"arr-sync",style:{marginTop:16},children:[e.jsx("div",{className:"settings-card__title",children:"Synchronisation"}),e.jsxs("div",{className:"indexer-list",children:[e.jsx("div",{className:`indexer-card${we("arr.arrAutoSyncEnabled")}${a?"":" is-disabled"}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Synchronisation Automatique"}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:"indexer-status",children:j.arrAutoSyncEnabled?"Actif":"Desactive"}),e.jsx(_e,{checked:j.arrAutoSyncEnabled,onIonChange:l=>{const ne=l.detail.checked,me={...j,arrAutoSyncEnabled:ne};ee(me)},className:"settings-toggle",disabled:!a||P})]})]})}),e.jsx("div",{className:`indexer-card${we("arr.arrSyncIntervalMinutes")}${!a||!j.arrAutoSyncEnabled?" is-disabled":""}`,children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Intervalle Sync (minutes)"}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"number",min:1,max:1440,value:j.arrSyncIntervalMinutes,onChange:l=>{const ne=Math.max(1,Math.min(1440,Number(l.target.value)||10));ee(me=>({...me,arrSyncIntervalMinutes:ne}))},disabled:!j.arrAutoSyncEnabled||!a})})]})})]}),M.length>0&&e.jsxs("div",{className:"indexer-list",style:{marginTop:16},children:[e.jsx("div",{className:"settings-card__title",style:{fontSize:14,marginBottom:8},children:"État de synchronisation"}),M.map(l=>{const ne=!!l.lastError;let me="Jamais";if(l.lastSyncAt){const ye=new Date(l.lastSyncAt),Ve=new Date,ke=ye.toDateString()===Ve.toDateString(),Ie=ws(),u=ye.toLocaleTimeString(Ie,{hour:"2-digit",minute:"2-digit"});ke?me=u:me=`${ye.toLocaleDateString(Ie,{day:"2-digit",month:"2-digit"})} ${u}`}return e.jsxs("div",{className:`indexer-card ${l.isEnabled?"":"is-disabled"}`,children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:`dot ${ne?"warn":l.isEnabled?"ok":"off"}`}),e.jsxs("span",{className:"indexer-title",children:[l.appName||`App ${l.appId}`,e.jsxs("span",{className:"muted",style:{marginLeft:8,fontSize:12},children:["(",vs(l.appType),")"]})]}),e.jsxs("div",{className:"indexer-actions",children:[e.jsxs("span",{className:"indexer-url muted",children:["Dernier sync: ",me]}),l.lastSyncCount>0&&e.jsxs("span",{className:"pill",children:[l.lastSyncCount," ",Cs(l.appType)?"items":"demandes"]}),ne&&e.jsx("span",{className:"pill pill-warn",children:"Erreur"})]})]}),ne&&e.jsx("div",{className:"settings-help",style:{color:"var(--color-warn)"},children:l.lastError})]},l.appId)})]})]}),Ae&&e.jsx("div",{className:"formactions",style:{marginTop:16},children:e.jsx("button",{className:"btn btn-accent",type:"button",onClick:as,disabled:P,children:P?"Enregistrement...":"Enregistrer"})})]}):e.jsx("div",{className:"muted",children:"Aucune application configurée."})})}),e.jsx(xe,{open:r,title:p==="add"?"Ajouter une application":`Modifier : ${V?.name||V?.type||"Application"}`,onClose:Ge,width:560,children:e.jsxs("div",{style:{padding:12},children:[p==="add"&&e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Type"}),e.jsxs("select",{value:W,onChange:l=>{ue(l.target.value),ve(!1),$e("")},disabled:S||R,children:[J&&e.jsx("option",{value:"",children:"Aucun type disponible"}),(o||[]).map(l=>e.jsx("option",{value:l,children:vs(l)},l))]})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Nom (optionnel)"}),e.jsx("input",{type:"text",value:K,onChange:l=>T(l.target.value),placeholder:`Mon ${vs(W)}`,disabled:S||R})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"URL"}),e.jsx("input",{type:"text",value:$,onChange:l=>{U(l.target.value),ve(!1),$e("")},placeholder:Is(W),disabled:S||R}),e.jsx("span",{className:"field-hint",children:"IP, hostname ou URL reverse proxy (http/https)"})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsxs("label",{className:"muted",children:["Clé API",p==="edit"&&V?.hasApiKey&&e.jsx("span",{style:{fontStyle:"italic",marginLeft:6},children:"(laisser vide pour conserver)"})]}),e.jsx("input",{type:"password",value:z,onChange:l=>{oe(l.target.value),ve(!1),$e("")},placeholder:p==="edit"&&V?.hasApiKey?"••••••••••••••••":"Entrez la clé API",disabled:S||R})]}),q&&e.jsx("div",{className:"onboarding__error",style:{marginBottom:12},children:q}),C&&e.jsx("div",{className:"onboarding__ok",style:{marginBottom:12},children:"Connexion réussie ! Vous pouvez enregistrer."}),p==="add"&&!C&&e.jsx("div",{className:"muted",style:{marginBottom:12},children:J?"Toutes les applications sont déjà ajoutées.":"Testez d'abord la connexion avant d'enregistrer."}),e.jsxs("div",{className:"formactions",children:[p==="add"&&!C?e.jsx("button",{className:"btn btn-accent",type:"button",onClick:Pe,disabled:J||!$.trim()||!z.trim()||S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(os,{name:"progress_activity",className:"iconbtn--spin",size:16,style:{marginRight:6}}),"Test en cours..."]}):"Tester"}):e.jsxs(e.Fragment,{children:[Cs(W)&&e.jsx("button",{className:"btn",type:"button",onClick:()=>{We({rootFolder:G,qualityProfile:D,seriesType:ie,seasonFolder:le,monitorMode:I,searchMissing:se,searchCutoff:te,minAvail:X,searchForMovie:ce}),fe(!0)},disabled:R,children:"Options avancées"}),e.jsx("button",{className:"btn btn-accent",type:"button",onClick:De,disabled:R||!$.trim()||p==="add"&&(J||!z.trim()),children:R?e.jsxs(e.Fragment,{children:[e.jsx(os,{name:"progress_activity",className:"iconbtn--spin",size:16,style:{marginRight:6}}),"Enregistrement..."]}):"Enregistrer"})]}),e.jsx("button",{className:"btn",type:"button",onClick:Ge,disabled:S||R,children:"Annuler"})]})]})}),e.jsx(xe,{open:Y,title:"Options avancées",onClose:()=>fe(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[H?e.jsxs("div",{className:"muted",style:{textAlign:"center",padding:20},children:[e.jsx(os,{name:"progress_activity",className:"iconbtn--spin",size:24}),e.jsx("div",{style:{marginTop:8},children:"Chargement de la configuration..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Dossier racine"}),F?.rootFolders?.length>0?e.jsxs("select",{value:G,onChange:l=>Be(l.target.value),children:[e.jsx("option",{value:"",children:"-- Sélectionner --"}),F.rootFolders.map(l=>e.jsxs("option",{value:l.path,children:[l.path," (",Ss(l.freeSpace)," libre)"]},l.id))]}):e.jsx("input",{type:"text",value:G,onChange:l=>Be(l.target.value),placeholder:"/media/series"})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Profil qualité"}),F?.qualityProfiles?.length>0?e.jsxs("select",{value:D,onChange:l=>Ne(l.target.value),children:[e.jsx("option",{value:"",children:"-- Sélectionner --"}),F.qualityProfiles.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}):e.jsx("input",{type:"number",value:D,onChange:l=>Ne(l.target.value),placeholder:"ID du profil"})]}),W==="sonarr"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Type de série"}),e.jsxs("select",{value:ie,onChange:l=>Fe(l.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"anime",children:"Anime"})]})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Mode de surveillance"}),e.jsxs("select",{value:I,onChange:l=>Ue(l.target.value),children:[e.jsx("option",{value:"all",children:"Tous les épisodes"}),e.jsx("option",{value:"future",children:"Futurs épisodes"}),e.jsx("option",{value:"missing",children:"Épisodes manquants"}),e.jsx("option",{value:"existing",children:"Épisodes existants"}),e.jsx("option",{value:"firstSeason",children:"Première saison"}),e.jsx("option",{value:"lastSeason",children:"Dernière saison"}),e.jsx("option",{value:"pilot",children:"Pilote"}),e.jsx("option",{value:"none",children:"Aucun"})]})]}),e.jsx("div",{className:"indexer-card",style:{marginBottom:8},children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Dossiers par saison"}),e.jsx("div",{className:"indexer-actions",children:e.jsx(_e,{checked:le,onIonChange:l=>Ye(l.detail.checked),className:"settings-toggle"})})]})}),e.jsx("div",{className:"indexer-card",style:{marginBottom:8},children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Rechercher épisodes manquants"}),e.jsx("div",{className:"indexer-actions",children:e.jsx(_e,{checked:se,onIonChange:l=>Ke(l.detail.checked),className:"settings-toggle"})})]})}),e.jsx("div",{className:"indexer-card",style:{marginBottom:8},children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Rechercher cutoff non atteint"}),e.jsx("div",{className:"indexer-actions",children:e.jsx(_e,{checked:te,onIonChange:l=>He(l.detail.checked),className:"settings-toggle"})})]})})]}),W==="radarr"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",children:"Disponibilité minimale"}),e.jsxs("select",{value:X,onChange:l=>ts(l.target.value),children:[e.jsx("option",{value:"announced",children:"Annoncé"}),e.jsx("option",{value:"inCinemas",children:"En salle"}),e.jsx("option",{value:"released",children:"Sorti"})]})]}),e.jsx("div",{className:"indexer-card",style:{marginBottom:8},children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:"Rechercher le film à l'ajout"}),e.jsx("div",{className:"indexer-actions",children:e.jsx(_e,{checked:ce,onIonChange:l=>ae(l.detail.checked),className:"settings-toggle"})})]})})]})]}),e.jsxs("div",{className:"formactions",style:{marginTop:16},children:[e.jsx("button",{className:"btn btn-accent",type:"button",onClick:()=>fe(!1),disabled:E&&G===E.rootFolder&&D===E.qualityProfile&&ie===E.seriesType&&le===E.seasonFolder&&I===E.monitorMode&&se===E.searchMissing&&te===E.searchCutoff&&X===E.minAvail&&ce===E.searchForMovie,children:"Enregistrer"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>{E&&(Be(E.rootFolder),Ne(E.qualityProfile),Fe(E.seriesType),Ye(E.seasonFolder),Ue(E.monitorMode),Ke(E.searchMissing),He(E.searchCutoff),ts(E.minAvail),ae(E.searchForMovie)),fe(!1)},children:"Retour"})]})]})}),e.jsx(xe,{open:Te,title:"Supprimer l'application",onClose:Qe,width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer la suppression ?"}),e.jsxs("div",{className:"muted",style:{marginBottom:12},children:["Cette action va supprimer l'application"," ",e.jsx("strong",{children:Le?.name||Le?.type||"-"}),".",e.jsx("br",{}),"Cette action est définitive."]}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn btn-danger",type:"button",onClick:Xe,disabled:Ce,children:Ce?"Suppression...":"Supprimer"}),e.jsx("button",{className:"btn",type:"button",onClick:Qe,disabled:Ce,children:"Annuler"})]})]})})]})}function nt(t){if(!t||t<=0)return"0s";const o=Math.floor(t/86400),i=Math.floor(t%86400/3600),A=Math.floor(t%3600/60);return o>0?`${o}j ${i}h ${A}m`:i>0?`${i}h ${A}m`:`${A}m`}function ss(){return e.jsx(os,{name:"progress_activity",className:"iconbtn--spin",size:14,style:{marginRight:6,verticalAlign:"middle"}})}function fs({label:t,description:o,buttonLabel:i,loadingLabel:A,loading:v,disabled:k,onClick:B,result:f}){return e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsxs("div",{children:[e.jsx("span",{className:"indexer-title",children:t}),o&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:2},children:o}),f&&e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:4,color:"var(--success, #4caf50)"},children:f})]}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("button",{className:"btn",type:"button",onClick:B,disabled:v||k,children:[v&&e.jsx(ss,{}),v?A||"...":i||"Exécuter"]})})]})})}function it({clearCacheOpen:t,clearCacheLoading:o,setClearCacheOpen:i,handleClearCache:A,purgeSelectiveOpen:v,setPurgeSelectiveOpen:k,purgeSelectiveLoading:B,purgeScope:f,setPurgeScope:j,purgeOlderThanDays:M,setPurgeOlderThanDays:P,purgeSelectiveResult:N,handlePurgeSelective:h,vacuumOpen:b,setVacuumOpen:a,vacuumLoading:d,vacuumResult:x,handleVacuum:w,stats:y,statsLoading:Q,cleanupPostersOpen:ee,setCleanupPostersOpen:_,cleanupPostersLoading:L,cleanupPostersResult:g,handleCleanupPosters:n,testProvidersLoading:r,testProvidersResults:p,handleTestProviders:V,reparseOpen:W,setReparseOpen:K,reparseLoading:$,reparseResult:z,handleReparse:S,duplicatesLoading:C,duplicatesResult:q,handleDetectDuplicates:R,duplicatesPurgeOpen:Y,setDuplicatesPurgeOpen:F,duplicatesPurgeLoading:H,handlePurgeDuplicates:E}){const G=o||B||d||L||r||$||C||H;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"settings-card settings-card--full",id:"maintenance",children:[e.jsx("div",{className:"settings-card__title",children:"Actions de maintenance"}),e.jsx(fs,{label:"Supprimer tous les posters en cache",description:"Supprime tous les posters téléchargés localement",loading:o,loadingLabel:"Suppression...",onClick:()=>i(!0),disabled:G||y&&y.posterCount===0}),e.jsx(fs,{label:"Purger logs",description:"Supprime les logs d'activité (tous, historique ou logs uniquement)",loading:B,loadingLabel:"Suppression...",onClick:()=>k(!0),disabled:G||y&&y.activityCount===0,result:N?.deleted>=0?`${N.deleted} entrées supprimées`:null}),e.jsx(fs,{label:"Optimiser la base de données",description:"Compacte la base SQLite (VACUUM) pour récupérer de l'espace",loading:d,loadingLabel:"Optimisation...",onClick:()=>a(!0),disabled:G,result:x?`${x.dbSizeBefore} MB → ${x.dbSizeAfter} MB (${x.savedMB} MB récupérés)`:null}),e.jsx(fs,{label:"Nettoyer posters orphelins",description:"Supprime les fichiers de posters non référencés en base",loading:L,loadingLabel:"Nettoyage...",onClick:()=>_(!0),disabled:G||y&&y.orphanedPosterCount===0,result:g?`${g.deleted} supprimés / ${g.scanned} scannés (${Ss(g.freedBytes)||"0 B"} libérés)`:null}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsxs("div",{children:[e.jsx("span",{className:"indexer-title",children:"Tester connectivité providers"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:2},children:"Vérifie la connexion TMDB, TvMaze, Fanart, IGDB"}),p&&e.jsx("div",{style:{marginTop:6,display:"flex",gap:12,flexWrap:"wrap"},children:p.map(D=>e.jsxs("span",{style:{fontSize:12,padding:"2px 8px",borderRadius:4,background:D.ok?"var(--success-bg, rgba(76,175,80,0.15))":"var(--danger-bg, rgba(244,67,54,0.15))",color:D.ok?"var(--success, #4caf50)":"var(--danger, #f44336)"},children:[D.provider.toUpperCase()," ",D.ok?"OK":"ERREUR"," (",D.elapsedMs,"ms)"]},D.provider))})]}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("button",{className:"btn",type:"button",onClick:V,disabled:r||G,children:[r&&e.jsx(ss,{}),r?"Test...":"Tester"]})})]})}),e.jsx(fs,{label:"Re-parser les titres",description:"Recalcule les métadonnées de toutes les releases (titre, saison, résolution...)",loading:$,loadingLabel:"Re-parsing...",onClick:()=>K(!0),disabled:G||y&&y.releasesCount===0,result:z?`${z.updated} / ${z.total} releases mises à jour`:null}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsxs("div",{children:[e.jsx("span",{className:"indexer-title",children:"Détecter les doublons"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginTop:2},children:"Identifie et supprime les releases en double par source"}),q&&!q.purged&&e.jsxs("div",{className:"muted",style:{fontSize:12,marginTop:4,color:"var(--warning, #ff9800)"},children:[q.groupsFound," groupes, ",q.duplicatesCount," doublons détectés"]}),q?.purged&&e.jsxs("div",{className:"muted",style:{fontSize:12,marginTop:4,color:"var(--success, #4caf50)"},children:[q.deleted," doublons supprimés"]})]}),e.jsxs("div",{className:"indexer-actions",style:{display:"flex",gap:6},children:[e.jsxs("button",{className:"btn",type:"button",onClick:R,disabled:C||G,children:[C&&e.jsx(ss,{}),C?"Analyse...":"Analyser"]}),q&&q.duplicatesCount>0&&!q.purged&&e.jsx("button",{className:"btn btn-danger",type:"button",onClick:()=>F(!0),disabled:H||G,children:"Purger"})]})]})})]}),e.jsxs("div",{className:"settings-card settings-card--full",id:"maintenance-stats",children:[e.jsx("div",{className:"settings-card__title",children:"Statistiques"}),Q&&e.jsx("div",{className:"muted",style:{padding:"8px 0"},children:"Chargement..."}),!Q&&y&&e.jsxs("div",{className:"stats-table table",children:[e.jsxs("div",{className:"thead",children:[e.jsx("div",{className:"th",children:"Métrique"}),e.jsx("div",{className:"th td-value",children:"Valeur"})]}),[["Releases en base",y.releasesCount?.toLocaleString()??"—"],["Sources",`${y.activeSourcesCount??0} actives / ${y.sourcesCount??0} total`],["Taille base de données",`${y.dbSizeMB??0} MB`],["Posters en cache",`${y.posterCount??0} (${y.posterSizeMB??0} MB)`],["Posters manquants",y.missingPosterCount?.toLocaleString()??"0"],["Posters orphelins",y.orphanedPosterCount?.toLocaleString()??"0"],["Cache de matching",`${y.matchCacheCount?.toLocaleString()??0} entrées`],["Entités média",y.mediaEntityCount?.toLocaleString()??"0"],["Doublons détectés",y.duplicateCount?.toLocaleString()??"0"],["Logs d'activité",y.activityCount?.toLocaleString()??"0"],["Uptime serveur",nt(y.uptimeSeconds)]].map(([D,ie])=>e.jsxs("div",{className:"trow",children:[e.jsx("div",{className:"td",children:D}),e.jsx("div",{className:"td td-value",children:ie})]},D)),y.releasesPerCategory?.length>0&&e.jsxs("div",{className:"trow",children:[e.jsx("div",{className:"td",children:"Par catégorie"}),e.jsx("div",{className:"td td-categories",children:y.releasesPerCategory.map(D=>e.jsxs("span",{className:"cat-bubble",children:[D.category,": ",D.count]},D.category))})]})]})]}),e.jsx(xe,{open:t,title:"Supprimer tous les posters en cache",onClose:()=>i(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer la suppression ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action va supprimer tous les posters téléchargés localement. Elle ne nettoie pas uniquement les orphelins. Ils seront re-téléchargés automatiquement lors du prochain affichage."}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-danger",type:"button",onClick:A,disabled:o,children:[o&&e.jsx(ss,{}),o?"Suppression...":"Confirmer"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>i(!1),disabled:o,children:"Annuler"})]})]})}),e.jsx(xe,{open:v,title:"Purger les logs",onClose:()=>k(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Options de purge"}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",style:{display:"block",marginBottom:4},children:"Scope"}),e.jsxs("select",{value:f,onChange:D=>j(D.target.value),style:{width:"100%"},children:[e.jsx("option",{value:"all",children:"Tous les logs"}),e.jsx("option",{value:"history",children:"Historique (sync uniquement)"}),e.jsx("option",{value:"logs",children:"Logs (hors sync)"})]})]}),e.jsxs("div",{className:"field",style:{marginBottom:12},children:[e.jsx("label",{className:"muted",style:{display:"block",marginBottom:4},children:"Plus vieux que (jours) — laisser vide pour tout supprimer"}),e.jsx("input",{type:"number",min:"1",placeholder:"ex: 30",value:M,onChange:D=>P(D.target.value),style:{width:"100%"}})]}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-danger",type:"button",onClick:h,disabled:B,children:[B&&e.jsx(ss,{}),B?"Suppression...":"Purger"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>k(!1),disabled:B,children:"Annuler"})]})]})}),e.jsx(xe,{open:b,title:"Optimiser la base de données",onClose:()=>a(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer l'optimisation ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action exécute un VACUUM SQLite pour compacter la base de données et récupérer l'espace disque. L'opération peut prendre quelques secondes."}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-accent",type:"button",onClick:w,disabled:d,children:[d&&e.jsx(ss,{}),d?"Optimisation...":"Confirmer"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>a(!1),disabled:d,children:"Annuler"})]})]})}),e.jsx(xe,{open:ee,title:"Nettoyer les posters orphelins",onClose:()=>_(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer le nettoyage ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action va scanner le dossier de posters et supprimer les fichiers qui ne sont plus référencés par aucune release en base. Cette action est définitive."}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-danger",type:"button",onClick:n,disabled:L,children:[L&&e.jsx(ss,{}),L?"Nettoyage...":"Confirmer"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>_(!1),disabled:L,children:"Annuler"})]})]})}),e.jsx(xe,{open:W,title:"Re-parser les titres",onClose:()=>K(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer le re-parsing ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action va re-parser tous les titres de releases pour recalculer les métadonnées (titre nettoyé, saison, épisode, résolution, codec, etc.). Utile après une mise à jour du parser. L'opération peut prendre un moment selon le nombre de releases."}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-accent",type:"button",onClick:S,disabled:$,children:[$&&e.jsx(ss,{}),$?"Re-parsing...":"Confirmer"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>K(!1),disabled:$,children:"Annuler"})]})]})}),e.jsx(xe,{open:Y,title:"Purger les doublons",onClose:()=>F(!1),width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Confirmer la suppression des doublons ?"}),e.jsxs("div",{className:"muted",style:{marginBottom:12},children:["Cette action va supprimer ",q?.duplicatesCount??0," releases en double. Pour chaque groupe de doublons, seule la release la plus récente sera conservée. Cette action est définitive."]}),e.jsxs("div",{className:"formactions",children:[e.jsxs("button",{className:"btn btn-danger",type:"button",onClick:E,disabled:H,children:[H&&e.jsx(ss,{}),H?"Suppression...":"Purger"]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>F(!1),disabled:H,children:"Annuler"})]})]})})]})}function bs({icon:t,title:o,onClick:i,disabled:A,className:v,spinning:k}){return e.jsx("button",{className:`iconbtn${v?` ${v}`:""}${k?" iconbtn--spin":""}`,onClick:i,disabled:A,title:o,style:{flexShrink:0},children:e.jsx(os,{name:k?"progress_activity":t})})}function lt({backupCreateOpen:t,backupCreateLoading:o,backups:i,backupsLoading:A,backupDownloadName:v,backupRestoreOpen:k,backupRestoreTarget:B,backupRestoreLoading:f,backupDeleteOpen:j,backupDeleteTarget:M,backupDeleteLoading:P,backupError:N,backupNotice:h,backupState:b,closeBackupCreate:a,handleBackupCreate:d,handleBackupDownload:x,openBackupRestore:w,closeBackupRestore:y,handleBackupRestore:Q,openBackupDelete:ee,closeBackupDelete:_,handleBackupDelete:L}){const g=!!b?.isBusy,n=!!b?.needsRestart,r=n||g||o||f||P||!!v;return e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"onboarding__error",style:{marginBottom:12,gridColumn:"1 / -1"},children:N}),h&&e.jsx("div",{className:"onboarding__ok",style:{marginBottom:12,gridColumn:"1 / -1"},children:h}),n&&e.jsx("div",{className:"onboarding__warn",style:{marginBottom:12,gridColumn:"1 / -1"},children:"Redemarrage requis apres restauration. Les actions de sauvegarde sont verrouillees jusqu'au redemarrage."}),g&&e.jsxs("div",{className:"onboarding__warn",style:{marginBottom:12,gridColumn:"1 / -1"},children:["Opération en cours: ",e.jsx("strong",{children:b?.operation||"backup"})," (",b?.phase||"running","). Les actions de sauvegarde sont temporairement verrouillées."]}),e.jsx("div",{className:"indexer-list",style:{gridColumn:"1 / -1"},children:A?e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:"Chargement..."})})}):i.length===0?e.jsx("div",{className:"indexer-card",children:e.jsx("div",{className:"indexer-row",children:e.jsx("span",{className:"indexer-url muted",children:"Aucune sauvegarde présente"})})}):i.map((p,V)=>{const W=Ss(p?.sizeBytes??p?.size_bytes??0)||"-",K=$s(p?.createdAtTs??p?.created_at_ts??0)||"-",$=v===p.name;return e.jsxs("div",{className:"settings-rowcard settings-rowcard--backup",children:[e.jsx("span",{className:"backup-row__dot"}),e.jsx("span",{className:"backup-row__idx",children:V+1}),e.jsx("span",{className:"backup-row__name",title:p.name,children:p.name}),e.jsxs("div",{className:"backup-row__meta",children:[e.jsx("span",{className:"pill pill-muted",children:W}),e.jsx("span",{className:"pill pill-muted",children:K})]}),e.jsxs("div",{className:"backup-row__actions",children:[e.jsx(bs,{icon:"download",title:$?"Téléchargement...":"Télécharger",onClick:()=>x(p.name),disabled:r,spinning:$}),e.jsx(bs,{icon:"restore",title:"Restaurer",onClick:()=>w(p),disabled:r,className:"iconbtn--warn"}),e.jsx(bs,{icon:"delete",title:"Supprimer",onClick:()=>ee(p),disabled:r,className:"iconbtn--danger"})]})]},p.name)})}),e.jsx(xe,{open:t,title:"Nouvelle sauvegarde",onClose:a,width:520,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Créer une nouvelle sauvegarde ?"}),e.jsx("div",{className:"muted",style:{marginBottom:12},children:"Cette action crée une archive ZIP locale contenant la base de données et les métadonnées de configuration (sans exposer les secrets en clair dans `config.json`)."}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn btn-accent",type:"button",onClick:d,disabled:o||r,children:o?"Sauvegarde...":"Créer"}),e.jsx("button",{className:"btn",type:"button",onClick:a,disabled:o,children:"Annuler"})]})]})}),e.jsx(xe,{open:k,title:"Restaurer une sauvegarde",onClose:y,width:640,children:e.jsxs("div",{className:"backup-confirm-modal__content",children:[e.jsx("div",{className:"backup-confirm-modal__lead",children:"Confirmer la restauration ?"}),e.jsxs("div",{className:"muted backup-confirm-modal__text",children:["Cette action remplace la base actuelle par la sauvegarde :",e.jsx("strong",{className:"backup-confirm-modal__name",children:B?.name||"-"}),"Un redémarrage de l'application sera requis après restauration."]}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn btn-danger",type:"button",onClick:Q,disabled:f||r,children:f?"Restauration...":"Restaurer"}),e.jsx("button",{className:"btn",type:"button",onClick:y,disabled:f,children:"Annuler"})]})]})}),e.jsx(xe,{open:j,title:"Supprimer une sauvegarde",onClose:_,width:640,children:e.jsxs("div",{className:"backup-confirm-modal__content",children:[e.jsx("div",{className:"backup-confirm-modal__lead",children:"Confirmer la suppression ?"}),e.jsxs("div",{className:"muted backup-confirm-modal__text",children:["Cette action va supprimer la sauvegarde :",e.jsx("strong",{className:"backup-confirm-modal__name",children:M?.name||"-"}),"Cette action est définitive."]}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn btn-danger",type:"button",onClick:L,disabled:P||r,children:P?"Suppression...":"Supprimer"}),e.jsx("button",{className:"btn",type:"button",onClick:_,disabled:P,children:"Annuler"})]})]})})]})}const As={error:"error",warning:"warning",info:"lock",success:"check_circle"};function ct({variant:t="info",title:o="",message:i=""}){if(!i)return null;const A=As[t]||As.info;return e.jsxs("div",{className:`inline-notice inline-notice--${t}`,role:"status","aria-live":"polite",children:[e.jsx("span",{className:"inline-notice__icon","aria-hidden":"true",children:e.jsx(os,{name:A,size:16})}),e.jsxs("div",{className:"inline-notice__content",children:[!!o&&e.jsx("div",{className:"inline-notice__title",children:o}),e.jsx("div",{className:"inline-notice__message",children:i})]})]})}function ot({security:t,setSecurity:o,securityErrors:i,securityMessage:A,passwordMessage:v,showExistingCredentialsHint:k,credentialsRequiredForMode:B,effectiveAuthRequired:f,usernameRequired:j,passwordRequired:M,confirmRequired:P,usernameFieldState:N,passwordFieldState:h,confirmFieldState:b}){const a=s.useRef(null),d=s.useRef(null),x=js(),w=x("settings.security.notice.credsRequired"),y=x("settings.security.notice.credsExisting"),Q=s.useRef({username:"",password:"",confirm:""}),ee=s.useRef(null),[_,L]=s.useState(()=>new Set);s.useEffect(()=>()=>{ee.current&&clearTimeout(ee.current)},[]),s.useEffect(()=>{if(i.includes("username")){a.current?.focus();return}i.includes("password")&&d.current?.focus()},[i]),s.useEffect(()=>{const S={username:i.includes("username")?"error":N,password:i.includes("password")?"error":h,confirm:i.includes("passwordConfirmation")?"error":b},C=[];for(const q of Object.keys(S)){const R=Q.current[q],Y=S[q];Y&&Y!==R&&C.push(q)}Q.current=S,C.length>0&&(ee.current&&clearTimeout(ee.current),L(new Set(C)),ee.current=setTimeout(()=>{L(new Set)},850))},[i,N,h,b]);const g=(S,C)=>{const q=C==="error"||C==="valid"?C:"";let R="fieldWrap";return q==="error"&&(R+=" fieldWrap--error"),q==="valid"&&(R+=" fieldWrap--valid"),_.has(S)&&(R+=" fieldWrap--pulse"),R},n=String(v||A||"").trim(),r=n.toLowerCase(),p=B&&!t.authConfigured,V=w.toLowerCase(),$=r.includes(V)||r.includes("credentials required")||r.includes("identifiants requis"),z=[];return p&&z.push({key:"warn-required",variant:"warning",message:w}),n&&(p&&($||n===w)||z.push({key:"security-message",variant:$?"warning":"error",message:n})),k&&z.push({key:"info-existing",variant:"info",message:y}),e.jsxs("div",{className:"settings-card",id:"security",children:[e.jsx("div",{className:"settings-card__title",children:x("settings.security.title")}),e.jsxs("div",{className:"indexer-list",children:[e.jsxs("div",{className:"indexer-card",children:[e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:x("settings.security.authMode")}),e.jsx("div",{className:"indexer-actions",children:e.jsxs("select",{value:t.authMode,onChange:S=>o(C=>({...C,authMode:S.target.value})),children:[e.jsx("option",{value:"smart",children:x("settings.security.authMode.smart")}),e.jsx("option",{value:"strict",children:x("settings.security.authMode.strict")}),e.jsx("option",{value:"open",children:x("settings.security.authMode.none")})]})})]}),e.jsx("div",{className:"settings-help",children:x("settings.security.help.smartExposure")})]}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:x("settings.security.publicBaseUrl")}),e.jsx("div",{className:"indexer-actions",children:e.jsx("input",{type:"text",value:t.publicBaseUrl||"",onChange:S=>o(C=>({...C,publicBaseUrl:S.target.value})),placeholder:"https://example.com/feedarr"})})]})}),t.authMode!=="open"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:x("settings.security.status")}),e.jsxs("div",{className:"indexer-actions",children:[e.jsx("span",{className:`pill ${t.authConfigured?"pill-ok":"pill-warn"}`,children:t.authConfigured?x("settings.security.status.configured"):x("settings.security.status.notConfigured")}),e.jsx("span",{className:`pill ${f?"pill-warn":"pill-blue"}`,children:x(f?"settings.security.status.authRequired":"settings.security.status.authNotRequired")})]})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:x("settings.security.username")}),e.jsx("div",{className:"indexer-actions",children:e.jsx("div",{className:g("username",i.includes("username")?"error":N),children:e.jsx("input",{ref:a,type:"text",value:t.username,onChange:S=>o(C=>({...C,username:S.target.value})),required:j,placeholder:x("settings.security.username.placeholder")})})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:x("settings.security.password")}),e.jsx("div",{className:"indexer-actions",children:e.jsx("div",{className:g("password",i.includes("password")?"error":h),children:e.jsx("input",{ref:d,type:"password",value:t.password,onChange:S=>o(C=>({...C,password:S.target.value})),required:M,placeholder:t.hasPassword?x("settings.security.password.placeholderKeepCurrent"):x("settings.security.password.placeholderEnter")})})})]})}),e.jsx("div",{className:"indexer-card",children:e.jsxs("div",{className:"indexer-row indexer-row--settings",children:[e.jsx("span",{className:"indexer-title",children:x("settings.security.confirm")}),e.jsx("div",{className:"indexer-actions",children:e.jsx("div",{className:g("confirm",i.includes("passwordConfirmation")?"error":b),children:e.jsx("input",{type:"password",value:t.passwordConfirmation,onChange:S=>o(C=>({...C,passwordConfirmation:S.target.value})),required:P,placeholder:x("settings.security.confirm.placeholder")})})})]})})]})]}),z.length>0&&e.jsx("div",{className:"security-notices",children:z.slice(0,3).map(S=>e.jsx(ct,{variant:S.variant,message:S.message},S.key))})]})}function St(){const t=js(),o=Ps(),A=Fs().pathname.split("/")[2]||"general",v=Zs(A),{settingsTitle:k,loading:B,err:f,showGeneral:j,showUi:M,showExternals:P,showApplications:N,showMaintenance:h,showBackup:b,showUsers:a,handleRefresh:d,handleSave:x,saveState:w,securityDowngradeModalOpen:y,closeSecurityDowngradeModal:Q,confirmSecurityDowngradeSave:ee,isDirty:_,isSaveBlocked:L,openArrModalAdd:g,canAddArrApp:n,openExternalModalAdd:r,canAddExternalProvider:p,triggerArrSync:V,arrSyncing:W,hasEnabledArrApps:K,general:$,ui:z,providers:S,applications:C,maintenance:q,backup:R,users:Y}=v,F=s.useRef(null),H=s.useRef(null),E=s.useRef(null),G=s.useRef(null);F.current=R?.openBackupCreate,H.current=x,E.current=g,G.current=r;const[D,ie]=s.useState(!1),[le,I]=s.useState(!1),[se,te]=s.useState(!1),X=!!R?.backupState?.isBusy||!!R?.backupState?.needsRestart,ce=R?.backupState?.needsRestart?"Redemarrage requis apres restauration":"Operation de sauvegarde en cours";return s.useEffect(()=>{N||I(!1)},[N]),s.useEffect(()=>(o(e.jsxs("div",{className:"settings-subbar-content",subbarClassName:N?"subbar--settings-apps-sync":"",children:[e.jsx(es,{icon:"refresh",label:"Rafraîchir",onClick:d}),N&&e.jsxs(e.Fragment,{children:[e.jsx(es,{icon:"add_circle",label:"Ajouter",onClick:()=>E.current?.(),disabled:!n,title:n?"Ajouter":"Toutes les applications sont déjà ajoutées"}),e.jsx(es,{icon:"settings",label:"Options",onClick:()=>I(!0)})]}),b&&e.jsx(es,{icon:"add_circle",label:"Ajouter",onClick:()=>F.current?.(),disabled:X,title:X?ce:"Ajouter"}),!h&&!b&&!P&&!N&&e.jsx(es,{icon:w==="loading"?"progress_activity":w==="success"?"check_circle":w==="error"?"cancel":"save",label:"Enregistrer",onClick:()=>H.current?.(),disabled:w==="loading"||!_||L,className:w==="loading"?"is-loading":w==="success"?"is-success":w==="error"?"is-error":""}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"subspacer"}),e.jsx(es,{icon:"info",label:t("settings.security.subbar.info"),onClick:()=>te(!0)})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"subspacer"}),e.jsx(es,{icon:W?"progress_activity":"sync",label:"Sync all",onClick:V,disabled:!K||W,title:K?"Sync all":"Aucune application active",className:W?"is-loading":void 0})]}),P&&e.jsxs(e.Fragment,{children:[e.jsx(es,{icon:"add_circle",label:"Ajouter",onClick:()=>G.current?.(),disabled:!p,title:p?"Ajouter":"Aucun provider disponible"}),e.jsx(es,{icon:"settings",label:"Options",onClick:()=>ie(!0)})]})]})),()=>o(null)),[o,d,N,h,b,P,w,_,L,n,V,W,K,p,X,ce,a]),e.jsxs("div",{className:"page page--settings",children:[e.jsx("div",{className:"pagehead",children:e.jsxs("div",{children:[e.jsx("h1",{children:k}),e.jsx("div",{className:"muted",children:"Configuration de l'application"})]})}),e.jsx("div",{className:"pagehead__divider"}),B&&e.jsx(Ds,{label:"Chargement des paramètres…"}),!B&&f&&e.jsxs("div",{className:"errorbox",children:[e.jsx("div",{className:"errorbox__title",children:"Erreur"}),e.jsx("div",{className:"muted",children:f})]}),!B&&!f&&e.jsxs("div",{className:"settings-grid",children:[j&&e.jsx(et,{...$}),M&&e.jsx(tt,{...z}),P&&e.jsx(at,{controller:S,posterModalOpen:D,closePosterModal:()=>ie(!1)}),N&&e.jsx(rt,{...C,optionsModalOpen:le,closeOptionsModal:()=>I(!1)}),h&&e.jsx(it,{...q}),b&&e.jsx(lt,{...R}),a&&e.jsx(ot,{...Y})]}),e.jsx(xe,{open:y,title:t("settings.security.modal.disableAuth.title"),onClose:Q,width:560,children:e.jsxs("div",{style:{padding:12},children:[e.jsx("div",{className:"muted",style:{marginBottom:12},children:t("settings.security.modal.disableAuth.message")}),e.jsxs("div",{className:"formactions",children:[e.jsx("button",{className:"btn",type:"button",onClick:Q,disabled:w==="loading",children:t("settings.security.modal.cancel")}),e.jsx("button",{className:"btn btn-danger",type:"button",onClick:ee,disabled:w==="loading",children:t("settings.security.modal.confirm")})]})]})}),e.jsx(xe,{open:se,title:t("settings.security.infoModal.title"),onClose:()=>te(!1),width:640,children:e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:t("settings.security.infoModal.none.title")}),e.jsx("div",{className:"muted",children:t("settings.security.infoModal.none.description")})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:t("settings.security.infoModal.smart.title")}),e.jsx("div",{className:"muted",children:t("settings.security.infoModal.smart.description")})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:t("settings.security.infoModal.strict.title")}),e.jsx("div",{className:"muted",children:t("settings.security.infoModal.strict.description")})]}),e.jsx("div",{className:"muted",style:{fontStyle:"italic"},children:t("settings.security.infoModal.note")}),e.jsx("div",{className:"formactions",children:e.jsx("button",{className:"btn",type:"button",onClick:()=>te(!1),children:t("settings.security.infoModal.close")})})]})})]})}export{St as default};
